document.addEventListener("DOMContentLoaded",(function(){RightMenu.init(),volantis.pjax.send((()=>{RightMenu.hideMenu()}))}));const RightMenu=(()=>{const e={},t=document.getElementById("rightmenu-wrapper"),n=document.getElementById("rightmenu-content"),o=document.getElementById("printHtml"),i=document.getElementById("menuMusic"),a=document.getElementById("readingModel"),l=document.getElementById("menuLoad"),r=document.getElementById("read_bkg"),s=document.querySelector(".menu-Option"),c=document.querySelector('.menu-Option[data-fn-type="copyText"]'),d=document.querySelector('.menu-Option[data-fn-type="copyPaste"]'),m=document.querySelector('.menu-Option[data-fn-type="copySelect"]'),u=document.querySelector('.menu-Option[data-fn-type="copyCut"]'),g=document.querySelector('.menu-Option[data-fn-type="copyHref"]'),p=document.querySelector('.menu-Option[data-fn-type="copySrc"]'),h=document.querySelector('.menu-Option[data-fn-type="copyImg"]'),v=document.querySelector('.menu-Option[data-fn-type="openTab"]'),b=/^((https|http)?:\/\/)+[A-Za-z0-9]+\.[A-Za-z0-9]+[\/=\?%\-&_~`@[\]\':+!]*([^<>\"\"])*$/;return e.init=()=>{e.visible(i,!1),e.visible(s,!1),r&&r.parentNode.removeChild(r);const t=document.createElement("div");t.className="common_read_bkg common_read_hide",t.id="read_bkg",window.document.body.appendChild(t)},e.initEvent=()=>{window.document.oncontextmenu=t=>t.ctrlKey||document.body.offsetWidth<=500?(e.hideMenu(),!0):e.popMenu(t),t.oncontextmenu=e=>(e.stopPropagation(),e.preventDefault(),!1),window.removeEventListener("blur",e.hideMenu),document.body.removeEventListener("click",e.hideMenu),t.removeEventListener("blur",e.hideMenu),window.addEventListener("blur",e.hideMenu),document.body.addEventListener("click",e.hideMenu),t.addEventListener("blur",e.hideMenu)},e.popMenu=o=>{let i=o.clientX,a=o.clientY,l=document.documentElement.clientWidth||document.body.clientWidth,r=document.documentElement.clientHeight||document.body.clientHeight;try{e.setMenuItem(o),e.visible(t),t.style.zIndex="-2147483648";let s=n.offsetWidth,c=n.offsetHeight,d=i+s>l?i-s+10:i,m=a+c>r?a-c+10:a;m=a+c>r&&m<c&&a<c?m+(r-c-m-10):m,t.style.left=d+"px",t.style.top=m+"px",t.style.zIndex="2147483648"}catch(e){return console.error(e),!0}return!1},e.setMenuItem=t=>{let n=!1;const r=t.target,s=window.getSelection().toString();if(e.visible(v,!1),"input"===r.tagName.toLowerCase()||"textarea"===r.tagName.toLowerCase()){const n=r.value;n.length>0?(e.visible(m),m.onclick=()=>{t.preventDefault(),r.select()}):e.visible(m,!1),s?(e.visible(u),u.onclick=()=>{const t=r.selectionStart,o=r.selectionEnd;e.copyString(s),r.value=n.substring(0,t)+n.substring(o,n.length),r.selectionStart=t,r.selectionEnd=t,r.focus()}):e.visible(u,!1),e.readClipboard().then((t=>{t?(e.visible(d),d.onclick=()=>{e.insertAtCaret(r,t)}):e.visible(d,!1)})).catch((t=>{console.error(t),e.visible(d,!1)}))}else e.visible(m,!1),e.visible(d,!1),e.visible(u,!1);const y=r.href;y&&b.test(y)?(n=!0,e.visible(g),e.visible(v),g&&(g.onclick=()=>{e.copyString(y)}),v.onclick=()=>{window.open(y)}):e.visible(g,!1);const f=r.currentSrc;f&&b.test(f)?(n=!0,e.visible(p),e.visible(v),p.onclick=()=>{e.copyString(f)},v.onclick=()=>{window.open(f)}):e.visible(p,!1),f&&b.test(f)&&f.trimEnd().endsWith(".png")?(n=!0,e.visible(h),h.onclick=()=>{e.writeClipImg(t,(()=>{volantis.message("系统提示","图片复制成功！","fal fa-images")}),(e=>{volantis.message("系统提示","复制失败："+e,"fal fa-exclamation-square red")}))}):e.visible(h,!1),s?(n=!0,e.visible(c),c.onclick=()=>{e.copyString(s)}):e.visible(c,!1);const w=document.querySelector("#post.article")||null,$=window.location.pathname;w?(e.visible(o),e.visible(a),o.onclick=()=>{window.location.pathname===$?volantis.question("",'是否打印当前页面？<br><em style="font-size: 80%">建议打印时勾选背景图形</em><br>',(()=>{e.printHtml()})):e.hideMenu()},a.onclick=()=>{window.location.pathname,e.readingModel()}):(e.visible(o,!1),e.visible(a,!1)),"play"===volantis.APlayerController.status?(n=!0,e.visible(i)):e.visible(i,!1),n?e.visible(l):e.visible(l,!1),1==volantis.rightMenu.music&&volantis.APlayerController.APlayerLoaded&&MainAPlayer.checkAPlayer()},e.hideMenu=()=>{e.visible(t,!1)},e.copyString=t=>{e.writeClipText(t).then((()=>{volantis.message("复制成功",t.length>120?t.substring(0,120)+"...":t,"fal fa-copy")})).catch((e=>{volantis.message("系统提示",e,"fal fa-exclamation-square red")}))},e.writeClipText=e=>{try{return navigator.clipboard.writeText(e).then((()=>Promise.resolve())).catch((e=>Promise.reject(e)))}catch(t){const n=document.createElement("input");n.setAttribute("readonly","readonly"),document.body.appendChild(n),n.setAttribute("value",e),n.select();try{let e=document.execCommand("copy");return document.body.removeChild(n),e&&"unsuccessful"!==e?Promise.resolve():Promise.reject("复制文本失败!")}catch(e){return document.body.removeChild(n),Promise.reject("当前浏览器不支持复制功能，请检查更新或更换其他浏览器操作!")}}},e.writeClipImg=async function(e,t,n){const o=e.target.currentSrc.replace("https://static.inkss.cn/img/article/","https://cdn.jsdelivr.net/gh/inkss/inkss-cdn@master/img/article/"),i=e.target.parentElement;try{const e=await fetch(o),i=await e.blob();await navigator.clipboard.write([new ClipboardItem({[i.type]:i})]).then((()=>{t()}),(e=>{console.error("图片复制失败：",e),n(e)}))}catch(e){const o=document;try{if(o.body.createTextRange){const e=document.body.createTextRange();e.moveToElementText(i),e.select()}else if(window.getSelection){const e=window.getSelection(),t=document.createRange();t.selectNodeContents(i),e.removeAllRanges(),e.addRange(t)}document.execCommand("copy"),window.getSelection().removeAllRanges(),t()}catch(e){console.error(e),n("不支持复制当前图片！")}}},e.readClipboard=async()=>{const e=await navigator.permissions.query({name:"clipboard-read"});return"granted"===e.state||"prompt"===e.state?navigator.clipboard.readText().then((e=>e)).catch((e=>Promise.reject(e))):Promise.reject(e)},e.insertAtCaret=(e,t)=>{const n=e.selectionStart,o=e.selectionEnd;if(document.selection)e.focus(),document.selection.createRange().text=t,e.focus();else if(n||"0"==n){var i=e.scrollTop;e.value=e.value.substring(0,n)+t+e.value.substring(o,e.value.length),e.focus(),e.selectionStart=n+t.length,e.selectionEnd=n+t.length,e.scrollTop=i}else e.value+=t,e.focus()},e.printHtml=()=>{volantis.isReadModel&&e.readingModel(),!0===volantis.rightMenu.defaultStyles&&($(".cus-article-bkg").remove(),$(".iziToast-overlay").remove(),$(".iziToast-wrapper").remove(),$("body").css({backgroundColor:"unset"}),$("#l_header").hide(),$("#l_cover").hide(),$("#l_side").hide(),$("#l_main").css({width:"100%"}),$("#post").css({"box-shadow":"none",background:"none",padding:"0"}),$("h1").css({"text-align":"center","font-weight":"600","font-size":"2rem","margin-bottom":"20px"}),$(".prev-next").hide(),$("#bottom").children().append('<div class="new-meta-item"><a class="tag" href="'+window.location.href+'" rel="nofollow" data-pjax-state=""><i class="fal fa-external-link fa-fw" aria-hidden="true"></i><p>本文地址：'+window.location.href+"</p></a></div>"),$("#comments").hide(),$("#s-top").hide(),$("footer").hide(),$("#rightmenu-wrapper").hide(),$("details").attr("open","true"),$(".tab-pane").css({display:"block"}),$(".tab-content").css({"border-top":"none"}),$(".highlight>table pre").css({"white-space":"pre-wrap","word-break":"break-all"}),$(".nav-tabs").hide(),$(".backstretch").hide(),$(".fancybox img").css({height:"auto",weight:"auto"}),$("#BKG").hide(),$("img").removeAttr("srcset data-srcset").removeClass("img lazyload loaded")),!0===volantis.rightMenu.printJs&&volantis.rightMenu.printJsFun(),$(document).click(),setTimeout((()=>{window.print(),document.body.innerHTML="",window.location.reload()}),50)},e.readingModel=()=>{$(".cus-article-bkg").fadeToggle(),$("#BKG").fadeToggle(),$("#l_header").fadeToggle(),$("footer").fadeToggle(),$("#s-top").fadeToggle(),$(".article-meta#bottom").fadeToggle(),$(".prev-next").fadeToggle(),$(".widget").fadeToggle(),$("#comments").fadeToggle(),$("#l_main").toggleClass("common_read common_read_main"),$("#l_body").toggleClass("common_read"),$("#safearea").toggleClass("common_read"),$("#pjax-container").toggleClass("common_read"),$("#read_bkg").toggleClass("common_read_hide"),$("h1").toggleClass("common_read_h1"),$("#post").toggleClass("post_read"),$("#l_cover").toggleClass("read_cover"),$(".widget.toc-wrapper").toggleClass("post_read"),volantis.isReadModel=void 0===volantis.isReadModel||!volantis.isReadModel,volantis.isReadModel?(window.ScrollReveal&&ScrollReveal().sync(),volantis.message("系统提示","阅读模式已开启，您可以点击屏幕空白处退出。","fal fa-book-reader light-blue",5e3),$("#l_body").off("click.rightMenu").on("click.rightMenu",(t=>{$(t.target).hasClass("common_read")&&e.readingModel()}))):($("#l_body").off("click.rightMenu"),$("#post").off("click.rightMenu"))},e.visible=(e,t=!0)=>{e&&(e.style.display=!0===t?"block":"none")},{init:(t=!1)=>{e.init(),e.initEvent(),t&&volantis.message("系统提示","自定义右键注册成功。")},destroy:(t=!1)=>{e.hideMenu(),window.document.oncontextmenu=()=>!0,t&&volantis.message("系统提示","自定义右键注销成功。")},hideMenu:()=>{e.hideMenu()}}})();Object.freeze(RightMenu);