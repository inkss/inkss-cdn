document.addEventListener("error",(function(e){const t=e.target;if("img"!==t.tagName.toLowerCase())return;const o=t.parentElement,n=o.className,a=o.parentElement.className;t.classList.add("fix-cursor-default","error"),"fancybox"===n&&"fancybox"===a?(o.parentElement.classList.add("hideFancybox"),o.parentElement.classList.remove("fancybox"),o.classList.remove("fancybox")):"img-bg"===n&&"img-wrap"===a?o.parentElement.classList.add("hideFancybox"):"author"===n?o.parentElement.classList.add("fix-author-imgError"):n.includes("tk-avatar")&&o.parentElement.classList.add("fix-avatar-imgError")}),!0),document.addEventListener("DOMContentLoaded",(()=>{volantis.requestAnimationFrame((()=>{VolantisApp.init(),VolantisApp.subscribe();const e=new VolantisFancyBox;e.bind("#post-body img:not([fancybox])"),window.lazyLoader=new LazyLoader("picture.lazy img"),Tools.locationHash(),Tools.changeTitle(),Tools.toggleGrayscaleEffect(),highlightKeyWords.startFromURL(),volantis.pjax.push((()=>{VolantisApp.pjaxReload(),window.lazyLoader.reinitObserver(),e.bind("#post-body img:not([fancybox])"),Tools.changeTitle(),Tools.toggleGrayscaleEffect(),highlightKeyWords.startFromURL()}),"app.js"),volantis.pjax.send((()=>{volantis.dom.switcher?.removeClass("active"),volantis.dom.header?.removeClass("z_search-open"),volantis.dom.wrapper?.removeClass("sub"),volantis.EventListener?.remove()}),"app.js")}))}));const Tools={handleTitleChange:e=>{const t=sessionStorage.getItem("domTitle")||e,o=t.split(" - ");document.title="hidden"===document.visibilityState?2===o.length?o[1]:o[0]:t},changeTitle:()=>{const e=document.title,t=()=>Tools.handleTitleChange(e);sessionStorage.setItem("domTitle",e),document.removeEventListener("visibilitychange",t),window.removeEventListener("beforeunload",t),document.addEventListener("visibilitychange",t),window.addEventListener("beforeunload",t)},toggleGrayscaleEffect:(e=!1)=>{const t=window.location.pathname,o=new Date,n=o.getFullYear(),a=[[`${n}/4/4`,`${n}/4/5`],[`${n}/12/13`,`${n}/12/14`]].some((([e,t])=>o>=new Date(e)&&o<new Date(t)));"/"===t&&(a||e)?document.querySelector("html").classList.add("grayscale"):document.querySelector("html").classList.remove("grayscale")},locationHash:()=>{if(window.location.hash){const e=decodeURI(window.location.hash.slice(1)).replace(/\s/g,"-"),t=document.getElementById(e);t&&setTimeout((()=>{const e="comments"==t.id?0:80;volantis.scroll.to(t,{addTop:e,behavior:"smooth",observer:!0})}),500)}}},VolantisApp=(()=>{const e={};let t=80;return e.init=()=>{volantis.dom.header&&(t=volantis.dom.header.clientHeight+16),window.onresize=()=>{const t=document.documentElement.clientWidth<500?1:0;volantis.isMobile!==t&&(volantis.isMobile=t,e.setGlobalHeaderMenuEvent(),e.setHeader(),e.setHeaderSearch())},volantis.scroll.push(volantis.scroll.debounce(e.scrollEventCallBack,200),"scrollEventCallBack")},e.event=()=>{volantis.dom.$(document.getElementById("scroll-down"))?.on("click",(function(){e.scrolltoElement(volantis.dom.bodyAnchor)}));const t=document.querySelector("#l_side");t&&!t.querySelectorAll("section").length&&document.querySelector("#l_main").classList.add("no_sidebar");const o=volantis.GLOBAL_CONFIG.sidebar;if(o.for_page.includes("webinfo")||o.for_post.includes("webinfo")){const t=o.webinfo.lastupd,n=document.getElementById("last-update-show");n&&t.enable&&t.friendlyShow&&(n.innerHTML=e.utilTimeAgo(volantis.GLOBAL_CONFIG.lastupdate))}const n=document.getElementById("webinfo-runtime-count");if(n){const e=new Date(o.webinfo.runtime.data),t=(new Date).getTime()-e.getTime(),a=Math.floor(t/864e5);n.innerHTML=`${(a/365).toFixed(2)} ${o.webinfo.runtime.unit}`,n.title=`${n.title} 👾 ${a} 天`}document.querySelector(".nextsite div.site-nav-toggle")?.addEventListener("click",(()=>{const e=document.querySelector(".nextsite nav.site-nav");e&&(e.style.display="none"===e.style.display||""===e.style.display?"block":"none")}));document.querySelectorAll('a[href$="#comments"]').forEach((e=>{const t=document.querySelector("#comments");t&&e.addEventListener("click",(e=>{e.preventDefault(),volantis.scroll.to(t,{addTop:0,behavior:"smooth",observer:!0})}))}))},e.restData=()=>{const e=volantis.dom.header;t=e?e.clientHeight:80},e.setIsMobile=()=>{const e=document.documentElement.clientWidth<500?1:0;volantis.isMobile=e,volantis.isMobileOld=e},e.scrolltoElement=(e,o=t)=>{const n=e.getBoundingClientRect().top+document.documentElement.scrollTop-o;volantis.scroll.to(e,{top:n})},e.scrollEventCallBack=()=>{const e=volantis.dom.bodyAnchor.offsetTop-t,o=volantis.scroll.getScrollTop();if(volantis.dom.topBtn){const e=volantis.dom.topBtn;o>volantis.dom.bodyAnchor.offsetTop?(e.addClass("show"),volantis.scroll.del<=0?e.classList.add("hl"):e.classList.remove("hl")):e.removeClass("show hl")}if(volantis.dom.header&&volantis.dom.header.toggleClass("show",o-e>-1),pdata.ispage&&volantis.dom.wrapper){const e=volantis.dom.wrapper;volantis.scroll.del>0&&o>100?e.addClass("sub"):volantis.scroll.del<0&&e.removeClass("sub")}volantis.isMobile&&(pdata.ispage&&volantis.dom.tocTarget&&volantis.dom.toc&&(volantis.dom.tocTarget.removeClass("active"),volantis.dom.toc.removeClass("active")),volantis.dom.mPhoneList&&volantis.dom.mPhoneList.forEach((e=>volantis.dom.$(e).hide())))},e.setScrollAnchor=()=>{volantis.dom.topBtn&&volantis.dom.bodyAnchor&&volantis.dom.topBtn.click((t=>{t.preventDefault(),t.stopPropagation(),e.scrolltoElement(volantis.dom.bodyAnchor),t.stopImmediatePropagation()}))},e.setHeader=()=>{pdata.ispage&&(volantis.dom.wrapper?.find(".nav-sub .title")?.html(document.title.split(" - ")[0]),volantis.dom.comment=volantis.dom.$(document.getElementById("s-comment")),volantis.dom.commentTarget=volantis.dom.$(document.querySelector("#l_main article#comments")),volantis.dom.commentTarget&&volantis.dom.comment?volantis.dom.comment.click((t=>{t.preventDefault(),t.stopPropagation(),volantis.cleanContentVisibility(),e.scrolltoElement(volantis.dom.commentTarget),t.stopImmediatePropagation()})):volantis.dom.comment&&(volantis.dom.comment.style.display="none"),volantis.isMobile&&(volantis.dom.toc=volantis.dom.$(document.getElementById("s-toc")),volantis.dom.tocTarget=volantis.dom.$(document.querySelector("#l_side .toc-wrapper")),volantis.dom.tocTarget&&volantis.dom.toc?(volantis.dom.toc.click((e=>{e.stopPropagation(),volantis.dom.tocTarget.toggleClass("active"),volantis.dom.toc.toggleClass("active")})),volantis.dom.$(document).click((e=>{e.stopPropagation(),volantis.dom.tocTarget?.removeClass("active"),volantis.dom.toc?.removeClass("active")}))):volantis.dom.toc&&(volantis.dom.toc.style.display="none")))},e.setHeaderMenuSelection=()=>{volantis.dom.headerMenu=volantis.dom.$(document.querySelectorAll("#l_header .navigation,#l_cover .navigation,#l_side .navigation")),volantis.dom.headerMenu.forEach((e=>{volantis.dom.$(e).find("li a.active")?.removeClass("active"),volantis.dom.$(e).find("div a.active")?.removeClass("active")}));let e=location.pathname.replace(/\/|%|\./g,"")||"home";e=e.split(/page\d{0,}$|index.html/)[0],e=e.replace(/(\[|\]|~|#|@)/g,"\\$1"),e&&volantis.dom.headerMenu&&volantis.dom.headerMenu.forEach((t=>{const o=t.querySelector(`[active-action=action-${e}]`);o&&volantis.dom.$(o).addClass("active")}))},e.nextSiteMenu=()=>{const e=document.querySelector(".widget.nextsite");if(!e)return;e.querySelector("li.menu-item-active")?.classList.remove("menu-item-active");let t=location.pathname.replace(/\/|%|\./g,"")||"home";t=t.split(/page\d{0,}$|index.html/)[0],t=t.replace(/(\[|\]|~|#|@)/g,"\\$1");const o=e.querySelector(`[active-action=action-${t}]`);o?.parentElement?.classList.add("menu-item-active")},e.setGlobalHeaderMenuEvent=()=>{volantis.isMobile?document.querySelectorAll("#l_header .m-phone li").forEach((e=>{e.querySelector(".list-v")&&volantis.dom.$(e).click((t=>{t.stopPropagation(),e.parentElement.childNodes.forEach((e=>{1===e.nodeType&&"LI"===e.tagName&&e.childNodes.forEach((e=>{1===e.nodeType&&"UL"===e.tagName&&volantis.dom.$(e).hide()}))})),Array.from(e.children).forEach((e=>{const t=volantis.dom.$(e);"menu"===t.title?t.style.display="flex":t.show()}))}),!1)})):document.querySelectorAll("#wrapper .m-pc li > a[href]").forEach((e=>{volantis.dom.$(e.parentElement).click((e=>{e.stopPropagation(),e.target.origin===e.target.baseURI&&document.querySelectorAll("#wrapper .m-pc .list-v").forEach((e=>{volantis.dom.$(e).hide()}))}),!1)})),e.setPageHeaderMenuEvent()},e.setPageHeaderMenuEvent=()=>{volantis.isMobile&&volantis.dom.$(document).click((e=>{volantis.dom.mPhoneList.forEach((e=>{volantis.dom.$(e).hide()}))}))},e.setHeaderSearch=()=>{volantis.isMobile&&volantis.dom.switcher&&(volantis.dom.switcher.click((e=>{e.stopPropagation(),volantis.dom.header.toggleClass("z_search-open"),volantis.dom.switcher.toggleClass("active")}),!1),volantis.dom.$(document).click((e=>{volantis.dom.header.removeClass("z_search-open"),volantis.dom.switcher.removeClass("active")}),!1),volantis.dom.search.click((e=>{e.stopPropagation()}),!1))},e.setTabs=()=>{const e=document.querySelectorAll("#l_main .tabs .nav-tabs, .widget .tabs .nav-tabs");e&&e.forEach((e=>{e.querySelectorAll("a").forEach((e=>{volantis.dom.$(e).on("click",(t=>{t.preventDefault(),t.stopPropagation();const o=volantis.dom.$(e.closest(".tabs"));return o.find(".nav-tabs .active").removeClass("active"),volantis.dom.$(e.parentElement).addClass("active"),o.find(".tab-content .active").removeClass("active"),o.find(t.currentTarget.className).addClass("active"),!1}))}))}))},e.footnotes=()=>{document.querySelectorAll("#l_main .footnote-backref, #l_main .footnote-ref > a").forEach((e=>{e.onclick=null,volantis.dom.$(e).on("click",(e=>{e.stopPropagation(),e.preventDefault();const t=decodeURI(e.target.hash.slice(1)).replace(/\s/g,"-"),o=document.getElementById(t);o&&volantis.scroll.to(o,{addTop:-5,behavior:"smooth"})}))}))},e.utilCopyCode=t=>{document.querySelectorAll(t).forEach((t=>{t.insertAdjacentHTML("beforebegin",'<button class="btn-copy" data-clipboard-snippet=""><span>COPY</span></button>');const o=t.previousSibling;o.onclick=n=>{n.stopPropagation();o.querySelector("span");t.focus();const a=new Range;a.selectNodeContents(t);const s=document.getSelection();s.removeAllRanges(),s.addRange(a);const l=s.toString();e.utilWriteClipText(l)}}))},e.utilWriteClipText=e=>(NProgress?.start(),navigator.clipboard.writeText(e).catch((t=>{const o=document.createElement("textarea");o.setAttribute("readonly","readonly"),document.body.appendChild(o),o.value=e,o.select();try{const e=document.execCommand("copy");if(document.body.removeChild(o),!e)throw new Error("复制文本失败!")}catch(t){throw document.body.removeChild(o),new Error("当前浏览器不支持复制功能，请检查更新或更换其他浏览器操作!")}NProgress?.done()})).finally((()=>{NProgress?.done()}))),e.utilTimeAgo=(e,t=30)=>{try{const o=Date.now()-e.getTime(),n=Math.floor(o/864e5);if(0===n){const e=Math.floor(o%864e5/36e5);if(0===e){const e=Math.floor(o%36e5/6e4);if(0===e){return`${Math.round(o%6e4/1e3)} 秒前`}return`${e} 分钟前`}return`${e} 小时前`}if(n<0)return"刚刚";if(n<t)return`${n} 天前`;const a=e.getFullYear(),s=String(e.getMonth()+1).padStart(2,"0");return`${a}年${s}月${String(e.getDate()).padStart(2,"0")}日`}catch(e){return console.error(e)," - "}},e.feather=()=>{if(feather)try{feather.replace({width:16,height:16})}catch(e){console.error("图标加载失败",e)}},e.dataToShow=()=>{document.querySelectorAll(".dataToShow").forEach((t=>{try{const o=e.utilTimeAgo(new Date(t.getAttribute("datetime")),60).trim();t.textContent=o||t.textContent}catch(e){console.error(e)}}))},{init:()=>{e.init(),e.event()},subscribe:()=>{e.setIsMobile(),e.setHeader(),e.setHeaderMenuSelection(),e.setGlobalHeaderMenuEvent(),e.setHeaderSearch(),e.setScrollAnchor(),e.setTabs(),e.footnotes(),e.dataToShow(),e.nextSiteMenu(),e.feather()},pjaxReload:()=>{e.event(),e.restData(),e.setHeader(),e.setHeaderMenuSelection(),e.setPageHeaderMenuEvent(),e.setScrollAnchor(),e.setTabs(),e.footnotes(),e.dataToShow(),e.nextSiteMenu(),e.feather();const t=document.querySelector("#l_header .nav-main");t?.querySelectorAll(".list-v:not(.menu-phone)")?.forEach((e=>e.removeAttribute("style"))),document.querySelector("#l_header .menu-phone.list-v")?.removeAttribute("style")},utilCopyCode:e.utilCopyCode,utilWriteClipText:e.utilWriteClipText,utilTimeAgo:e.utilTimeAgo,scrolltoElement:e.scrolltoElement}})();Object.freeze(VolantisApp);const highlightKeyWords=(()=>{let e=0,t=-1;const o=()=>{n("0")||requestAnimationFrame(o)},n=o=>{t=parseInt(o||(t+1)%e,10);let n=document.getElementById(`keyword-mark-${t}`);return n||(t=(t+1)%e,n=document.getElementById(`keyword-mark-${t}`)),n&&(volantis.scroll.to(n,{addTop:-10,behavior:"smooth"}),document.querySelector(".highlighted")?.classList.remove("highlighted"),n.classList.add("highlighted")),n},a=(t,o)=>{if(e=0,!t.length||!o||1===t.length&&"null"===t[0])return;const n=document.createTreeWalker(o,NodeFilter.SHOW_TEXT,null),a=[];for(;n.nextNode();)n.currentNode.parentNode.matches("button, select, textarea")||a.push(n.currentNode);a.forEach((e=>{const[o]=s(t,e.nodeValue);if(!o.length)return;const n=l(0,e.nodeValue.length,o);i(e,n,"keyword")}))},s=(e,t,o=!1)=>{const n=[],a=new Set,s=o?t:t.toLowerCase();return e.forEach((e=>{const t=document.createElement("div");t.innerText=e;const l=(e=o?t.innerHTML:t.innerHTML.toLowerCase()).length;if(0===l)return;let i,r=0;for(;(i=s.indexOf(e,r))>-1;)n.push({position:i,word:e}),a.add(e),r=i+l})),n.sort(((e,t)=>e.position-t.position||t.word.length-e.word.length)),[n,a]},l=(e,t,o)=>{const n=[],a=new Set;for(;o.length;){const{position:e,word:s}=o[0];if(e+s.length>t)break;for(a.add(s),n.push({position:e,length:s.length}),o.shift();o.length&&o[0].position<e+s.length;)o.shift()}return{hits:n,start:e,end:t,count:a.size}},i=(e,t,o)=>{const n=e.nodeValue;let a=t.start;const s=[];for(const{position:e,length:l}of t.hits){s.push(document.createTextNode(n.substring(a,e)));const t=document.createElement("mark");t.appendChild(document.createTextNode(n.substr(e,l))),t.className=o,r(t),s.push(t),a=e+l}e.nodeValue=n.substring(a,t.end),s.forEach((t=>e.parentNode.insertBefore(t,e)))},r=t=>{if(t)return t.id="keyword-mark-"+e++,t.classList.add("highlightKey"),t};return{start:a,startFromURL:()=>{const e=new URLSearchParams(window.location.search),t=decodeURI(e.get("keyword")),n=t?t.split(" "):[],s=document.querySelector("#l_main");1===n.length&&"null"===n[0]||(a(n,s),o())},scrollToNextHighlightKeywordMark:n,scrollToPrevHighlightKeywordMark:o=>{t=parseInt(o||(t-1+e)%e,10);let n=document.getElementById(`keyword-mark-${t}`);if(n||(t=(t-1+e)%e,n=document.getElementById(`keyword-mark-${t}`)),n){document.querySelector("#s-top")&&document.querySelector("#s-top").offsetHeight;volantis.scroll.to(n,{addTop:-10,behavior:"smooth"}),document.querySelector(".highlighted")?.classList.remove("highlighted"),n.classList.add("highlighted")}return n},cleanHighlightStyle:()=>{document.querySelectorAll(".keyword").forEach((e=>{e.classList.remove("highlightKey")}))}}})();class VolantisFancyBox{constructor(e=!0){this.option={Hash:!1,groupAll:!0,caption:(e,t)=>t.thumbEl?.alt||"",wheel:"slide",contentClick:"iterateZoom",Thumbs:{showOnStart:!1},Images:{content:(e,t)=>{const o=t.thumbEl,n=o.closest("picture");if(o.hasAttribute("data-src")&&o.setAttribute("src",o.getAttribute("data-src")),n){n.classList.remove("lazy");let e=n.getElementsByTagName("source");for(let t of e)t.hasAttribute("data-srcset")&&t.setAttribute("srcset",t.getAttribute("data-srcset"));return n.outerHTML}return o.outerHTML},Panzoom:{maxScale:1.5,panMode:"mousemove",mouseMoveFactor:1.1,mouseMoveFriction:.12}},Toolbar:{display:{left:["infobar"],middle:["zoomIn","zoomOut","toggle1to1","rotateCCW","rotateCW","flipX","flipY"],right:["slideshow","download","thumbs","close"]}}},e&&this.#e()}async#e(){await this.loadFancybox(),document.querySelector(".md .gallery img, .fancybox")&&this.groupBind()}async loadFancybox(){"undefined"==typeof Fancybox&&(await volantis.css(volantis.GLOBAL_CONFIG.cdn.fancybox_css),await volantis.js(volantis.GLOBAL_CONFIG.cdn.fancybox_js))}async bind(e){await this.loadFancybox(),"undefined"!=typeof Fancybox&&(Fancybox.unbind(e),Fancybox.bind(e,this.option))}async groupBind(e,t="default"){await this.loadFancybox(),this.#t(e,t);const o=new Set;document.querySelectorAll(".gallery").forEach((e=>{e.querySelector("img")&&o.add(e.getAttribute("data-group")||"default")})),t&&o.add(t),o.forEach((e=>{"undefined"!=typeof Fancybox&&(Fancybox.unbind(`[data-fancybox="${e}"]`),Fancybox.bind(`[data-fancybox="${e}"]`,this.option))}))}#t(e,t){e&&document.querySelectorAll(e).forEach((e=>{if(e.hasAttribute("fancybox"))return;e.setAttribute("fancybox","");const o=document.createElement("a");o.setAttribute("href",e.src||e.dataset?.src),o.setAttribute("data-caption",e.alt||""),o.setAttribute("data-fancybox",t),o.classList.add("fancybox"),o.append(e.cloneNode()),e.replaceWith(o)}))}}class LazyLoader{constructor(e){this.lazyPictureObserver=null,this.observedElements=new Set,this.selector=e,this.initObserver(),this.observeElements()}initObserver(){this.lazyPictureObserver=new IntersectionObserver(((e,t)=>{e.forEach((e=>{!e.isIntersecting||volantis?.scroll&&volantis?.scroll?.isScrolling||(this.loadImage(e.target),this.lazyPictureObserver.unobserve(e.target),this.observedElements.delete(e.target))}))}))}observeElement(e){this.observedElements.has(e)||(this.lazyPictureObserver.observe(e),this.observedElements.add(e))}observeElements(){document.querySelectorAll(this.selector).forEach((e=>{this.observeElement(e)}))}loadImage(e){let t=e.parentElement.getElementsByTagName("source");for(let e of t)e.srcset=e.dataset.srcset;e.src=e.dataset.src,e.onload=function(){e.closest("picture").classList.remove("lazy")}}unobserveAll(){this.lazyPictureObserver&&(this.lazyPictureObserver.disconnect(),this.observedElements.clear())}reinitObserver(){this.unobserveAll(),this.initObserver(),this.observeElements()}}