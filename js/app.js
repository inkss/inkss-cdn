document.addEventListener("error",(function(e){const t=e.target;if("img"!==t.tagName.toLowerCase())return;const o=t.parentElement,a=o.className,n=o.parentElement.className;t.classList.add("fix-cursor-default","error"),"fancybox"===a&&"fancybox"===n?(o.parentElement.classList.add("hideFancybox"),o.parentElement.classList.remove("fancybox"),o.classList.remove("fancybox")):"img-bg"===a&&"img-wrap"===n?o.parentElement.classList.add("hideFancybox"):"author"===a?o.parentElement.classList.add("fix-author-imgError"):a.includes("tk-avatar")&&o.parentElement.classList.add("fix-avatar-imgError")}),!0),document.addEventListener("DOMContentLoaded",(()=>{volantis.requestAnimationFrame((()=>{VolantisApp.init(),VolantisApp.subscribe();(new VolantisFancyBox).bind("#post-body img:not([fancybox])"),highlightKeyWords.startFromURL(),locationHash(),lazyLoadImages(),toggleGrayscaleEffect(),volantis.pjax.push((()=>{lazyLoadImages(),toggleGrayscaleEffect(),VolantisApp.pjaxReload();(new VolantisFancyBox).bind("#post-body img:not([fancybox])"),sessionStorage.setItem("domTitle",document.title),highlightKeyWords.startFromURL()}),"app.js"),volantis.pjax.send((()=>{volantis.dom.switcher?.removeClass("active"),volantis.dom.header?.removeClass("z_search-open"),volantis.dom.wrapper?.removeClass("sub"),volantis.EventListener?.remove()}),"app.js")}))}));const changeTitle=()=>{const e=document.title;sessionStorage.setItem("domTitle",e),document.addEventListener("visibilitychange",(()=>{const t=sessionStorage.getItem("domTitle")||e,o=t.split(" - ");document.title="hidden"===document.visibilityState?2===o.length?o[1]:o[0]:t}))},toggleGrayscaleEffect=()=>{const e=window.location.pathname,t=new Date,o=t.getFullYear(),a=[[`${o}/4/4`,`${o}/4/5`],[`${o}/12/13`,`${o}/12/14`]].some((([e,o])=>t>=new Date(e)&&t<new Date(o)));"/"===e&&a?document.querySelector("html").classList.add("grayscale"):document.querySelector("html").classList.remove("grayscale")};let lazyPictureObserver;const lazyLoadImages=()=>{let e=[].slice.call(document.querySelectorAll("picture.lazy img"));lazyPictureObserver||(lazyPictureObserver=new IntersectionObserver(((e,t)=>{e.forEach((e=>{if(e.isIntersecting&&(!volantis?.scroll||!volantis?.scroll?.isScrolling)){let t=e.target,o=t.parentElement.getElementsByTagName("source");for(let e of o)e.srcset=e.dataset.srcset;t.src=t.dataset.src,t.onload=function(){t.closest("picture").classList.remove("lazy")},lazyPictureObserver.unobserve(t)}}))}))),e.forEach((e=>{lazyPictureObserver.observe(e)}))};window.lazyLoadImages=lazyLoadImages;const locationHash=()=>{if(window.location.hash){const e=decodeURI(window.location.hash.slice(1)).replace(/\s/g,"-"),t=document.getElementById(e);t&&setTimeout((()=>{const e="comments"==t.id?0:80;volantis.scroll.to(t,{addTop:e,behavior:"smooth",observer:!0})}),500)}};Object.freeze(locationHash);const VolantisApp=(()=>{const e={};let t=80;return e.init=()=>{volantis.dom.header&&(t=volantis.dom.header.clientHeight+16),window.onresize=()=>{const t=document.documentElement.clientWidth<500?1:0;volantis.isMobile!==t&&(volantis.isMobile=t,e.setGlobalHeaderMenuEvent(),e.setHeader(),e.setHeaderSearch())},volantis.scroll.push(e.scrollEventCallBack,"scrollEventCallBack")},e.event=()=>{volantis.dom.$(document.getElementById("scroll-down"))?.on("click",(function(){e.scrolltoElement(volantis.dom.bodyAnchor)}));const t=document.querySelector("#l_side");t&&!t.querySelectorAll("section").length&&document.querySelector("#l_main").classList.add("no_sidebar");const o=volantis.GLOBAL_CONFIG.sidebar;if(o.for_page.includes("webinfo")||o.for_post.includes("webinfo")){const t=o.webinfo.lastupd,a=document.getElementById("last-update-show");a&&t.enable&&t.friendlyShow&&(a.innerHTML=e.utilTimeAgo(volantis.GLOBAL_CONFIG.lastupdate))}const a=document.getElementById("webinfo-runtime-count");if(a){const e=new Date(o.webinfo.runtime.data),t=(new Date).getTime()-e.getTime(),n=Math.floor(t/864e5);a.innerHTML=`${(n/365).toFixed(2)} ${o.webinfo.runtime.unit}`,a.title=`${a.title} 👾 ${n} 天`}document.querySelector(".nextsite div.site-nav-toggle")?.addEventListener("click",(()=>{const e=document.querySelector(".nextsite nav.site-nav");e&&(e.style.display="none"===e.style.display||""===e.style.display?"block":"none")}));document.querySelectorAll('a[href$="#comments"]').forEach((e=>{const t=document.querySelector("#comments");t&&e.addEventListener("click",(e=>{e.preventDefault(),volantis.scroll.to(t,{addTop:0,behavior:"smooth",observer:!0})}))}))},e.restData=()=>{const e=volantis.dom.header;t=e?e.clientHeight:80},e.setIsMobile=()=>{const e=document.documentElement.clientWidth<500?1:0;volantis.isMobile=e,volantis.isMobileOld=e},e.scrolltoElement=(e,o=t)=>{const a=e.getBoundingClientRect().top+document.documentElement.scrollTop-o;volantis.scroll.to(e,{top:a})},e.scrollEventCallBack=()=>{const e=volantis.dom.bodyAnchor.offsetTop-t,o=volantis.scroll.getScrollTop();if(volantis.dom.topBtn){const e=volantis.dom.topBtn;o>volantis.dom.bodyAnchor.offsetTop?(e.addClass("show"),volantis.scroll.del<=0?e.classList.add("hl"):e.classList.remove("hl")):e.removeClass("show hl")}if(volantis.dom.header&&volantis.dom.header.toggleClass("show",o-e>-1),pdata.ispage&&volantis.dom.wrapper){const e=volantis.dom.wrapper;volantis.scroll.del>0&&o>100?e.addClass("sub"):volantis.scroll.del<0&&e.removeClass("sub")}volantis.isMobile&&(pdata.ispage&&volantis.dom.tocTarget&&volantis.dom.toc&&(volantis.dom.tocTarget.removeClass("active"),volantis.dom.toc.removeClass("active")),volantis.dom.mPhoneList&&volantis.dom.mPhoneList.forEach((e=>volantis.dom.$(e).hide())))},e.setScrollAnchor=()=>{volantis.dom.topBtn&&volantis.dom.bodyAnchor&&volantis.dom.topBtn.click((t=>{t.preventDefault(),t.stopPropagation(),e.scrolltoElement(volantis.dom.bodyAnchor),t.stopImmediatePropagation()}))},e.setHeader=()=>{pdata.ispage&&(volantis.dom.wrapper?.find(".nav-sub .title")?.html(document.title.split(" - ")[0]),volantis.dom.comment=volantis.dom.$(document.getElementById("s-comment")),volantis.dom.commentTarget=volantis.dom.$(document.querySelector("#l_main article#comments")),volantis.dom.commentTarget&&volantis.dom.comment?volantis.dom.comment.click((t=>{t.preventDefault(),t.stopPropagation(),volantis.cleanContentVisibility(),e.scrolltoElement(volantis.dom.commentTarget),t.stopImmediatePropagation()})):volantis.dom.comment&&(volantis.dom.comment.style.display="none"),volantis.isMobile&&(volantis.dom.toc=volantis.dom.$(document.getElementById("s-toc")),volantis.dom.tocTarget=volantis.dom.$(document.querySelector("#l_side .toc-wrapper")),volantis.dom.tocTarget&&volantis.dom.toc?(volantis.dom.toc.click((e=>{e.stopPropagation(),volantis.dom.tocTarget.toggleClass("active"),volantis.dom.toc.toggleClass("active")})),volantis.dom.$(document).click((e=>{e.stopPropagation(),volantis.dom.tocTarget?.removeClass("active"),volantis.dom.toc?.removeClass("active")}))):volantis.dom.toc&&(volantis.dom.toc.style.display="none")))},e.setHeaderMenuSelection=()=>{volantis.dom.headerMenu=volantis.dom.$(document.querySelectorAll("#l_header .navigation,#l_cover .navigation,#l_side .navigation")),volantis.dom.headerMenu.forEach((e=>{volantis.dom.$(e).find("li a.active")?.removeClass("active"),volantis.dom.$(e).find("div a.active")?.removeClass("active")}));let e=location.pathname.replace(/\/|%|\./g,"")||"home";e=e.split(/page\d{0,}$|index.html/)[0],e=e.replace(/(\[|\]|~|#|@)/g,"\\$1"),e&&volantis.dom.headerMenu&&volantis.dom.headerMenu.forEach((t=>{const o=t.querySelector(`[active-action=action-${e}]`);o&&volantis.dom.$(o).addClass("active")}))},e.nextSiteMenu=()=>{const e=document.querySelector(".widget.nextsite");if(!e)return;e.querySelector("li.menu-item-active")?.classList.remove("menu-item-active");let t=location.pathname.replace(/\/|%|\./g,"")||"home";t=t.split(/page\d{0,}$|index.html/)[0],t=t.replace(/(\[|\]|~|#|@)/g,"\\$1");const o=e.querySelector(`[active-action=action-${t}]`);o?.parentElement?.classList.add("menu-item-active")},e.setGlobalHeaderMenuEvent=()=>{volantis.isMobile?document.querySelectorAll("#l_header .m-phone li").forEach((e=>{e.querySelector(".list-v")&&volantis.dom.$(e).click((t=>{t.stopPropagation(),e.parentElement.childNodes.forEach((e=>{1===e.nodeType&&"LI"===e.tagName&&e.childNodes.forEach((e=>{1===e.nodeType&&"UL"===e.tagName&&volantis.dom.$(e).hide()}))})),Array.from(e.children).forEach((e=>{const t=volantis.dom.$(e);"menu"===t.title?t.style.display="flex":t.show()}))}),!1)})):document.querySelectorAll("#wrapper .m-pc li > a[href]").forEach((e=>{volantis.dom.$(e.parentElement).click((e=>{e.stopPropagation(),e.target.origin===e.target.baseURI&&document.querySelectorAll("#wrapper .m-pc .list-v").forEach((e=>{volantis.dom.$(e).hide()}))}),!1)})),e.setPageHeaderMenuEvent()},e.setPageHeaderMenuEvent=()=>{volantis.isMobile&&volantis.dom.$(document).click((e=>{volantis.dom.mPhoneList.forEach((e=>{volantis.dom.$(e).hide()}))}))},e.setHeaderSearch=()=>{volantis.isMobile&&volantis.dom.switcher&&(volantis.dom.switcher.click((e=>{e.stopPropagation(),volantis.dom.header.toggleClass("z_search-open"),volantis.dom.switcher.toggleClass("active")}),!1),volantis.dom.$(document).click((e=>{volantis.dom.header.removeClass("z_search-open"),volantis.dom.switcher.removeClass("active")}),!1),volantis.dom.search.click((e=>{e.stopPropagation()}),!1))},e.setTabs=()=>{const e=document.querySelectorAll("#l_main .tabs .nav-tabs, .widget .tabs .nav-tabs");e&&e.forEach((e=>{e.querySelectorAll("a").forEach((e=>{volantis.dom.$(e).on("click",(t=>{t.preventDefault(),t.stopPropagation();const o=volantis.dom.$(e.closest(".tabs"));return o.find(".nav-tabs .active").removeClass("active"),volantis.dom.$(e.parentElement).addClass("active"),o.find(".tab-content .active").removeClass("active"),o.find(t.currentTarget.className).addClass("active"),!1}))}))}))},e.footnotes=()=>{document.querySelectorAll("#l_main .footnote-backref, #l_main .footnote-ref > a").forEach((e=>{e.onclick=null,volantis.dom.$(e).on("click",(e=>{e.stopPropagation(),e.preventDefault();const t=decodeURI(e.target.hash.slice(1)).replace(/\s/g,"-"),o=document.getElementById(t);o&&volantis.scroll.to(o,{addTop:-5,behavior:"smooth"})}))}))},e.utilCopyCode=t=>{document.querySelectorAll(t).forEach((t=>{t.insertAdjacentHTML("beforebegin",'<button class="btn-copy" data-clipboard-snippet=""><span>COPY</span></button>');const o=t.previousSibling;o.onclick=a=>{a.stopPropagation();o.querySelector("span");t.focus();const n=new Range;n.selectNodeContents(t);const s=document.getSelection();s.removeAllRanges(),s.addRange(n);const l=s.toString();e.utilWriteClipText(l)}}))},e.utilWriteClipText=e=>(NProgress?.start(),navigator.clipboard.writeText(e).catch((t=>{const o=document.createElement("textarea");o.setAttribute("readonly","readonly"),document.body.appendChild(o),o.value=e,o.select();try{const e=document.execCommand("copy");if(document.body.removeChild(o),!e)throw new Error("复制文本失败!")}catch(t){throw document.body.removeChild(o),new Error("当前浏览器不支持复制功能，请检查更新或更换其他浏览器操作!")}NProgress?.done()})).finally((()=>{NProgress?.done()}))),e.utilTimeAgo=(e,t=30)=>{try{const o=Date.now()-e.getTime(),a=Math.floor(o/864e5);if(0===a){const e=Math.floor(o%864e5/36e5);if(0===e){const e=Math.floor(o%36e5/6e4);if(0===e){return`${Math.round(o%6e4/1e3)} 秒前`}return`${e} 分钟前`}return`${e} 小时前`}if(a<0)return"刚刚";if(a<t)return`${a} 天前`;const n=e.getFullYear(),s=String(e.getMonth()+1).padStart(2,"0");return`${n}年${s}月${String(e.getDate()).padStart(2,"0")}日`}catch(e){return console.error(e)," - "}},e.feather=()=>{if(feather)try{feather.replace({width:16,height:16})}catch(e){console.error("图标加载失败",e)}},e.dataToShow=()=>{document.querySelectorAll(".dataToShow").forEach((t=>{try{const o=e.utilTimeAgo(new Date(t.getAttribute("datetime")),60).trim();t.textContent=o||t.textContent}catch(e){console.error(e)}}))},{init:()=>{e.init(),e.event()},subscribe:()=>{e.setIsMobile(),e.setHeader(),e.setHeaderMenuSelection(),e.setGlobalHeaderMenuEvent(),e.setHeaderSearch(),e.setScrollAnchor(),e.setTabs(),e.footnotes(),e.dataToShow(),e.nextSiteMenu(),e.feather()},pjaxReload:()=>{e.event(),e.restData(),e.setHeader(),e.setHeaderMenuSelection(),e.setPageHeaderMenuEvent(),e.setScrollAnchor(),e.setTabs(),e.footnotes(),e.dataToShow(),e.nextSiteMenu(),e.feather();const t=document.querySelector("#l_header .nav-main");t?.querySelectorAll(".list-v:not(.menu-phone)")?.forEach((e=>e.removeAttribute("style"))),document.querySelector("#l_header .menu-phone.list-v")?.removeAttribute("style")},utilCopyCode:e.utilCopyCode,utilWriteClipText:e.utilWriteClipText,utilTimeAgo:e.utilTimeAgo,scrolltoElement:e.scrolltoElement}})();Object.freeze(VolantisApp);const highlightKeyWords=(()=>{let e=0,t=-1;const o=()=>{a("0")||requestAnimationFrame(o)},a=o=>{t=parseInt(o||(t+1)%e,10);let a=document.getElementById(`keyword-mark-${t}`);return a||(t=(t+1)%e,a=document.getElementById(`keyword-mark-${t}`)),a&&(volantis.scroll.to(a,{addTop:-10,behavior:"smooth"}),document.querySelector(".highlighted")?.classList.remove("highlighted"),a.classList.add("highlighted")),a},n=(t,o)=>{if(e=0,!t.length||!o||1===t.length&&"null"===t[0])return;const a=document.createTreeWalker(o,NodeFilter.SHOW_TEXT,null),n=[];for(;a.nextNode();)a.currentNode.parentNode.matches("button, select, textarea")||n.push(a.currentNode);n.forEach((e=>{const[o]=s(t,e.nodeValue);if(!o.length)return;const a=l(0,e.nodeValue.length,o);i(e,a,"keyword")}))},s=(e,t,o=!1)=>{const a=[],n=new Set,s=o?t:t.toLowerCase();return e.forEach((e=>{const t=document.createElement("div");t.innerText=e;const l=(e=o?t.innerHTML:t.innerHTML.toLowerCase()).length;if(0===l)return;let i,r=0;for(;(i=s.indexOf(e,r))>-1;)a.push({position:i,word:e}),n.add(e),r=i+l})),a.sort(((e,t)=>e.position-t.position||t.word.length-e.word.length)),[a,n]},l=(e,t,o)=>{const a=[],n=new Set;for(;o.length;){const{position:e,word:s}=o[0];if(e+s.length>t)break;for(n.add(s),a.push({position:e,length:s.length}),o.shift();o.length&&o[0].position<e+s.length;)o.shift()}return{hits:a,start:e,end:t,count:n.size}},i=(e,t,o)=>{const a=e.nodeValue;let n=t.start;const s=[];for(const{position:e,length:l}of t.hits){s.push(document.createTextNode(a.substring(n,e)));const t=document.createElement("mark");t.appendChild(document.createTextNode(a.substr(e,l))),t.className=o,r(t),s.push(t),n=e+l}e.nodeValue=a.substring(n,t.end),s.forEach((t=>e.parentNode.insertBefore(t,e)))},r=t=>{if(t)return t.id="keyword-mark-"+e++,t.classList.add("highlightKey"),t};return{start:n,startFromURL:()=>{const e=new URLSearchParams(window.location.search),t=decodeURI(e.get("keyword")),a=t?t.split(" "):[],s=document.querySelector("#l_main");1===a.length&&"null"===a[0]||(n(a,s),o())},scrollToNextHighlightKeywordMark:a,scrollToPrevHighlightKeywordMark:o=>{t=parseInt(o||(t-1+e)%e,10);let a=document.getElementById(`keyword-mark-${t}`);if(a||(t=(t-1+e)%e,a=document.getElementById(`keyword-mark-${t}`)),a){document.querySelector("#s-top")&&document.querySelector("#s-top").offsetHeight;volantis.scroll.to(a,{addTop:-10,behavior:"smooth"}),document.querySelector(".highlighted")?.classList.remove("highlighted"),a.classList.add("highlighted")}return a},cleanHighlightStyle:()=>{document.querySelectorAll(".keyword").forEach((e=>{e.classList.remove("highlightKey")}))}}})();class VolantisFancyBox{constructor(e=!0){this.option={Hash:!1,groupAll:!0,caption:(e,t)=>t.thumbEl?.alt||"",wheel:"slide",contentClick:"iterateZoom",Thumbs:{showOnStart:!1},Images:{content:(e,t)=>{const o=t.thumbEl,a=o.closest("picture");if(o.hasAttribute("data-src")&&o.setAttribute("src",o.getAttribute("data-src")),a){a.classList.remove("lazy");let e=a.getElementsByTagName("source");for(let t of e)t.hasAttribute("data-srcset")&&t.setAttribute("srcset",t.getAttribute("data-srcset"));return a.outerHTML}return o.outerHTML},Panzoom:{maxScale:1.5,panMode:"mousemove",mouseMoveFactor:1.1,mouseMoveFriction:.12}},Toolbar:{display:{left:["infobar"],middle:["zoomIn","zoomOut","toggle1to1","rotateCCW","rotateCW","flipX","flipY"],right:["slideshow","download","thumbs","close"]}}},this.#e(e)}#e(e){!document.querySelector(".md .gallery img, .fancybox")&&e||this.groupBind()}async#t(e){"undefined"==typeof Fancybox?(await volantis.css(volantis.GLOBAL_CONFIG.cdn.fancybox_css),await volantis.js(volantis.GLOBAL_CONFIG.cdn.fancybox_js),e.call(this)):e.call(this)}#o(e,t){e&&document.querySelectorAll(e).forEach((e=>{if(e.hasAttribute("fancybox"))return;e.setAttribute("fancybox","");const o=document.createElement("a");o.setAttribute("href",e.src||e.dataset?.src),o.setAttribute("data-caption",e.alt||""),o.setAttribute("data-fancybox",t),o.classList.add("fancybox"),o.append(e.cloneNode()),e.replaceWith(o)}))}bind(e){this.#t((()=>{Fancybox?.unbind(e),Fancybox?.bind(e,this.option)}))}groupBind(e,t="default"){this.#t((()=>{this.#o(e,t);const o=new Set;document.querySelectorAll(".gallery").forEach((e=>{e.querySelector("img")&&o.add(e.getAttribute("data-group")||"default")})),t&&o.add(t),o.forEach((e=>{Fancybox?.unbind(`[data-fancybox="${e}"]`),Fancybox?.bind(`[data-fancybox="${e}"]`,this.option)}))}))}}