document.addEventListener("error",(function(e){const t=e.target;if("img"!==t.tagName.toLowerCase())return;const o=t.parentElement,n=o.className,a=o.parentElement.className;t.classList.add("fix-cursor-default","error"),"fancybox"===n&&"fancybox"===a?(o.parentElement.classList.add("hideFancybox"),o.parentElement.classList.remove("fancybox"),o.classList.remove("fancybox")):"img-bg"===n&&"img-wrap"===a?o.parentElement.classList.add("hideFancybox"):"author"===n?o.parentElement.classList.add("fix-author-imgError"):n.includes("tk-avatar")&&o.parentElement.classList.add("fix-avatar-imgError")}),!0),document.addEventListener("DOMContentLoaded",(()=>{volantis.requestAnimationFrame((()=>{VolantisApp.init(),VolantisApp.subscribe(),VolantisFancyBox.init(),VolantisFancyBox.bind("#post-body img:not([fancybox])"),highlightKeyWords.startFromURL(),locationHash(),lazyLoadImages(),toggleGrayscaleEffect(),volantis.pjax.push((()=>{lazyLoadImages(),toggleGrayscaleEffect(),VolantisApp.pjaxReload(),VolantisFancyBox.init(),VolantisFancyBox.bind("#post-body img:not([fancybox])"),sessionStorage.setItem("domTitle",document.title),highlightKeyWords.startFromURL()}),"app.js"),volantis.pjax.send((()=>{volantis.dom.switcher?.removeClass("active"),volantis.dom.header?.removeClass("z_search-open"),volantis.dom.wrapper?.removeClass("sub"),volantis.EventListener?.remove()}),"app.js")}))}));const changeTitle=()=>{const e=document.title;sessionStorage.setItem("domTitle",e),document.addEventListener("visibilitychange",(()=>{const t=sessionStorage.getItem("domTitle")||e,o=t.split(" - ");document.title="hidden"===document.visibilityState?2===o.length?o[1]:o[0]:t}))},toggleGrayscaleEffect=()=>{const e=window.location.pathname,t=new Date,o=t.getFullYear(),n=[[`${o}/4/4`,`${o}/4/5`],[`${o}/12/13`,`${o}/12/14`]].some((([e,o])=>t>=new Date(e)&&t<new Date(o)));"/"===e&&n?document.querySelector("html").classList.add("grayscale"):document.querySelector("html").classList.remove("grayscale")},lazyLoadImages=()=>{let e=[].slice.call(document.querySelectorAll("picture.lazy img"));if("IntersectionObserver"in window){let t=new IntersectionObserver(((e,o)=>{e.forEach((e=>{if(e.isIntersecting){let o=e.target,n=o.parentElement.getElementsByTagName("source");for(let e of n)e.srcset=e.dataset.srcset;o.src=o.dataset.src,o.classList.remove("lazy"),t.unobserve(o)}}))}));e.forEach((e=>{t.observe(e)}))}else{const t=function(){e.forEach((e=>{if(e.getBoundingClientRect().top<=window.innerHeight&&e.getBoundingClientRect().bottom>=0){let t=e.parentElement.getElementsByTagName("source");for(let e of t)e.srcset=e.dataset.srcset;e.src=e.dataset.src,e.classList.remove("lazy")}})),0===e.length&&(document.removeEventListener("scroll",t),window.removeEventListener("resize",t),window.removeEventListener("orientationchange",t))};document.addEventListener("scroll",t),window.addEventListener("resize",t),window.addEventListener("orientationchange",t)}},locationHash=()=>{if(window.location.hash){const e=decodeURI(window.location.hash.slice(1)).replace(/\s/g,"-"),t=document.getElementById(e);t&&setTimeout((()=>{volantis.scroll.to(t,{addTop:80,behavior:"instant",observer:!0})}),1e3)}};Object.freeze(locationHash);const VolantisApp=(()=>{const e={};let t=80;return e.init=()=>{volantis.dom.header&&(t=volantis.dom.header.clientHeight+16),window.onresize=()=>{const t=document.documentElement.clientWidth<500?1:0;volantis.isMobile!==t&&(volantis.isMobile=t,e.setGlobalHeaderMenuEvent(),e.setHeader(),e.setHeaderSearch())},volantis.scroll.push(e.scrollEventCallBack,"scrollEventCallBack")},e.event=()=>{volantis.dom.$(document.getElementById("scroll-down"))?.on("click",(function(){e.scrolltoElement(volantis.dom.bodyAnchor)}));const t=document.querySelector("#l_side");t&&!t.querySelectorAll("section").length&&document.querySelector("#l_main").classList.add("no_sidebar");const o=volantis.GLOBAL_CONFIG.sidebar;if(o.for_page.includes("webinfo")||o.for_post.includes("webinfo")){const t=o.webinfo.lastupd,n=document.getElementById("last-update-show");n&&t.enable&&t.friendlyShow&&(n.innerHTML=e.utilTimeAgo(volantis.GLOBAL_CONFIG.lastupdate))}const n=document.getElementById("webinfo-runtime-count");if(n){const e=new Date(o.webinfo.runtime.data),t=(new Date).getTime()-e.getTime(),a=Math.floor(t/864e5);n.innerHTML=`${(a/365).toFixed(2)} ${o.webinfo.runtime.unit}`,n.title=`${n.title} 👾 ${a} 天`}document.querySelector(".nextsite div.site-nav-toggle")?.addEventListener("click",(()=>{const e=document.querySelector(".nextsite nav.site-nav");e&&(e.style.display="none"===e.style.display||""===e.style.display?"block":"none")}))},e.restData=()=>{const e=volantis.dom.header;t=e?e.clientHeight:80},e.setIsMobile=()=>{const e=document.documentElement.clientWidth<500?1:0;volantis.isMobile=e,volantis.isMobileOld=e},e.scrolltoElement=(e,o=t)=>{const n=e.getBoundingClientRect().top+document.documentElement.scrollTop-o;volantis.scroll.to(e,{top:n})},e.scrollEventCallBack=()=>{const e=volantis.dom.bodyAnchor.offsetTop-t,o=volantis.scroll.getScrollTop();if(volantis.dom.topBtn){const e=volantis.dom.topBtn;o>volantis.dom.bodyAnchor.offsetTop?(e.addClass("show"),e.toggleClass("hl",volantis.scroll.del<=0)):e.removeClass("show hl")}if(volantis.dom.header&&volantis.dom.header.toggleClass("show",o-e>-1),pdata.ispage&&volantis.dom.wrapper){const e=volantis.dom.wrapper;volantis.scroll.del>0&&o>100?e.addClass("sub"):volantis.scroll.del<0&&e.removeClass("sub")}volantis.isMobile&&(pdata.ispage&&volantis.dom.tocTarget&&volantis.dom.toc&&(volantis.dom.tocTarget.removeClass("active"),volantis.dom.toc.removeClass("active")),volantis.dom.mPhoneList&&volantis.dom.mPhoneList.forEach((e=>volantis.dom.$(e).hide())))},e.setScrollAnchor=()=>{volantis.dom.topBtn&&volantis.dom.bodyAnchor&&volantis.dom.topBtn.click((t=>{t.preventDefault(),t.stopPropagation(),e.scrolltoElement(volantis.dom.bodyAnchor),t.stopImmediatePropagation()}))},e.setHeader=()=>{pdata.ispage&&(volantis.dom.wrapper?.find(".nav-sub .title")?.html(document.title.split(" - ")[0]),volantis.dom.comment=volantis.dom.$(document.getElementById("s-comment")),volantis.dom.commentTarget=volantis.dom.$(document.querySelector("#l_main article#comments")),volantis.dom.commentTarget&&volantis.dom.comment?volantis.dom.comment.click((t=>{t.preventDefault(),t.stopPropagation(),volantis.cleanContentVisibility(),e.scrolltoElement(volantis.dom.commentTarget),t.stopImmediatePropagation()})):volantis.dom.comment&&(volantis.dom.comment.style.display="none"),volantis.isMobile&&(volantis.dom.toc=volantis.dom.$(document.getElementById("s-toc")),volantis.dom.tocTarget=volantis.dom.$(document.querySelector("#l_side .toc-wrapper")),volantis.dom.tocTarget&&volantis.dom.toc?(volantis.dom.toc.click((e=>{e.stopPropagation(),volantis.dom.tocTarget.toggleClass("active"),volantis.dom.toc.toggleClass("active")})),volantis.dom.$(document).click((e=>{e.stopPropagation(),volantis.dom.tocTarget?.removeClass("active"),volantis.dom.toc?.removeClass("active")}))):volantis.dom.toc&&(volantis.dom.toc.style.display="none")))},e.setHeaderMenuSelection=()=>{volantis.dom.headerMenu=volantis.dom.$(document.querySelectorAll("#l_header .navigation,#l_cover .navigation,#l_side .navigation")),volantis.dom.headerMenu.forEach((e=>{volantis.dom.$(e).find("li a.active")?.removeClass("active"),volantis.dom.$(e).find("div a.active")?.removeClass("active")}));let e=location.pathname.replace(/\/|%|\./g,"")||"home";e=e.split(/page\d{0,}$|index.html/)[0],e=e.replace(/(\[|\]|~|#|@)/g,"\\$1"),e&&volantis.dom.headerMenu&&volantis.dom.headerMenu.forEach((t=>{const o=t.querySelector(`[active-action=action-${e}]`);o&&volantis.dom.$(o).addClass("active")}))},e.nextSiteMenu=()=>{const e=document.querySelector(".widget.nextsite");if(!e)return;e.querySelector("li.menu-item-active")?.classList.remove("menu-item-active");let t=location.pathname.replace(/\/|%|\./g,"")||"home";t=t.split(/page\d{0,}$|index.html/)[0],t=t.replace(/(\[|\]|~|#|@)/g,"\\$1");const o=e.querySelector(`[active-action=action-${t}]`);o?.parentElement?.classList.add("menu-item-active")},e.setGlobalHeaderMenuEvent=()=>{volantis.isMobile?document.querySelectorAll("#l_header .m-phone li").forEach((e=>{e.querySelector(".list-v")&&volantis.dom.$(e).click((t=>{t.stopPropagation(),e.parentElement.childNodes.forEach((e=>{1===e.nodeType&&"LI"===e.tagName&&e.childNodes.forEach((e=>{1===e.nodeType&&"UL"===e.tagName&&volantis.dom.$(e).hide()}))})),Array.from(e.children).forEach((e=>{const t=volantis.dom.$(e);"menu"===t.title?t.style.display="flex":t.show()}))}),!1)})):document.querySelectorAll("#wrapper .m-pc li > a[href]").forEach((e=>{volantis.dom.$(e.parentElement).click((e=>{e.stopPropagation(),e.target.origin===e.target.baseURI&&document.querySelectorAll("#wrapper .m-pc .list-v").forEach((e=>{volantis.dom.$(e).hide()}))}),!1)})),e.setPageHeaderMenuEvent()},e.setPageHeaderMenuEvent=()=>{volantis.isMobile&&volantis.dom.$(document).click((e=>{volantis.dom.mPhoneList.forEach((e=>{volantis.dom.$(e).hide()}))}))},e.setHeaderSearch=()=>{volantis.isMobile&&volantis.dom.switcher&&(volantis.dom.switcher.click((e=>{e.stopPropagation(),volantis.dom.header.toggleClass("z_search-open"),volantis.dom.switcher.toggleClass("active")}),!1),volantis.dom.$(document).click((e=>{volantis.dom.header.removeClass("z_search-open"),volantis.dom.switcher.removeClass("active")}),!1),volantis.dom.search.click((e=>{e.stopPropagation()}),!1))},e.setTabs=()=>{const e=document.querySelectorAll("#l_main .tabs .nav-tabs, .widget .tabs .nav-tabs");e&&e.forEach((e=>{e.querySelectorAll("a").forEach((e=>{volantis.dom.$(e).on("click",(t=>{t.preventDefault(),t.stopPropagation();const o=volantis.dom.$(e.closest(".tabs"));return o.find(".nav-tabs .active").removeClass("active"),volantis.dom.$(e.parentElement).addClass("active"),o.find(".tab-content .active").removeClass("active"),o.find(t.currentTarget.className).addClass("active"),!1}))}))}))},e.footnotes=()=>{document.querySelectorAll("#l_main .footnote-backref, #l_main .footnote-ref > a").forEach((e=>{e.onclick=null,volantis.dom.$(e).on("click",(e=>{e.stopPropagation(),e.preventDefault();const t=decodeURI(e.target.hash.slice(1)).replace(/\s/g,"-"),o=document.getElementById(t);if(o){const e=volantis.dom.header?volantis.dom.header.offsetHeight:0;volantis.scroll.to(o,{addTop:-e-5,behavior:"smooth"})}}))}))},e.utilCopyCode=t=>{document.querySelectorAll(t).forEach((t=>{t.insertAdjacentHTML("beforebegin",'<button class="btn-copy" data-clipboard-snippet=""><span>COPY</span></button>');const o=t.previousSibling;o.onclick=n=>{n.stopPropagation();o.querySelector("span");t.focus();const a=new Range;a.selectNodeContents(t);const l=document.getSelection();l.removeAllRanges(),l.addRange(a);const s=l.toString();e.utilWriteClipText(s)}}))},e.utilWriteClipText=e=>navigator.clipboard.writeText(e).catch((t=>{const o=document.createElement("textarea");o.setAttribute("readonly","readonly"),document.body.appendChild(o),o.value=e,o.select();try{const e=document.execCommand("copy");if(document.body.removeChild(o),!e)throw new Error("复制文本失败!")}catch(t){throw document.body.removeChild(o),new Error("当前浏览器不支持复制功能，请检查更新或更换其他浏览器操作!")}})),e.utilTimeAgo=(e,t=30)=>{try{const o=Date.now()-e.getTime(),n=Math.floor(o/864e5);if(0===n){const e=Math.floor(o%864e5/36e5);if(0===e){const e=Math.floor(o%36e5/6e4);if(0===e){return`${Math.round(o%6e4/1e3)} 秒前`}return`${e} 分钟前`}return`${e} 小时前`}if(n<0)return"刚刚";if(n<t)return`${n} 天前`;const a=e.getFullYear(),l=String(e.getMonth()+1).padStart(2,"0");return`${a}年${l}月${String(e.getDate()).padStart(2,"0")}日`}catch(e){return console.error(e)," - "}},e.feather=()=>{if(feather)try{feather.replace({width:16,height:16})}catch(e){console.error("图标加载失败",e)}},e.dataToShow=()=>{document.querySelectorAll(".dataToShow").forEach((t=>{try{const o=e.utilTimeAgo(new Date(t.getAttribute("datetime")),60).trim();t.textContent=o||t.textContent}catch(e){console.error(e)}}))},{init:()=>{e.init(),e.event()},subscribe:()=>{e.setIsMobile(),e.setHeader(),e.setHeaderMenuSelection(),e.setGlobalHeaderMenuEvent(),e.setHeaderSearch(),e.setScrollAnchor(),e.setTabs(),e.footnotes(),e.dataToShow(),e.nextSiteMenu(),e.feather()},pjaxReload:()=>{e.event(),e.restData(),e.setHeader(),e.setHeaderMenuSelection(),e.setPageHeaderMenuEvent(),e.setScrollAnchor(),e.setTabs(),e.footnotes(),e.dataToShow(),e.nextSiteMenu(),e.feather();const t=document.querySelector("#l_header .nav-main");t?.querySelectorAll(".list-v:not(.menu-phone)")?.forEach((e=>e.removeAttribute("style"))),document.querySelector("#l_header .menu-phone.list-v")?.removeAttribute("style")},utilCopyCode:e.utilCopyCode,utilWriteClipText:e.utilWriteClipText,utilTimeAgo:e.utilTimeAgo,scrolltoElement:e.scrolltoElement}})();Object.freeze(VolantisApp);const VolantisFancyBox=(()=>{const e={loadFancyBox:e=>{volantis.css(volantis.GLOBAL_CONFIG.cdn.fancybox_css),volantis.js(volantis.GLOBAL_CONFIG.cdn.fancybox_js).then((()=>{e&&e()}))},init:(t=!0,o=e.groupBind)=>{!document.querySelector(".md .gallery img, .fancybox")&&t||("undefined"==typeof Fancybox?e.loadFancyBox(o):o())},elementHandling:(e,t)=>{document.querySelectorAll(e).forEach((e=>{if(e.hasAttribute("fancybox"))return;e.setAttribute("fancybox","");const o=document.createElement("a");o.setAttribute("href",e.src),o.setAttribute("data-caption",e.alt),o.setAttribute("data-fancybox",t),o.classList.add("fancybox"),o.append(e.cloneNode()),e.replaceWith(o)}))},bind:t=>{e.init(!1,(()=>{Fancybox.bind(t,{Hash:!1,groupAll:!0,caption:(e,t)=>t.thumbEl?.alt||"",contentClick:"toggleCover",wheel:"slide",Thumbs:{showOnStart:!1},Images:{content:(e,t)=>{const o=t.thumbEl,n=o.closest("picture");if(o.classList.remove("lazy"),o.hasAttribute("data-src")&&o.setAttribute("src",o.getAttribute("data-src")),n){let e=n.getElementsByTagName("source");for(let t of e)t.hasAttribute("data-srcset")&&t.setAttribute("srcset",t.getAttribute("data-srcset"));return n.outerHTML}return o.outerHTML},Panzoom:{maxScale:1,panMode:"mousemove",mouseMoveFactor:1.1,mouseMoveFriction:.12}},Toolbar:{display:{left:["infobar"],middle:["zoomIn","zoomOut","toggle1to1","rotateCCW","rotateCW","flipX","flipY"],right:["slideshow","thumbs","close"]}}})}))},groupBind:(e=null)=>{const t=new Set;document.querySelectorAll(".gallery").forEach((e=>{e.querySelector("img")&&t.add(e.getAttribute("data-group")||"default")})),e&&t.add(e),t.forEach((e=>{Fancybox.unbind(`[data-fancybox="${e}"]`),Fancybox.bind(`[data-fancybox="${e}"]`,{Hash:!1,Thumbs:{showOnStart:!1}})}))}};return{init:e.init,bind:e.bind,groupBind:(t,o="default")=>{try{e.elementHandling(t,o),e.init(!1,(()=>e.groupBind(o)))}catch(e){console.error(e)}}}})();Object.freeze(VolantisFancyBox);const highlightKeyWords=(()=>{let e={markNum:0,markNextId:-1,startFromURL:()=>{const t=decodeURI(new URL(location.href).searchParams.get("keyword")),o=t?t.split(" "):[],n=document.querySelector("#l_main");1===o.length&&"null"===o[0]||(e.start(o,n),e.scrollToFirstHighlightKeywordMark())},scrollToFirstHighlightKeywordMark:()=>{volantis.cleanContentVisibility();e.scrollToNextHighlightKeywordMark("0")||volantis.requestAnimationFrame(e.scrollToFirstHighlightKeywordMark)},scrollToNextHighlightKeywordMark:t=>{const o=t||(e.markNextId+1)%e.markNum;e.markNextId=parseInt(o,10);let n=document.getElementById("keyword-mark-"+e.markNextId);if(n||(e.markNextId=(e.markNextId+1)%e.markNum,n=document.getElementById("keyword-mark-"+e.markNextId)),n){const e=volantis.dom.header?volantis.dom.header.offsetHeight:0;volantis.scroll.to(n,{addTop:-e-5,behavior:"instant"})}return n},scrollToPrevHighlightKeywordMark:t=>{const o=t||(e.markNextId-1+e.markNum)%e.markNum;e.markNextId=parseInt(o,10);let n=document.getElementById("keyword-mark-"+e.markNextId);if(n||(e.markNextId=(e.markNextId-1+e.markNum)%e.markNum,n=document.getElementById("keyword-mark-"+e.markNextId)),n){const e=volantis.dom.header?volantis.dom.header.offsetHeight:0;volantis.scroll.to(n,{addTop:-e-5,behavior:"instant"})}return n},start:(t,o)=>{if(e.markNum=0,!t.length||!o||1===t.length&&"null"===t[0])return;console.log(t);const n=document.createTreeWalker(o,NodeFilter.SHOW_TEXT,null),a=[];for(;n.nextNode();)n.currentNode.parentNode.matches("button, select, textarea")||a.push(n.currentNode);a.forEach((o=>{const[n]=e.getIndexByWord(t,o.nodeValue);if(!n.length)return;const a=e.mergeIntoSlice(0,o.nodeValue.length,n);e.highlightText(o,a,"keyword"),e.highlightStyle()}))},getIndexByWord:(e,t,o=!1)=>{const n=[],a=new Set,l=o?t:t.toLowerCase();return e.forEach((e=>{const t=document.createElement("div");t.innerText=e;const s=(e=o?t.innerHTML:t.innerHTML.toLowerCase()).length;if(0===s)return;let r,i=0;for(;(r=l.indexOf(e,i))>-1;)n.push({position:r,word:e}),a.add(e),i=r+s})),n.sort(((e,t)=>e.position-t.position||t.word.length-e.word.length)),[n,a]},mergeIntoSlice:(e,t,o)=>{const n=[],a=new Set;for(;o.length;){const{position:e,word:l}=o[0];if(e+l.length>t)break;for(a.add(l),n.push({position:e,length:l.length}),o.shift();o.length&&o[0].position<e+l.length;)o.shift()}return{hits:n,start:e,end:t,count:a.size}},highlightText:(t,o,n)=>{const a=t.nodeValue;let l=o.start;const s=[];for(const{position:t,length:r}of o.hits){s.push(document.createTextNode(a.substring(l,t)));const o=e.highlightStyle(document.createElement("mark").appendChild(document.createTextNode(a.substr(t,r))));o.className=n,s.push(o),l=t+r}t.nodeValue=a.substring(l,o.end),s.forEach((e=>t.parentNode.insertBefore(e,t)))},highlightStyle:t=>{if(t)return t.id="keyword-mark-"+e.markNum++,t.style.background="#ff0",t.style.borderBottom="1px dashed #ff2a2a",t.style.color="#ff2a2a",t.style.fontWeight="bold",t},cleanHighlightStyle:()=>{document.querySelectorAll(".keyword").forEach((e=>{e.style.background="transparent",e.style.borderBottom=null,e.style.color=null,e.style.fontWeight=null}))}};return{start:e.start,startFromURL:e.startFromURL,scrollToNextHighlightKeywordMark:e.scrollToNextHighlightKeywordMark,scrollToPrevHighlightKeywordMark:e.scrollToPrevHighlightKeywordMark,cleanHighlightStyle:e.cleanHighlightStyle}})();Object.freeze(highlightKeyWords);