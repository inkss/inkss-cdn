class SearchService{constructor(){this.queryText=null,this.data=null,this.hitsEmpty=volantis.GLOBAL_CONFIG.languages.search.hits_empty,this.normalText=volantis.GLOBAL_CONFIG.languages.search.normal,this.normal=`<div id="resule-hits-empty"><p>${this.normalText}üîç</p></div>`,this.template=`\n      <div id="u-search">\n        <div class="modal">\n          <header class="modal-header clearfix">\n            <form id="u-search-modal-form" class="u-search-form" name="uSearchModalForm">\n              <input type="text" id="u-search-modal-input" class="u-search-input" placeholder="${this.normalText}" />\n              <button type="submit" id="u-search-modal-btn-submit" class="u-search-btn-submit">\n                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">\n                  <circle cx="11" cy="11" r="8"></circle>\n                  <line x1="21" y1="21" x2="16.65" y2="16.65"></line>\n                </svg>\n              </button>\n            </form>\n            <a id="u-search-btn-close" class="btn-close">\n              <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">\n                <line x1="18" y1="6" x2="6" y2="18"></line>\n                <line x1="6" y1="6" x2="18" y2="18"></line>\n              </svg>\n            </a>\n          </header>\n          <main class="modal-body">\n            <ul class="modal-results"></ul>\n          </main>\n        </div>\n        <div id="modal-overlay" class="modal-overlay"></div>\n      </div>`,this.init()}init(){if(!document.querySelector("#u-search")){const e=document.createElement("div");e.innerHTML=this.template,document.body.append(e)}this.bindEvents()}bindEvents(){const e=document.querySelector("#u-search-modal-input");let t=!1;e.addEventListener("compositionstart",(()=>t=!0)),e.addEventListener("compositionend",(e=>{t=!1,this.onSubmit(e)})),e.addEventListener("input",(e=>{t||this.onSubmit(e)})),document.querySelectorAll(".u-search-form").forEach((e=>{e.addEventListener("submit",this.onSubmit.bind(this),!1)})),document.querySelector("#u-search-btn-close").addEventListener("click",this.close.bind(this),!1),document.querySelector("#modal-overlay").addEventListener("click",this.close.bind(this),!1)}async onSubmit(e){e.preventDefault();const t=e.target.querySelector(".u-search-input")||e.target;this.queryText=t.value.trim(),await this.search()}async search(){const e=document.querySelectorAll(".u-search-input"),t=document.querySelector("#u-search"),s=document.querySelector("#modal-overlay"),n=document.querySelector("#u-search .modal-results"),i=document.querySelector("#u-search .modal");e.forEach((e=>e.value=this.queryText)),t.style.display="block",s.style.backdropFilter="blur(10px)",setTimeout((()=>{i.style.transform="translate(0px, 0px)"}),100),this.data||(this.data=await this.fetchData());let r="";r+=this.buildResultList(this.data.posts),r+=this.buildResultList(this.data.pages),r||(r=`<div id="resule-hits-empty"><i class="fa-solid fa-box-open"></i><p>${this.hitsEmpty.replace(/\$\{query}/,this.queryText)}</p></div>`),n.innerHTML=""===this.queryText?this.normal:r,window.pjax&&pjax.refresh(t);const a=e=>{"Escape"===e.code&&(this.close(),document.removeEventListener("keydown",a))};document.addEventListener("keydown",a)}close(){const e=document.querySelector("#u-search .modal"),t=document.querySelector("#u-search"),s=document.querySelector("#modal-overlay");e.style.transform="translateY(120%)",setTimeout((()=>{t.style.display="none",s.style.backdropFilter="blur(0)"}),300)}async fetchData(){try{const e=await fetch(volantis.GLOBAL_CONFIG.search.dataPath);return await e.json()}catch(e){return console.error("Error fetching data:",e),null}}buildResultList(e){return e.sort(((e,t)=>new Date(t.updated)-new Date(e.updated))).reduce(((e,t)=>(this.contentSearch(t)&&(e+=this.buildResult(t.permalink,t.title,t.digest)),e)),"")}contentSearch(e){const t=this.queryText.toLowerCase().split(/[-\s]+/),s=e?.title?.toLowerCase(),n=e?.content?.toLowerCase();if(!s||!n)return!1;if(!t.some((e=>s.includes(e)||n.includes(e))))return!1;const i=t.reduce(((e,t)=>Math.min(e,n.indexOf(t))),n.length),r=Math.max(i-40,0),a=Math.min(i+120,n.length),c=this.stripHTML(e.content).slice(r,a).replace(new RegExp(`(${t.join("|")})`,"gi"),"<b mark>$1</b>");return e.digest=`${c}......`,!0}buildResult(e,t,s){const n=s?`<span class="digest">${s}</span>`:"";return`<li><a class="result" href="${new URL(e).pathname.split("?")[0]}?keyword=${this.queryText}"><span class="title">${t}</span>${n}</a></li>`}stripHTML(e){return e.replace(/\n+/g," ").replace(/<(img|figure)[^>]*>.*?<\/\1>/g,"").replace(/<[^>]+>/g,"").trim().replace(/\s+/g," ").replace(/(\S)(https:\/\/)/g,"$1 $2")}static setQueryText(e){this.instance&&(this.instance.queryText=e)}static async search(){this.instance&&await this.instance.search()}static init(){const e=new SearchService;this.instance=e}}SearchService.init(),document.addEventListener("pjax:success",SearchService.init),document.addEventListener("pjax:send",(()=>{document.querySelector("#u-search").style.display="none"}));