let SearchService=(()=>{const e={queryText:null,data:null,template:'<div id="u-search">\n  <div class="modal">\n    <header class="modal-header" class="clearfix">\n      <form id="u-search-modal-form" class="u-search-form" name="uSearchModalForm">\n        <input type="text" id="u-search-modal-input" class="u-search-input" />\n        <button type="submit" id="u-search-modal-btn-submit" class="u-search-btn-submit">\n          <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line></svg>\n        </button>\n      </form>\n      <a id="u-search-btn-close" class="btn-close"> <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg> </a>\n    </header>\n    <main class="modal-body">\n      <ul class="modal-results"></ul>\n    </main>\n  </div>\n  <div id="modal-overlay" class="modal-overlay"></div>\n</div>\n',init:()=>{let t=document.createElement("div");t.innerHTML+=e.template,document.body.append(t),document.querySelectorAll(".u-search-form").forEach((t=>{t.addEventListener("submit",e.onSubmit,!1)})),document.querySelector("#u-search-modal-input").addEventListener("input",e.onSubmit),document.querySelector("#u-search-btn-close").addEventListener("click",e.close,!1),document.querySelector("#modal-overlay").addEventListener("click",e.close,!1)},onSubmit:t=>{t.preventDefault();let r=t.target.querySelector(".u-search-input");e.queryText=r?r.value:t.target.value,e.queryText&&e.search()},search:async()=>{document.querySelectorAll(".u-search-input").forEach((t=>{t.value=e.queryText})),document.querySelector("#u-search").style.display="block",e.data||(e.data=await e.fetchData());let t="";t+=e.buildResultList(e.data?.posts),t+=e.buildResultList(e.data?.pages),""===t&&(t=`<div id="resule-hits-empty"><i class="fa-solid fa-box-open"></i><p>${volantis.GLOBAL_CONFIG.languages.search.hits_empty.replace(/\$\{query}/,e.queryText)}</p></div>`),document.querySelector("#u-search .modal-results").innerHTML=t,window.pjax&&pjax.refresh(document.querySelector("#u-search")),document.addEventListener("keydown",(function t(r){"Escape"===r.code&&(e.close(),document.removeEventListener("keydown",t))}))},close:()=>{document.querySelector("#u-search").style.display="none"},fetchData:()=>fetch(volantis.GLOBAL_CONFIG.search.dataPath).then((e=>e.text())).then((e=>JSON.parse(e))),buildResultList:t=>{t.sort(((e,t)=>new Date(t.updated)-new Date(e.updated)));let r="";return t.forEach((t=>{e.contentSearch(t)&&(r+=e.buildResult(t.permalink,t.title,t.digest))})),r},contentSearch:t=>{let r=t?.title?.trim().toLowerCase(),n=t?.content?.trim().toLowerCase(),a=e.queryText.trim().toLowerCase().split(/[-\s]+/),s=!1,l=-1,i=-1,c=-1;return r&&n&&a.forEach(((o,u)=>{if(l=r.indexOf(o),i=n.indexOf(o),l<0&&i<0?s=!1:(s=!0,i<0&&(i=0),0===u&&(c=i)),s){n=e.stripHTML(t?.content);let r=0,s=0;if(c>=0){r=Math.max(c-40,0),s=0===r?Math.min(200,n.length):Math.min(c+120,n.length);let e=n.substring(r,s);a.forEach((function(t){let r=new RegExp(t,"gi");e=e.replace(r,"<b mark>"+t+"</b>")})),t.digest=e+"......"}else s=Math.min(200,n.length),t.digest=n.trim().substring(0,s)}})),s},buildResult:(t,r,n)=>{let a="";return""!==n&&(a=`<span class="digest">${n}</span>`),`<li><a class="result" href ="${e.getUrlRelativePath(t)}?keyword=${e.queryText}"><span class="title">${r}</span>${a}</a></li>`},getUrlRelativePath:function(e){let t=e.split("//"),r=t[1].indexOf("/"),n=t[1].substring(r);return-1!=n.indexOf("?")&&(n=n.split("?")[0]),n},stripHTML:e=>e=(e=(e=(e=(e=e.replace(/\n+/g," ")).replace(/<(img|figure)[^>]*>.*?<\/\1>/g,"")).replace(/<[^>]+>/g,"")).trim().replace(/\s+/g," ")).replace(/(\S)(https:\/\/)/g,"$1 $2")};return{init:()=>{e.init()},setQueryText:t=>{e.queryText=t},search:()=>{e.search()}}})();Object.freeze(SearchService),SearchService.init(),document.addEventListener("pjax:success",SearchService.init),document.addEventListener("pjax:send",(function(){document.querySelector("#u-search").style.display="none"}));