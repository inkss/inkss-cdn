{"version":3,"file":"Artalk.js","sources":["../src/api/v2.ts","../node_modules/abortcontroller-polyfill/dist/polyfill-patch-fetch.js","../src/api/fetch.ts","../src/api/index.ts","../node_modules/marked/lib/marked.esm.js","../node_modules/insane/she.js","../node_modules/assignment/assignment.js","../node_modules/insane/lowercase.js","../node_modules/insane/toMap.js","../node_modules/insane/attributes.js","../node_modules/insane/elements.js","../node_modules/insane/parser.js","../node_modules/insane/sanitizer.js","../node_modules/insane/insane.js","../node_modules/insane/defaults.js","../src/lib/sanitizer.ts","../node_modules/hanabi/dist/hanabi.js","../src/lib/highlight.ts","../src/lib/marked-renderer.ts","../src/lib/marked.ts","../src/lib/merge-deep.ts","../src/data.ts","../src/i18n/en.ts","../src/i18n/external.ts","../src/lib/utils.ts","../src/i18n/index.ts","../src/i18n/zh-CN.ts","../src/lib/event-manager.ts","../src/defaults.ts","../src/config.ts","../src/lib/watch-conf.ts","../src/context.ts","../src/api/handler.ts","../src/components/dialog.ts","../src/lib/ui.ts","../src/components/checker/captcha-renders.ts","../src/components/checker/captcha.ts","../src/components/checker/admin.ts","../src/components/checker/index.ts","../src/lib/component.ts","../src/editor/editor.html?raw","../src/editor/ui.ts","../src/plugins/editor/_plug.ts","../src/plugins/editor/mover.ts","../src/editor/state.ts","../src/editor/editor.ts","../src/layer/sidebar-layer.ts","../src/layer/sidebar-layer.html?raw","../src/list/layout/nest.ts","../src/list/nest.ts","../src/list/layout/flat.ts","../src/list/layout/index.ts","../src/comment/height-limit.ts","../src/comment/renders/header.ts","../src/components/action-btn.ts","../src/comment/renders/actions.ts","../src/comment/renders/index.ts","../src/comment/renders/avatar.ts","../src/comment/renders/content.ts","../src/comment/renders/reply-at.ts","../src/comment/renders/reply-to.ts","../src/comment/renders/pending.ts","../src/comment/render.ts","../src/comment/comment.html?raw","../src/comment/actions.ts","../src/comment/comment-node.ts","../src/lib/detect.ts","../src/components/read-more-btn.ts","../src/list/paginator/read-more.ts","../src/components/pagination.ts","../src/list/paginator/up-down.ts","../src/list/page.ts","../src/list/list.ts","../src/list/list.html?raw","../src/list/comment.ts","../src/layer/scrollbar-helper.ts","../src/layer/layer.ts","../src/layer/wrap.ts","../src/layer/layer-manager.ts","../src/lib/user.ts","../src/service.ts","../src/plugins/stat.ts","../src/components/error-dialog.ts","../src/plugins/markdown.ts","../src/plugins/editor/local-storage.ts","../src/plugins/editor/submit-add.ts","../src/plugins/editor/submit.ts","../src/plugins/editor/emoticons.ts","../src/plugins/editor/upload.ts","../src/plugins/editor/preview.ts","../src/plugins/editor/index.ts","../src/plugins/editor/header-event.ts","../src/plugins/editor/header-user.ts","../src/plugins/editor/header-link.ts","../src/plugins/editor/textarea.ts","../src/plugins/editor/submit-btn.ts","../src/plugins/editor/state-reply.ts","../src/plugins/editor/state-edit.ts","../src/plugins/editor/closable.ts","../src/plugins/editor/refresh.ts","../src/plugins/editor/_kit.ts","../src/plugins/editor-kit.ts","../src/plugins/list/goto-focus.ts","../src/plugins/version-check.ts","../src/plugins/dark-mode.ts","../src/load.ts","../src/plugins/index.ts","../src/plugins/admin-only-elem.ts","../src/plugins/list/index.ts","../src/plugins/list/fetch.ts","../src/plugins/list/loading.ts","../src/plugins/list/unread.ts","../src/plugins/list/with-editor.ts","../src/plugins/list/count.ts","../src/plugins/list/sidebar-btn.ts","../src/plugins/list/unread-badge.ts","../src/plugins/list/dropdown.ts","../src/plugins/list/goto-dispatcher.ts","../src/plugins/list/no-comment.ts","../src/plugins/list/copyright.ts","../src/plugins/list/time-ticking.ts","../src/plugins/list/error-dialog.ts","../src/plugins/list/reach-bottom.ts","../src/plugins/list/goto-first.ts","../src/plugins/notifies.ts","../src/artalk.ts","../src/main.ts"],"sourcesContent":["/* eslint-disable */\r\n/* tslint:disable */\r\n/*\r\n * ---------------------------------------------------------------\r\n * ## THIS FILE WAS GENERATED VIA SWAGGER-TYPESCRIPT-API        ##\r\n * ##                                                           ##\r\n * ## AUTHOR: acacode                                           ##\r\n * ## SOURCE: https://github.com/acacode/swagger-typescript-api ##\r\n * ---------------------------------------------------------------\r\n */\r\n\r\nexport interface CommonApiVersionData {\r\n  app: string\r\n  commit_hash: string\r\n  version: string\r\n}\r\n\r\nexport interface CommonConfData {\r\n  frontend_conf: CommonMap\r\n  version: CommonApiVersionData\r\n}\r\n\r\nexport interface CommonJSONResult {\r\n  /** Data */\r\n  data: any\r\n  /** Message */\r\n  msg: string\r\n}\r\n\r\nexport type CommonMap = Record<string, any>\r\n\r\nexport interface EntityCookedComment {\r\n  badge_color: string\r\n  badge_name: string\r\n  content: string\r\n  content_marked: string\r\n  date: string\r\n  email_encrypted: string\r\n  id: number\r\n  ip_region: string\r\n  is_allow_reply: boolean\r\n  is_collapsed: boolean\r\n  is_pending: boolean\r\n  is_pinned: boolean\r\n  is_verified: boolean\r\n  link: string\r\n  nick: string\r\n  page_key: string\r\n  page_url: string\r\n  rid: number\r\n  site_name: string\r\n  ua: string\r\n  user_id: number\r\n  visible: boolean\r\n  vote_down: number\r\n  vote_up: number\r\n}\r\n\r\nexport interface EntityCookedNotify {\r\n  comment_id: number\r\n  id: number\r\n  is_emailed: boolean\r\n  is_read: boolean\r\n  read_link: string\r\n  user_id: number\r\n}\r\n\r\nexport interface EntityCookedPage {\r\n  admin_only: boolean\r\n  id: number\r\n  key: string\r\n  pv: number\r\n  site_name: string\r\n  title: string\r\n  url: string\r\n  vote_down: number\r\n  vote_up: number\r\n}\r\n\r\nexport interface EntityCookedSite {\r\n  first_url: string\r\n  id: number\r\n  name: string\r\n  urls: string[]\r\n  urls_raw: string\r\n}\r\n\r\nexport interface EntityCookedUser {\r\n  badge_color: string\r\n  badge_name: string\r\n  email: string\r\n  id: number\r\n  is_admin: boolean\r\n  link: string\r\n  name: string\r\n  receive_email: boolean\r\n}\r\n\r\nexport interface EntityCookedUserForAdmin {\r\n  badge_color: string\r\n  badge_name: string\r\n  comment_count: number\r\n  email: string\r\n  id: number\r\n  is_admin: boolean\r\n  is_in_conf: boolean\r\n  last_ip: string\r\n  last_ua: string\r\n  link: string\r\n  name: string\r\n  receive_email: boolean\r\n}\r\n\r\nexport type HandlerMap = Record<string, any>\r\n\r\nexport interface HandlerParamsCaptchaVerify {\r\n  /** The captcha value to check */\r\n  value: string\r\n}\r\n\r\nexport interface HandlerParamsCommentCreate {\r\n  /** The comment content */\r\n  content: string\r\n  /** The comment email */\r\n  email: string\r\n  /** The comment link */\r\n  link?: string\r\n  /** The comment name */\r\n  name: string\r\n  /** The comment page_key */\r\n  page_key: string\r\n  /** The comment page_title */\r\n  page_title?: string\r\n  /** The comment rid */\r\n  rid?: number\r\n  /** The site name of your content scope */\r\n  site_name: string\r\n  /** The comment ua */\r\n  ua?: string\r\n}\r\n\r\nexport interface HandlerParamsCommentUpdate {\r\n  /** The comment content */\r\n  content: string\r\n  /** The comment email */\r\n  email?: string\r\n  /** The comment ip */\r\n  ip?: string\r\n  /** The comment is_collapsed */\r\n  is_collapsed: boolean\r\n  /** The comment is_pending */\r\n  is_pending: boolean\r\n  /** The comment is_pinned */\r\n  is_pinned: boolean\r\n  /** The comment link */\r\n  link?: string\r\n  /** The comment nick */\r\n  nick?: string\r\n  /** The comment page_key */\r\n  page_key: string\r\n  /** The comment rid */\r\n  rid: number\r\n  /** The site name of your content scope */\r\n  site_name: string\r\n  /** The comment ua */\r\n  ua?: string\r\n}\r\n\r\nexport interface HandlerParamsEmailSend {\r\n  /** The body of email */\r\n  body: string\r\n  /** The subject of email */\r\n  subject: string\r\n  /** The email address of the receiver */\r\n  to_addr: string\r\n}\r\n\r\nexport interface HandlerParamsNotifyReadAll {\r\n  /** The user email */\r\n  email: string\r\n  /** The username */\r\n  name: string\r\n}\r\n\r\nexport interface HandlerParamsPageFetchAll {\r\n  /** If not empty, only fetch pages of this site */\r\n  site_name?: string\r\n}\r\n\r\nexport interface HandlerParamsPagePV {\r\n  /** The page key */\r\n  page_key: string\r\n  /** The page title */\r\n  page_title?: string\r\n  /** The site name of your content scope */\r\n  site_name?: string\r\n}\r\n\r\nexport interface HandlerParamsPageUpdate {\r\n  /** Updated page admin_only option */\r\n  admin_only: boolean\r\n  /** Updated page key */\r\n  key: string\r\n  /** The site name of your content scope */\r\n  site_name: string\r\n  /** Updated page title */\r\n  title: string\r\n}\r\n\r\nexport interface HandlerParamsSettingApply {\r\n  /** The content of the config file in YAML format */\r\n  yaml: string\r\n}\r\n\r\nexport interface HandlerParamsSiteCreate {\r\n  /** The site name */\r\n  name: string\r\n  /** The site urls */\r\n  urls: string[]\r\n}\r\n\r\nexport interface HandlerParamsSiteUpdate {\r\n  /** Updated site name */\r\n  name: string\r\n  /** Updated site urls */\r\n  urls: string[]\r\n}\r\n\r\nexport interface HandlerParamsTransferImport {\r\n  /** Automatically answer yes for all questions. */\r\n  assumeyes?: boolean\r\n  /** The JSON data */\r\n  json_data?: string\r\n  /** The JSON file path */\r\n  json_file?: string\r\n  /** The target site name */\r\n  target_site_name?: string\r\n  /** The target site url */\r\n  target_site_url?: string\r\n  /** Enable URL resolver */\r\n  url_resolver?: boolean\r\n}\r\n\r\nexport interface HandlerParamsUserCreate {\r\n  /** The user badge color (hex format) */\r\n  badge_color?: string\r\n  /** The user badge name */\r\n  badge_name?: string\r\n  /** The user email */\r\n  email: string\r\n  /** The user is an admin */\r\n  is_admin: boolean\r\n  /** The user link */\r\n  link?: string\r\n  /** The user name */\r\n  name: string\r\n  /** The user password */\r\n  password?: string\r\n  /** The user receive email */\r\n  receive_email: boolean\r\n}\r\n\r\nexport interface HandlerParamsUserLogin {\r\n  /** The user email */\r\n  email: string\r\n  /** The username */\r\n  name?: string\r\n  /** The user password */\r\n  password: string\r\n}\r\n\r\nexport interface HandlerParamsUserUpdate {\r\n  /** The user badge color (hex format) */\r\n  badge_color?: string\r\n  /** The user badge name */\r\n  badge_name?: string\r\n  /** The user email */\r\n  email: string\r\n  /** The user is an admin */\r\n  is_admin: boolean\r\n  /** The user link */\r\n  link?: string\r\n  /** The user name */\r\n  name: string\r\n  /** The user password */\r\n  password?: string\r\n  /** The user receive email */\r\n  receive_email: boolean\r\n}\r\n\r\nexport interface HandlerParamsVote {\r\n  /** The user email */\r\n  email?: string\r\n  /** The username */\r\n  name?: string\r\n}\r\n\r\nexport interface HandlerResponseAdminUserList {\r\n  count: number\r\n  users: EntityCookedUserForAdmin[]\r\n}\r\n\r\nexport interface HandlerResponseCaptchaGet {\r\n  img_data: string\r\n}\r\n\r\nexport interface HandlerResponseCaptchaStatus {\r\n  is_pass: boolean\r\n}\r\n\r\nexport interface HandlerResponseCommentCreate {\r\n  badge_color: string\r\n  badge_name: string\r\n  content: string\r\n  content_marked: string\r\n  date: string\r\n  email_encrypted: string\r\n  id: number\r\n  ip_region: string\r\n  is_allow_reply: boolean\r\n  is_collapsed: boolean\r\n  is_pending: boolean\r\n  is_pinned: boolean\r\n  is_verified: boolean\r\n  link: string\r\n  nick: string\r\n  page_key: string\r\n  page_url: string\r\n  rid: number\r\n  site_name: string\r\n  ua: string\r\n  user_id: number\r\n  visible: boolean\r\n  vote_down: number\r\n  vote_up: number\r\n}\r\n\r\nexport interface HandlerResponseCommentGet {\r\n  /** The comment detail */\r\n  comment: EntityCookedComment\r\n  /** The reply comment if exists (like reply) */\r\n  reply_comment: EntityCookedComment\r\n}\r\n\r\nexport interface HandlerResponseCommentList {\r\n  comments: EntityCookedComment[]\r\n  count: number\r\n  page: EntityCookedPage\r\n  roots_count: number\r\n}\r\n\r\nexport interface HandlerResponseCommentUpdate {\r\n  badge_color: string\r\n  badge_name: string\r\n  content: string\r\n  content_marked: string\r\n  date: string\r\n  email_encrypted: string\r\n  id: number\r\n  ip_region: string\r\n  is_allow_reply: boolean\r\n  is_collapsed: boolean\r\n  is_pending: boolean\r\n  is_pinned: boolean\r\n  is_verified: boolean\r\n  link: string\r\n  nick: string\r\n  page_key: string\r\n  page_url: string\r\n  rid: number\r\n  site_name: string\r\n  ua: string\r\n  user_id: number\r\n  visible: boolean\r\n  vote_down: number\r\n  vote_up: number\r\n}\r\n\r\nexport interface HandlerResponseConfDomain {\r\n  /** Is the domain trusted */\r\n  is_trusted: boolean\r\n  /** The origin of the domain */\r\n  origin: string\r\n}\r\n\r\nexport interface HandlerResponseNotifyList {\r\n  count: number\r\n  notifies: EntityCookedNotify[]\r\n}\r\n\r\nexport interface HandlerResponsePageFetch {\r\n  admin_only: boolean\r\n  id: number\r\n  key: string\r\n  pv: number\r\n  site_name: string\r\n  title: string\r\n  url: string\r\n  vote_down: number\r\n  vote_up: number\r\n}\r\n\r\nexport interface HandlerResponsePageFetchStatus {\r\n  /** The number of pages that have been fetched */\r\n  done: number\r\n  /** If the task is in progress */\r\n  is_progress: boolean\r\n  /** The message of the task status */\r\n  msg: string\r\n  /** The total number of pages */\r\n  total: number\r\n}\r\n\r\nexport interface HandlerResponsePageList {\r\n  count: number\r\n  pages: EntityCookedPage[]\r\n}\r\n\r\nexport interface HandlerResponsePagePV {\r\n  pv: number\r\n}\r\n\r\nexport interface HandlerResponsePageUpdate {\r\n  admin_only: boolean\r\n  id: number\r\n  key: string\r\n  pv: number\r\n  site_name: string\r\n  title: string\r\n  url: string\r\n  vote_down: number\r\n  vote_up: number\r\n}\r\n\r\nexport interface HandlerResponseSettingGet {\r\n  yaml: string\r\n}\r\n\r\nexport interface HandlerResponseSettingTemplate {\r\n  yaml: string\r\n}\r\n\r\nexport interface HandlerResponseSiteCreate {\r\n  first_url: string\r\n  id: number\r\n  name: string\r\n  urls: string[]\r\n  urls_raw: string\r\n}\r\n\r\nexport interface HandlerResponseSiteList {\r\n  count: number\r\n  sites: EntityCookedSite[]\r\n}\r\n\r\nexport interface HandlerResponseSiteUpdate {\r\n  first_url: string\r\n  id: number\r\n  name: string\r\n  urls: string[]\r\n  urls_raw: string\r\n}\r\n\r\nexport interface HandlerResponseTransferExport {\r\n  /** The exported data which is a JSON string */\r\n  artrans: string\r\n}\r\n\r\nexport interface HandlerResponseTransferUpload {\r\n  /** The uploaded file name which can be used to import */\r\n  filename: string\r\n}\r\n\r\nexport interface HandlerResponseUpload {\r\n  file_name: string\r\n  file_type: string\r\n  public_url: string\r\n}\r\n\r\nexport interface HandlerResponseUserCreate {\r\n  badge_color: string\r\n  badge_name: string\r\n  comment_count: number\r\n  email: string\r\n  id: number\r\n  is_admin: boolean\r\n  is_in_conf: boolean\r\n  last_ip: string\r\n  last_ua: string\r\n  link: string\r\n  name: string\r\n  receive_email: boolean\r\n}\r\n\r\nexport interface HandlerResponseUserInfo {\r\n  is_login: boolean\r\n  notifies: EntityCookedNotify[]\r\n  notifies_count: number\r\n  user: EntityCookedUser\r\n}\r\n\r\nexport interface HandlerResponseUserLogin {\r\n  token: string\r\n  user: EntityCookedUser\r\n}\r\n\r\nexport interface HandlerResponseUserStatus {\r\n  is_admin: boolean\r\n  is_login: boolean\r\n}\r\n\r\nexport interface HandlerResponseUserUpdate {\r\n  badge_color: string\r\n  badge_name: string\r\n  comment_count: number\r\n  email: string\r\n  id: number\r\n  is_admin: boolean\r\n  is_in_conf: boolean\r\n  last_ip: string\r\n  last_ua: string\r\n  link: string\r\n  name: string\r\n  receive_email: boolean\r\n}\r\n\r\nexport interface HandlerResponseVote {\r\n  down: number\r\n  up: number\r\n}\r\n\r\nexport type QueryParamsType = Record<string | number, any>\r\nexport type ResponseFormat = keyof Omit<Body, 'body' | 'bodyUsed'>\r\n\r\nexport interface FullRequestParams extends Omit<RequestInit, 'body'> {\r\n  /** set parameter to `true` for call `securityWorker` for this request */\r\n  secure?: boolean\r\n  /** request path */\r\n  path: string\r\n  /** content type of request body */\r\n  type?: ContentType\r\n  /** query params */\r\n  query?: QueryParamsType\r\n  /** format of response (i.e. response.json() -> format: \"json\") */\r\n  format?: ResponseFormat\r\n  /** request body */\r\n  body?: unknown\r\n  /** base url */\r\n  baseUrl?: string\r\n  /** request cancellation token */\r\n  cancelToken?: CancelToken\r\n}\r\n\r\nexport type RequestParams = Omit<FullRequestParams, 'body' | 'method' | 'query' | 'path'>\r\n\r\nexport interface ApiConfig<SecurityDataType = unknown> {\r\n  baseUrl?: string\r\n  baseApiParams?: Omit<RequestParams, 'baseUrl' | 'cancelToken' | 'signal'>\r\n  securityWorker?: (securityData: SecurityDataType | null) => Promise<RequestParams | void> | RequestParams | void\r\n  customFetch?: typeof fetch\r\n}\r\n\r\nexport interface HttpResponse<D extends unknown, E extends unknown = unknown> extends Response {\r\n  data: D\r\n  error: E\r\n}\r\n\r\ntype CancelToken = Symbol | string | number\r\n\r\nexport enum ContentType {\r\n  Json = 'application/json',\r\n  FormData = 'multipart/form-data',\r\n  UrlEncoded = 'application/x-www-form-urlencoded',\r\n  Text = 'text/plain',\r\n}\r\n\r\nexport class HttpClient<SecurityDataType = unknown> {\r\n  public baseUrl: string = '/api/v2'\r\n  private securityData: SecurityDataType | null = null\r\n  private securityWorker?: ApiConfig<SecurityDataType>['securityWorker']\r\n  private abortControllers = new Map<CancelToken, AbortController>()\r\n  private customFetch = (...fetchParams: Parameters<typeof fetch>) => fetch(...fetchParams)\r\n\r\n  private baseApiParams: RequestParams = {\r\n    credentials: 'same-origin',\r\n    headers: {},\r\n    redirect: 'follow',\r\n    referrerPolicy: 'no-referrer',\r\n  }\r\n\r\n  constructor(apiConfig: ApiConfig<SecurityDataType> = {}) {\r\n    Object.assign(this, apiConfig)\r\n  }\r\n\r\n  public setSecurityData = (data: SecurityDataType | null) => {\r\n    this.securityData = data\r\n  }\r\n\r\n  protected encodeQueryParam(key: string, value: any) {\r\n    const encodedKey = encodeURIComponent(key)\r\n    return `${encodedKey}=${encodeURIComponent(typeof value === 'number' ? value : `${value}`)}`\r\n  }\r\n\r\n  protected addQueryParam(query: QueryParamsType, key: string) {\r\n    return this.encodeQueryParam(key, query[key])\r\n  }\r\n\r\n  protected addArrayQueryParam(query: QueryParamsType, key: string) {\r\n    const value = query[key]\r\n    return value.map((v: any) => this.encodeQueryParam(key, v)).join('&')\r\n  }\r\n\r\n  protected toQueryString(rawQuery?: QueryParamsType): string {\r\n    const query = rawQuery || {}\r\n    const keys = Object.keys(query).filter((key) => 'undefined' !== typeof query[key])\r\n    return keys\r\n      .map((key) => (Array.isArray(query[key]) ? this.addArrayQueryParam(query, key) : this.addQueryParam(query, key)))\r\n      .join('&')\r\n  }\r\n\r\n  protected addQueryParams(rawQuery?: QueryParamsType): string {\r\n    const queryString = this.toQueryString(rawQuery)\r\n    return queryString ? `?${queryString}` : ''\r\n  }\r\n\r\n  private contentFormatters: Record<ContentType, (input: any) => any> = {\r\n    [ContentType.Json]: (input: any) =>\r\n      input !== null && (typeof input === 'object' || typeof input === 'string') ? JSON.stringify(input) : input,\r\n    [ContentType.Text]: (input: any) => (input !== null && typeof input !== 'string' ? JSON.stringify(input) : input),\r\n    [ContentType.FormData]: (input: any) =>\r\n      Object.keys(input || {}).reduce((formData, key) => {\r\n        const property = input[key]\r\n        formData.append(\r\n          key,\r\n          property instanceof Blob\r\n            ? property\r\n            : typeof property === 'object' && property !== null\r\n            ? JSON.stringify(property)\r\n            : `${property}`,\r\n        )\r\n        return formData\r\n      }, new FormData()),\r\n    [ContentType.UrlEncoded]: (input: any) => this.toQueryString(input),\r\n  }\r\n\r\n  protected mergeRequestParams(params1: RequestParams, params2?: RequestParams): RequestParams {\r\n    return {\r\n      ...this.baseApiParams,\r\n      ...params1,\r\n      ...(params2 || {}),\r\n      headers: {\r\n        ...(this.baseApiParams.headers || {}),\r\n        ...(params1.headers || {}),\r\n        ...((params2 && params2.headers) || {}),\r\n      },\r\n    }\r\n  }\r\n\r\n  protected createAbortSignal = (cancelToken: CancelToken): AbortSignal | undefined => {\r\n    if (this.abortControllers.has(cancelToken)) {\r\n      const abortController = this.abortControllers.get(cancelToken)\r\n      if (abortController) {\r\n        return abortController.signal\r\n      }\r\n      return void 0\r\n    }\r\n\r\n    const abortController = new AbortController()\r\n    this.abortControllers.set(cancelToken, abortController)\r\n    return abortController.signal\r\n  }\r\n\r\n  public abortRequest = (cancelToken: CancelToken) => {\r\n    const abortController = this.abortControllers.get(cancelToken)\r\n\r\n    if (abortController) {\r\n      abortController.abort()\r\n      this.abortControllers.delete(cancelToken)\r\n    }\r\n  }\r\n\r\n  public request = async <T = any, E = any>({\r\n    body,\r\n    secure,\r\n    path,\r\n    type,\r\n    query,\r\n    format,\r\n    baseUrl,\r\n    cancelToken,\r\n    ...params\r\n  }: FullRequestParams): Promise<HttpResponse<T, E>> => {\r\n    const secureParams =\r\n      ((typeof secure === 'boolean' ? secure : this.baseApiParams.secure) &&\r\n        this.securityWorker &&\r\n        (await this.securityWorker(this.securityData))) ||\r\n      {}\r\n    const requestParams = this.mergeRequestParams(params, secureParams)\r\n    const queryString = query && this.toQueryString(query)\r\n    const payloadFormatter = this.contentFormatters[type || ContentType.Json]\r\n    const responseFormat = format || requestParams.format\r\n\r\n    return this.customFetch(`${baseUrl || this.baseUrl || ''}${path}${queryString ? `?${queryString}` : ''}`, {\r\n      ...requestParams,\r\n      headers: {\r\n        ...(requestParams.headers || {}),\r\n        ...(type && type !== ContentType.FormData ? { 'Content-Type': type } : {}),\r\n      },\r\n      signal: (cancelToken ? this.createAbortSignal(cancelToken) : requestParams.signal) || null,\r\n      body: typeof body === 'undefined' || body === null ? null : payloadFormatter(body),\r\n    }).then(async (response) => {\r\n      const r = response as HttpResponse<T, E>\r\n      r.data = null as unknown as T\r\n      r.error = null as unknown as E\r\n\r\n      const data = !responseFormat\r\n        ? r\r\n        : await response[responseFormat]()\r\n            .then((data) => {\r\n              if (r.ok) {\r\n                r.data = data\r\n              } else {\r\n                r.error = data\r\n              }\r\n              return r\r\n            })\r\n            .catch((e) => {\r\n              r.error = e\r\n              return r\r\n            })\r\n\r\n      if (cancelToken) {\r\n        this.abortControllers.delete(cancelToken)\r\n      }\r\n\r\n      if (!response.ok) throw data\r\n      return data\r\n    })\r\n  }\r\n}\r\n\r\n/**\r\n * @title Artalk API\r\n * @version 2.0\r\n * @license MIT (https://github.com/ArtalkJS/Artalk/blob/master/LICENSE)\r\n * @baseUrl /api/v2\r\n * @contact API Support <artalkjs@gmail.com> (https://artalk.js.org)\r\n *\r\n * Artalk is a modern comment system based on Golang.\r\n */\r\nexport class Api<SecurityDataType extends unknown> extends HttpClient<SecurityDataType> {\r\n  cache = {\r\n    /**\r\n * @description Flush all cache on the server\r\n *\r\n * @tags Cache\r\n * @name FlushCache\r\n * @summary Flush Cache\r\n * @request POST:/cache/flush\r\n * @secure\r\n * @response `200` `(HandlerMap & {\r\n    msg?: string,\r\n\r\n})` OK\r\n * @response `400` `(HandlerMap & {\r\n    msg?: string,\r\n\r\n})` Bad Request\r\n * @response `403` `(HandlerMap & {\r\n    msg?: string,\r\n\r\n})` Forbidden\r\n */\r\n    flushCache: (params: RequestParams = {}) =>\r\n      this.request<\r\n        HandlerMap & {\r\n          msg?: string\r\n        },\r\n        HandlerMap & {\r\n          msg?: string\r\n        }\r\n      >({\r\n        path: `/cache/flush`,\r\n        method: 'POST',\r\n        secure: true,\r\n        format: 'json',\r\n        ...params,\r\n      }),\r\n\r\n    /**\r\n * @description Cache warming helps you to pre-load the cache to improve the performance of the first request\r\n *\r\n * @tags Cache\r\n * @name WarmUpCache\r\n * @summary Warm-Up Cache\r\n * @request POST:/cache/warm_up\r\n * @secure\r\n * @response `200` `(HandlerMap & {\r\n    msg?: string,\r\n\r\n})` OK\r\n * @response `400` `(HandlerMap & {\r\n    msg?: string,\r\n\r\n})` Bad Request\r\n * @response `403` `(HandlerMap & {\r\n    msg?: string,\r\n\r\n})` Forbidden\r\n */\r\n    warmUpCache: (params: RequestParams = {}) =>\r\n      this.request<\r\n        HandlerMap & {\r\n          msg?: string\r\n        },\r\n        HandlerMap & {\r\n          msg?: string\r\n        }\r\n      >({\r\n        path: `/cache/warm_up`,\r\n        method: 'POST',\r\n        secure: true,\r\n        format: 'json',\r\n        ...params,\r\n      }),\r\n  }\r\n  captcha = {\r\n    /**\r\n * @description Get a base64 encoded captcha image or a HTML page to verify for user\r\n *\r\n * @tags Captcha\r\n * @name GetCaptcha\r\n * @summary Get Captcha\r\n * @request GET:/captcha\r\n * @response `200` `HandlerResponseCaptchaGet` OK\r\n * @response `500` `(HandlerMap & {\r\n    msg?: string,\r\n\r\n})` Internal Server Error\r\n */\r\n    getCaptcha: (params: RequestParams = {}) =>\r\n      this.request<\r\n        HandlerResponseCaptchaGet,\r\n        HandlerMap & {\r\n          msg?: string\r\n        }\r\n      >({\r\n        path: `/captcha`,\r\n        method: 'GET',\r\n        format: 'json',\r\n        ...params,\r\n      }),\r\n\r\n    /**\r\n     * @description Get the status of the user's captcha verification\r\n     *\r\n     * @tags Captcha\r\n     * @name GetCaptchaStatus\r\n     * @summary Get Captcha Status\r\n     * @request GET:/captcha/status\r\n     * @response `200` `HandlerResponseCaptchaStatus` OK\r\n     */\r\n    getCaptchaStatus: (params: RequestParams = {}) =>\r\n      this.request<HandlerResponseCaptchaStatus, any>({\r\n        path: `/captcha/status`,\r\n        method: 'GET',\r\n        format: 'json',\r\n        ...params,\r\n      }),\r\n\r\n    /**\r\n * @description Verify user enters correct captcha code\r\n *\r\n * @tags Captcha\r\n * @name VerifyCaptcha\r\n * @summary Verify Captcha\r\n * @request POST:/captcha/verify\r\n * @response `200` `HandlerMap` OK\r\n * @response `403` `(HandlerMap & {\r\n    img_data?: string,\r\n\r\n})` Forbidden\r\n */\r\n    verifyCaptcha: (data: HandlerParamsCaptchaVerify, params: RequestParams = {}) =>\r\n      this.request<\r\n        HandlerMap,\r\n        HandlerMap & {\r\n          img_data?: string\r\n        }\r\n      >({\r\n        path: `/captcha/verify`,\r\n        method: 'POST',\r\n        body: data,\r\n        type: ContentType.Json,\r\n        format: 'json',\r\n        ...params,\r\n      }),\r\n  }\r\n  comments = {\r\n    /**\r\n * @description Get a list of comments by some conditions\r\n *\r\n * @tags Comment\r\n * @name GetComments\r\n * @summary Get Comment List\r\n * @request GET:/comments\r\n * @secure\r\n * @response `200` `HandlerResponseCommentList` OK\r\n * @response `500` `(HandlerMap & {\r\n    msg?: string,\r\n\r\n})` Internal Server Error\r\n */\r\n    getComments: (\r\n      query: {\r\n        /** The user email */\r\n        email?: string\r\n        /** Enable flat_mode */\r\n        flat_mode?: boolean\r\n        /** The limit for pagination */\r\n        limit?: number\r\n        /** The username */\r\n        name?: string\r\n        /** The offset for pagination */\r\n        offset?: number\r\n        /** The comment page_key */\r\n        page_key: string\r\n        /** The scope of comments */\r\n        scope?: 'page' | 'user' | 'site'\r\n        /** Search keywords */\r\n        search?: string\r\n        /** The site name of your content scope */\r\n        site_name?: string\r\n        /** Sort by condition */\r\n        sort_by?: 'date_asc' | 'date_desc' | 'vote'\r\n        /** Message center show type */\r\n        type?: 'all' | 'mentions' | 'mine' | 'pending'\r\n        /** Only show comments by admin */\r\n        view_only_admin?: boolean\r\n      },\r\n      params: RequestParams = {},\r\n    ) =>\r\n      this.request<\r\n        HandlerResponseCommentList,\r\n        HandlerMap & {\r\n          msg?: string\r\n        }\r\n      >({\r\n        path: `/comments`,\r\n        method: 'GET',\r\n        query: query,\r\n        secure: true,\r\n        type: ContentType.Json,\r\n        format: 'json',\r\n        ...params,\r\n      }),\r\n\r\n    /**\r\n * @description Create a new comment\r\n *\r\n * @tags Comment\r\n * @name CreateComment\r\n * @summary Create Comment\r\n * @request POST:/comments\r\n * @secure\r\n * @response `200` `HandlerResponseCommentCreate` OK\r\n * @response `400` `(HandlerMap & {\r\n    msg?: string,\r\n\r\n})` Bad Request\r\n * @response `500` `(HandlerMap & {\r\n    msg?: string,\r\n\r\n})` Internal Server Error\r\n */\r\n    createComment: (comment: HandlerParamsCommentCreate, params: RequestParams = {}) =>\r\n      this.request<\r\n        HandlerResponseCommentCreate,\r\n        HandlerMap & {\r\n          msg?: string\r\n        }\r\n      >({\r\n        path: `/comments`,\r\n        method: 'POST',\r\n        body: comment,\r\n        secure: true,\r\n        type: ContentType.Json,\r\n        format: 'json',\r\n        ...params,\r\n      }),\r\n\r\n    /**\r\n * @description Get the detail of a comment by comment id\r\n *\r\n * @tags Comment\r\n * @name GetComment\r\n * @summary Get a comment\r\n * @request GET:/comments/{id}\r\n * @response `200` `HandlerResponseCommentGet` OK\r\n * @response `404` `(HandlerMap & {\r\n    msg?: string,\r\n\r\n})` Not Found\r\n * @response `500` `(HandlerMap & {\r\n    msg?: string,\r\n\r\n})` Internal Server Error\r\n */\r\n    getComment: (id: number, params: RequestParams = {}) =>\r\n      this.request<\r\n        HandlerResponseCommentGet,\r\n        HandlerMap & {\r\n          msg?: string\r\n        }\r\n      >({\r\n        path: `/comments/${id}`,\r\n        method: 'GET',\r\n        type: ContentType.Json,\r\n        format: 'json',\r\n        ...params,\r\n      }),\r\n\r\n    /**\r\n * @description Update a specific comment\r\n *\r\n * @tags Comment\r\n * @name UpdateComment\r\n * @summary Update Comment\r\n * @request PUT:/comments/{id}\r\n * @secure\r\n * @response `200` `HandlerResponseCommentUpdate` OK\r\n * @response `400` `(HandlerMap & {\r\n    msg?: string,\r\n\r\n})` Bad Request\r\n * @response `403` `(HandlerMap & {\r\n    msg?: string,\r\n\r\n})` Forbidden\r\n * @response `404` `(HandlerMap & {\r\n    msg?: string,\r\n\r\n})` Not Found\r\n * @response `500` `(HandlerMap & {\r\n    msg?: string,\r\n\r\n})` Internal Server Error\r\n */\r\n    updateComment: (id: number, comment: HandlerParamsCommentUpdate, params: RequestParams = {}) =>\r\n      this.request<\r\n        HandlerResponseCommentUpdate,\r\n        HandlerMap & {\r\n          msg?: string\r\n        }\r\n      >({\r\n        path: `/comments/${id}`,\r\n        method: 'PUT',\r\n        body: comment,\r\n        secure: true,\r\n        type: ContentType.Json,\r\n        format: 'json',\r\n        ...params,\r\n      }),\r\n\r\n    /**\r\n * @description Delete a specific comment\r\n *\r\n * @tags Comment\r\n * @name DeleteComment\r\n * @summary Delete Comment\r\n * @request DELETE:/comments/{id}\r\n * @secure\r\n * @response `200` `HandlerMap` OK\r\n * @response `403` `(HandlerMap & {\r\n    msg?: string,\r\n\r\n})` Forbidden\r\n * @response `404` `(HandlerMap & {\r\n    msg?: string,\r\n\r\n})` Not Found\r\n * @response `500` `(HandlerMap & {\r\n    msg?: string,\r\n\r\n})` Internal Server Error\r\n */\r\n    deleteComment: (id: number, params: RequestParams = {}) =>\r\n      this.request<\r\n        HandlerMap,\r\n        HandlerMap & {\r\n          msg?: string\r\n        }\r\n      >({\r\n        path: `/comments/${id}`,\r\n        method: 'DELETE',\r\n        secure: true,\r\n        format: 'json',\r\n        ...params,\r\n      }),\r\n  }\r\n  conf = {\r\n    /**\r\n     * @description Get System Configs for UI\r\n     *\r\n     * @tags System\r\n     * @name Conf\r\n     * @summary Get System Configs\r\n     * @request GET:/conf\r\n     * @response `200` `CommonConfData` OK\r\n     */\r\n    conf: (params: RequestParams = {}) =>\r\n      this.request<CommonConfData, any>({\r\n        path: `/conf`,\r\n        method: 'GET',\r\n        format: 'json',\r\n        ...params,\r\n      }),\r\n\r\n    /**\r\n     * @description Get Domain Info\r\n     *\r\n     * @tags System\r\n     * @name GetDomain\r\n     * @summary Get Domain Info\r\n     * @request GET:/conf/domain\r\n     * @response `200` `HandlerResponseConfDomain` OK\r\n     */\r\n    getDomain: (\r\n      query?: {\r\n        /** Domain URL */\r\n        url?: string\r\n      },\r\n      params: RequestParams = {},\r\n    ) =>\r\n      this.request<HandlerResponseConfDomain, any>({\r\n        path: `/conf/domain`,\r\n        method: 'GET',\r\n        query: query,\r\n        format: 'json',\r\n        ...params,\r\n      }),\r\n  }\r\n  notifies = {\r\n    /**\r\n * @description Get a list of notifies for user\r\n *\r\n * @tags Notify\r\n * @name GetNotifies\r\n * @summary Get Notifies\r\n * @request GET:/notifies\r\n * @response `200` `HandlerResponseNotifyList` OK\r\n * @response `400` `(HandlerMap & {\r\n    msg?: string,\r\n\r\n})` Bad Request\r\n * @response `500` `(HandlerMap & {\r\n    msg?: string,\r\n\r\n})` Internal Server Error\r\n */\r\n    getNotifies: (\r\n      query: {\r\n        /** The user email */\r\n        email: string\r\n        /** The user name */\r\n        name: string\r\n      },\r\n      params: RequestParams = {},\r\n    ) =>\r\n      this.request<\r\n        HandlerResponseNotifyList,\r\n        HandlerMap & {\r\n          msg?: string\r\n        }\r\n      >({\r\n        path: `/notifies`,\r\n        method: 'GET',\r\n        query: query,\r\n        type: ContentType.Json,\r\n        format: 'json',\r\n        ...params,\r\n      }),\r\n\r\n    /**\r\n * @description Mark all notifies as read for user\r\n *\r\n * @tags Notify\r\n * @name MarkAllNotifyRead\r\n * @summary Mark All Notifies as Read\r\n * @request POST:/notifies/read\r\n * @response `200` `HandlerMap` OK\r\n * @response `400` `(HandlerMap & {\r\n    msg?: string,\r\n\r\n})` Bad Request\r\n * @response `500` `(HandlerMap & {\r\n    msg?: string,\r\n\r\n})` Internal Server Error\r\n */\r\n    markAllNotifyRead: (options: HandlerParamsNotifyReadAll, params: RequestParams = {}) =>\r\n      this.request<\r\n        HandlerMap,\r\n        HandlerMap & {\r\n          msg?: string\r\n        }\r\n      >({\r\n        path: `/notifies/read`,\r\n        method: 'POST',\r\n        body: options,\r\n        type: ContentType.Json,\r\n        format: 'json',\r\n        ...params,\r\n      }),\r\n\r\n    /**\r\n * @description Mark specific notification as read for user\r\n *\r\n * @tags Notify\r\n * @name MarkNotifyRead\r\n * @summary Mark Notify as Read\r\n * @request POST:/notifies/{comment_id}/{notify_key}\r\n * @response `200` `HandlerMap` OK\r\n * @response `400` `(HandlerMap & {\r\n    msg?: string,\r\n\r\n})` Bad Request\r\n * @response `404` `(HandlerMap & {\r\n    msg?: string,\r\n\r\n})` Not Found\r\n * @response `500` `(HandlerMap & {\r\n    msg?: string,\r\n\r\n})` Internal Server Error\r\n */\r\n    markNotifyRead: (commentId: number, notifyKey: string, params: RequestParams = {}) =>\r\n      this.request<\r\n        HandlerMap,\r\n        HandlerMap & {\r\n          msg?: string\r\n        }\r\n      >({\r\n        path: `/notifies/${commentId}/${notifyKey}`,\r\n        method: 'POST',\r\n        format: 'json',\r\n        ...params,\r\n      }),\r\n  }\r\n  pages = {\r\n    /**\r\n * @description Get a list of pages by some conditions\r\n *\r\n * @tags Page\r\n * @name GetPages\r\n * @summary Get Page List\r\n * @request GET:/pages\r\n * @secure\r\n * @response `200` `HandlerResponsePageList` OK\r\n * @response `403` `(HandlerMap & {\r\n    msg?: string,\r\n\r\n})` Forbidden\r\n */\r\n    getPages: (\r\n      query?: {\r\n        /** The limit for pagination */\r\n        limit?: number\r\n        /** The offset for pagination */\r\n        offset?: number\r\n        /** The site name of your content scope */\r\n        site_name?: string\r\n      },\r\n      params: RequestParams = {},\r\n    ) =>\r\n      this.request<\r\n        HandlerResponsePageList,\r\n        HandlerMap & {\r\n          msg?: string\r\n        }\r\n      >({\r\n        path: `/pages`,\r\n        method: 'GET',\r\n        query: query,\r\n        secure: true,\r\n        type: ContentType.Json,\r\n        format: 'json',\r\n        ...params,\r\n      }),\r\n\r\n    /**\r\n * @description Fetch the data of all pages\r\n *\r\n * @tags Page\r\n * @name FetchAllPages\r\n * @summary Fetch All Pages Data\r\n * @request POST:/pages/fetch\r\n * @secure\r\n * @response `200` `HandlerMap` OK\r\n * @response `400` `(HandlerMap & {\r\n    msg?: string,\r\n\r\n})` Bad Request\r\n * @response `500` `(HandlerMap & {\r\n    msg?: string,\r\n\r\n})` Internal Server Error\r\n */\r\n    fetchAllPages: (options: HandlerParamsPageFetchAll, params: RequestParams = {}) =>\r\n      this.request<\r\n        HandlerMap,\r\n        HandlerMap & {\r\n          msg?: string\r\n        }\r\n      >({\r\n        path: `/pages/fetch`,\r\n        method: 'POST',\r\n        body: options,\r\n        secure: true,\r\n        type: ContentType.Json,\r\n        format: 'json',\r\n        ...params,\r\n      }),\r\n\r\n    /**\r\n     * @description Get the status of the task of fetching all pages\r\n     *\r\n     * @tags Page\r\n     * @name GetPageFetchStatus\r\n     * @summary Get Pages Fetch Status\r\n     * @request GET:/pages/fetch/status\r\n     * @secure\r\n     * @response `200` `HandlerResponsePageFetchStatus` OK\r\n     */\r\n    getPageFetchStatus: (params: RequestParams = {}) =>\r\n      this.request<HandlerResponsePageFetchStatus, any>({\r\n        path: `/pages/fetch/status`,\r\n        method: 'GET',\r\n        secure: true,\r\n        format: 'json',\r\n        ...params,\r\n      }),\r\n\r\n    /**\r\n     * @description Increase and get the number of page views\r\n     *\r\n     * @tags Page\r\n     * @name LogPv\r\n     * @summary Increase Page Views (PV)\r\n     * @request POST:/pages/pv\r\n     * @response `200` `HandlerResponsePagePV` OK\r\n     */\r\n    logPv: (page: HandlerParamsPagePV, params: RequestParams = {}) =>\r\n      this.request<HandlerResponsePagePV, any>({\r\n        path: `/pages/pv`,\r\n        method: 'POST',\r\n        body: page,\r\n        type: ContentType.Json,\r\n        format: 'json',\r\n        ...params,\r\n      }),\r\n\r\n    /**\r\n * @description Update a specific page\r\n *\r\n * @tags Page\r\n * @name UpdatePage\r\n * @summary Update Page\r\n * @request PUT:/pages/{id}\r\n * @secure\r\n * @response `200` `HandlerResponsePageUpdate` OK\r\n * @response `400` `(HandlerMap & {\r\n    msg?: string,\r\n\r\n})` Bad Request\r\n * @response `403` `(HandlerMap & {\r\n    msg?: string,\r\n\r\n})` Forbidden\r\n * @response `404` `(HandlerMap & {\r\n    msg?: string,\r\n\r\n})` Not Found\r\n * @response `500` `(HandlerMap & {\r\n    msg?: string,\r\n\r\n})` Internal Server Error\r\n */\r\n    updatePage: (id: number, page: HandlerParamsPageUpdate, params: RequestParams = {}) =>\r\n      this.request<\r\n        HandlerResponsePageUpdate,\r\n        HandlerMap & {\r\n          msg?: string\r\n        }\r\n      >({\r\n        path: `/pages/${id}`,\r\n        method: 'PUT',\r\n        body: page,\r\n        secure: true,\r\n        type: ContentType.Json,\r\n        format: 'json',\r\n        ...params,\r\n      }),\r\n\r\n    /**\r\n * @description Delete a specific page\r\n *\r\n * @tags Page\r\n * @name DeletePage\r\n * @summary Delete Page\r\n * @request DELETE:/pages/{id}\r\n * @secure\r\n * @response `200` `HandlerMap` OK\r\n * @response `403` `(HandlerMap & {\r\n    msg?: string,\r\n\r\n})` Forbidden\r\n * @response `404` `(HandlerMap & {\r\n    msg?: string,\r\n\r\n})` Not Found\r\n * @response `500` `(HandlerMap & {\r\n    msg?: string,\r\n\r\n})` Internal Server Error\r\n */\r\n    deletePage: (id: number, params: RequestParams = {}) =>\r\n      this.request<\r\n        HandlerMap,\r\n        HandlerMap & {\r\n          msg?: string\r\n        }\r\n      >({\r\n        path: `/pages/${id}`,\r\n        method: 'DELETE',\r\n        secure: true,\r\n        format: 'json',\r\n        ...params,\r\n      }),\r\n\r\n    /**\r\n * @description Fetch the data of a specific page\r\n *\r\n * @tags Page\r\n * @name FetchPage\r\n * @summary Fetch Page Data\r\n * @request POST:/pages/{id}/fetch\r\n * @secure\r\n * @response `200` `HandlerResponsePageFetch` OK\r\n * @response `404` `(HandlerMap & {\r\n    msg?: string,\r\n\r\n})` Not Found\r\n * @response `500` `(HandlerMap & {\r\n    msg?: string,\r\n\r\n})` Internal Server Error\r\n */\r\n    fetchPage: (id: number, params: RequestParams = {}) =>\r\n      this.request<\r\n        HandlerResponsePageFetch,\r\n        HandlerMap & {\r\n          msg?: string\r\n        }\r\n      >({\r\n        path: `/pages/${id}/fetch`,\r\n        method: 'POST',\r\n        secure: true,\r\n        type: ContentType.Json,\r\n        format: 'json',\r\n        ...params,\r\n      }),\r\n  }\r\n  sendEmail = {\r\n    /**\r\n * @description Send an email to test the email sender\r\n *\r\n * @tags System\r\n * @name SendEmail\r\n * @summary Send Email\r\n * @request POST:/send_email\r\n * @secure\r\n * @response `200` `HandlerMap` OK\r\n * @response `403` `(HandlerMap & {\r\n    msg?: string,\r\n\r\n})` Forbidden\r\n * @response `500` `HandlerMap` Internal Server Error\r\n */\r\n    sendEmail: (email: HandlerParamsEmailSend, params: RequestParams = {}) =>\r\n      this.request<\r\n        HandlerMap,\r\n        | (HandlerMap & {\r\n            msg?: string\r\n          })\r\n        | HandlerMap\r\n      >({\r\n        path: `/send_email`,\r\n        method: 'POST',\r\n        body: email,\r\n        secure: true,\r\n        type: ContentType.Json,\r\n        format: 'json',\r\n        ...params,\r\n      }),\r\n  }\r\n  settings = {\r\n    /**\r\n * @description Get settings from app config file\r\n *\r\n * @tags System\r\n * @name GetSettings\r\n * @summary Get Settings\r\n * @request GET:/settings\r\n * @secure\r\n * @response `200` `HandlerResponseSettingGet` OK\r\n * @response `403` `(HandlerMap & {\r\n    msg?: string,\r\n\r\n})` Forbidden\r\n * @response `500` `(HandlerMap & {\r\n    msg?: string,\r\n\r\n})` Internal Server Error\r\n */\r\n    getSettings: (params: RequestParams = {}) =>\r\n      this.request<\r\n        HandlerResponseSettingGet,\r\n        HandlerMap & {\r\n          msg?: string\r\n        }\r\n      >({\r\n        path: `/settings`,\r\n        method: 'GET',\r\n        secure: true,\r\n        format: 'json',\r\n        ...params,\r\n      }),\r\n\r\n    /**\r\n * @description Apply settings and restart the server\r\n *\r\n * @tags System\r\n * @name ApplySettings\r\n * @summary Save and apply Settings\r\n * @request PUT:/settings\r\n * @secure\r\n * @response `200` `HandlerMap` OK\r\n * @response `403` `(HandlerMap & {\r\n    msg?: string,\r\n\r\n})` Forbidden\r\n * @response `500` `(HandlerMap & {\r\n    msg?: string,\r\n\r\n})` Internal Server Error\r\n */\r\n    applySettings: (settings: HandlerParamsSettingApply, params: RequestParams = {}) =>\r\n      this.request<\r\n        HandlerMap,\r\n        HandlerMap & {\r\n          msg?: string\r\n        }\r\n      >({\r\n        path: `/settings`,\r\n        method: 'PUT',\r\n        body: settings,\r\n        secure: true,\r\n        type: ContentType.Json,\r\n        format: 'json',\r\n        ...params,\r\n      }),\r\n\r\n    /**\r\n     * @description Get config templates in different languages for rendering the settings page in the frontend\r\n     *\r\n     * @tags System\r\n     * @name GetSettingsTemplate\r\n     * @summary Get Settings Template\r\n     * @request GET:/settings/template/{locale}\r\n     * @secure\r\n     * @response `200` `HandlerResponseSettingTemplate` OK\r\n     */\r\n    getSettingsTemplate: (locale: string, params: RequestParams = {}) =>\r\n      this.request<HandlerResponseSettingTemplate, any>({\r\n        path: `/settings/template/${locale}`,\r\n        method: 'GET',\r\n        secure: true,\r\n        format: 'json',\r\n        ...params,\r\n      }),\r\n  }\r\n  sites = {\r\n    /**\r\n     * @description Get a list of sites by some conditions\r\n     *\r\n     * @tags Site\r\n     * @name GetSites\r\n     * @summary Get Site List\r\n     * @request GET:/sites\r\n     * @secure\r\n     * @response `200` `HandlerResponseSiteList` OK\r\n     */\r\n    getSites: (params: RequestParams = {}) =>\r\n      this.request<HandlerResponseSiteList, any>({\r\n        path: `/sites`,\r\n        method: 'GET',\r\n        secure: true,\r\n        format: 'json',\r\n        ...params,\r\n      }),\r\n\r\n    /**\r\n * @description Create a new site\r\n *\r\n * @tags Site\r\n * @name CreateSite\r\n * @summary Create Site\r\n * @request POST:/sites\r\n * @secure\r\n * @response `200` `HandlerResponseSiteCreate` OK\r\n * @response `400` `(HandlerMap & {\r\n    msg?: string,\r\n\r\n})` Bad Request\r\n * @response `403` `(HandlerMap & {\r\n    msg?: string,\r\n\r\n})` Forbidden\r\n * @response `500` `(HandlerMap & {\r\n    msg?: string,\r\n\r\n})` Internal Server Error\r\n */\r\n    createSite: (site: HandlerParamsSiteCreate, params: RequestParams = {}) =>\r\n      this.request<\r\n        HandlerResponseSiteCreate,\r\n        HandlerMap & {\r\n          msg?: string\r\n        }\r\n      >({\r\n        path: `/sites`,\r\n        method: 'POST',\r\n        body: site,\r\n        secure: true,\r\n        type: ContentType.Json,\r\n        format: 'json',\r\n        ...params,\r\n      }),\r\n\r\n    /**\r\n     * @description Update a specific site\r\n     *\r\n     * @tags Site\r\n     * @name UpdateSite\r\n     * @summary Update Site\r\n     * @request PUT:/sites/{id}\r\n     * @secure\r\n     * @response `200` `HandlerResponseSiteUpdate` OK\r\n     */\r\n    updateSite: (id: number, site: HandlerParamsSiteUpdate, params: RequestParams = {}) =>\r\n      this.request<HandlerResponseSiteUpdate, any>({\r\n        path: `/sites/${id}`,\r\n        method: 'PUT',\r\n        body: site,\r\n        secure: true,\r\n        type: ContentType.Json,\r\n        format: 'json',\r\n        ...params,\r\n      }),\r\n\r\n    /**\r\n * @description Delete a specific site\r\n *\r\n * @tags Site\r\n * @name DeleteSite\r\n * @summary Site Delete\r\n * @request DELETE:/sites/{id}\r\n * @secure\r\n * @response `200` `HandlerMap` OK\r\n * @response `403` `(HandlerMap & {\r\n    msg?: string,\r\n\r\n})` Forbidden\r\n * @response `404` `(HandlerMap & {\r\n    msg?: string,\r\n\r\n})` Not Found\r\n * @response `500` `(HandlerMap & {\r\n    msg?: string,\r\n\r\n})` Internal Server Error\r\n */\r\n    deleteSite: (id: number, params: RequestParams = {}) =>\r\n      this.request<\r\n        HandlerMap,\r\n        HandlerMap & {\r\n          msg?: string\r\n        }\r\n      >({\r\n        path: `/sites/${id}`,\r\n        method: 'DELETE',\r\n        secure: true,\r\n        format: 'json',\r\n        ...params,\r\n      }),\r\n  }\r\n  stats = {\r\n    /**\r\n * @description Get the statistics of various data analysis\r\n *\r\n * @tags Statistic\r\n * @name GetStats\r\n * @summary Statistic\r\n * @request GET:/stats/{type}\r\n * @response `200` `CommonJSONResult` OK\r\n * @response `400` `(HandlerMap & {\r\n    msg?: string,\r\n\r\n})` Bad Request\r\n * @response `403` `(HandlerMap & {\r\n    msg?: string,\r\n\r\n})` Forbidden\r\n * @response `404` `(HandlerMap & {\r\n    msg?: string,\r\n\r\n})` Not Found\r\n * @response `500` `(HandlerMap & {\r\n    msg?: string,\r\n\r\n})` Internal Server Error\r\n */\r\n    getStats: (\r\n      type:\r\n        | 'latest_comments'\r\n        | 'latest_pages'\r\n        | 'pv_most_pages'\r\n        | 'comment_most_pages'\r\n        | 'page_pv'\r\n        | 'site_pv'\r\n        | 'page_comment'\r\n        | 'site_comment'\r\n        | 'rand_comments'\r\n        | 'rand_pages',\r\n      query?: {\r\n        /** The limit for pagination */\r\n        limit?: number\r\n        /** multiple page keys separated by commas */\r\n        page_keys?: string\r\n        /** The site name of your content scope */\r\n        site_name?: string\r\n      },\r\n      params: RequestParams = {},\r\n    ) =>\r\n      this.request<\r\n        CommonJSONResult,\r\n        HandlerMap & {\r\n          msg?: string\r\n        }\r\n      >({\r\n        path: `/stats/${type}`,\r\n        method: 'GET',\r\n        query: query,\r\n        type: ContentType.Json,\r\n        format: 'json',\r\n        ...params,\r\n      }),\r\n  }\r\n  transfer = {\r\n    /**\r\n * @description Export data from Artalk\r\n *\r\n * @tags Transfer\r\n * @name ExportArtrans\r\n * @summary Export Artrans\r\n * @request GET:/transfer/export\r\n * @secure\r\n * @response `200` `HandlerResponseTransferExport` OK\r\n * @response `500` `(HandlerMap & {\r\n    msg?: string,\r\n\r\n})` Internal Server Error\r\n */\r\n    exportArtrans: (params: RequestParams = {}) =>\r\n      this.request<\r\n        HandlerResponseTransferExport,\r\n        HandlerMap & {\r\n          msg?: string\r\n        }\r\n      >({\r\n        path: `/transfer/export`,\r\n        method: 'GET',\r\n        secure: true,\r\n        format: 'json',\r\n        ...params,\r\n      }),\r\n\r\n    /**\r\n     * @description Import data to Artalk\r\n     *\r\n     * @tags Transfer\r\n     * @name ImportArtrans\r\n     * @summary Import Artrans\r\n     * @request POST:/transfer/import\r\n     * @secure\r\n     * @response `200` `string` OK\r\n     */\r\n    importArtrans: (data: HandlerParamsTransferImport, params: RequestParams = {}) =>\r\n      this.request<string, any>({\r\n        path: `/transfer/import`,\r\n        method: 'POST',\r\n        body: data,\r\n        secure: true,\r\n        type: ContentType.Json,\r\n        ...params,\r\n      }),\r\n\r\n    /**\r\n * @description Upload a file to prepare to import\r\n *\r\n * @tags Transfer\r\n * @name UploadArtrans\r\n * @summary Upload Artrans\r\n * @request POST:/transfer/upload\r\n * @secure\r\n * @response `200` `(HandlerResponseTransferUpload & {\r\n    filename?: string,\r\n\r\n})` OK\r\n * @response `500` `(HandlerMap & {\r\n    msg?: string,\r\n\r\n})` Internal Server Error\r\n */\r\n    uploadArtrans: (\r\n      data: {\r\n        /**\r\n         * Upload file in preparation for import task\r\n         * @format binary\r\n         */\r\n        file: File\r\n      },\r\n      params: RequestParams = {},\r\n    ) =>\r\n      this.request<\r\n        HandlerResponseTransferUpload & {\r\n          filename?: string\r\n        },\r\n        HandlerMap & {\r\n          msg?: string\r\n        }\r\n      >({\r\n        path: `/transfer/upload`,\r\n        method: 'POST',\r\n        body: data,\r\n        secure: true,\r\n        type: ContentType.FormData,\r\n        format: 'json',\r\n        ...params,\r\n      }),\r\n  }\r\n  upload = {\r\n    /**\r\n * @description Upload file from this endpoint\r\n *\r\n * @tags Upload\r\n * @name Upload\r\n * @summary Upload\r\n * @request POST:/upload\r\n * @secure\r\n * @response `200` `HandlerResponseUpload` OK\r\n * @response `400` `(HandlerMap & {\r\n    msg?: string,\r\n\r\n})` Bad Request\r\n * @response `403` `(HandlerMap & {\r\n    msg?: string,\r\n\r\n})` Forbidden\r\n * @response `500` `(HandlerMap & {\r\n    msg?: string,\r\n\r\n})` Internal Server Error\r\n */\r\n    upload: (\r\n      data: {\r\n        /**\r\n         * Upload file\r\n         * @format binary\r\n         */\r\n        file: File\r\n      },\r\n      params: RequestParams = {},\r\n    ) =>\r\n      this.request<\r\n        HandlerResponseUpload,\r\n        HandlerMap & {\r\n          msg?: string\r\n        }\r\n      >({\r\n        path: `/upload`,\r\n        method: 'POST',\r\n        body: data,\r\n        secure: true,\r\n        type: ContentType.FormData,\r\n        format: 'json',\r\n        ...params,\r\n      }),\r\n  }\r\n  user = {\r\n    /**\r\n * @description Get user info to prepare for login or check current user status\r\n *\r\n * @tags Auth\r\n * @name GetUser\r\n * @summary Get User Info\r\n * @request GET:/user\r\n * @secure\r\n * @response `200` `HandlerResponseUserInfo` OK\r\n * @response `400` `(HandlerMap & {\r\n    msg?: string,\r\n\r\n})` Bad Request\r\n */\r\n    getUser: (\r\n      query?: {\r\n        /** The user email */\r\n        email?: string\r\n        /** The username */\r\n        name?: string\r\n      },\r\n      params: RequestParams = {},\r\n    ) =>\r\n      this.request<\r\n        HandlerResponseUserInfo,\r\n        HandlerMap & {\r\n          msg?: string\r\n        }\r\n      >({\r\n        path: `/user`,\r\n        method: 'GET',\r\n        query: query,\r\n        secure: true,\r\n        format: 'json',\r\n        ...params,\r\n      }),\r\n\r\n    /**\r\n * @description Login user by name or email\r\n *\r\n * @tags Auth\r\n * @name Login\r\n * @summary Get Access Token\r\n * @request POST:/user/access_token\r\n * @response `200` `HandlerResponseUserLogin` OK\r\n * @response `400` `(HandlerMap & {\r\n    data?: {\r\n    need_name_select?: (string)[],\r\n\r\n},\r\n    msg?: string,\r\n\r\n})` Multiple users with the same email address are matched\r\n * @response `401` `(HandlerMap & {\r\n    msg?: string,\r\n\r\n})` Unauthorized\r\n * @response `500` `(HandlerMap & {\r\n    msg?: string,\r\n\r\n})` Internal Server Error\r\n */\r\n    login: (user: HandlerParamsUserLogin, params: RequestParams = {}) =>\r\n      this.request<\r\n        HandlerResponseUserLogin,\r\n        | (HandlerMap & {\r\n            data?: {\r\n              need_name_select?: string[]\r\n            }\r\n            msg?: string\r\n          })\r\n        | (HandlerMap & {\r\n            msg?: string\r\n          })\r\n      >({\r\n        path: `/user/access_token`,\r\n        method: 'POST',\r\n        body: user,\r\n        type: ContentType.Json,\r\n        format: 'json',\r\n        ...params,\r\n      }),\r\n\r\n    /**\r\n     * @description Get user login status by header Authorization\r\n     *\r\n     * @tags Auth\r\n     * @name GetUserStatus\r\n     * @summary Get Login Status\r\n     * @request GET:/user/status\r\n     * @secure\r\n     * @response `200` `HandlerResponseUserStatus` OK\r\n     */\r\n    getUserStatus: (\r\n      query?: {\r\n        /** The user email */\r\n        email?: string\r\n        /** The username */\r\n        name?: string\r\n      },\r\n      params: RequestParams = {},\r\n    ) =>\r\n      this.request<HandlerResponseUserStatus, any>({\r\n        path: `/user/status`,\r\n        method: 'GET',\r\n        query: query,\r\n        secure: true,\r\n        format: 'json',\r\n        ...params,\r\n      }),\r\n  }\r\n  users = {\r\n    /**\r\n * @description Create a new user\r\n *\r\n * @tags User\r\n * @name CreateUser\r\n * @summary Create User\r\n * @request POST:/users\r\n * @secure\r\n * @response `200` `HandlerResponseUserCreate` OK\r\n * @response `400` `(HandlerMap & {\r\n    msg?: string,\r\n\r\n})` Bad Request\r\n * @response `403` `(HandlerMap & {\r\n    msg?: string,\r\n\r\n})` Forbidden\r\n * @response `500` `(HandlerMap & {\r\n    msg?: string,\r\n\r\n})` Internal Server Error\r\n */\r\n    createUser: (user: HandlerParamsUserCreate, params: RequestParams = {}) =>\r\n      this.request<\r\n        HandlerResponseUserCreate,\r\n        HandlerMap & {\r\n          msg?: string\r\n        }\r\n      >({\r\n        path: `/users`,\r\n        method: 'POST',\r\n        body: user,\r\n        secure: true,\r\n        type: ContentType.Json,\r\n        format: 'json',\r\n        ...params,\r\n      }),\r\n\r\n    /**\r\n * @description Update a specific user\r\n *\r\n * @tags User\r\n * @name UpdateUser\r\n * @summary Update User\r\n * @request PUT:/users/{id}\r\n * @secure\r\n * @response `200` `HandlerResponseUserUpdate` OK\r\n * @response `400` `(HandlerMap & {\r\n    msg?: string,\r\n\r\n})` Bad Request\r\n * @response `403` `(HandlerMap & {\r\n    msg?: string,\r\n\r\n})` Forbidden\r\n * @response `404` `(HandlerMap & {\r\n    msg?: string,\r\n\r\n})` Not Found\r\n * @response `500` `(HandlerMap & {\r\n    msg?: string,\r\n\r\n})` Internal Server Error\r\n */\r\n    updateUser: (id: number, user: HandlerParamsUserUpdate, params: RequestParams = {}) =>\r\n      this.request<\r\n        HandlerResponseUserUpdate,\r\n        HandlerMap & {\r\n          msg?: string\r\n        }\r\n      >({\r\n        path: `/users/${id}`,\r\n        method: 'PUT',\r\n        body: user,\r\n        secure: true,\r\n        type: ContentType.Json,\r\n        format: 'json',\r\n        ...params,\r\n      }),\r\n\r\n    /**\r\n * @description Delete a specific user\r\n *\r\n * @tags User\r\n * @name DeleteUser\r\n * @summary Delete User\r\n * @request DELETE:/users/{id}\r\n * @secure\r\n * @response `200` `HandlerMap` OK\r\n * @response `403` `(HandlerMap & {\r\n    msg?: string,\r\n\r\n})` Forbidden\r\n * @response `404` `(HandlerMap & {\r\n    msg?: string,\r\n\r\n})` Not Found\r\n * @response `500` `(HandlerMap & {\r\n    msg?: string,\r\n\r\n})` Internal Server Error\r\n */\r\n    deleteUser: (id: number, params: RequestParams = {}) =>\r\n      this.request<\r\n        HandlerMap,\r\n        HandlerMap & {\r\n          msg?: string\r\n        }\r\n      >({\r\n        path: `/users/${id}`,\r\n        method: 'DELETE',\r\n        secure: true,\r\n        format: 'json',\r\n        ...params,\r\n      }),\r\n\r\n    /**\r\n * @description Get a list of users by some conditions\r\n *\r\n * @tags User\r\n * @name GetUsers\r\n * @summary Get User List\r\n * @request GET:/users/{type}\r\n * @secure\r\n * @response `200` `HandlerResponseAdminUserList` OK\r\n * @response `403` `(HandlerMap & {\r\n    msg?: string,\r\n\r\n})` Forbidden\r\n */\r\n    getUsers: (\r\n      type?: 'all' | 'admin' | 'in_conf',\r\n      query?: {\r\n        /** The limit for pagination */\r\n        limit?: number\r\n        /** The offset for pagination */\r\n        offset?: number\r\n      },\r\n      params: RequestParams = {},\r\n    ) =>\r\n      this.request<\r\n        HandlerResponseAdminUserList,\r\n        HandlerMap & {\r\n          msg?: string\r\n        }\r\n      >({\r\n        path: `/users/${type}`,\r\n        method: 'GET',\r\n        query: query,\r\n        secure: true,\r\n        type: ContentType.Json,\r\n        format: 'json',\r\n        ...params,\r\n      }),\r\n  }\r\n  version = {\r\n    /**\r\n     * @description Get the version of Artalk\r\n     *\r\n     * @tags System\r\n     * @name GetVersion\r\n     * @summary Get Version Info\r\n     * @request GET:/version\r\n     * @response `200` `CommonApiVersionData` OK\r\n     */\r\n    getVersion: (params: RequestParams = {}) =>\r\n      this.request<CommonApiVersionData, any>({\r\n        path: `/version`,\r\n        method: 'GET',\r\n        format: 'json',\r\n        ...params,\r\n      }),\r\n  }\r\n  votes = {\r\n    /**\r\n * @description Sync the number of votes in the `comments` or `pages` data tables to keep them the same as the `votes` table\r\n *\r\n * @tags Vote\r\n * @name SyncVotes\r\n * @summary Sync Vote Data\r\n * @request POST:/votes/sync\r\n * @secure\r\n * @response `200` `HandlerMap` OK\r\n * @response `403` `(HandlerMap & {\r\n    msg?: string,\r\n\r\n})` Forbidden\r\n */\r\n    syncVotes: (params: RequestParams = {}) =>\r\n      this.request<\r\n        HandlerMap,\r\n        HandlerMap & {\r\n          msg?: string\r\n        }\r\n      >({\r\n        path: `/votes/sync`,\r\n        method: 'POST',\r\n        secure: true,\r\n        format: 'json',\r\n        ...params,\r\n      }),\r\n\r\n    /**\r\n * @description Vote for a specific comment or page\r\n *\r\n * @tags Vote\r\n * @name Vote\r\n * @summary Vote\r\n * @request POST:/votes/{type}/{target_id}\r\n * @response `200` `HandlerResponseVote` OK\r\n * @response `403` `(HandlerMap & {\r\n    msg?: string,\r\n\r\n})` Forbidden\r\n * @response `404` `(HandlerMap & {\r\n    msg?: string,\r\n\r\n})` Not Found\r\n * @response `500` `(HandlerMap & {\r\n    msg?: string,\r\n\r\n})` Internal Server Error\r\n */\r\n    vote: (\r\n      type: 'comment_up' | 'comment_down' | 'page_up' | 'page_down',\r\n      targetId: number,\r\n      vote: HandlerParamsVote,\r\n      params: RequestParams = {},\r\n    ) =>\r\n      this.request<\r\n        HandlerResponseVote,\r\n        HandlerMap & {\r\n          msg?: string\r\n        }\r\n      >({\r\n        path: `/votes/${type}/${targetId}`,\r\n        method: 'POST',\r\n        body: vote,\r\n        type: ContentType.Json,\r\n        format: 'json',\r\n        ...params,\r\n      }),\r\n  }\r\n}\r\n","(function (factory) {\n  typeof define === 'function' && define.amd ? define(factory) :\n  factory();\n})((function () { 'use strict';\n\n  function _arrayLikeToArray(r, a) {\n    (null == a || a > r.length) && (a = r.length);\n    for (var e = 0, n = Array(a); e < a; e++) n[e] = r[e];\n    return n;\n  }\n  function _assertThisInitialized(e) {\n    if (void 0 === e) throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\");\n    return e;\n  }\n  function _callSuper(t, o, e) {\n    return o = _getPrototypeOf(o), _possibleConstructorReturn(t, _isNativeReflectConstruct() ? Reflect.construct(o, e || [], _getPrototypeOf(t).constructor) : o.apply(t, e));\n  }\n  function _classCallCheck(a, n) {\n    if (!(a instanceof n)) throw new TypeError(\"Cannot call a class as a function\");\n  }\n  function _defineProperties(e, r) {\n    for (var t = 0; t < r.length; t++) {\n      var o = r[t];\n      o.enumerable = o.enumerable || !1, o.configurable = !0, \"value\" in o && (o.writable = !0), Object.defineProperty(e, _toPropertyKey(o.key), o);\n    }\n  }\n  function _createClass(e, r, t) {\n    return r && _defineProperties(e.prototype, r), t && _defineProperties(e, t), Object.defineProperty(e, \"prototype\", {\n      writable: !1\n    }), e;\n  }\n  function _createForOfIteratorHelper(r, e) {\n    var t = \"undefined\" != typeof Symbol && r[Symbol.iterator] || r[\"@@iterator\"];\n    if (!t) {\n      if (Array.isArray(r) || (t = _unsupportedIterableToArray(r)) || e && r && \"number\" == typeof r.length) {\n        t && (r = t);\n        var n = 0,\n          F = function () {};\n        return {\n          s: F,\n          n: function () {\n            return n >= r.length ? {\n              done: !0\n            } : {\n              done: !1,\n              value: r[n++]\n            };\n          },\n          e: function (r) {\n            throw r;\n          },\n          f: F\n        };\n      }\n      throw new TypeError(\"Invalid attempt to iterate non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\");\n    }\n    var o,\n      a = !0,\n      u = !1;\n    return {\n      s: function () {\n        t = t.call(r);\n      },\n      n: function () {\n        var r = t.next();\n        return a = r.done, r;\n      },\n      e: function (r) {\n        u = !0, o = r;\n      },\n      f: function () {\n        try {\n          a || null == t.return || t.return();\n        } finally {\n          if (u) throw o;\n        }\n      }\n    };\n  }\n  function _get() {\n    return _get = \"undefined\" != typeof Reflect && Reflect.get ? Reflect.get.bind() : function (e, t, r) {\n      var p = _superPropBase(e, t);\n      if (p) {\n        var n = Object.getOwnPropertyDescriptor(p, t);\n        return n.get ? n.get.call(arguments.length < 3 ? e : r) : n.value;\n      }\n    }, _get.apply(null, arguments);\n  }\n  function _getPrototypeOf(t) {\n    return _getPrototypeOf = Object.setPrototypeOf ? Object.getPrototypeOf.bind() : function (t) {\n      return t.__proto__ || Object.getPrototypeOf(t);\n    }, _getPrototypeOf(t);\n  }\n  function _inherits(t, e) {\n    if (\"function\" != typeof e && null !== e) throw new TypeError(\"Super expression must either be null or a function\");\n    t.prototype = Object.create(e && e.prototype, {\n      constructor: {\n        value: t,\n        writable: !0,\n        configurable: !0\n      }\n    }), Object.defineProperty(t, \"prototype\", {\n      writable: !1\n    }), e && _setPrototypeOf(t, e);\n  }\n  function _isNativeReflectConstruct() {\n    try {\n      var t = !Boolean.prototype.valueOf.call(Reflect.construct(Boolean, [], function () {}));\n    } catch (t) {}\n    return (_isNativeReflectConstruct = function () {\n      return !!t;\n    })();\n  }\n  function _possibleConstructorReturn(t, e) {\n    if (e && (\"object\" == typeof e || \"function\" == typeof e)) return e;\n    if (void 0 !== e) throw new TypeError(\"Derived constructors may only return object or undefined\");\n    return _assertThisInitialized(t);\n  }\n  function _setPrototypeOf(t, e) {\n    return _setPrototypeOf = Object.setPrototypeOf ? Object.setPrototypeOf.bind() : function (t, e) {\n      return t.__proto__ = e, t;\n    }, _setPrototypeOf(t, e);\n  }\n  function _superPropBase(t, o) {\n    for (; !{}.hasOwnProperty.call(t, o) && null !== (t = _getPrototypeOf(t)););\n    return t;\n  }\n  function _superPropGet(t, o, e, r) {\n    var p = _get(_getPrototypeOf(1 & r ? t.prototype : t), o, e);\n    return 2 & r && \"function\" == typeof p ? function (t) {\n      return p.apply(e, t);\n    } : p;\n  }\n  function _toPrimitive(t, r) {\n    if (\"object\" != typeof t || !t) return t;\n    var e = t[Symbol.toPrimitive];\n    if (void 0 !== e) {\n      var i = e.call(t, r || \"default\");\n      if (\"object\" != typeof i) return i;\n      throw new TypeError(\"@@toPrimitive must return a primitive value.\");\n    }\n    return (\"string\" === r ? String : Number)(t);\n  }\n  function _toPropertyKey(t) {\n    var i = _toPrimitive(t, \"string\");\n    return \"symbol\" == typeof i ? i : i + \"\";\n  }\n  function _unsupportedIterableToArray(r, a) {\n    if (r) {\n      if (\"string\" == typeof r) return _arrayLikeToArray(r, a);\n      var t = {}.toString.call(r).slice(8, -1);\n      return \"Object\" === t && r.constructor && (t = r.constructor.name), \"Map\" === t || \"Set\" === t ? Array.from(r) : \"Arguments\" === t || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t) ? _arrayLikeToArray(r, a) : void 0;\n    }\n  }\n\n  (function (self) {\n      return {\n        NativeAbortSignal: self.AbortSignal,\n        NativeAbortController: self.AbortController\n      };\n    })(typeof self !== 'undefined' ? self : global);\n\n  /**\n   * @param {any} reason abort reason\n   */\n  function createAbortEvent(reason) {\n    var event;\n    try {\n      event = new Event('abort');\n    } catch (e) {\n      if (typeof document !== 'undefined') {\n        if (!document.createEvent) {\n          // For Internet Explorer 8:\n          event = document.createEventObject();\n          event.type = 'abort';\n        } else {\n          // For Internet Explorer 11:\n          event = document.createEvent('Event');\n          event.initEvent('abort', false, false);\n        }\n      } else {\n        // Fallback where document isn't available:\n        event = {\n          type: 'abort',\n          bubbles: false,\n          cancelable: false\n        };\n      }\n    }\n    event.reason = reason;\n    return event;\n  }\n\n  /**\n   * @param {any} reason abort reason\n   */\n  function normalizeAbortReason(reason) {\n    if (reason === undefined) {\n      if (typeof document === 'undefined') {\n        reason = new Error('This operation was aborted');\n        reason.name = 'AbortError';\n      } else {\n        try {\n          reason = new DOMException('signal is aborted without reason');\n          // The DOMException does not support setting the name property directly.\n          Object.defineProperty(reason, 'name', {\n            value: 'AbortError'\n          });\n        } catch (err) {\n          // IE 11 does not support calling the DOMException constructor, use a\n          // regular error object on it instead.\n          reason = new Error('This operation was aborted');\n          reason.name = 'AbortError';\n        }\n      }\n    }\n    return reason;\n  }\n\n  var Emitter = /*#__PURE__*/function () {\n    function Emitter() {\n      _classCallCheck(this, Emitter);\n      Object.defineProperty(this, 'listeners', {\n        value: {},\n        writable: true,\n        configurable: true\n      });\n    }\n    return _createClass(Emitter, [{\n      key: \"addEventListener\",\n      value: function addEventListener(type, callback, options) {\n        if (!(type in this.listeners)) {\n          this.listeners[type] = [];\n        }\n        this.listeners[type].push({\n          callback: callback,\n          options: options\n        });\n      }\n    }, {\n      key: \"removeEventListener\",\n      value: function removeEventListener(type, callback) {\n        if (!(type in this.listeners)) {\n          return;\n        }\n        var stack = this.listeners[type];\n        for (var i = 0, l = stack.length; i < l; i++) {\n          if (stack[i].callback === callback) {\n            stack.splice(i, 1);\n            return;\n          }\n        }\n      }\n    }, {\n      key: \"dispatchEvent\",\n      value: function dispatchEvent(event) {\n        var _this = this;\n        if (!(event.type in this.listeners)) {\n          return;\n        }\n        var stack = this.listeners[event.type];\n        var stackToCall = stack.slice();\n        var _loop = function _loop() {\n          var listener = stackToCall[i];\n          try {\n            listener.callback.call(_this, event);\n          } catch (e) {\n            Promise.resolve().then(function () {\n              throw e;\n            });\n          }\n          if (listener.options && listener.options.once) {\n            _this.removeEventListener(event.type, listener.callback);\n          }\n        };\n        for (var i = 0, l = stackToCall.length; i < l; i++) {\n          _loop();\n        }\n        return !event.defaultPrevented;\n      }\n    }]);\n  }();\n  var AbortSignal = /*#__PURE__*/function (_Emitter) {\n    function AbortSignal() {\n      var _this2;\n      _classCallCheck(this, AbortSignal);\n      _this2 = _callSuper(this, AbortSignal);\n      // Some versions of babel does not transpile super() correctly for IE <= 10, if the parent\n      // constructor has failed to run, then \"this.listeners\" will still be undefined and then we call\n      // the parent constructor directly instead as a workaround. For general details, see babel bug:\n      // https://github.com/babel/babel/issues/3041\n      // This hack was added as a fix for the issue described here:\n      // https://github.com/Financial-Times/polyfill-library/pull/59#issuecomment-477558042\n      if (!_this2.listeners) {\n        Emitter.call(_this2);\n      }\n\n      // Compared to assignment, Object.defineProperty makes properties non-enumerable by default and\n      // we want Object.keys(new AbortController().signal) to be [] for compat with the native impl\n      Object.defineProperty(_this2, 'aborted', {\n        value: false,\n        writable: true,\n        configurable: true\n      });\n      Object.defineProperty(_this2, 'onabort', {\n        value: null,\n        writable: true,\n        configurable: true\n      });\n      Object.defineProperty(_this2, 'reason', {\n        value: undefined,\n        writable: true,\n        configurable: true\n      });\n      return _this2;\n    }\n    _inherits(AbortSignal, _Emitter);\n    return _createClass(AbortSignal, [{\n      key: \"toString\",\n      value: function toString() {\n        return '[object AbortSignal]';\n      }\n    }, {\n      key: \"dispatchEvent\",\n      value: function dispatchEvent(event) {\n        if (event.type === 'abort') {\n          this.aborted = true;\n          if (typeof this.onabort === 'function') {\n            this.onabort.call(this, event);\n          }\n        }\n        _superPropGet(AbortSignal, \"dispatchEvent\", this, 3)([event]);\n      }\n\n      /**\n       * @see {@link https://developer.mozilla.org/zh-CN/docs/Web/API/AbortSignal/throwIfAborted}\n       */\n    }, {\n      key: \"throwIfAborted\",\n      value: function throwIfAborted() {\n        var aborted = this.aborted,\n          _this$reason = this.reason,\n          reason = _this$reason === void 0 ? 'Aborted' : _this$reason;\n        if (!aborted) return;\n        throw reason;\n      }\n\n      /**\n       * @see {@link https://developer.mozilla.org/zh-CN/docs/Web/API/AbortSignal/timeout_static}\n       * @param {number} time The \"active\" time in milliseconds before the returned {@link AbortSignal} will abort.\n       *                      The value must be within range of 0 and {@link Number.MAX_SAFE_INTEGER}.\n       * @returns {AbortSignal} The signal will abort with its {@link AbortSignal.reason} property set to a `TimeoutError` {@link DOMException} on timeout,\n       *                        or an `AbortError` {@link DOMException} if the operation was user-triggered.\n       */\n    }], [{\n      key: \"timeout\",\n      value: function timeout(time) {\n        var controller = new AbortController();\n        setTimeout(function () {\n          return controller.abort(new DOMException(\"This signal is timeout in \".concat(time, \"ms\"), 'TimeoutError'));\n        }, time);\n        return controller.signal;\n      }\n\n      /**\n       * @see {@link https://developer.mozilla.org/en-US/docs/Web/API/AbortSignal/any_static}\n       * @param {Iterable<AbortSignal>} iterable An {@link Iterable} (such as an {@link Array}) of abort signals.\n       * @returns {AbortSignal} - **Already aborted**, if any of the abort signals given is already aborted.\n       *                          The returned {@link AbortSignal}'s reason will be already set to the `reason` of the first abort signal that was already aborted.\n       *                        - **Asynchronously aborted**, when any abort signal in `iterable` aborts.\n       *                          The `reason` will be set to the reason of the first abort signal that is aborted.\n       */\n    }, {\n      key: \"any\",\n      value: function any(iterable) {\n        var controller = new AbortController();\n        /**\n         * @this AbortSignal\n         */\n        function abort() {\n          controller.abort(this.reason);\n          clean();\n        }\n        function clean() {\n          var _iterator = _createForOfIteratorHelper(iterable),\n            _step;\n          try {\n            for (_iterator.s(); !(_step = _iterator.n()).done;) {\n              var signal = _step.value;\n              signal.removeEventListener('abort', abort);\n            }\n          } catch (err) {\n            _iterator.e(err);\n          } finally {\n            _iterator.f();\n          }\n        }\n        var _iterator2 = _createForOfIteratorHelper(iterable),\n          _step2;\n        try {\n          for (_iterator2.s(); !(_step2 = _iterator2.n()).done;) {\n            var signal = _step2.value;\n            if (signal.aborted) {\n              controller.abort(signal.reason);\n              break;\n            } else signal.addEventListener('abort', abort);\n          }\n        } catch (err) {\n          _iterator2.e(err);\n        } finally {\n          _iterator2.f();\n        }\n        return controller.signal;\n      }\n    }]);\n  }(Emitter);\n  var AbortController = /*#__PURE__*/function () {\n    function AbortController() {\n      _classCallCheck(this, AbortController);\n      // Compared to assignment, Object.defineProperty makes properties non-enumerable by default and\n      // we want Object.keys(new AbortController()) to be [] for compat with the native impl\n      Object.defineProperty(this, 'signal', {\n        value: new AbortSignal(),\n        writable: true,\n        configurable: true\n      });\n    }\n    return _createClass(AbortController, [{\n      key: \"abort\",\n      value: function abort(reason) {\n        var signalReason = normalizeAbortReason(reason);\n        var event = createAbortEvent(signalReason);\n        this.signal.reason = signalReason;\n        this.signal.dispatchEvent(event);\n      }\n    }, {\n      key: \"toString\",\n      value: function toString() {\n        return '[object AbortController]';\n      }\n    }]);\n  }();\n  if (typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n    // These are necessary to make sure that we get correct output for:\n    // Object.prototype.toString.call(new AbortController())\n    AbortController.prototype[Symbol.toStringTag] = 'AbortController';\n    AbortSignal.prototype[Symbol.toStringTag] = 'AbortSignal';\n  }\n\n  function polyfillNeeded(self) {\n    if (self.__FORCE_INSTALL_ABORTCONTROLLER_POLYFILL) {\n      console.log('__FORCE_INSTALL_ABORTCONTROLLER_POLYFILL=true is set, will force install polyfill');\n      return true;\n    }\n\n    // Note that the \"unfetch\" minimal fetch polyfill defines fetch() without\n    // defining window.Request, and this polyfill need to work on top of unfetch\n    // so the below feature detection needs the !self.AbortController part.\n    // The Request.prototype check is also needed because Safari versions 11.1.2\n    // up to and including 12.1.x has a window.AbortController present but still\n    // does NOT correctly implement abortable fetch:\n    // https://bugs.webkit.org/show_bug.cgi?id=174980#c2\n    return typeof self.Request === 'function' && !self.Request.prototype.hasOwnProperty('signal') || !self.AbortController;\n  }\n\n  /**\n   * Note: the \"fetch.Request\" default value is available for fetch imported from\n   * the \"node-fetch\" package and not in browsers. This is OK since browsers\n   * will be importing umd-polyfill.js from that path \"self\" is passed the\n   * decorator so the default value will not be used (because browsers that define\n   * fetch also has Request). One quirky setup where self.fetch exists but\n   * self.Request does not is when the \"unfetch\" minimal fetch polyfill is used\n   * on top of IE11; for this case the browser will try to use the fetch.Request\n   * default value which in turn will be undefined but then then \"if (Request)\"\n   * will ensure that you get a patched fetch but still no Request (as expected).\n   * @param {fetch, Request = fetch.Request}\n   * @returns {fetch: abortableFetch, Request: AbortableRequest}\n   */\n  function abortableFetchDecorator(patchTargets) {\n    if ('function' === typeof patchTargets) {\n      patchTargets = {\n        fetch: patchTargets\n      };\n    }\n    var _patchTargets = patchTargets,\n      fetch = _patchTargets.fetch,\n      _patchTargets$Request = _patchTargets.Request,\n      NativeRequest = _patchTargets$Request === void 0 ? fetch.Request : _patchTargets$Request,\n      NativeAbortController = _patchTargets.AbortController,\n      _patchTargets$__FORCE = _patchTargets.__FORCE_INSTALL_ABORTCONTROLLER_POLYFILL,\n      __FORCE_INSTALL_ABORTCONTROLLER_POLYFILL = _patchTargets$__FORCE === void 0 ? false : _patchTargets$__FORCE;\n    if (!polyfillNeeded({\n      fetch: fetch,\n      Request: NativeRequest,\n      AbortController: NativeAbortController,\n      __FORCE_INSTALL_ABORTCONTROLLER_POLYFILL: __FORCE_INSTALL_ABORTCONTROLLER_POLYFILL\n    })) {\n      return {\n        fetch: fetch,\n        Request: Request\n      };\n    }\n    var Request = NativeRequest;\n    // Note that the \"unfetch\" minimal fetch polyfill defines fetch() without\n    // defining window.Request, and this polyfill need to work on top of unfetch\n    // hence we only patch it if it's available. Also we don't patch it if signal\n    // is already available on the Request prototype because in this case support\n    // is present and the patching below can cause a crash since it assigns to\n    // request.signal which is technically a read-only property. This latter error\n    // happens when you run the main5.js node-fetch example in the repo\n    // \"abortcontroller-polyfill-examples\". The exact error is:\n    //   request.signal = init.signal;\n    //   ^\n    // TypeError: Cannot set property signal of #<Request> which has only a getter\n    if (Request && !Request.prototype.hasOwnProperty('signal') || __FORCE_INSTALL_ABORTCONTROLLER_POLYFILL) {\n      Request = function Request(input, init) {\n        var signal;\n        if (init && init.signal) {\n          signal = init.signal;\n          // Never pass init.signal to the native Request implementation when the polyfill has\n          // been installed because if we're running on top of a browser with a\n          // working native AbortController (i.e. the polyfill was installed due to\n          // __FORCE_INSTALL_ABORTCONTROLLER_POLYFILL being set), then passing our\n          // fake AbortSignal to the native fetch will trigger:\n          // TypeError: Failed to construct 'Request': member signal is not of type AbortSignal.\n          delete init.signal;\n        }\n        var request = new NativeRequest(input, init);\n        if (signal) {\n          Object.defineProperty(request, 'signal', {\n            writable: false,\n            enumerable: false,\n            configurable: true,\n            value: signal\n          });\n        }\n        return request;\n      };\n      Request.prototype = NativeRequest.prototype;\n    }\n    var realFetch = fetch;\n    var abortableFetch = function abortableFetch(input, init) {\n      var signal = Request && Request.prototype.isPrototypeOf(input) ? input.signal : init ? init.signal : undefined;\n      if (signal) {\n        var abortError;\n        try {\n          abortError = new DOMException('Aborted', 'AbortError');\n        } catch (err) {\n          // IE 11 does not support calling the DOMException constructor, use a\n          // regular error object on it instead.\n          abortError = new Error('Aborted');\n          abortError.name = 'AbortError';\n        }\n\n        // Return early if already aborted, thus avoiding making an HTTP request\n        if (signal.aborted) {\n          return Promise.reject(abortError);\n        }\n\n        // Turn an event into a promise, reject it once `abort` is dispatched\n        var cancellation = new Promise(function (_, reject) {\n          signal.addEventListener('abort', function () {\n            return reject(abortError);\n          }, {\n            once: true\n          });\n        });\n        if (init && init.signal) {\n          // Never pass .signal to the native implementation when the polyfill has\n          // been installed because if we're running on top of a browser with a\n          // working native AbortController (i.e. the polyfill was installed due to\n          // __FORCE_INSTALL_ABORTCONTROLLER_POLYFILL being set), then passing our\n          // fake AbortSignal to the native fetch will trigger:\n          // TypeError: Failed to execute 'fetch' on 'Window': member signal is not of type AbortSignal.\n          delete init.signal;\n        }\n        // Return the fastest promise (don't need to wait for request to finish)\n        return Promise.race([cancellation, realFetch(input, init)]);\n      }\n      return realFetch(input, init);\n    };\n    return {\n      fetch: abortableFetch,\n      Request: Request\n    };\n  }\n\n  (function (self) {\n\n    if (!polyfillNeeded(self)) {\n      return;\n    }\n    if (!self.fetch) {\n      console.warn('fetch() is not available, cannot install abortcontroller-polyfill');\n      return;\n    }\n    var _abortableFetch = abortableFetchDecorator(self),\n      fetch = _abortableFetch.fetch,\n      Request = _abortableFetch.Request;\n    self.fetch = fetch;\n    self.Request = Request;\n    Object.defineProperty(self, 'AbortController', {\n      writable: true,\n      enumerable: false,\n      configurable: true,\n      value: AbortController\n    });\n    Object.defineProperty(self, 'AbortSignal', {\n      writable: true,\n      enumerable: false,\n      configurable: true,\n      value: AbortSignal\n    });\n  })(typeof self !== 'undefined' ? self : global);\n\n}));\n","import 'abortcontroller-polyfill/dist/polyfill-patch-fetch'\r\n\r\nimport { FetchError } from '@/types'\r\nimport { ApiOptions } from './options'\r\n\r\nexport const Fetch = async (\r\n  opts: ApiOptions,\r\n  input: string | URL | Request,\r\n  init?: RequestInit,\r\n) => {\r\n  const apiToken = opts.getApiToken && opts.getApiToken()\r\n\r\n  const headers = new Headers({\r\n    Authorization: apiToken ? `Bearer ${apiToken}` : '',\r\n    ...init?.headers,\r\n  })\r\n\r\n  if (!headers.get('Authorization')) headers.delete('Authorization')\r\n\r\n  // 请求操作\r\n  const resp = await fetch(input, {\r\n    ...init,\r\n    headers,\r\n  })\r\n\r\n  if (!resp.ok) {\r\n    // Deserialize response body (if it is JSON, otherwise returns `{}`)\r\n    const json: any = (await resp.json().catch(() => {})) || {}\r\n\r\n    let retry = false\r\n    opts.handlers &&\r\n      (await opts.handlers.get().reduce(async (promise, item) => {\r\n        await promise\r\n        if (json[item.action] === true) {\r\n          await item.handler(json)\r\n          retry = true\r\n        }\r\n      }, Promise.resolve()))\r\n\r\n    if (retry) return Fetch(opts, input, init)\r\n    throw createError(resp.status, json)\r\n  }\r\n\r\n  return resp\r\n}\r\n\r\nexport class FetchException extends Error implements FetchError {\r\n  code: number = 0\r\n  message: string = 'fetch error'\r\n  data?: any\r\n}\r\n\r\nfunction createError(code: number, data: any): FetchException {\r\n  const err = new FetchException()\r\n  err.message = data.msg || data.message || 'fetch error'\r\n  err.code = code\r\n  err.data = data\r\n  console.error(err)\r\n  return err\r\n}\r\n","import { ApiOptions } from './options'\r\nimport { Api as ApiV2 } from './v2'\r\nimport { Fetch } from './fetch'\r\n\r\nexport * from './options'\r\nexport * from './handler'\r\n\r\nexport class Api extends ApiV2<void> {\r\n  private _opts: ApiOptions\r\n\r\n  constructor(opts: ApiOptions) {\r\n    super({\r\n      baseUrl: opts.baseURL,\r\n      customFetch: (input, init) => Fetch(opts, input, init),\r\n    })\r\n\r\n    this._opts = opts\r\n  }\r\n\r\n  /**\r\n   * Get user info as params for request\r\n   *\r\n   * @returns Request params with user info\r\n   */\r\n  getUserFields() {\r\n    const user = this._opts.userInfo\r\n    if (!user?.name || !user?.email) return undefined\r\n    return { name: user.name, email: user.email }\r\n  }\r\n}\r\n","/**\n * marked v12.0.2 - a markdown parser\n * Copyright (c) 2011-2024, Christopher Jeffrey. (MIT Licensed)\n * https://github.com/markedjs/marked\n */\n\n/**\n * DO NOT EDIT THIS FILE\n * The code in this file is generated from files in ./src/\n */\n\n/**\n * Gets the original marked default options.\n */\nfunction _getDefaults() {\n    return {\n        async: false,\n        breaks: false,\n        extensions: null,\n        gfm: true,\n        hooks: null,\n        pedantic: false,\n        renderer: null,\n        silent: false,\n        tokenizer: null,\n        walkTokens: null\n    };\n}\nlet _defaults = _getDefaults();\nfunction changeDefaults(newDefaults) {\n    _defaults = newDefaults;\n}\n\n/**\n * Helpers\n */\nconst escapeTest = /[&<>\"']/;\nconst escapeReplace = new RegExp(escapeTest.source, 'g');\nconst escapeTestNoEncode = /[<>\"']|&(?!(#\\d{1,7}|#[Xx][a-fA-F0-9]{1,6}|\\w+);)/;\nconst escapeReplaceNoEncode = new RegExp(escapeTestNoEncode.source, 'g');\nconst escapeReplacements = {\n    '&': '&amp;',\n    '<': '&lt;',\n    '>': '&gt;',\n    '\"': '&quot;',\n    \"'\": '&#39;'\n};\nconst getEscapeReplacement = (ch) => escapeReplacements[ch];\nfunction escape$1(html, encode) {\n    if (encode) {\n        if (escapeTest.test(html)) {\n            return html.replace(escapeReplace, getEscapeReplacement);\n        }\n    }\n    else {\n        if (escapeTestNoEncode.test(html)) {\n            return html.replace(escapeReplaceNoEncode, getEscapeReplacement);\n        }\n    }\n    return html;\n}\nconst unescapeTest = /&(#(?:\\d+)|(?:#x[0-9A-Fa-f]+)|(?:\\w+));?/ig;\nfunction unescape(html) {\n    // explicitly match decimal, hex, and named HTML entities\n    return html.replace(unescapeTest, (_, n) => {\n        n = n.toLowerCase();\n        if (n === 'colon')\n            return ':';\n        if (n.charAt(0) === '#') {\n            return n.charAt(1) === 'x'\n                ? String.fromCharCode(parseInt(n.substring(2), 16))\n                : String.fromCharCode(+n.substring(1));\n        }\n        return '';\n    });\n}\nconst caret = /(^|[^\\[])\\^/g;\nfunction edit(regex, opt) {\n    let source = typeof regex === 'string' ? regex : regex.source;\n    opt = opt || '';\n    const obj = {\n        replace: (name, val) => {\n            let valSource = typeof val === 'string' ? val : val.source;\n            valSource = valSource.replace(caret, '$1');\n            source = source.replace(name, valSource);\n            return obj;\n        },\n        getRegex: () => {\n            return new RegExp(source, opt);\n        }\n    };\n    return obj;\n}\nfunction cleanUrl(href) {\n    try {\n        href = encodeURI(href).replace(/%25/g, '%');\n    }\n    catch (e) {\n        return null;\n    }\n    return href;\n}\nconst noopTest = { exec: () => null };\nfunction splitCells(tableRow, count) {\n    // ensure that every cell-delimiting pipe has a space\n    // before it to distinguish it from an escaped pipe\n    const row = tableRow.replace(/\\|/g, (match, offset, str) => {\n        let escaped = false;\n        let curr = offset;\n        while (--curr >= 0 && str[curr] === '\\\\')\n            escaped = !escaped;\n        if (escaped) {\n            // odd number of slashes means | is escaped\n            // so we leave it alone\n            return '|';\n        }\n        else {\n            // add space before unescaped |\n            return ' |';\n        }\n    }), cells = row.split(/ \\|/);\n    let i = 0;\n    // First/last cell in a row cannot be empty if it has no leading/trailing pipe\n    if (!cells[0].trim()) {\n        cells.shift();\n    }\n    if (cells.length > 0 && !cells[cells.length - 1].trim()) {\n        cells.pop();\n    }\n    if (count) {\n        if (cells.length > count) {\n            cells.splice(count);\n        }\n        else {\n            while (cells.length < count)\n                cells.push('');\n        }\n    }\n    for (; i < cells.length; i++) {\n        // leading or trailing whitespace is ignored per the gfm spec\n        cells[i] = cells[i].trim().replace(/\\\\\\|/g, '|');\n    }\n    return cells;\n}\n/**\n * Remove trailing 'c's. Equivalent to str.replace(/c*$/, '').\n * /c*$/ is vulnerable to REDOS.\n *\n * @param str\n * @param c\n * @param invert Remove suffix of non-c chars instead. Default falsey.\n */\nfunction rtrim(str, c, invert) {\n    const l = str.length;\n    if (l === 0) {\n        return '';\n    }\n    // Length of suffix matching the invert condition.\n    let suffLen = 0;\n    // Step left until we fail to match the invert condition.\n    while (suffLen < l) {\n        const currChar = str.charAt(l - suffLen - 1);\n        if (currChar === c && !invert) {\n            suffLen++;\n        }\n        else if (currChar !== c && invert) {\n            suffLen++;\n        }\n        else {\n            break;\n        }\n    }\n    return str.slice(0, l - suffLen);\n}\nfunction findClosingBracket(str, b) {\n    if (str.indexOf(b[1]) === -1) {\n        return -1;\n    }\n    let level = 0;\n    for (let i = 0; i < str.length; i++) {\n        if (str[i] === '\\\\') {\n            i++;\n        }\n        else if (str[i] === b[0]) {\n            level++;\n        }\n        else if (str[i] === b[1]) {\n            level--;\n            if (level < 0) {\n                return i;\n            }\n        }\n    }\n    return -1;\n}\n\nfunction outputLink(cap, link, raw, lexer) {\n    const href = link.href;\n    const title = link.title ? escape$1(link.title) : null;\n    const text = cap[1].replace(/\\\\([\\[\\]])/g, '$1');\n    if (cap[0].charAt(0) !== '!') {\n        lexer.state.inLink = true;\n        const token = {\n            type: 'link',\n            raw,\n            href,\n            title,\n            text,\n            tokens: lexer.inlineTokens(text)\n        };\n        lexer.state.inLink = false;\n        return token;\n    }\n    return {\n        type: 'image',\n        raw,\n        href,\n        title,\n        text: escape$1(text)\n    };\n}\nfunction indentCodeCompensation(raw, text) {\n    const matchIndentToCode = raw.match(/^(\\s+)(?:```)/);\n    if (matchIndentToCode === null) {\n        return text;\n    }\n    const indentToCode = matchIndentToCode[1];\n    return text\n        .split('\\n')\n        .map(node => {\n        const matchIndentInNode = node.match(/^\\s+/);\n        if (matchIndentInNode === null) {\n            return node;\n        }\n        const [indentInNode] = matchIndentInNode;\n        if (indentInNode.length >= indentToCode.length) {\n            return node.slice(indentToCode.length);\n        }\n        return node;\n    })\n        .join('\\n');\n}\n/**\n * Tokenizer\n */\nclass _Tokenizer {\n    options;\n    rules; // set by the lexer\n    lexer; // set by the lexer\n    constructor(options) {\n        this.options = options || _defaults;\n    }\n    space(src) {\n        const cap = this.rules.block.newline.exec(src);\n        if (cap && cap[0].length > 0) {\n            return {\n                type: 'space',\n                raw: cap[0]\n            };\n        }\n    }\n    code(src) {\n        const cap = this.rules.block.code.exec(src);\n        if (cap) {\n            const text = cap[0].replace(/^ {1,4}/gm, '');\n            return {\n                type: 'code',\n                raw: cap[0],\n                codeBlockStyle: 'indented',\n                text: !this.options.pedantic\n                    ? rtrim(text, '\\n')\n                    : text\n            };\n        }\n    }\n    fences(src) {\n        const cap = this.rules.block.fences.exec(src);\n        if (cap) {\n            const raw = cap[0];\n            const text = indentCodeCompensation(raw, cap[3] || '');\n            return {\n                type: 'code',\n                raw,\n                lang: cap[2] ? cap[2].trim().replace(this.rules.inline.anyPunctuation, '$1') : cap[2],\n                text\n            };\n        }\n    }\n    heading(src) {\n        const cap = this.rules.block.heading.exec(src);\n        if (cap) {\n            let text = cap[2].trim();\n            // remove trailing #s\n            if (/#$/.test(text)) {\n                const trimmed = rtrim(text, '#');\n                if (this.options.pedantic) {\n                    text = trimmed.trim();\n                }\n                else if (!trimmed || / $/.test(trimmed)) {\n                    // CommonMark requires space before trailing #s\n                    text = trimmed.trim();\n                }\n            }\n            return {\n                type: 'heading',\n                raw: cap[0],\n                depth: cap[1].length,\n                text,\n                tokens: this.lexer.inline(text)\n            };\n        }\n    }\n    hr(src) {\n        const cap = this.rules.block.hr.exec(src);\n        if (cap) {\n            return {\n                type: 'hr',\n                raw: cap[0]\n            };\n        }\n    }\n    blockquote(src) {\n        const cap = this.rules.block.blockquote.exec(src);\n        if (cap) {\n            // precede setext continuation with 4 spaces so it isn't a setext\n            let text = cap[0].replace(/\\n {0,3}((?:=+|-+) *)(?=\\n|$)/g, '\\n    $1');\n            text = rtrim(text.replace(/^ *>[ \\t]?/gm, ''), '\\n');\n            const top = this.lexer.state.top;\n            this.lexer.state.top = true;\n            const tokens = this.lexer.blockTokens(text);\n            this.lexer.state.top = top;\n            return {\n                type: 'blockquote',\n                raw: cap[0],\n                tokens,\n                text\n            };\n        }\n    }\n    list(src) {\n        let cap = this.rules.block.list.exec(src);\n        if (cap) {\n            let bull = cap[1].trim();\n            const isordered = bull.length > 1;\n            const list = {\n                type: 'list',\n                raw: '',\n                ordered: isordered,\n                start: isordered ? +bull.slice(0, -1) : '',\n                loose: false,\n                items: []\n            };\n            bull = isordered ? `\\\\d{1,9}\\\\${bull.slice(-1)}` : `\\\\${bull}`;\n            if (this.options.pedantic) {\n                bull = isordered ? bull : '[*+-]';\n            }\n            // Get next list item\n            const itemRegex = new RegExp(`^( {0,3}${bull})((?:[\\t ][^\\\\n]*)?(?:\\\\n|$))`);\n            let raw = '';\n            let itemContents = '';\n            let endsWithBlankLine = false;\n            // Check if current bullet point can start a new List Item\n            while (src) {\n                let endEarly = false;\n                if (!(cap = itemRegex.exec(src))) {\n                    break;\n                }\n                if (this.rules.block.hr.test(src)) { // End list if bullet was actually HR (possibly move into itemRegex?)\n                    break;\n                }\n                raw = cap[0];\n                src = src.substring(raw.length);\n                let line = cap[2].split('\\n', 1)[0].replace(/^\\t+/, (t) => ' '.repeat(3 * t.length));\n                let nextLine = src.split('\\n', 1)[0];\n                let indent = 0;\n                if (this.options.pedantic) {\n                    indent = 2;\n                    itemContents = line.trimStart();\n                }\n                else {\n                    indent = cap[2].search(/[^ ]/); // Find first non-space char\n                    indent = indent > 4 ? 1 : indent; // Treat indented code blocks (> 4 spaces) as having only 1 indent\n                    itemContents = line.slice(indent);\n                    indent += cap[1].length;\n                }\n                let blankLine = false;\n                if (!line && /^ *$/.test(nextLine)) { // Items begin with at most one blank line\n                    raw += nextLine + '\\n';\n                    src = src.substring(nextLine.length + 1);\n                    endEarly = true;\n                }\n                if (!endEarly) {\n                    const nextBulletRegex = new RegExp(`^ {0,${Math.min(3, indent - 1)}}(?:[*+-]|\\\\d{1,9}[.)])((?:[ \\t][^\\\\n]*)?(?:\\\\n|$))`);\n                    const hrRegex = new RegExp(`^ {0,${Math.min(3, indent - 1)}}((?:- *){3,}|(?:_ *){3,}|(?:\\\\* *){3,})(?:\\\\n+|$)`);\n                    const fencesBeginRegex = new RegExp(`^ {0,${Math.min(3, indent - 1)}}(?:\\`\\`\\`|~~~)`);\n                    const headingBeginRegex = new RegExp(`^ {0,${Math.min(3, indent - 1)}}#`);\n                    // Check if following lines should be included in List Item\n                    while (src) {\n                        const rawLine = src.split('\\n', 1)[0];\n                        nextLine = rawLine;\n                        // Re-align to follow commonmark nesting rules\n                        if (this.options.pedantic) {\n                            nextLine = nextLine.replace(/^ {1,4}(?=( {4})*[^ ])/g, '  ');\n                        }\n                        // End list item if found code fences\n                        if (fencesBeginRegex.test(nextLine)) {\n                            break;\n                        }\n                        // End list item if found start of new heading\n                        if (headingBeginRegex.test(nextLine)) {\n                            break;\n                        }\n                        // End list item if found start of new bullet\n                        if (nextBulletRegex.test(nextLine)) {\n                            break;\n                        }\n                        // Horizontal rule found\n                        if (hrRegex.test(src)) {\n                            break;\n                        }\n                        if (nextLine.search(/[^ ]/) >= indent || !nextLine.trim()) { // Dedent if possible\n                            itemContents += '\\n' + nextLine.slice(indent);\n                        }\n                        else {\n                            // not enough indentation\n                            if (blankLine) {\n                                break;\n                            }\n                            // paragraph continuation unless last line was a different block level element\n                            if (line.search(/[^ ]/) >= 4) { // indented code block\n                                break;\n                            }\n                            if (fencesBeginRegex.test(line)) {\n                                break;\n                            }\n                            if (headingBeginRegex.test(line)) {\n                                break;\n                            }\n                            if (hrRegex.test(line)) {\n                                break;\n                            }\n                            itemContents += '\\n' + nextLine;\n                        }\n                        if (!blankLine && !nextLine.trim()) { // Check if current line is blank\n                            blankLine = true;\n                        }\n                        raw += rawLine + '\\n';\n                        src = src.substring(rawLine.length + 1);\n                        line = nextLine.slice(indent);\n                    }\n                }\n                if (!list.loose) {\n                    // If the previous item ended with a blank line, the list is loose\n                    if (endsWithBlankLine) {\n                        list.loose = true;\n                    }\n                    else if (/\\n *\\n *$/.test(raw)) {\n                        endsWithBlankLine = true;\n                    }\n                }\n                let istask = null;\n                let ischecked;\n                // Check for task list items\n                if (this.options.gfm) {\n                    istask = /^\\[[ xX]\\] /.exec(itemContents);\n                    if (istask) {\n                        ischecked = istask[0] !== '[ ] ';\n                        itemContents = itemContents.replace(/^\\[[ xX]\\] +/, '');\n                    }\n                }\n                list.items.push({\n                    type: 'list_item',\n                    raw,\n                    task: !!istask,\n                    checked: ischecked,\n                    loose: false,\n                    text: itemContents,\n                    tokens: []\n                });\n                list.raw += raw;\n            }\n            // Do not consume newlines at end of final item. Alternatively, make itemRegex *start* with any newlines to simplify/speed up endsWithBlankLine logic\n            list.items[list.items.length - 1].raw = raw.trimEnd();\n            (list.items[list.items.length - 1]).text = itemContents.trimEnd();\n            list.raw = list.raw.trimEnd();\n            // Item child tokens handled here at end because we needed to have the final item to trim it first\n            for (let i = 0; i < list.items.length; i++) {\n                this.lexer.state.top = false;\n                list.items[i].tokens = this.lexer.blockTokens(list.items[i].text, []);\n                if (!list.loose) {\n                    // Check if list should be loose\n                    const spacers = list.items[i].tokens.filter(t => t.type === 'space');\n                    const hasMultipleLineBreaks = spacers.length > 0 && spacers.some(t => /\\n.*\\n/.test(t.raw));\n                    list.loose = hasMultipleLineBreaks;\n                }\n            }\n            // Set all items to loose if list is loose\n            if (list.loose) {\n                for (let i = 0; i < list.items.length; i++) {\n                    list.items[i].loose = true;\n                }\n            }\n            return list;\n        }\n    }\n    html(src) {\n        const cap = this.rules.block.html.exec(src);\n        if (cap) {\n            const token = {\n                type: 'html',\n                block: true,\n                raw: cap[0],\n                pre: cap[1] === 'pre' || cap[1] === 'script' || cap[1] === 'style',\n                text: cap[0]\n            };\n            return token;\n        }\n    }\n    def(src) {\n        const cap = this.rules.block.def.exec(src);\n        if (cap) {\n            const tag = cap[1].toLowerCase().replace(/\\s+/g, ' ');\n            const href = cap[2] ? cap[2].replace(/^<(.*)>$/, '$1').replace(this.rules.inline.anyPunctuation, '$1') : '';\n            const title = cap[3] ? cap[3].substring(1, cap[3].length - 1).replace(this.rules.inline.anyPunctuation, '$1') : cap[3];\n            return {\n                type: 'def',\n                tag,\n                raw: cap[0],\n                href,\n                title\n            };\n        }\n    }\n    table(src) {\n        const cap = this.rules.block.table.exec(src);\n        if (!cap) {\n            return;\n        }\n        if (!/[:|]/.test(cap[2])) {\n            // delimiter row must have a pipe (|) or colon (:) otherwise it is a setext heading\n            return;\n        }\n        const headers = splitCells(cap[1]);\n        const aligns = cap[2].replace(/^\\||\\| *$/g, '').split('|');\n        const rows = cap[3] && cap[3].trim() ? cap[3].replace(/\\n[ \\t]*$/, '').split('\\n') : [];\n        const item = {\n            type: 'table',\n            raw: cap[0],\n            header: [],\n            align: [],\n            rows: []\n        };\n        if (headers.length !== aligns.length) {\n            // header and align columns must be equal, rows can be different.\n            return;\n        }\n        for (const align of aligns) {\n            if (/^ *-+: *$/.test(align)) {\n                item.align.push('right');\n            }\n            else if (/^ *:-+: *$/.test(align)) {\n                item.align.push('center');\n            }\n            else if (/^ *:-+ *$/.test(align)) {\n                item.align.push('left');\n            }\n            else {\n                item.align.push(null);\n            }\n        }\n        for (const header of headers) {\n            item.header.push({\n                text: header,\n                tokens: this.lexer.inline(header)\n            });\n        }\n        for (const row of rows) {\n            item.rows.push(splitCells(row, item.header.length).map(cell => {\n                return {\n                    text: cell,\n                    tokens: this.lexer.inline(cell)\n                };\n            }));\n        }\n        return item;\n    }\n    lheading(src) {\n        const cap = this.rules.block.lheading.exec(src);\n        if (cap) {\n            return {\n                type: 'heading',\n                raw: cap[0],\n                depth: cap[2].charAt(0) === '=' ? 1 : 2,\n                text: cap[1],\n                tokens: this.lexer.inline(cap[1])\n            };\n        }\n    }\n    paragraph(src) {\n        const cap = this.rules.block.paragraph.exec(src);\n        if (cap) {\n            const text = cap[1].charAt(cap[1].length - 1) === '\\n'\n                ? cap[1].slice(0, -1)\n                : cap[1];\n            return {\n                type: 'paragraph',\n                raw: cap[0],\n                text,\n                tokens: this.lexer.inline(text)\n            };\n        }\n    }\n    text(src) {\n        const cap = this.rules.block.text.exec(src);\n        if (cap) {\n            return {\n                type: 'text',\n                raw: cap[0],\n                text: cap[0],\n                tokens: this.lexer.inline(cap[0])\n            };\n        }\n    }\n    escape(src) {\n        const cap = this.rules.inline.escape.exec(src);\n        if (cap) {\n            return {\n                type: 'escape',\n                raw: cap[0],\n                text: escape$1(cap[1])\n            };\n        }\n    }\n    tag(src) {\n        const cap = this.rules.inline.tag.exec(src);\n        if (cap) {\n            if (!this.lexer.state.inLink && /^<a /i.test(cap[0])) {\n                this.lexer.state.inLink = true;\n            }\n            else if (this.lexer.state.inLink && /^<\\/a>/i.test(cap[0])) {\n                this.lexer.state.inLink = false;\n            }\n            if (!this.lexer.state.inRawBlock && /^<(pre|code|kbd|script)(\\s|>)/i.test(cap[0])) {\n                this.lexer.state.inRawBlock = true;\n            }\n            else if (this.lexer.state.inRawBlock && /^<\\/(pre|code|kbd|script)(\\s|>)/i.test(cap[0])) {\n                this.lexer.state.inRawBlock = false;\n            }\n            return {\n                type: 'html',\n                raw: cap[0],\n                inLink: this.lexer.state.inLink,\n                inRawBlock: this.lexer.state.inRawBlock,\n                block: false,\n                text: cap[0]\n            };\n        }\n    }\n    link(src) {\n        const cap = this.rules.inline.link.exec(src);\n        if (cap) {\n            const trimmedUrl = cap[2].trim();\n            if (!this.options.pedantic && /^</.test(trimmedUrl)) {\n                // commonmark requires matching angle brackets\n                if (!(/>$/.test(trimmedUrl))) {\n                    return;\n                }\n                // ending angle bracket cannot be escaped\n                const rtrimSlash = rtrim(trimmedUrl.slice(0, -1), '\\\\');\n                if ((trimmedUrl.length - rtrimSlash.length) % 2 === 0) {\n                    return;\n                }\n            }\n            else {\n                // find closing parenthesis\n                const lastParenIndex = findClosingBracket(cap[2], '()');\n                if (lastParenIndex > -1) {\n                    const start = cap[0].indexOf('!') === 0 ? 5 : 4;\n                    const linkLen = start + cap[1].length + lastParenIndex;\n                    cap[2] = cap[2].substring(0, lastParenIndex);\n                    cap[0] = cap[0].substring(0, linkLen).trim();\n                    cap[3] = '';\n                }\n            }\n            let href = cap[2];\n            let title = '';\n            if (this.options.pedantic) {\n                // split pedantic href and title\n                const link = /^([^'\"]*[^\\s])\\s+(['\"])(.*)\\2/.exec(href);\n                if (link) {\n                    href = link[1];\n                    title = link[3];\n                }\n            }\n            else {\n                title = cap[3] ? cap[3].slice(1, -1) : '';\n            }\n            href = href.trim();\n            if (/^</.test(href)) {\n                if (this.options.pedantic && !(/>$/.test(trimmedUrl))) {\n                    // pedantic allows starting angle bracket without ending angle bracket\n                    href = href.slice(1);\n                }\n                else {\n                    href = href.slice(1, -1);\n                }\n            }\n            return outputLink(cap, {\n                href: href ? href.replace(this.rules.inline.anyPunctuation, '$1') : href,\n                title: title ? title.replace(this.rules.inline.anyPunctuation, '$1') : title\n            }, cap[0], this.lexer);\n        }\n    }\n    reflink(src, links) {\n        let cap;\n        if ((cap = this.rules.inline.reflink.exec(src))\n            || (cap = this.rules.inline.nolink.exec(src))) {\n            const linkString = (cap[2] || cap[1]).replace(/\\s+/g, ' ');\n            const link = links[linkString.toLowerCase()];\n            if (!link) {\n                const text = cap[0].charAt(0);\n                return {\n                    type: 'text',\n                    raw: text,\n                    text\n                };\n            }\n            return outputLink(cap, link, cap[0], this.lexer);\n        }\n    }\n    emStrong(src, maskedSrc, prevChar = '') {\n        let match = this.rules.inline.emStrongLDelim.exec(src);\n        if (!match)\n            return;\n        // _ can't be between two alphanumerics. \\p{L}\\p{N} includes non-english alphabet/numbers as well\n        if (match[3] && prevChar.match(/[\\p{L}\\p{N}]/u))\n            return;\n        const nextChar = match[1] || match[2] || '';\n        if (!nextChar || !prevChar || this.rules.inline.punctuation.exec(prevChar)) {\n            // unicode Regex counts emoji as 1 char; spread into array for proper count (used multiple times below)\n            const lLength = [...match[0]].length - 1;\n            let rDelim, rLength, delimTotal = lLength, midDelimTotal = 0;\n            const endReg = match[0][0] === '*' ? this.rules.inline.emStrongRDelimAst : this.rules.inline.emStrongRDelimUnd;\n            endReg.lastIndex = 0;\n            // Clip maskedSrc to same section of string as src (move to lexer?)\n            maskedSrc = maskedSrc.slice(-1 * src.length + lLength);\n            while ((match = endReg.exec(maskedSrc)) != null) {\n                rDelim = match[1] || match[2] || match[3] || match[4] || match[5] || match[6];\n                if (!rDelim)\n                    continue; // skip single * in __abc*abc__\n                rLength = [...rDelim].length;\n                if (match[3] || match[4]) { // found another Left Delim\n                    delimTotal += rLength;\n                    continue;\n                }\n                else if (match[5] || match[6]) { // either Left or Right Delim\n                    if (lLength % 3 && !((lLength + rLength) % 3)) {\n                        midDelimTotal += rLength;\n                        continue; // CommonMark Emphasis Rules 9-10\n                    }\n                }\n                delimTotal -= rLength;\n                if (delimTotal > 0)\n                    continue; // Haven't found enough closing delimiters\n                // Remove extra characters. *a*** -> *a*\n                rLength = Math.min(rLength, rLength + delimTotal + midDelimTotal);\n                // char length can be >1 for unicode characters;\n                const lastCharLength = [...match[0]][0].length;\n                const raw = src.slice(0, lLength + match.index + lastCharLength + rLength);\n                // Create `em` if smallest delimiter has odd char count. *a***\n                if (Math.min(lLength, rLength) % 2) {\n                    const text = raw.slice(1, -1);\n                    return {\n                        type: 'em',\n                        raw,\n                        text,\n                        tokens: this.lexer.inlineTokens(text)\n                    };\n                }\n                // Create 'strong' if smallest delimiter has even char count. **a***\n                const text = raw.slice(2, -2);\n                return {\n                    type: 'strong',\n                    raw,\n                    text,\n                    tokens: this.lexer.inlineTokens(text)\n                };\n            }\n        }\n    }\n    codespan(src) {\n        const cap = this.rules.inline.code.exec(src);\n        if (cap) {\n            let text = cap[2].replace(/\\n/g, ' ');\n            const hasNonSpaceChars = /[^ ]/.test(text);\n            const hasSpaceCharsOnBothEnds = /^ /.test(text) && / $/.test(text);\n            if (hasNonSpaceChars && hasSpaceCharsOnBothEnds) {\n                text = text.substring(1, text.length - 1);\n            }\n            text = escape$1(text, true);\n            return {\n                type: 'codespan',\n                raw: cap[0],\n                text\n            };\n        }\n    }\n    br(src) {\n        const cap = this.rules.inline.br.exec(src);\n        if (cap) {\n            return {\n                type: 'br',\n                raw: cap[0]\n            };\n        }\n    }\n    del(src) {\n        const cap = this.rules.inline.del.exec(src);\n        if (cap) {\n            return {\n                type: 'del',\n                raw: cap[0],\n                text: cap[2],\n                tokens: this.lexer.inlineTokens(cap[2])\n            };\n        }\n    }\n    autolink(src) {\n        const cap = this.rules.inline.autolink.exec(src);\n        if (cap) {\n            let text, href;\n            if (cap[2] === '@') {\n                text = escape$1(cap[1]);\n                href = 'mailto:' + text;\n            }\n            else {\n                text = escape$1(cap[1]);\n                href = text;\n            }\n            return {\n                type: 'link',\n                raw: cap[0],\n                text,\n                href,\n                tokens: [\n                    {\n                        type: 'text',\n                        raw: text,\n                        text\n                    }\n                ]\n            };\n        }\n    }\n    url(src) {\n        let cap;\n        if (cap = this.rules.inline.url.exec(src)) {\n            let text, href;\n            if (cap[2] === '@') {\n                text = escape$1(cap[0]);\n                href = 'mailto:' + text;\n            }\n            else {\n                // do extended autolink path validation\n                let prevCapZero;\n                do {\n                    prevCapZero = cap[0];\n                    cap[0] = this.rules.inline._backpedal.exec(cap[0])?.[0] ?? '';\n                } while (prevCapZero !== cap[0]);\n                text = escape$1(cap[0]);\n                if (cap[1] === 'www.') {\n                    href = 'http://' + cap[0];\n                }\n                else {\n                    href = cap[0];\n                }\n            }\n            return {\n                type: 'link',\n                raw: cap[0],\n                text,\n                href,\n                tokens: [\n                    {\n                        type: 'text',\n                        raw: text,\n                        text\n                    }\n                ]\n            };\n        }\n    }\n    inlineText(src) {\n        const cap = this.rules.inline.text.exec(src);\n        if (cap) {\n            let text;\n            if (this.lexer.state.inRawBlock) {\n                text = cap[0];\n            }\n            else {\n                text = escape$1(cap[0]);\n            }\n            return {\n                type: 'text',\n                raw: cap[0],\n                text\n            };\n        }\n    }\n}\n\n/**\n * Block-Level Grammar\n */\nconst newline = /^(?: *(?:\\n|$))+/;\nconst blockCode = /^( {4}[^\\n]+(?:\\n(?: *(?:\\n|$))*)?)+/;\nconst fences = /^ {0,3}(`{3,}(?=[^`\\n]*(?:\\n|$))|~{3,})([^\\n]*)(?:\\n|$)(?:|([\\s\\S]*?)(?:\\n|$))(?: {0,3}\\1[~`]* *(?=\\n|$)|$)/;\nconst hr = /^ {0,3}((?:-[\\t ]*){3,}|(?:_[ \\t]*){3,}|(?:\\*[ \\t]*){3,})(?:\\n+|$)/;\nconst heading = /^ {0,3}(#{1,6})(?=\\s|$)(.*)(?:\\n+|$)/;\nconst bullet = /(?:[*+-]|\\d{1,9}[.)])/;\nconst lheading = edit(/^(?!bull |blockCode|fences|blockquote|heading|html)((?:.|\\n(?!\\s*?\\n|bull |blockCode|fences|blockquote|heading|html))+?)\\n {0,3}(=+|-+) *(?:\\n+|$)/)\n    .replace(/bull/g, bullet) // lists can interrupt\n    .replace(/blockCode/g, / {4}/) // indented code blocks can interrupt\n    .replace(/fences/g, / {0,3}(?:`{3,}|~{3,})/) // fenced code blocks can interrupt\n    .replace(/blockquote/g, / {0,3}>/) // blockquote can interrupt\n    .replace(/heading/g, / {0,3}#{1,6}/) // ATX heading can interrupt\n    .replace(/html/g, / {0,3}<[^\\n>]+>\\n/) // block html can interrupt\n    .getRegex();\nconst _paragraph = /^([^\\n]+(?:\\n(?!hr|heading|lheading|blockquote|fences|list|html|table| +\\n)[^\\n]+)*)/;\nconst blockText = /^[^\\n]+/;\nconst _blockLabel = /(?!\\s*\\])(?:\\\\.|[^\\[\\]\\\\])+/;\nconst def = edit(/^ {0,3}\\[(label)\\]: *(?:\\n *)?([^<\\s][^\\s]*|<.*?>)(?:(?: +(?:\\n *)?| *\\n *)(title))? *(?:\\n+|$)/)\n    .replace('label', _blockLabel)\n    .replace('title', /(?:\"(?:\\\\\"?|[^\"\\\\])*\"|'[^'\\n]*(?:\\n[^'\\n]+)*\\n?'|\\([^()]*\\))/)\n    .getRegex();\nconst list = edit(/^( {0,3}bull)([ \\t][^\\n]+?)?(?:\\n|$)/)\n    .replace(/bull/g, bullet)\n    .getRegex();\nconst _tag = 'address|article|aside|base|basefont|blockquote|body|caption'\n    + '|center|col|colgroup|dd|details|dialog|dir|div|dl|dt|fieldset|figcaption'\n    + '|figure|footer|form|frame|frameset|h[1-6]|head|header|hr|html|iframe'\n    + '|legend|li|link|main|menu|menuitem|meta|nav|noframes|ol|optgroup|option'\n    + '|p|param|search|section|summary|table|tbody|td|tfoot|th|thead|title'\n    + '|tr|track|ul';\nconst _comment = /<!--(?:-?>|[\\s\\S]*?(?:-->|$))/;\nconst html = edit('^ {0,3}(?:' // optional indentation\n    + '<(script|pre|style|textarea)[\\\\s>][\\\\s\\\\S]*?(?:</\\\\1>[^\\\\n]*\\\\n+|$)' // (1)\n    + '|comment[^\\\\n]*(\\\\n+|$)' // (2)\n    + '|<\\\\?[\\\\s\\\\S]*?(?:\\\\?>\\\\n*|$)' // (3)\n    + '|<![A-Z][\\\\s\\\\S]*?(?:>\\\\n*|$)' // (4)\n    + '|<!\\\\[CDATA\\\\[[\\\\s\\\\S]*?(?:\\\\]\\\\]>\\\\n*|$)' // (5)\n    + '|</?(tag)(?: +|\\\\n|/?>)[\\\\s\\\\S]*?(?:(?:\\\\n *)+\\\\n|$)' // (6)\n    + '|<(?!script|pre|style|textarea)([a-z][\\\\w-]*)(?:attribute)*? */?>(?=[ \\\\t]*(?:\\\\n|$))[\\\\s\\\\S]*?(?:(?:\\\\n *)+\\\\n|$)' // (7) open tag\n    + '|</(?!script|pre|style|textarea)[a-z][\\\\w-]*\\\\s*>(?=[ \\\\t]*(?:\\\\n|$))[\\\\s\\\\S]*?(?:(?:\\\\n *)+\\\\n|$)' // (7) closing tag\n    + ')', 'i')\n    .replace('comment', _comment)\n    .replace('tag', _tag)\n    .replace('attribute', / +[a-zA-Z:_][\\w.:-]*(?: *= *\"[^\"\\n]*\"| *= *'[^'\\n]*'| *= *[^\\s\"'=<>`]+)?/)\n    .getRegex();\nconst paragraph = edit(_paragraph)\n    .replace('hr', hr)\n    .replace('heading', ' {0,3}#{1,6}(?:\\\\s|$)')\n    .replace('|lheading', '') // setext headings don't interrupt commonmark paragraphs\n    .replace('|table', '')\n    .replace('blockquote', ' {0,3}>')\n    .replace('fences', ' {0,3}(?:`{3,}(?=[^`\\\\n]*\\\\n)|~{3,})[^\\\\n]*\\\\n')\n    .replace('list', ' {0,3}(?:[*+-]|1[.)]) ') // only lists starting from 1 can interrupt\n    .replace('html', '</?(?:tag)(?: +|\\\\n|/?>)|<(?:script|pre|style|textarea|!--)')\n    .replace('tag', _tag) // pars can be interrupted by type (6) html blocks\n    .getRegex();\nconst blockquote = edit(/^( {0,3}> ?(paragraph|[^\\n]*)(?:\\n|$))+/)\n    .replace('paragraph', paragraph)\n    .getRegex();\n/**\n * Normal Block Grammar\n */\nconst blockNormal = {\n    blockquote,\n    code: blockCode,\n    def,\n    fences,\n    heading,\n    hr,\n    html,\n    lheading,\n    list,\n    newline,\n    paragraph,\n    table: noopTest,\n    text: blockText\n};\n/**\n * GFM Block Grammar\n */\nconst gfmTable = edit('^ *([^\\\\n ].*)\\\\n' // Header\n    + ' {0,3}((?:\\\\| *)?:?-+:? *(?:\\\\| *:?-+:? *)*(?:\\\\| *)?)' // Align\n    + '(?:\\\\n((?:(?! *\\\\n|hr|heading|blockquote|code|fences|list|html).*(?:\\\\n|$))*)\\\\n*|$)') // Cells\n    .replace('hr', hr)\n    .replace('heading', ' {0,3}#{1,6}(?:\\\\s|$)')\n    .replace('blockquote', ' {0,3}>')\n    .replace('code', ' {4}[^\\\\n]')\n    .replace('fences', ' {0,3}(?:`{3,}(?=[^`\\\\n]*\\\\n)|~{3,})[^\\\\n]*\\\\n')\n    .replace('list', ' {0,3}(?:[*+-]|1[.)]) ') // only lists starting from 1 can interrupt\n    .replace('html', '</?(?:tag)(?: +|\\\\n|/?>)|<(?:script|pre|style|textarea|!--)')\n    .replace('tag', _tag) // tables can be interrupted by type (6) html blocks\n    .getRegex();\nconst blockGfm = {\n    ...blockNormal,\n    table: gfmTable,\n    paragraph: edit(_paragraph)\n        .replace('hr', hr)\n        .replace('heading', ' {0,3}#{1,6}(?:\\\\s|$)')\n        .replace('|lheading', '') // setext headings don't interrupt commonmark paragraphs\n        .replace('table', gfmTable) // interrupt paragraphs with table\n        .replace('blockquote', ' {0,3}>')\n        .replace('fences', ' {0,3}(?:`{3,}(?=[^`\\\\n]*\\\\n)|~{3,})[^\\\\n]*\\\\n')\n        .replace('list', ' {0,3}(?:[*+-]|1[.)]) ') // only lists starting from 1 can interrupt\n        .replace('html', '</?(?:tag)(?: +|\\\\n|/?>)|<(?:script|pre|style|textarea|!--)')\n        .replace('tag', _tag) // pars can be interrupted by type (6) html blocks\n        .getRegex()\n};\n/**\n * Pedantic grammar (original John Gruber's loose markdown specification)\n */\nconst blockPedantic = {\n    ...blockNormal,\n    html: edit('^ *(?:comment *(?:\\\\n|\\\\s*$)'\n        + '|<(tag)[\\\\s\\\\S]+?</\\\\1> *(?:\\\\n{2,}|\\\\s*$)' // closed tag\n        + '|<tag(?:\"[^\"]*\"|\\'[^\\']*\\'|\\\\s[^\\'\"/>\\\\s]*)*?/?> *(?:\\\\n{2,}|\\\\s*$))')\n        .replace('comment', _comment)\n        .replace(/tag/g, '(?!(?:'\n        + 'a|em|strong|small|s|cite|q|dfn|abbr|data|time|code|var|samp|kbd|sub'\n        + '|sup|i|b|u|mark|ruby|rt|rp|bdi|bdo|span|br|wbr|ins|del|img)'\n        + '\\\\b)\\\\w+(?!:|[^\\\\w\\\\s@]*@)\\\\b')\n        .getRegex(),\n    def: /^ *\\[([^\\]]+)\\]: *<?([^\\s>]+)>?(?: +([\"(][^\\n]+[\")]))? *(?:\\n+|$)/,\n    heading: /^(#{1,6})(.*)(?:\\n+|$)/,\n    fences: noopTest, // fences not supported\n    lheading: /^(.+?)\\n {0,3}(=+|-+) *(?:\\n+|$)/,\n    paragraph: edit(_paragraph)\n        .replace('hr', hr)\n        .replace('heading', ' *#{1,6} *[^\\n]')\n        .replace('lheading', lheading)\n        .replace('|table', '')\n        .replace('blockquote', ' {0,3}>')\n        .replace('|fences', '')\n        .replace('|list', '')\n        .replace('|html', '')\n        .replace('|tag', '')\n        .getRegex()\n};\n/**\n * Inline-Level Grammar\n */\nconst escape = /^\\\\([!\"#$%&'()*+,\\-./:;<=>?@\\[\\]\\\\^_`{|}~])/;\nconst inlineCode = /^(`+)([^`]|[^`][\\s\\S]*?[^`])\\1(?!`)/;\nconst br = /^( {2,}|\\\\)\\n(?!\\s*$)/;\nconst inlineText = /^(`+|[^`])(?:(?= {2,}\\n)|[\\s\\S]*?(?:(?=[\\\\<!\\[`*_]|\\b_|$)|[^ ](?= {2,}\\n)))/;\n// list of unicode punctuation marks, plus any missing characters from CommonMark spec\nconst _punctuation = '\\\\p{P}\\\\p{S}';\nconst punctuation = edit(/^((?![*_])[\\spunctuation])/, 'u')\n    .replace(/punctuation/g, _punctuation).getRegex();\n// sequences em should skip over [title](link), `code`, <html>\nconst blockSkip = /\\[[^[\\]]*?\\]\\([^\\(\\)]*?\\)|`[^`]*?`|<[^<>]*?>/g;\nconst emStrongLDelim = edit(/^(?:\\*+(?:((?!\\*)[punct])|[^\\s*]))|^_+(?:((?!_)[punct])|([^\\s_]))/, 'u')\n    .replace(/punct/g, _punctuation)\n    .getRegex();\nconst emStrongRDelimAst = edit('^[^_*]*?__[^_*]*?\\\\*[^_*]*?(?=__)' // Skip orphan inside strong\n    + '|[^*]+(?=[^*])' // Consume to delim\n    + '|(?!\\\\*)[punct](\\\\*+)(?=[\\\\s]|$)' // (1) #*** can only be a Right Delimiter\n    + '|[^punct\\\\s](\\\\*+)(?!\\\\*)(?=[punct\\\\s]|$)' // (2) a***#, a*** can only be a Right Delimiter\n    + '|(?!\\\\*)[punct\\\\s](\\\\*+)(?=[^punct\\\\s])' // (3) #***a, ***a can only be Left Delimiter\n    + '|[\\\\s](\\\\*+)(?!\\\\*)(?=[punct])' // (4) ***# can only be Left Delimiter\n    + '|(?!\\\\*)[punct](\\\\*+)(?!\\\\*)(?=[punct])' // (5) #***# can be either Left or Right Delimiter\n    + '|[^punct\\\\s](\\\\*+)(?=[^punct\\\\s])', 'gu') // (6) a***a can be either Left or Right Delimiter\n    .replace(/punct/g, _punctuation)\n    .getRegex();\n// (6) Not allowed for _\nconst emStrongRDelimUnd = edit('^[^_*]*?\\\\*\\\\*[^_*]*?_[^_*]*?(?=\\\\*\\\\*)' // Skip orphan inside strong\n    + '|[^_]+(?=[^_])' // Consume to delim\n    + '|(?!_)[punct](_+)(?=[\\\\s]|$)' // (1) #___ can only be a Right Delimiter\n    + '|[^punct\\\\s](_+)(?!_)(?=[punct\\\\s]|$)' // (2) a___#, a___ can only be a Right Delimiter\n    + '|(?!_)[punct\\\\s](_+)(?=[^punct\\\\s])' // (3) #___a, ___a can only be Left Delimiter\n    + '|[\\\\s](_+)(?!_)(?=[punct])' // (4) ___# can only be Left Delimiter\n    + '|(?!_)[punct](_+)(?!_)(?=[punct])', 'gu') // (5) #___# can be either Left or Right Delimiter\n    .replace(/punct/g, _punctuation)\n    .getRegex();\nconst anyPunctuation = edit(/\\\\([punct])/, 'gu')\n    .replace(/punct/g, _punctuation)\n    .getRegex();\nconst autolink = edit(/^<(scheme:[^\\s\\x00-\\x1f<>]*|email)>/)\n    .replace('scheme', /[a-zA-Z][a-zA-Z0-9+.-]{1,31}/)\n    .replace('email', /[a-zA-Z0-9.!#$%&'*+/=?^_`{|}~-]+(@)[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)+(?![-_])/)\n    .getRegex();\nconst _inlineComment = edit(_comment).replace('(?:-->|$)', '-->').getRegex();\nconst tag = edit('^comment'\n    + '|^</[a-zA-Z][\\\\w:-]*\\\\s*>' // self-closing tag\n    + '|^<[a-zA-Z][\\\\w-]*(?:attribute)*?\\\\s*/?>' // open tag\n    + '|^<\\\\?[\\\\s\\\\S]*?\\\\?>' // processing instruction, e.g. <?php ?>\n    + '|^<![a-zA-Z]+\\\\s[\\\\s\\\\S]*?>' // declaration, e.g. <!DOCTYPE html>\n    + '|^<!\\\\[CDATA\\\\[[\\\\s\\\\S]*?\\\\]\\\\]>') // CDATA section\n    .replace('comment', _inlineComment)\n    .replace('attribute', /\\s+[a-zA-Z:_][\\w.:-]*(?:\\s*=\\s*\"[^\"]*\"|\\s*=\\s*'[^']*'|\\s*=\\s*[^\\s\"'=<>`]+)?/)\n    .getRegex();\nconst _inlineLabel = /(?:\\[(?:\\\\.|[^\\[\\]\\\\])*\\]|\\\\.|`[^`]*`|[^\\[\\]\\\\`])*?/;\nconst link = edit(/^!?\\[(label)\\]\\(\\s*(href)(?:\\s+(title))?\\s*\\)/)\n    .replace('label', _inlineLabel)\n    .replace('href', /<(?:\\\\.|[^\\n<>\\\\])+>|[^\\s\\x00-\\x1f]*/)\n    .replace('title', /\"(?:\\\\\"?|[^\"\\\\])*\"|'(?:\\\\'?|[^'\\\\])*'|\\((?:\\\\\\)?|[^)\\\\])*\\)/)\n    .getRegex();\nconst reflink = edit(/^!?\\[(label)\\]\\[(ref)\\]/)\n    .replace('label', _inlineLabel)\n    .replace('ref', _blockLabel)\n    .getRegex();\nconst nolink = edit(/^!?\\[(ref)\\](?:\\[\\])?/)\n    .replace('ref', _blockLabel)\n    .getRegex();\nconst reflinkSearch = edit('reflink|nolink(?!\\\\()', 'g')\n    .replace('reflink', reflink)\n    .replace('nolink', nolink)\n    .getRegex();\n/**\n * Normal Inline Grammar\n */\nconst inlineNormal = {\n    _backpedal: noopTest, // only used for GFM url\n    anyPunctuation,\n    autolink,\n    blockSkip,\n    br,\n    code: inlineCode,\n    del: noopTest,\n    emStrongLDelim,\n    emStrongRDelimAst,\n    emStrongRDelimUnd,\n    escape,\n    link,\n    nolink,\n    punctuation,\n    reflink,\n    reflinkSearch,\n    tag,\n    text: inlineText,\n    url: noopTest\n};\n/**\n * Pedantic Inline Grammar\n */\nconst inlinePedantic = {\n    ...inlineNormal,\n    link: edit(/^!?\\[(label)\\]\\((.*?)\\)/)\n        .replace('label', _inlineLabel)\n        .getRegex(),\n    reflink: edit(/^!?\\[(label)\\]\\s*\\[([^\\]]*)\\]/)\n        .replace('label', _inlineLabel)\n        .getRegex()\n};\n/**\n * GFM Inline Grammar\n */\nconst inlineGfm = {\n    ...inlineNormal,\n    escape: edit(escape).replace('])', '~|])').getRegex(),\n    url: edit(/^((?:ftp|https?):\\/\\/|www\\.)(?:[a-zA-Z0-9\\-]+\\.?)+[^\\s<]*|^email/, 'i')\n        .replace('email', /[A-Za-z0-9._+-]+(@)[a-zA-Z0-9-_]+(?:\\.[a-zA-Z0-9-_]*[a-zA-Z0-9])+(?![-_])/)\n        .getRegex(),\n    _backpedal: /(?:[^?!.,:;*_'\"~()&]+|\\([^)]*\\)|&(?![a-zA-Z0-9]+;$)|[?!.,:;*_'\"~)]+(?!$))+/,\n    del: /^(~~?)(?=[^\\s~])([\\s\\S]*?[^\\s~])\\1(?=[^~]|$)/,\n    text: /^([`~]+|[^`~])(?:(?= {2,}\\n)|(?=[a-zA-Z0-9.!#$%&'*+\\/=?_`{\\|}~-]+@)|[\\s\\S]*?(?:(?=[\\\\<!\\[`*~_]|\\b_|https?:\\/\\/|ftp:\\/\\/|www\\.|$)|[^ ](?= {2,}\\n)|[^a-zA-Z0-9.!#$%&'*+\\/=?_`{\\|}~-](?=[a-zA-Z0-9.!#$%&'*+\\/=?_`{\\|}~-]+@)))/\n};\n/**\n * GFM + Line Breaks Inline Grammar\n */\nconst inlineBreaks = {\n    ...inlineGfm,\n    br: edit(br).replace('{2,}', '*').getRegex(),\n    text: edit(inlineGfm.text)\n        .replace('\\\\b_', '\\\\b_| {2,}\\\\n')\n        .replace(/\\{2,\\}/g, '*')\n        .getRegex()\n};\n/**\n * exports\n */\nconst block = {\n    normal: blockNormal,\n    gfm: blockGfm,\n    pedantic: blockPedantic\n};\nconst inline = {\n    normal: inlineNormal,\n    gfm: inlineGfm,\n    breaks: inlineBreaks,\n    pedantic: inlinePedantic\n};\n\n/**\n * Block Lexer\n */\nclass _Lexer {\n    tokens;\n    options;\n    state;\n    tokenizer;\n    inlineQueue;\n    constructor(options) {\n        // TokenList cannot be created in one go\n        this.tokens = [];\n        this.tokens.links = Object.create(null);\n        this.options = options || _defaults;\n        this.options.tokenizer = this.options.tokenizer || new _Tokenizer();\n        this.tokenizer = this.options.tokenizer;\n        this.tokenizer.options = this.options;\n        this.tokenizer.lexer = this;\n        this.inlineQueue = [];\n        this.state = {\n            inLink: false,\n            inRawBlock: false,\n            top: true\n        };\n        const rules = {\n            block: block.normal,\n            inline: inline.normal\n        };\n        if (this.options.pedantic) {\n            rules.block = block.pedantic;\n            rules.inline = inline.pedantic;\n        }\n        else if (this.options.gfm) {\n            rules.block = block.gfm;\n            if (this.options.breaks) {\n                rules.inline = inline.breaks;\n            }\n            else {\n                rules.inline = inline.gfm;\n            }\n        }\n        this.tokenizer.rules = rules;\n    }\n    /**\n     * Expose Rules\n     */\n    static get rules() {\n        return {\n            block,\n            inline\n        };\n    }\n    /**\n     * Static Lex Method\n     */\n    static lex(src, options) {\n        const lexer = new _Lexer(options);\n        return lexer.lex(src);\n    }\n    /**\n     * Static Lex Inline Method\n     */\n    static lexInline(src, options) {\n        const lexer = new _Lexer(options);\n        return lexer.inlineTokens(src);\n    }\n    /**\n     * Preprocessing\n     */\n    lex(src) {\n        src = src\n            .replace(/\\r\\n|\\r/g, '\\n');\n        this.blockTokens(src, this.tokens);\n        for (let i = 0; i < this.inlineQueue.length; i++) {\n            const next = this.inlineQueue[i];\n            this.inlineTokens(next.src, next.tokens);\n        }\n        this.inlineQueue = [];\n        return this.tokens;\n    }\n    blockTokens(src, tokens = []) {\n        if (this.options.pedantic) {\n            src = src.replace(/\\t/g, '    ').replace(/^ +$/gm, '');\n        }\n        else {\n            src = src.replace(/^( *)(\\t+)/gm, (_, leading, tabs) => {\n                return leading + '    '.repeat(tabs.length);\n            });\n        }\n        let token;\n        let lastToken;\n        let cutSrc;\n        let lastParagraphClipped;\n        while (src) {\n            if (this.options.extensions\n                && this.options.extensions.block\n                && this.options.extensions.block.some((extTokenizer) => {\n                    if (token = extTokenizer.call({ lexer: this }, src, tokens)) {\n                        src = src.substring(token.raw.length);\n                        tokens.push(token);\n                        return true;\n                    }\n                    return false;\n                })) {\n                continue;\n            }\n            // newline\n            if (token = this.tokenizer.space(src)) {\n                src = src.substring(token.raw.length);\n                if (token.raw.length === 1 && tokens.length > 0) {\n                    // if there's a single \\n as a spacer, it's terminating the last line,\n                    // so move it there so that we don't get unnecessary paragraph tags\n                    tokens[tokens.length - 1].raw += '\\n';\n                }\n                else {\n                    tokens.push(token);\n                }\n                continue;\n            }\n            // code\n            if (token = this.tokenizer.code(src)) {\n                src = src.substring(token.raw.length);\n                lastToken = tokens[tokens.length - 1];\n                // An indented code block cannot interrupt a paragraph.\n                if (lastToken && (lastToken.type === 'paragraph' || lastToken.type === 'text')) {\n                    lastToken.raw += '\\n' + token.raw;\n                    lastToken.text += '\\n' + token.text;\n                    this.inlineQueue[this.inlineQueue.length - 1].src = lastToken.text;\n                }\n                else {\n                    tokens.push(token);\n                }\n                continue;\n            }\n            // fences\n            if (token = this.tokenizer.fences(src)) {\n                src = src.substring(token.raw.length);\n                tokens.push(token);\n                continue;\n            }\n            // heading\n            if (token = this.tokenizer.heading(src)) {\n                src = src.substring(token.raw.length);\n                tokens.push(token);\n                continue;\n            }\n            // hr\n            if (token = this.tokenizer.hr(src)) {\n                src = src.substring(token.raw.length);\n                tokens.push(token);\n                continue;\n            }\n            // blockquote\n            if (token = this.tokenizer.blockquote(src)) {\n                src = src.substring(token.raw.length);\n                tokens.push(token);\n                continue;\n            }\n            // list\n            if (token = this.tokenizer.list(src)) {\n                src = src.substring(token.raw.length);\n                tokens.push(token);\n                continue;\n            }\n            // html\n            if (token = this.tokenizer.html(src)) {\n                src = src.substring(token.raw.length);\n                tokens.push(token);\n                continue;\n            }\n            // def\n            if (token = this.tokenizer.def(src)) {\n                src = src.substring(token.raw.length);\n                lastToken = tokens[tokens.length - 1];\n                if (lastToken && (lastToken.type === 'paragraph' || lastToken.type === 'text')) {\n                    lastToken.raw += '\\n' + token.raw;\n                    lastToken.text += '\\n' + token.raw;\n                    this.inlineQueue[this.inlineQueue.length - 1].src = lastToken.text;\n                }\n                else if (!this.tokens.links[token.tag]) {\n                    this.tokens.links[token.tag] = {\n                        href: token.href,\n                        title: token.title\n                    };\n                }\n                continue;\n            }\n            // table (gfm)\n            if (token = this.tokenizer.table(src)) {\n                src = src.substring(token.raw.length);\n                tokens.push(token);\n                continue;\n            }\n            // lheading\n            if (token = this.tokenizer.lheading(src)) {\n                src = src.substring(token.raw.length);\n                tokens.push(token);\n                continue;\n            }\n            // top-level paragraph\n            // prevent paragraph consuming extensions by clipping 'src' to extension start\n            cutSrc = src;\n            if (this.options.extensions && this.options.extensions.startBlock) {\n                let startIndex = Infinity;\n                const tempSrc = src.slice(1);\n                let tempStart;\n                this.options.extensions.startBlock.forEach((getStartIndex) => {\n                    tempStart = getStartIndex.call({ lexer: this }, tempSrc);\n                    if (typeof tempStart === 'number' && tempStart >= 0) {\n                        startIndex = Math.min(startIndex, tempStart);\n                    }\n                });\n                if (startIndex < Infinity && startIndex >= 0) {\n                    cutSrc = src.substring(0, startIndex + 1);\n                }\n            }\n            if (this.state.top && (token = this.tokenizer.paragraph(cutSrc))) {\n                lastToken = tokens[tokens.length - 1];\n                if (lastParagraphClipped && lastToken.type === 'paragraph') {\n                    lastToken.raw += '\\n' + token.raw;\n                    lastToken.text += '\\n' + token.text;\n                    this.inlineQueue.pop();\n                    this.inlineQueue[this.inlineQueue.length - 1].src = lastToken.text;\n                }\n                else {\n                    tokens.push(token);\n                }\n                lastParagraphClipped = (cutSrc.length !== src.length);\n                src = src.substring(token.raw.length);\n                continue;\n            }\n            // text\n            if (token = this.tokenizer.text(src)) {\n                src = src.substring(token.raw.length);\n                lastToken = tokens[tokens.length - 1];\n                if (lastToken && lastToken.type === 'text') {\n                    lastToken.raw += '\\n' + token.raw;\n                    lastToken.text += '\\n' + token.text;\n                    this.inlineQueue.pop();\n                    this.inlineQueue[this.inlineQueue.length - 1].src = lastToken.text;\n                }\n                else {\n                    tokens.push(token);\n                }\n                continue;\n            }\n            if (src) {\n                const errMsg = 'Infinite loop on byte: ' + src.charCodeAt(0);\n                if (this.options.silent) {\n                    console.error(errMsg);\n                    break;\n                }\n                else {\n                    throw new Error(errMsg);\n                }\n            }\n        }\n        this.state.top = true;\n        return tokens;\n    }\n    inline(src, tokens = []) {\n        this.inlineQueue.push({ src, tokens });\n        return tokens;\n    }\n    /**\n     * Lexing/Compiling\n     */\n    inlineTokens(src, tokens = []) {\n        let token, lastToken, cutSrc;\n        // String with links masked to avoid interference with em and strong\n        let maskedSrc = src;\n        let match;\n        let keepPrevChar, prevChar;\n        // Mask out reflinks\n        if (this.tokens.links) {\n            const links = Object.keys(this.tokens.links);\n            if (links.length > 0) {\n                while ((match = this.tokenizer.rules.inline.reflinkSearch.exec(maskedSrc)) != null) {\n                    if (links.includes(match[0].slice(match[0].lastIndexOf('[') + 1, -1))) {\n                        maskedSrc = maskedSrc.slice(0, match.index) + '[' + 'a'.repeat(match[0].length - 2) + ']' + maskedSrc.slice(this.tokenizer.rules.inline.reflinkSearch.lastIndex);\n                    }\n                }\n            }\n        }\n        // Mask out other blocks\n        while ((match = this.tokenizer.rules.inline.blockSkip.exec(maskedSrc)) != null) {\n            maskedSrc = maskedSrc.slice(0, match.index) + '[' + 'a'.repeat(match[0].length - 2) + ']' + maskedSrc.slice(this.tokenizer.rules.inline.blockSkip.lastIndex);\n        }\n        // Mask out escaped characters\n        while ((match = this.tokenizer.rules.inline.anyPunctuation.exec(maskedSrc)) != null) {\n            maskedSrc = maskedSrc.slice(0, match.index) + '++' + maskedSrc.slice(this.tokenizer.rules.inline.anyPunctuation.lastIndex);\n        }\n        while (src) {\n            if (!keepPrevChar) {\n                prevChar = '';\n            }\n            keepPrevChar = false;\n            // extensions\n            if (this.options.extensions\n                && this.options.extensions.inline\n                && this.options.extensions.inline.some((extTokenizer) => {\n                    if (token = extTokenizer.call({ lexer: this }, src, tokens)) {\n                        src = src.substring(token.raw.length);\n                        tokens.push(token);\n                        return true;\n                    }\n                    return false;\n                })) {\n                continue;\n            }\n            // escape\n            if (token = this.tokenizer.escape(src)) {\n                src = src.substring(token.raw.length);\n                tokens.push(token);\n                continue;\n            }\n            // tag\n            if (token = this.tokenizer.tag(src)) {\n                src = src.substring(token.raw.length);\n                lastToken = tokens[tokens.length - 1];\n                if (lastToken && token.type === 'text' && lastToken.type === 'text') {\n                    lastToken.raw += token.raw;\n                    lastToken.text += token.text;\n                }\n                else {\n                    tokens.push(token);\n                }\n                continue;\n            }\n            // link\n            if (token = this.tokenizer.link(src)) {\n                src = src.substring(token.raw.length);\n                tokens.push(token);\n                continue;\n            }\n            // reflink, nolink\n            if (token = this.tokenizer.reflink(src, this.tokens.links)) {\n                src = src.substring(token.raw.length);\n                lastToken = tokens[tokens.length - 1];\n                if (lastToken && token.type === 'text' && lastToken.type === 'text') {\n                    lastToken.raw += token.raw;\n                    lastToken.text += token.text;\n                }\n                else {\n                    tokens.push(token);\n                }\n                continue;\n            }\n            // em & strong\n            if (token = this.tokenizer.emStrong(src, maskedSrc, prevChar)) {\n                src = src.substring(token.raw.length);\n                tokens.push(token);\n                continue;\n            }\n            // code\n            if (token = this.tokenizer.codespan(src)) {\n                src = src.substring(token.raw.length);\n                tokens.push(token);\n                continue;\n            }\n            // br\n            if (token = this.tokenizer.br(src)) {\n                src = src.substring(token.raw.length);\n                tokens.push(token);\n                continue;\n            }\n            // del (gfm)\n            if (token = this.tokenizer.del(src)) {\n                src = src.substring(token.raw.length);\n                tokens.push(token);\n                continue;\n            }\n            // autolink\n            if (token = this.tokenizer.autolink(src)) {\n                src = src.substring(token.raw.length);\n                tokens.push(token);\n                continue;\n            }\n            // url (gfm)\n            if (!this.state.inLink && (token = this.tokenizer.url(src))) {\n                src = src.substring(token.raw.length);\n                tokens.push(token);\n                continue;\n            }\n            // text\n            // prevent inlineText consuming extensions by clipping 'src' to extension start\n            cutSrc = src;\n            if (this.options.extensions && this.options.extensions.startInline) {\n                let startIndex = Infinity;\n                const tempSrc = src.slice(1);\n                let tempStart;\n                this.options.extensions.startInline.forEach((getStartIndex) => {\n                    tempStart = getStartIndex.call({ lexer: this }, tempSrc);\n                    if (typeof tempStart === 'number' && tempStart >= 0) {\n                        startIndex = Math.min(startIndex, tempStart);\n                    }\n                });\n                if (startIndex < Infinity && startIndex >= 0) {\n                    cutSrc = src.substring(0, startIndex + 1);\n                }\n            }\n            if (token = this.tokenizer.inlineText(cutSrc)) {\n                src = src.substring(token.raw.length);\n                if (token.raw.slice(-1) !== '_') { // Track prevChar before string of ____ started\n                    prevChar = token.raw.slice(-1);\n                }\n                keepPrevChar = true;\n                lastToken = tokens[tokens.length - 1];\n                if (lastToken && lastToken.type === 'text') {\n                    lastToken.raw += token.raw;\n                    lastToken.text += token.text;\n                }\n                else {\n                    tokens.push(token);\n                }\n                continue;\n            }\n            if (src) {\n                const errMsg = 'Infinite loop on byte: ' + src.charCodeAt(0);\n                if (this.options.silent) {\n                    console.error(errMsg);\n                    break;\n                }\n                else {\n                    throw new Error(errMsg);\n                }\n            }\n        }\n        return tokens;\n    }\n}\n\n/**\n * Renderer\n */\nclass _Renderer {\n    options;\n    constructor(options) {\n        this.options = options || _defaults;\n    }\n    code(code, infostring, escaped) {\n        const lang = (infostring || '').match(/^\\S*/)?.[0];\n        code = code.replace(/\\n$/, '') + '\\n';\n        if (!lang) {\n            return '<pre><code>'\n                + (escaped ? code : escape$1(code, true))\n                + '</code></pre>\\n';\n        }\n        return '<pre><code class=\"language-'\n            + escape$1(lang)\n            + '\">'\n            + (escaped ? code : escape$1(code, true))\n            + '</code></pre>\\n';\n    }\n    blockquote(quote) {\n        return `<blockquote>\\n${quote}</blockquote>\\n`;\n    }\n    html(html, block) {\n        return html;\n    }\n    heading(text, level, raw) {\n        // ignore IDs\n        return `<h${level}>${text}</h${level}>\\n`;\n    }\n    hr() {\n        return '<hr>\\n';\n    }\n    list(body, ordered, start) {\n        const type = ordered ? 'ol' : 'ul';\n        const startatt = (ordered && start !== 1) ? (' start=\"' + start + '\"') : '';\n        return '<' + type + startatt + '>\\n' + body + '</' + type + '>\\n';\n    }\n    listitem(text, task, checked) {\n        return `<li>${text}</li>\\n`;\n    }\n    checkbox(checked) {\n        return '<input '\n            + (checked ? 'checked=\"\" ' : '')\n            + 'disabled=\"\" type=\"checkbox\">';\n    }\n    paragraph(text) {\n        return `<p>${text}</p>\\n`;\n    }\n    table(header, body) {\n        if (body)\n            body = `<tbody>${body}</tbody>`;\n        return '<table>\\n'\n            + '<thead>\\n'\n            + header\n            + '</thead>\\n'\n            + body\n            + '</table>\\n';\n    }\n    tablerow(content) {\n        return `<tr>\\n${content}</tr>\\n`;\n    }\n    tablecell(content, flags) {\n        const type = flags.header ? 'th' : 'td';\n        const tag = flags.align\n            ? `<${type} align=\"${flags.align}\">`\n            : `<${type}>`;\n        return tag + content + `</${type}>\\n`;\n    }\n    /**\n     * span level renderer\n     */\n    strong(text) {\n        return `<strong>${text}</strong>`;\n    }\n    em(text) {\n        return `<em>${text}</em>`;\n    }\n    codespan(text) {\n        return `<code>${text}</code>`;\n    }\n    br() {\n        return '<br>';\n    }\n    del(text) {\n        return `<del>${text}</del>`;\n    }\n    link(href, title, text) {\n        const cleanHref = cleanUrl(href);\n        if (cleanHref === null) {\n            return text;\n        }\n        href = cleanHref;\n        let out = '<a href=\"' + href + '\"';\n        if (title) {\n            out += ' title=\"' + title + '\"';\n        }\n        out += '>' + text + '</a>';\n        return out;\n    }\n    image(href, title, text) {\n        const cleanHref = cleanUrl(href);\n        if (cleanHref === null) {\n            return text;\n        }\n        href = cleanHref;\n        let out = `<img src=\"${href}\" alt=\"${text}\"`;\n        if (title) {\n            out += ` title=\"${title}\"`;\n        }\n        out += '>';\n        return out;\n    }\n    text(text) {\n        return text;\n    }\n}\n\n/**\n * TextRenderer\n * returns only the textual part of the token\n */\nclass _TextRenderer {\n    // no need for block level renderers\n    strong(text) {\n        return text;\n    }\n    em(text) {\n        return text;\n    }\n    codespan(text) {\n        return text;\n    }\n    del(text) {\n        return text;\n    }\n    html(text) {\n        return text;\n    }\n    text(text) {\n        return text;\n    }\n    link(href, title, text) {\n        return '' + text;\n    }\n    image(href, title, text) {\n        return '' + text;\n    }\n    br() {\n        return '';\n    }\n}\n\n/**\n * Parsing & Compiling\n */\nclass _Parser {\n    options;\n    renderer;\n    textRenderer;\n    constructor(options) {\n        this.options = options || _defaults;\n        this.options.renderer = this.options.renderer || new _Renderer();\n        this.renderer = this.options.renderer;\n        this.renderer.options = this.options;\n        this.textRenderer = new _TextRenderer();\n    }\n    /**\n     * Static Parse Method\n     */\n    static parse(tokens, options) {\n        const parser = new _Parser(options);\n        return parser.parse(tokens);\n    }\n    /**\n     * Static Parse Inline Method\n     */\n    static parseInline(tokens, options) {\n        const parser = new _Parser(options);\n        return parser.parseInline(tokens);\n    }\n    /**\n     * Parse Loop\n     */\n    parse(tokens, top = true) {\n        let out = '';\n        for (let i = 0; i < tokens.length; i++) {\n            const token = tokens[i];\n            // Run any renderer extensions\n            if (this.options.extensions && this.options.extensions.renderers && this.options.extensions.renderers[token.type]) {\n                const genericToken = token;\n                const ret = this.options.extensions.renderers[genericToken.type].call({ parser: this }, genericToken);\n                if (ret !== false || !['space', 'hr', 'heading', 'code', 'table', 'blockquote', 'list', 'html', 'paragraph', 'text'].includes(genericToken.type)) {\n                    out += ret || '';\n                    continue;\n                }\n            }\n            switch (token.type) {\n                case 'space': {\n                    continue;\n                }\n                case 'hr': {\n                    out += this.renderer.hr();\n                    continue;\n                }\n                case 'heading': {\n                    const headingToken = token;\n                    out += this.renderer.heading(this.parseInline(headingToken.tokens), headingToken.depth, unescape(this.parseInline(headingToken.tokens, this.textRenderer)));\n                    continue;\n                }\n                case 'code': {\n                    const codeToken = token;\n                    out += this.renderer.code(codeToken.text, codeToken.lang, !!codeToken.escaped);\n                    continue;\n                }\n                case 'table': {\n                    const tableToken = token;\n                    let header = '';\n                    // header\n                    let cell = '';\n                    for (let j = 0; j < tableToken.header.length; j++) {\n                        cell += this.renderer.tablecell(this.parseInline(tableToken.header[j].tokens), { header: true, align: tableToken.align[j] });\n                    }\n                    header += this.renderer.tablerow(cell);\n                    let body = '';\n                    for (let j = 0; j < tableToken.rows.length; j++) {\n                        const row = tableToken.rows[j];\n                        cell = '';\n                        for (let k = 0; k < row.length; k++) {\n                            cell += this.renderer.tablecell(this.parseInline(row[k].tokens), { header: false, align: tableToken.align[k] });\n                        }\n                        body += this.renderer.tablerow(cell);\n                    }\n                    out += this.renderer.table(header, body);\n                    continue;\n                }\n                case 'blockquote': {\n                    const blockquoteToken = token;\n                    const body = this.parse(blockquoteToken.tokens);\n                    out += this.renderer.blockquote(body);\n                    continue;\n                }\n                case 'list': {\n                    const listToken = token;\n                    const ordered = listToken.ordered;\n                    const start = listToken.start;\n                    const loose = listToken.loose;\n                    let body = '';\n                    for (let j = 0; j < listToken.items.length; j++) {\n                        const item = listToken.items[j];\n                        const checked = item.checked;\n                        const task = item.task;\n                        let itemBody = '';\n                        if (item.task) {\n                            const checkbox = this.renderer.checkbox(!!checked);\n                            if (loose) {\n                                if (item.tokens.length > 0 && item.tokens[0].type === 'paragraph') {\n                                    item.tokens[0].text = checkbox + ' ' + item.tokens[0].text;\n                                    if (item.tokens[0].tokens && item.tokens[0].tokens.length > 0 && item.tokens[0].tokens[0].type === 'text') {\n                                        item.tokens[0].tokens[0].text = checkbox + ' ' + item.tokens[0].tokens[0].text;\n                                    }\n                                }\n                                else {\n                                    item.tokens.unshift({\n                                        type: 'text',\n                                        text: checkbox + ' '\n                                    });\n                                }\n                            }\n                            else {\n                                itemBody += checkbox + ' ';\n                            }\n                        }\n                        itemBody += this.parse(item.tokens, loose);\n                        body += this.renderer.listitem(itemBody, task, !!checked);\n                    }\n                    out += this.renderer.list(body, ordered, start);\n                    continue;\n                }\n                case 'html': {\n                    const htmlToken = token;\n                    out += this.renderer.html(htmlToken.text, htmlToken.block);\n                    continue;\n                }\n                case 'paragraph': {\n                    const paragraphToken = token;\n                    out += this.renderer.paragraph(this.parseInline(paragraphToken.tokens));\n                    continue;\n                }\n                case 'text': {\n                    let textToken = token;\n                    let body = textToken.tokens ? this.parseInline(textToken.tokens) : textToken.text;\n                    while (i + 1 < tokens.length && tokens[i + 1].type === 'text') {\n                        textToken = tokens[++i];\n                        body += '\\n' + (textToken.tokens ? this.parseInline(textToken.tokens) : textToken.text);\n                    }\n                    out += top ? this.renderer.paragraph(body) : body;\n                    continue;\n                }\n                default: {\n                    const errMsg = 'Token with \"' + token.type + '\" type was not found.';\n                    if (this.options.silent) {\n                        console.error(errMsg);\n                        return '';\n                    }\n                    else {\n                        throw new Error(errMsg);\n                    }\n                }\n            }\n        }\n        return out;\n    }\n    /**\n     * Parse Inline Tokens\n     */\n    parseInline(tokens, renderer) {\n        renderer = renderer || this.renderer;\n        let out = '';\n        for (let i = 0; i < tokens.length; i++) {\n            const token = tokens[i];\n            // Run any renderer extensions\n            if (this.options.extensions && this.options.extensions.renderers && this.options.extensions.renderers[token.type]) {\n                const ret = this.options.extensions.renderers[token.type].call({ parser: this }, token);\n                if (ret !== false || !['escape', 'html', 'link', 'image', 'strong', 'em', 'codespan', 'br', 'del', 'text'].includes(token.type)) {\n                    out += ret || '';\n                    continue;\n                }\n            }\n            switch (token.type) {\n                case 'escape': {\n                    const escapeToken = token;\n                    out += renderer.text(escapeToken.text);\n                    break;\n                }\n                case 'html': {\n                    const tagToken = token;\n                    out += renderer.html(tagToken.text);\n                    break;\n                }\n                case 'link': {\n                    const linkToken = token;\n                    out += renderer.link(linkToken.href, linkToken.title, this.parseInline(linkToken.tokens, renderer));\n                    break;\n                }\n                case 'image': {\n                    const imageToken = token;\n                    out += renderer.image(imageToken.href, imageToken.title, imageToken.text);\n                    break;\n                }\n                case 'strong': {\n                    const strongToken = token;\n                    out += renderer.strong(this.parseInline(strongToken.tokens, renderer));\n                    break;\n                }\n                case 'em': {\n                    const emToken = token;\n                    out += renderer.em(this.parseInline(emToken.tokens, renderer));\n                    break;\n                }\n                case 'codespan': {\n                    const codespanToken = token;\n                    out += renderer.codespan(codespanToken.text);\n                    break;\n                }\n                case 'br': {\n                    out += renderer.br();\n                    break;\n                }\n                case 'del': {\n                    const delToken = token;\n                    out += renderer.del(this.parseInline(delToken.tokens, renderer));\n                    break;\n                }\n                case 'text': {\n                    const textToken = token;\n                    out += renderer.text(textToken.text);\n                    break;\n                }\n                default: {\n                    const errMsg = 'Token with \"' + token.type + '\" type was not found.';\n                    if (this.options.silent) {\n                        console.error(errMsg);\n                        return '';\n                    }\n                    else {\n                        throw new Error(errMsg);\n                    }\n                }\n            }\n        }\n        return out;\n    }\n}\n\nclass _Hooks {\n    options;\n    constructor(options) {\n        this.options = options || _defaults;\n    }\n    static passThroughHooks = new Set([\n        'preprocess',\n        'postprocess',\n        'processAllTokens'\n    ]);\n    /**\n     * Process markdown before marked\n     */\n    preprocess(markdown) {\n        return markdown;\n    }\n    /**\n     * Process HTML after marked is finished\n     */\n    postprocess(html) {\n        return html;\n    }\n    /**\n     * Process all tokens before walk tokens\n     */\n    processAllTokens(tokens) {\n        return tokens;\n    }\n}\n\nclass Marked {\n    defaults = _getDefaults();\n    options = this.setOptions;\n    parse = this.#parseMarkdown(_Lexer.lex, _Parser.parse);\n    parseInline = this.#parseMarkdown(_Lexer.lexInline, _Parser.parseInline);\n    Parser = _Parser;\n    Renderer = _Renderer;\n    TextRenderer = _TextRenderer;\n    Lexer = _Lexer;\n    Tokenizer = _Tokenizer;\n    Hooks = _Hooks;\n    constructor(...args) {\n        this.use(...args);\n    }\n    /**\n     * Run callback for every token\n     */\n    walkTokens(tokens, callback) {\n        let values = [];\n        for (const token of tokens) {\n            values = values.concat(callback.call(this, token));\n            switch (token.type) {\n                case 'table': {\n                    const tableToken = token;\n                    for (const cell of tableToken.header) {\n                        values = values.concat(this.walkTokens(cell.tokens, callback));\n                    }\n                    for (const row of tableToken.rows) {\n                        for (const cell of row) {\n                            values = values.concat(this.walkTokens(cell.tokens, callback));\n                        }\n                    }\n                    break;\n                }\n                case 'list': {\n                    const listToken = token;\n                    values = values.concat(this.walkTokens(listToken.items, callback));\n                    break;\n                }\n                default: {\n                    const genericToken = token;\n                    if (this.defaults.extensions?.childTokens?.[genericToken.type]) {\n                        this.defaults.extensions.childTokens[genericToken.type].forEach((childTokens) => {\n                            const tokens = genericToken[childTokens].flat(Infinity);\n                            values = values.concat(this.walkTokens(tokens, callback));\n                        });\n                    }\n                    else if (genericToken.tokens) {\n                        values = values.concat(this.walkTokens(genericToken.tokens, callback));\n                    }\n                }\n            }\n        }\n        return values;\n    }\n    use(...args) {\n        const extensions = this.defaults.extensions || { renderers: {}, childTokens: {} };\n        args.forEach((pack) => {\n            // copy options to new object\n            const opts = { ...pack };\n            // set async to true if it was set to true before\n            opts.async = this.defaults.async || opts.async || false;\n            // ==-- Parse \"addon\" extensions --== //\n            if (pack.extensions) {\n                pack.extensions.forEach((ext) => {\n                    if (!ext.name) {\n                        throw new Error('extension name required');\n                    }\n                    if ('renderer' in ext) { // Renderer extensions\n                        const prevRenderer = extensions.renderers[ext.name];\n                        if (prevRenderer) {\n                            // Replace extension with func to run new extension but fall back if false\n                            extensions.renderers[ext.name] = function (...args) {\n                                let ret = ext.renderer.apply(this, args);\n                                if (ret === false) {\n                                    ret = prevRenderer.apply(this, args);\n                                }\n                                return ret;\n                            };\n                        }\n                        else {\n                            extensions.renderers[ext.name] = ext.renderer;\n                        }\n                    }\n                    if ('tokenizer' in ext) { // Tokenizer Extensions\n                        if (!ext.level || (ext.level !== 'block' && ext.level !== 'inline')) {\n                            throw new Error(\"extension level must be 'block' or 'inline'\");\n                        }\n                        const extLevel = extensions[ext.level];\n                        if (extLevel) {\n                            extLevel.unshift(ext.tokenizer);\n                        }\n                        else {\n                            extensions[ext.level] = [ext.tokenizer];\n                        }\n                        if (ext.start) { // Function to check for start of token\n                            if (ext.level === 'block') {\n                                if (extensions.startBlock) {\n                                    extensions.startBlock.push(ext.start);\n                                }\n                                else {\n                                    extensions.startBlock = [ext.start];\n                                }\n                            }\n                            else if (ext.level === 'inline') {\n                                if (extensions.startInline) {\n                                    extensions.startInline.push(ext.start);\n                                }\n                                else {\n                                    extensions.startInline = [ext.start];\n                                }\n                            }\n                        }\n                    }\n                    if ('childTokens' in ext && ext.childTokens) { // Child tokens to be visited by walkTokens\n                        extensions.childTokens[ext.name] = ext.childTokens;\n                    }\n                });\n                opts.extensions = extensions;\n            }\n            // ==-- Parse \"overwrite\" extensions --== //\n            if (pack.renderer) {\n                const renderer = this.defaults.renderer || new _Renderer(this.defaults);\n                for (const prop in pack.renderer) {\n                    if (!(prop in renderer)) {\n                        throw new Error(`renderer '${prop}' does not exist`);\n                    }\n                    if (prop === 'options') {\n                        // ignore options property\n                        continue;\n                    }\n                    const rendererProp = prop;\n                    const rendererFunc = pack.renderer[rendererProp];\n                    const prevRenderer = renderer[rendererProp];\n                    // Replace renderer with func to run extension, but fall back if false\n                    renderer[rendererProp] = (...args) => {\n                        let ret = rendererFunc.apply(renderer, args);\n                        if (ret === false) {\n                            ret = prevRenderer.apply(renderer, args);\n                        }\n                        return ret || '';\n                    };\n                }\n                opts.renderer = renderer;\n            }\n            if (pack.tokenizer) {\n                const tokenizer = this.defaults.tokenizer || new _Tokenizer(this.defaults);\n                for (const prop in pack.tokenizer) {\n                    if (!(prop in tokenizer)) {\n                        throw new Error(`tokenizer '${prop}' does not exist`);\n                    }\n                    if (['options', 'rules', 'lexer'].includes(prop)) {\n                        // ignore options, rules, and lexer properties\n                        continue;\n                    }\n                    const tokenizerProp = prop;\n                    const tokenizerFunc = pack.tokenizer[tokenizerProp];\n                    const prevTokenizer = tokenizer[tokenizerProp];\n                    // Replace tokenizer with func to run extension, but fall back if false\n                    // @ts-expect-error cannot type tokenizer function dynamically\n                    tokenizer[tokenizerProp] = (...args) => {\n                        let ret = tokenizerFunc.apply(tokenizer, args);\n                        if (ret === false) {\n                            ret = prevTokenizer.apply(tokenizer, args);\n                        }\n                        return ret;\n                    };\n                }\n                opts.tokenizer = tokenizer;\n            }\n            // ==-- Parse Hooks extensions --== //\n            if (pack.hooks) {\n                const hooks = this.defaults.hooks || new _Hooks();\n                for (const prop in pack.hooks) {\n                    if (!(prop in hooks)) {\n                        throw new Error(`hook '${prop}' does not exist`);\n                    }\n                    if (prop === 'options') {\n                        // ignore options property\n                        continue;\n                    }\n                    const hooksProp = prop;\n                    const hooksFunc = pack.hooks[hooksProp];\n                    const prevHook = hooks[hooksProp];\n                    if (_Hooks.passThroughHooks.has(prop)) {\n                        // @ts-expect-error cannot type hook function dynamically\n                        hooks[hooksProp] = (arg) => {\n                            if (this.defaults.async) {\n                                return Promise.resolve(hooksFunc.call(hooks, arg)).then(ret => {\n                                    return prevHook.call(hooks, ret);\n                                });\n                            }\n                            const ret = hooksFunc.call(hooks, arg);\n                            return prevHook.call(hooks, ret);\n                        };\n                    }\n                    else {\n                        // @ts-expect-error cannot type hook function dynamically\n                        hooks[hooksProp] = (...args) => {\n                            let ret = hooksFunc.apply(hooks, args);\n                            if (ret === false) {\n                                ret = prevHook.apply(hooks, args);\n                            }\n                            return ret;\n                        };\n                    }\n                }\n                opts.hooks = hooks;\n            }\n            // ==-- Parse WalkTokens extensions --== //\n            if (pack.walkTokens) {\n                const walkTokens = this.defaults.walkTokens;\n                const packWalktokens = pack.walkTokens;\n                opts.walkTokens = function (token) {\n                    let values = [];\n                    values.push(packWalktokens.call(this, token));\n                    if (walkTokens) {\n                        values = values.concat(walkTokens.call(this, token));\n                    }\n                    return values;\n                };\n            }\n            this.defaults = { ...this.defaults, ...opts };\n        });\n        return this;\n    }\n    setOptions(opt) {\n        this.defaults = { ...this.defaults, ...opt };\n        return this;\n    }\n    lexer(src, options) {\n        return _Lexer.lex(src, options ?? this.defaults);\n    }\n    parser(tokens, options) {\n        return _Parser.parse(tokens, options ?? this.defaults);\n    }\n    #parseMarkdown(lexer, parser) {\n        return (src, options) => {\n            const origOpt = { ...options };\n            const opt = { ...this.defaults, ...origOpt };\n            // Show warning if an extension set async to true but the parse was called with async: false\n            if (this.defaults.async === true && origOpt.async === false) {\n                if (!opt.silent) {\n                    console.warn('marked(): The async option was set to true by an extension. The async: false option sent to parse will be ignored.');\n                }\n                opt.async = true;\n            }\n            const throwError = this.#onError(!!opt.silent, !!opt.async);\n            // throw error in case of non string input\n            if (typeof src === 'undefined' || src === null) {\n                return throwError(new Error('marked(): input parameter is undefined or null'));\n            }\n            if (typeof src !== 'string') {\n                return throwError(new Error('marked(): input parameter is of type '\n                    + Object.prototype.toString.call(src) + ', string expected'));\n            }\n            if (opt.hooks) {\n                opt.hooks.options = opt;\n            }\n            if (opt.async) {\n                return Promise.resolve(opt.hooks ? opt.hooks.preprocess(src) : src)\n                    .then(src => lexer(src, opt))\n                    .then(tokens => opt.hooks ? opt.hooks.processAllTokens(tokens) : tokens)\n                    .then(tokens => opt.walkTokens ? Promise.all(this.walkTokens(tokens, opt.walkTokens)).then(() => tokens) : tokens)\n                    .then(tokens => parser(tokens, opt))\n                    .then(html => opt.hooks ? opt.hooks.postprocess(html) : html)\n                    .catch(throwError);\n            }\n            try {\n                if (opt.hooks) {\n                    src = opt.hooks.preprocess(src);\n                }\n                let tokens = lexer(src, opt);\n                if (opt.hooks) {\n                    tokens = opt.hooks.processAllTokens(tokens);\n                }\n                if (opt.walkTokens) {\n                    this.walkTokens(tokens, opt.walkTokens);\n                }\n                let html = parser(tokens, opt);\n                if (opt.hooks) {\n                    html = opt.hooks.postprocess(html);\n                }\n                return html;\n            }\n            catch (e) {\n                return throwError(e);\n            }\n        };\n    }\n    #onError(silent, async) {\n        return (e) => {\n            e.message += '\\nPlease report this to https://github.com/markedjs/marked.';\n            if (silent) {\n                const msg = '<p>An error occurred:</p><pre>'\n                    + escape$1(e.message + '', true)\n                    + '</pre>';\n                if (async) {\n                    return Promise.resolve(msg);\n                }\n                return msg;\n            }\n            if (async) {\n                return Promise.reject(e);\n            }\n            throw e;\n        };\n    }\n}\n\nconst markedInstance = new Marked();\nfunction marked(src, opt) {\n    return markedInstance.parse(src, opt);\n}\n/**\n * Sets the default options.\n *\n * @param options Hash of options\n */\nmarked.options =\n    marked.setOptions = function (options) {\n        markedInstance.setOptions(options);\n        marked.defaults = markedInstance.defaults;\n        changeDefaults(marked.defaults);\n        return marked;\n    };\n/**\n * Gets the original marked default options.\n */\nmarked.getDefaults = _getDefaults;\nmarked.defaults = _defaults;\n/**\n * Use Extension\n */\nmarked.use = function (...args) {\n    markedInstance.use(...args);\n    marked.defaults = markedInstance.defaults;\n    changeDefaults(marked.defaults);\n    return marked;\n};\n/**\n * Run callback for every token\n */\nmarked.walkTokens = function (tokens, callback) {\n    return markedInstance.walkTokens(tokens, callback);\n};\n/**\n * Compiles markdown to HTML without enclosing `p` tag.\n *\n * @param src String of markdown source to be compiled\n * @param options Hash of options\n * @return String of compiled HTML\n */\nmarked.parseInline = markedInstance.parseInline;\n/**\n * Expose\n */\nmarked.Parser = _Parser;\nmarked.parser = _Parser.parse;\nmarked.Renderer = _Renderer;\nmarked.TextRenderer = _TextRenderer;\nmarked.Lexer = _Lexer;\nmarked.lexer = _Lexer.lex;\nmarked.Tokenizer = _Tokenizer;\nmarked.Hooks = _Hooks;\nmarked.parse = marked;\nconst options = marked.options;\nconst setOptions = marked.setOptions;\nconst use = marked.use;\nconst walkTokens = marked.walkTokens;\nconst parseInline = marked.parseInline;\nconst parse = marked;\nconst parser = _Parser.parse;\nconst lexer = _Lexer.lex;\n\nexport { _Hooks as Hooks, _Lexer as Lexer, Marked, _Parser as Parser, _Renderer as Renderer, _TextRenderer as TextRenderer, _Tokenizer as Tokenizer, _defaults as defaults, _getDefaults as getDefaults, lexer, marked, options, parse, parseInline, parser, setOptions, use, walkTokens };\n//# sourceMappingURL=marked.esm.js.map\n","'use strict';\n\nvar escapes = {\n  '&': '&amp;',\n  '<': '&lt;',\n  '>': '&gt;',\n  '\"': '&quot;',\n  \"'\": '&#39;'\n};\nvar unescapes = {\n  '&amp;': '&',\n  '&lt;': '<',\n  '&gt;': '>',\n  '&quot;': '\"',\n  '&#39;': \"'\"\n};\nvar rescaped = /(&amp;|&lt;|&gt;|&quot;|&#39;)/g;\nvar runescaped = /[&<>\"']/g;\n\nfunction escapeHtmlChar (match) {\n  return escapes[match];\n}\nfunction unescapeHtmlChar (match) {\n  return unescapes[match];\n}\n\nfunction escapeHtml (text) {\n  return text == null ? '' : String(text).replace(runescaped, escapeHtmlChar);\n}\n\nfunction unescapeHtml (html) {\n  return html == null ? '' : String(html).replace(rescaped, unescapeHtmlChar);\n}\n\nescapeHtml.options = unescapeHtml.options = {};\n\nmodule.exports = {\n  encode: escapeHtml,\n  escape: escapeHtml,\n  decode: unescapeHtml,\n  unescape: unescapeHtml,\n  version: '1.0.0-browser'\n};\n","'use strict';\n\nfunction assignment (result) {\n  var stack = Array.prototype.slice.call(arguments, 1);\n  var item;\n  var key;\n  while (stack.length) {\n    item = stack.shift();\n    for (key in item) {\n      if (item.hasOwnProperty(key)) {\n        if (Object.prototype.toString.call(result[key]) === '[object Object]') {\n          result[key] = assignment(result[key], item[key]);\n        } else {\n          result[key] = item[key];\n        }\n      }\n    }\n  }\n  return result;\n}\n\nmodule.exports = assignment;\n","'use strict';\n\nmodule.exports = function lowercase (string) {\n  return typeof string === 'string' ? string.toLowerCase() : string;\n};\n","'use strict';\n\nfunction toMap (list) {\n  return list.reduce(asKey, {});\n}\n\nfunction asKey (accumulator, item) {\n  accumulator[item] = true;\n  return accumulator;\n}\n\nmodule.exports = toMap;\n","'use strict';\n\nvar toMap = require('./toMap');\nvar uris = ['background', 'base', 'cite', 'href', 'longdesc', 'src', 'usemap'];\n\nmodule.exports = {\n  uris: toMap(uris) // attributes that have an href and hence need to be sanitized\n};\n","'use strict';\n\nvar toMap = require('./toMap');\nvar voids = ['area', 'br', 'col', 'hr', 'img', 'wbr', 'input', 'base', 'basefont', 'link', 'meta'];\n\nmodule.exports = {\n  voids: toMap(voids)\n};\n","'use strict';\n\nvar he = require('he');\nvar lowercase = require('./lowercase');\nvar attributes = require('./attributes');\nvar elements = require('./elements');\nvar rstart = /^<\\s*([\\w:-]+)((?:\\s+[\\w:-]+(?:\\s*=\\s*(?:(?:\"[^\"]*\")|(?:'[^']*')|[^>\\s]+))?)*)\\s*(\\/?)\\s*>/;\nvar rend = /^<\\s*\\/\\s*([\\w:-]+)[^>]*>/;\nvar rattrs = /([\\w:-]+)(?:\\s*=\\s*(?:(?:\"((?:[^\"])*)\")|(?:'((?:[^'])*)')|([^>\\s]+)))?/g;\nvar rtag = /^</;\nvar rtagend = /^<\\s*\\//;\n\nfunction createStack () {\n  var stack = [];\n  stack.lastItem = function lastItem () {\n    return stack[stack.length - 1];\n  };\n  return stack;\n}\n\nfunction parser (html, handler) {\n  var stack = createStack();\n  var last = html;\n  var chars;\n\n  while (html) {\n    parsePart();\n  }\n  parseEndTag(); // clean up any remaining tags\n\n  function parsePart () {\n    chars = true;\n    parseTag();\n\n    var same = html === last;\n    last = html;\n\n    if (same) { // discard, because it's invalid\n      html = '';\n    }\n  }\n\n  function parseTag () {\n    if (html.substr(0, 4) === '<!--') { // comments\n      parseComment();\n    } else if (rtagend.test(html)) {\n      parseEdge(rend, parseEndTag);\n    } else if (rtag.test(html)) {\n      parseEdge(rstart, parseStartTag);\n    }\n    parseTagDecode();\n  }\n\n  function parseEdge (regex, parser) {\n    var match = html.match(regex);\n    if (match) {\n      html = html.substring(match[0].length);\n      match[0].replace(regex, parser);\n      chars = false;\n    }\n  }\n\n  function parseComment () {\n    var index = html.indexOf('-->');\n    if (index >= 0) {\n      if (handler.comment) {\n        handler.comment(html.substring(4, index));\n      }\n      html = html.substring(index + 3);\n      chars = false;\n    }\n  }\n\n  function parseTagDecode () {\n    if (!chars) {\n      return;\n    }\n    var text;\n    var index = html.indexOf('<');\n    if (index >= 0) {\n      text = html.substring(0, index);\n      html = html.substring(index);\n    } else {\n      text = html;\n      html = '';\n    }\n    if (handler.chars) {\n      handler.chars(text);\n    }\n  }\n\n  function parseStartTag (tag, tagName, rest, unary) {\n    var attrs = {};\n    var low = lowercase(tagName);\n    var u = elements.voids[low] || !!unary;\n\n    rest.replace(rattrs, attrReplacer);\n\n    if (!u) {\n      stack.push(low);\n    }\n    if (handler.start) {\n      handler.start(low, attrs, u);\n    }\n\n    function attrReplacer (match, name, doubleQuotedValue, singleQuotedValue, unquotedValue) {\n      if (doubleQuotedValue === void 0 && singleQuotedValue === void 0 && unquotedValue === void 0) {\n        attrs[name] = void 0; // attribute is like <button disabled></button>\n      } else {\n        attrs[name] = he.decode(doubleQuotedValue || singleQuotedValue || unquotedValue || '');\n      }\n    }\n  }\n\n  function parseEndTag (tag, tagName) {\n    var i;\n    var pos = 0;\n    var low = lowercase(tagName);\n    if (low) {\n      for (pos = stack.length - 1; pos >= 0; pos--) {\n        if (stack[pos] === low) {\n          break; // find the closest opened tag of the same type\n        }\n      }\n    }\n    if (pos >= 0) {\n      for (i = stack.length - 1; i >= pos; i--) {\n        if (handler.end) { // close all the open elements, up the stack\n          handler.end(stack[i]);\n        }\n      }\n      stack.length = pos;\n    }\n  }\n}\n\nmodule.exports = parser;\n","'use strict';\n\nvar he = require('he');\nvar lowercase = require('./lowercase');\nvar attributes = require('./attributes');\nvar elements = require('./elements');\n\nfunction sanitizer (buffer, options) {\n  var last;\n  var context;\n  var o = options || {};\n\n  reset();\n\n  return {\n    start: start,\n    end: end,\n    chars: chars\n  };\n\n  function out (value) {\n    buffer.push(value);\n  }\n\n  function start (tag, attrs, unary) {\n    var low = lowercase(tag);\n\n    if (context.ignoring) {\n      ignore(low); return;\n    }\n    if ((o.allowedTags || []).indexOf(low) === -1) {\n      ignore(low); return;\n    }\n    if (o.filter && !o.filter({ tag: low, attrs: attrs })) {\n      ignore(low); return;\n    }\n\n    out('<');\n    out(low);\n    Object.keys(attrs).forEach(parse);\n    out(unary ? '/>' : '>');\n\n    function parse (key) {\n      var value = attrs[key];\n      var classesOk = (o.allowedClasses || {})[low] || [];\n      var attrsOk = (o.allowedAttributes || {})[low] || [];\n      var valid;\n      var lkey = lowercase(key);\n      if (lkey === 'class' && attrsOk.indexOf(lkey) === -1) {\n        value = value.split(' ').filter(isValidClass).join(' ').trim();\n        valid = value.length;\n      } else {\n        valid = attrsOk.indexOf(lkey) !== -1 && (attributes.uris[lkey] !== true || testUrl(value));\n      }\n      if (valid) {\n        out(' ');\n        out(key);\n        if (typeof value === 'string') {\n          out('=\"');\n          out(he.encode(value));\n          out('\"');\n        }\n      }\n      function isValidClass (className) {\n        return classesOk && classesOk.indexOf(className) !== -1;\n      }\n    }\n  }\n\n  function end (tag) {\n    var low = lowercase(tag);\n    var allowed = (o.allowedTags || []).indexOf(low) !== -1;\n    if (allowed) {\n      if (context.ignoring === false) {\n        out('</');\n        out(low);\n        out('>');\n      } else {\n        unignore(low);\n      }\n    } else {\n      unignore(low);\n    }\n  }\n\n  function testUrl (text) {\n    var start = text[0];\n    if (start === '#' || start === '/') {\n      return true;\n    }\n    var colon = text.indexOf(':');\n    if (colon === -1) {\n      return true;\n    }\n    var questionmark = text.indexOf('?');\n    if (questionmark !== -1 && colon > questionmark) {\n      return true;\n    }\n    var hash = text.indexOf('#');\n    if (hash !== -1 && colon > hash) {\n      return true;\n    }\n    return o.allowedSchemes.some(matches);\n\n    function matches (scheme) {\n      return text.indexOf(scheme + ':') === 0;\n    }\n  }\n\n  function chars (text) {\n    if (context.ignoring === false) {\n      out(o.transformText ? o.transformText(text) : text);\n    }\n  }\n\n  function ignore (tag) {\n    if (elements.voids[tag]) {\n      return;\n    }\n    if (context.ignoring === false) {\n      context = { ignoring: tag, depth: 1 };\n    } else if (context.ignoring === tag) {\n      context.depth++;\n    }\n  }\n\n  function unignore (tag) {\n    if (context.ignoring === tag) {\n      if (--context.depth <= 0) {\n        reset();\n      }\n    }\n  }\n\n  function reset () {\n    context = { ignoring: false, depth: 0 };\n  }\n}\n\nmodule.exports = sanitizer;\n","'use strict';\n\nvar he = require('he');\nvar assign = require('assignment');\nvar parser = require('./parser');\nvar sanitizer = require('./sanitizer');\nvar defaults = require('./defaults');\n\nfunction insane (html, options, strict) {\n  var buffer = [];\n  var configuration = strict === true ? options : assign({}, defaults, options);\n  var handler = sanitizer(buffer, configuration);\n\n  parser(html, handler);\n\n  return buffer.join('');\n}\n\ninsane.defaults = defaults;\nmodule.exports = insane;\n","'use strict';\n\nvar defaults = {\n  allowedAttributes: {\n    a: ['href', 'name', 'target', 'title', 'aria-label'],\n    iframe: ['allowfullscreen', 'frameborder', 'src'],\n    img: ['src', 'alt', 'title', 'aria-label']\n  },\n  allowedClasses: {},\n  allowedSchemes: ['http', 'https', 'mailto'],\n  allowedTags: [\n    'a', 'abbr', 'article', 'b', 'blockquote', 'br', 'caption', 'code', 'del', 'details', 'div', 'em',\n    'h1', 'h2', 'h3', 'h4', 'h5', 'h6', 'hr', 'i', 'img', 'ins', 'kbd', 'li', 'main', 'mark',\n    'ol', 'p', 'pre', 'section', 'span', 'strike', 'strong', 'sub', 'summary', 'sup', 'table',\n    'tbody', 'td', 'th', 'thead', 'tr', 'u', 'ul'\n  ],\n  filter: null\n};\n\nmodule.exports = defaults;\n","import insane from 'insane'\r\n\r\nconst insaneOptions = {\r\n  allowedClasses: {},\r\n  // @refer CVE-2018-8495\r\n  // @link https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2018-8495\r\n  // @link https://leucosite.com/Microsoft-Edge-RCE/\r\n  // @link https://medium.com/@knownsec404team/analysis-of-the-security-issues-of-url-scheme-in-pc-from-cve-2018-8495-934478a36756\r\n  allowedSchemes: [\r\n    'http',\r\n    'https',\r\n    'mailto',\r\n    'data', // for support base64 encoded image (安全性有待考虑)\r\n  ],\r\n  allowedTags: [\r\n    'a',\r\n    'abbr',\r\n    'article',\r\n    'b',\r\n    'blockquote',\r\n    'br',\r\n    'caption',\r\n    'code',\r\n    'del',\r\n    'details',\r\n    'div',\r\n    'em',\r\n    'h1',\r\n    'h2',\r\n    'h3',\r\n    'h4',\r\n    'h5',\r\n    'h6',\r\n    'hr',\r\n    'i',\r\n    'img',\r\n    'ins',\r\n    'kbd',\r\n    'li',\r\n    'main',\r\n    'mark',\r\n    'ol',\r\n    'p',\r\n    'pre',\r\n    'section',\r\n    'span',\r\n    'strike',\r\n    'strong',\r\n    'sub',\r\n    'summary',\r\n    'sup',\r\n    'table',\r\n    'tbody',\r\n    'td',\r\n    'th',\r\n    'thead',\r\n    'tr',\r\n    'u',\r\n    'ul',\r\n  ],\r\n  allowedAttributes: {\r\n    '*': ['title', 'accesskey'],\r\n    a: ['href', 'name', 'target', 'aria-label', 'rel'],\r\n    img: ['src', 'alt', 'title', 'atk-emoticon', 'aria-label', 'notitle', 'loading', 'data-src'],\r\n    // for code highlight\r\n    // code: ['class'],\r\n    code: ['language'],\r\n    span: ['class', 'style'],\r\n  },\r\n  filter: (node) => {\r\n    // allow hljs style\r\n    const allowed = [\r\n      ['code', /^hljs\\W+language-(.*)$/],\r\n      ['span', /^(hljs-.*)$/],\r\n    ]\r\n    allowed.forEach(([tag, reg]) => {\r\n      if (node.tag === tag && !!node.attrs.class && !(reg as RegExp).test(node.attrs.class)) {\r\n        delete node.attrs.class\r\n      }\r\n    })\r\n\r\n    // allow <span> set color sty\r\n    if (\r\n      node.tag === 'span' &&\r\n      !!node.attrs.style &&\r\n      !/^color:(\\W+)?#[0-9a-f]{3,6};?$/i.test(node.attrs.style)\r\n    ) {\r\n      delete node.attrs.style\r\n    }\r\n\r\n    return true\r\n  },\r\n}\r\n\r\nexport function sanitize(content: string): string {\r\n  // @link https://github.com/markedjs/marked/discussions/1232\r\n  // @link https://gist.github.com/lionel-rowe/bb384465ba4e4c81a9c8dada84167225\r\n  return insane(content, insaneOptions)\r\n}\r\n","(function (global, factory) {\n  typeof exports === 'object' && typeof module !== 'undefined' ? module.exports = factory() :\n  typeof define === 'function' && define.amd ? define(factory) :\n  (global.hanabi = factory());\n}(this, (function () { 'use strict';\n\nfunction createCommonjsModule(fn, module) {\n\treturn module = { exports: {} }, fn(module, module.exports), module.exports;\n}\n\nvar index$1 = createCommonjsModule(function (module) {\n'use strict';\n\nvar comment = module.exports = function () {\n\treturn new RegExp('(?:' + comment.line().source + ')|(?:' + comment.block().source + ')', 'gm');\n};\n\ncomment.line = function () {\n\treturn /(?:^|\\s)\\/\\/(.+?)$/gm;\n};\n\ncomment.block = function () {\n\treturn /\\/\\*([\\S\\s]*?)\\*\\//gm;\n};\n});\n\nvar defaultColors = ['23AC69', '91C132', 'F19726', 'E8552D', '1AAB8E', 'E1147F', '2980C1', '1BA1E6', '9FA0A0', 'F19726', 'E30B20', 'E30B20', 'A3338B'];\n\nvar index = function (input, ref) {\n  if ( ref === void 0 ) ref = {};\n  var colors = ref.colors; if ( colors === void 0 ) colors = defaultColors;\n\n  var index = 0;\n  var cache = {};\n  var wordRe = /[\\u4E00-\\u9FFF\\u3400-\\u4dbf\\uf900-\\ufaff\\u3040-\\u309f\\uac00-\\ud7af\\u0400-\\u04FF]+|\\w+/;\n  var leftAngleRe = /</;\n\n  var re = new RegExp((\"(\" + (wordRe.source) + \"|\" + (leftAngleRe.source) + \")|(\" + (index$1().source) + \")\"), 'gmi');\n  return input\n  .replace(re, function (m, word, cm) {\n    if (cm) {\n      return toComment(cm)\n    }\n\n    if (word === '<') {\n      return '&lt;'\n    }\n    var color;\n    if (cache[word]) {\n      color = cache[word];\n    } else {\n      color = colors[index];\n      cache[word] = color;\n    }\n\n    var out = \"<span style=\\\"color: #\" + color + \"\\\">\" + word + \"</span>\";\n    index = ++index % colors.length;\n    return out\n  })\n};\n\nfunction toComment(cm) {\n  return (\"<span style=\\\"color: slategray\\\">\" + cm + \"</span>\")\n}\n\nreturn index;\n\n})));\n","import hanabi from 'hanabi'\r\n\r\nexport function renderCode(code: string) {\r\n  return hanabi(code)\r\n}\r\n","import { marked as libMarked } from 'marked'\r\nimport { renderCode } from './highlight'\r\n\r\nexport function getRenderer() {\r\n  const renderer = new libMarked.Renderer()\r\n  renderer.link = markedLinkRenderer(renderer, renderer.link)\r\n  renderer.code = markedCodeRenderer()\r\n  return renderer\r\n}\r\n\r\nexport const markedLinkRenderer =\r\n  (renderer: any, orgLinkRenderer: Function) =>\r\n  (href: string, title: string, text: string): string => {\r\n    const localLink = href?.startsWith(`${window.location.protocol}//${window.location.hostname}`)\r\n    const html = orgLinkRenderer.call(renderer, href, title, text)\r\n    return html.replace(\r\n      /^<a /,\r\n      `<a target=\"_blank\" ${!localLink ? `rel=\"noreferrer noopener nofollow\"` : ''} `,\r\n    )\r\n  }\r\n\r\nexport const markedCodeRenderer =\r\n  () =>\r\n  (block: string, lang: string | undefined): string => {\r\n    // Colorize the block only if the language is known to highlight.js\r\n    const realLang = !lang ? 'plaintext' : lang\r\n    let colorized = block\r\n    if ((window as any).hljs) {\r\n      if (realLang && (window as any).hljs.getLanguage(realLang)) {\r\n        colorized = (window as any).hljs.highlight(realLang, block).value\r\n      }\r\n    } else {\r\n      colorized = renderCode(block)\r\n    }\r\n\r\n    return (\r\n      `<pre rel=\"${realLang}\">\\n` +\r\n      `<code class=\"hljs language-${realLang}\">${colorized.replace(/&amp;/g, '&')}</code>\\n` +\r\n      `</pre>`\r\n    )\r\n  }\r\n","import { marked as libMarked, MarkedOptions } from 'marked'\r\n\r\nimport { sanitize } from './sanitizer'\r\nimport { renderCode } from './highlight'\r\nimport { getRenderer } from './marked-renderer'\r\n\r\ntype Replacer = (raw: string) => string\r\nexport type TMarked = typeof libMarked\r\n\r\nlet instance: TMarked | undefined\r\nlet replacers: Replacer[] = []\r\n\r\nconst markedOptions: MarkedOptions = {\r\n  gfm: true,\r\n  breaks: true,\r\n  async: false,\r\n}\r\n\r\n/** Get Marked instance */\r\nexport function getInstance() {\r\n  return instance\r\n}\r\n\r\nexport function setReplacers(arr: Replacer[]) {\r\n  replacers = arr\r\n}\r\n\r\n/** 初始化 marked */\r\nexport function initMarked() {\r\n  try {\r\n    if (!libMarked.name) return\r\n  } catch {\r\n    return\r\n  }\r\n\r\n  // @see https://github.com/markedjs/marked/blob/4afb228d956a415624c4e5554bb8f25d047676fe/src/Tokenizer.js#L329\r\n  libMarked.setOptions({\r\n    renderer: getRenderer(),\r\n    ...markedOptions,\r\n  })\r\n\r\n  instance = libMarked\r\n}\r\n\r\n/** 解析 markdown */\r\nexport default function marked(src: string): string {\r\n  let markedContent = getInstance()?.parse(src) as string;\r\n  if (!markedContent) {\r\n    // 无 Markdown 模式简单处理\r\n    markedContent = simpleMarked(src);\r\n  }\r\n\r\n  let dest = sanitize(markedContent);\r\n\r\n  // 为内容中的 img 标签添加 loading=\"lazy\"\r\n  const tempDiv = document.createElement('div');\r\n  tempDiv.innerHTML = dest;\r\n  tempDiv.querySelectorAll('img').forEach(img => {\r\n    if (!img.hasAttribute('loading')) {\r\n      img.setAttribute('loading', 'lazy');\r\n    }\r\n    const imgSrc = img.getAttribute('src');\r\n    if (imgSrc) {\r\n      img.setAttribute('data-src', imgSrc)\r\n      img.removeAttribute('src')\r\n    }    \r\n  });\r\n  dest = tempDiv.innerHTML;\r\n\r\n  // 内容替换器\r\n  replacers.forEach((replacer) => {\r\n    if (typeof replacer === 'function') dest = replacer(dest);\r\n  });\r\n\r\n  return dest;\r\n}\r\n\r\nfunction simpleMarked(src: string) {\r\n  return (\r\n    src\r\n      // .replace(/\\*\\*(.*?)\\*\\*/g, '<strong>$1</strong>')\r\n      .replace(\r\n        /```\\s*([^]+?.*?[^]+?[^]+?)```/g,\r\n        (_, code) => `<pre><code>${renderCode(code)}</code></pre>`,\r\n      )\r\n      // .replace(/`([^`]+?)`/g, '<code>$1</code>')\r\n      .replace(/!\\[(.*?)\\]\\((.*?)\\)/g, (_, alt, imgSrc) => `<img src=\"${imgSrc}\" alt=\"${alt}\" />`)\r\n      .replace(\r\n        /\\[(.*?)\\]\\((.*?)\\)/g,\r\n        (_, text, link) => `<a href=\"${link}\" target=\"_blank\">${text}</a>`,\r\n      )\r\n      .replace(/\\n/g, '<br>')\r\n  )\r\n}\r\n","/**\r\n * Performs a deep merge of objects and returns new object.\r\n * Does not modify objects (immutable) and merges arrays via concatenation.\r\n *\r\n * @param objects - Objects to merge\r\n * @returns New object with merged key/values\r\n */\r\nexport function mergeDeep<T>(...objects: any[]): T {\r\n  const isObject = (obj: any) => obj && typeof obj === 'object' && obj.constructor === Object\r\n\r\n  return objects.reduce((prev, obj) => {\r\n    Object.keys(obj ?? {}).forEach((key) => {\r\n      // Avoid prototype pollution\r\n      if (key === '__proto__' || key === 'constructor' || key === 'prototype') {\r\n        return\r\n      }\r\n\r\n      const pVal = prev[key]\r\n      const oVal = obj[key]\r\n\r\n      if (Array.isArray(pVal) && Array.isArray(oVal)) {\r\n        prev[key] = pVal.concat(...oVal)\r\n      } else if (isObject(pVal) && isObject(oVal)) {\r\n        prev[key] = mergeDeep(pVal, oVal)\r\n      } else {\r\n        prev[key] = oVal\r\n      }\r\n    })\r\n\r\n    return prev\r\n  }, {})\r\n}\r\n","import type {\r\n  NotifyData,\r\n  PageData,\r\n  CommentData,\r\n  DataManagerApi,\r\n  ListFetchParams,\r\n  ListLastFetchData,\r\n  EventPayloadMap,\r\n} from '@/types'\r\nimport EventManager from './lib/event-manager'\r\n\r\nexport class DataManager implements DataManagerApi {\r\n  private loading: boolean = false\r\n  private listLastFetch?: ListLastFetchData\r\n  private comments: CommentData[] = [] // Note: 无层级结构 + 无须排列\r\n  private notifies: NotifyData[] = []\r\n  private page?: PageData\r\n\r\n  constructor(protected events: EventManager<EventPayloadMap>) {}\r\n\r\n  getLoading() {\r\n    return this.loading\r\n  }\r\n\r\n  setLoading(val: boolean) {\r\n    this.loading = val\r\n  }\r\n\r\n  getListLastFetch() {\r\n    return this.listLastFetch\r\n  }\r\n\r\n  setListLastFetch(val: ListLastFetchData) {\r\n    this.listLastFetch = val\r\n  }\r\n\r\n  // -------------------------------------------------------------------\r\n  //  Comments\r\n  // -------------------------------------------------------------------\r\n  getComments() {\r\n    return this.comments\r\n  }\r\n\r\n  fetchComments(params: Partial<ListFetchParams>) {\r\n    this.events.trigger('list-fetch', params)\r\n  }\r\n\r\n  findComment(id: number) {\r\n    return this.comments.find((c) => c.id === id)\r\n  }\r\n\r\n  clearComments() {\r\n    this.comments = []\r\n    this.events.trigger('list-loaded', this.comments)\r\n  }\r\n\r\n  loadComments(partialComments: CommentData[]) {\r\n    this.events.trigger('list-load', partialComments)\r\n\r\n    this.comments.push(...partialComments)\r\n\r\n    this.events.trigger('list-loaded', this.comments)\r\n  }\r\n\r\n  insertComment(comment: CommentData) {\r\n    this.comments.push(comment)\r\n\r\n    this.events.trigger('comment-inserted', comment)\r\n    this.events.trigger('list-loaded', this.comments) // list-loaded should always keep the last\r\n  }\r\n\r\n  updateComment(comment: CommentData) {\r\n    this.comments = this.comments.map((c) => {\r\n      if (c.id === comment.id) return comment\r\n      return c\r\n    })\r\n\r\n    this.events.trigger('comment-updated', comment)\r\n    this.events.trigger('list-loaded', this.comments)\r\n  }\r\n\r\n  deleteComment(id: number) {\r\n    const comment = this.comments.find((c) => c.id === id)\r\n    if (!comment) throw new Error(`Comment ${id} not found`)\r\n    this.comments = this.comments.filter((c) => c.id !== id)\r\n\r\n    this.events.trigger('comment-deleted', comment)\r\n    this.events.trigger('list-loaded', this.comments)\r\n  }\r\n\r\n  // -------------------------------------------------------------------\r\n  //  Notifies\r\n  // -------------------------------------------------------------------\r\n  getNotifies() {\r\n    return this.notifies\r\n  }\r\n\r\n  updateNotifies(notifies: NotifyData[]) {\r\n    this.notifies = notifies\r\n\r\n    this.events.trigger('notifies-updated', this.notifies)\r\n  }\r\n\r\n  // -------------------------------------------------------------------\r\n  // Page\r\n  // -------------------------------------------------------------------\r\n  getPage() {\r\n    return this.page\r\n  }\r\n\r\n  updatePage(pageData: PageData) {\r\n    this.page = pageData\r\n\r\n    this.events.trigger('page-loaded', pageData)\r\n  }\r\n}\r\n","const en = {\r\n  /* Editor */\r\n  placeholder: 'Leave a comment',\r\n  noComment: 'No Comment',\r\n  send: 'Send',\r\n  save: 'Save',\r\n  nick: 'Nickname',\r\n  email: 'Email',\r\n  link: 'Website',\r\n  emoticon: 'Emoji',\r\n  preview: 'Preview',\r\n  image: 'Image',\r\n  refresh: 'Refresh',\r\n  uploadImage: 'Upload Image',\r\n  uploadFail: 'Upload Failed',\r\n  commentFail: 'Failed to comment',\r\n  restoredMsg: 'Content has been restored',\r\n  onlyAdminCanReply: 'Only admin can reply',\r\n  uploadLoginMsg: 'Please fill in your name and email to upload',\r\n\r\n  /* List */\r\n  counter: '{count} Comments',\r\n  sortLatest: 'Latest',\r\n  sortOldest: 'Oldest',\r\n  sortBest: 'Best',\r\n  sortAuthor: 'Author',\r\n  openComment: 'Open Comment',\r\n  closeComment: 'Close Comment',\r\n  listLoadFailMsg: 'Failed to load comments',\r\n  listRetry: 'Retry',\r\n  loadMore: 'Load More',\r\n\r\n  /* Comment */\r\n  admin: 'Admin',\r\n  reply: 'Reply',\r\n  voteUp: 'Up',\r\n  voteDown: 'Down',\r\n  voteFail: 'Vote Failed',\r\n  readMore: 'Read More',\r\n  actionConfirm: 'Confirm',\r\n  collapse: 'Collapse',\r\n  collapsed: 'Collapsed',\r\n  collapsedMsg: 'This comment has been collapsed',\r\n  expand: 'Expand',\r\n  approved: 'Approved',\r\n  pending: 'Pending',\r\n  pendingMsg: 'Pending, visible only to commenter.',\r\n  edit: 'Edit',\r\n  editCancel: 'Cancel Edit',\r\n  delete: 'Delete',\r\n  deleteConfirm: 'Confirm',\r\n  pin: 'Pin',\r\n  unpin: 'Unpin',\r\n\r\n  /* Time */\r\n  seconds: 'seconds ago',\r\n  minutes: 'minutes ago',\r\n  hours: 'hours ago',\r\n  days: 'days ago',\r\n  now: 'just now',\r\n\r\n  /* Checker */\r\n  adminCheck: 'Enter admin password:',\r\n  captchaCheck: 'Enter the CAPTCHA to continue:',\r\n  confirm: 'Confirm',\r\n  cancel: 'Cancel',\r\n\r\n  /* Sidebar */\r\n  msgCenter: 'Messages',\r\n  ctrlCenter: 'Admin',\r\n  emailVerified: 'Email has been verified',\r\n\r\n  /* General */\r\n  frontend: 'Frontend',\r\n  backend: 'Backend',\r\n  loading: 'Loading',\r\n  loadFail: 'Load Failed',\r\n  editing: 'Editing',\r\n  editFail: 'Edit Failed',\r\n  deleting: 'Deleting',\r\n  deleteFail: 'Delete Failed',\r\n  reqGot: 'Request got',\r\n  reqAborted: 'Request timed out or terminated unexpectedly',\r\n  updateMsg: 'Please update Artalk {name} to get the best experience!',\r\n  currentVersion: 'Current Version',\r\n  ignore: 'Ignore',\r\n  open: 'Open',\r\n  openName: 'Open {name}',\r\n}\r\n\r\nexport type I18n = typeof en\r\nexport type I18nKeys = keyof I18n\r\n\r\nexport default en\r\n","import type { I18n } from '.'\r\n\r\nexport const GLOBAL_LOCALES_KEY = 'ArtalkI18n'\r\n\r\nexport function defineLocaleExternal(lang: string, locale: I18n, aliases?: string[]) {\r\n  if (!window[GLOBAL_LOCALES_KEY]) window[GLOBAL_LOCALES_KEY] = {}\r\n  window[GLOBAL_LOCALES_KEY][lang] = locale\r\n  if (aliases)\r\n    aliases.forEach((l) => {\r\n      window[GLOBAL_LOCALES_KEY][l] = locale\r\n    })\r\n  return locale\r\n}\r\n","export function createElement<E extends HTMLElement = HTMLElement>(htmlStr: string = ''): E {\r\n  const div = document.createElement('div')\r\n  div.innerHTML = htmlStr.trim()\r\n  return (div.firstElementChild || div) as E\r\n}\r\n\r\nexport function getHeight(el: HTMLElement) {\r\n  return parseFloat(getComputedStyle(el, null).height.replace('px', ''))\r\n}\r\n\r\nexport function htmlEncode(str: string) {\r\n  const temp = document.createElement('div')\r\n  temp.innerText = str\r\n  const output = temp.innerHTML\r\n  return output\r\n}\r\n\r\nexport function htmlDecode(str: string) {\r\n  const temp = document.createElement('div')\r\n  temp.innerHTML = str\r\n  const output = temp.innerText\r\n  return output\r\n}\r\n\r\nexport function getQueryParam(name: string) {\r\n  const match = RegExp(`[?&]${name}=([^&]*)`).exec(window.location.search)\r\n  return match && decodeURIComponent(match[1].replace(/\\+/g, ' '))\r\n}\r\n\r\nexport function getOffset(el: HTMLElement, relativeTo?: HTMLElement) {\r\n  const getOffsetRecursive = (element: HTMLElement): { top: number; left: number } => {\r\n    const rect = element.getBoundingClientRect()\r\n    const scrollLeft = window.pageXOffset || document.documentElement.scrollLeft\r\n    const scrollTop = window.pageYOffset || document.documentElement.scrollTop\r\n    return {\r\n      top: rect.top + scrollTop,\r\n      left: rect.left + scrollLeft,\r\n    }\r\n  }\r\n\r\n  const elOffset = getOffsetRecursive(el)\r\n  if (!relativeTo) return elOffset\r\n\r\n  const relativeToOffset = getOffsetRecursive(relativeTo)\r\n\r\n  return {\r\n    top: elOffset.top - relativeToOffset.top,\r\n    left: elOffset.left - relativeToOffset.left,\r\n  }\r\n}\r\n\r\nexport function padWithZeros(vNumber: number, width: number) {\r\n  let numAsString = vNumber.toString()\r\n  while (numAsString.length < width) {\r\n    numAsString = `0${numAsString}`\r\n  }\r\n  return numAsString\r\n}\r\n\r\nexport function dateFormat(date: Date) {\r\n  const vDay = padWithZeros(date.getDate(), 2)\r\n  const vMonth = padWithZeros(date.getMonth() + 1, 2)\r\n  const vYear = padWithZeros(date.getFullYear(), 2)\r\n  // var vHour = padWithZeros(date.getHours(), 2);\r\n  // var vMinute = padWithZeros(date.getMinutes(), 2);\r\n  // var vSecond = padWithZeros(date.getSeconds(), 2);\r\n  return `${vYear}-${vMonth}-${vDay}`\r\n}\r\n\r\nexport function timeAgo(date: Date, $t: Function = (n: string) => n) {\r\n  try {\r\n    const oldTime = date.getTime()\r\n    const currTime = new Date().getTime()\r\n    const diffValue = currTime - oldTime\r\n\r\n    const days = Math.floor(diffValue / (24 * 3600 * 1000))\r\n    if (days === 0) {\r\n      // 计算相差小时数\r\n      const leave1 = diffValue % (24 * 3600 * 1000) // 计算天数后剩余的毫秒数\r\n      const hours = Math.floor(leave1 / (3600 * 1000))\r\n      if (hours === 0) {\r\n        // 计算相差分钟数\r\n        const leave2 = leave1 % (3600 * 1000) // 计算小时数后剩余的毫秒数\r\n        const minutes = Math.floor(leave2 / (60 * 1000))\r\n        if (minutes === 0) {\r\n          // 计算相差秒数\r\n          const leave3 = leave2 % (60 * 1000) // 计算分钟数后剩余的毫秒数\r\n          const seconds = Math.round(leave3 / 1000)\r\n          if (seconds < 10) return $t('now')\r\n          return `${seconds} ${$t('seconds')}`\r\n        }\r\n        return `${minutes} ${$t('minutes')}`\r\n      }\r\n      return `${hours} ${$t('hours')}`\r\n    }\r\n    if (days < 0) return $t('now')\r\n\r\n    if (days < 30) {\r\n      return `${days} ${$t('days')}`\r\n    }\r\n\r\n    return dateFormat(date)\r\n  } catch (error) {\r\n    console.error(error)\r\n    return ' - '\r\n  }\r\n}\r\n\r\n/** 所有图片加载完毕后执行 */\r\nexport function onImagesLoaded($container: HTMLElement, event: Function) {\r\n  if (!$container) return\r\n  const images = $container.getElementsByTagName('img')\r\n  if (!images.length) return\r\n  let loaded = images.length\r\n  for (let i = 0; i < images.length; i++) {\r\n    if (images[i].complete) {\r\n      loaded--\r\n    } else {\r\n      // eslint-disable-next-line @typescript-eslint/no-loop-func\r\n      images[i].addEventListener('load', () => {\r\n        loaded--\r\n        if (loaded === 0) event()\r\n      })\r\n    }\r\n\r\n    if (loaded === 0) event()\r\n  }\r\n}\r\n\r\nexport function getGravatarURL(opts: { params: string; mirror: string; emailMD5: string }) {\r\n  return `${opts.mirror.replace(/\\/$/, '')}/${opts.emailMD5}?${opts.params.replace(/^\\?/, '')}`\r\n}\r\n\r\nexport function sleep(ms: number) {\r\n  return new Promise((resolve) => {\r\n    setTimeout(resolve, ms)\r\n  })\r\n}\r\n\r\n/** 版本号比较（a < b :-1 | 0 | b < a :1） */\r\nexport function versionCompare(a: string, b: string) {\r\n  const pa = a.split('.')\r\n  const pb = b.split('.')\r\n  for (let i = 0; i < 3; i++) {\r\n    const na = Number(pa[i])\r\n    const nb = Number(pb[i])\r\n    if (na > nb) return 1\r\n    if (nb > na) return -1\r\n    if (!Number.isNaN(na) && Number.isNaN(nb)) return 1\r\n    if (Number.isNaN(na) && !Number.isNaN(nb)) return -1\r\n  }\r\n  return 0\r\n}\r\n\r\n/** 获取修正后的 UserAgent */\r\nexport async function getCorrectUserAgent() {\r\n  const uaRaw = navigator.userAgent\r\n  if (!(navigator as any).userAgentData || !(navigator as any).userAgentData.getHighEntropyValues) {\r\n    return uaRaw\r\n  }\r\n\r\n  // @link https://web.dev/migrate-to-ua-ch/\r\n  // @link https://web.dev/user-agent-client-hints/\r\n  const uaData = (navigator as any).userAgentData\r\n  let uaGot: any = null\r\n  try {\r\n    uaGot = await uaData.getHighEntropyValues(['platformVersion'])\r\n  } catch (err) {\r\n    console.error(err)\r\n    return uaRaw\r\n  }\r\n  const majorPlatformVersion = Number(uaGot.platformVersion.split('.')[0])\r\n\r\n  if (uaData.platform === 'Windows') {\r\n    if (majorPlatformVersion >= 13) {\r\n      // @link https://docs.microsoft.com/en-us/microsoft-edge/web-platform/how-to-detect-win11\r\n      // @date 2022-4-29\r\n      // Win 11 样本：\"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/98.0.4758.102 Safari/537.36\"\r\n      return uaRaw.replace(/Windows NT 10.0/, 'Windows NT 11.0')\r\n    }\r\n  }\r\n  if (uaData.platform === 'macOS') {\r\n    if (majorPlatformVersion >= 11) {\r\n      // 11 => BigSur\r\n      // @date 2022-4-29\r\n      // (Intel Chip) macOS 12.3 样本：\"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/100.0.4896.127 Safari/537.36\"\r\n      // (Arm Chip) macOS 样本：\"Mozilla/5.0 (Macintosh; ARM Mac OS X 10_15_6) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/14.0.2 Safari/605.1.15\"\r\n      return uaRaw.replace(\r\n        /(Mac OS X \\d+_\\d+_\\d+|Mac OS X)/,\r\n        `Mac OS X ${uaGot.platformVersion.replace(/\\./g, '_')}`,\r\n      )\r\n    }\r\n  }\r\n\r\n  return uaRaw\r\n}\r\n\r\n/** 是否为完整的 URL */\r\nexport function isValidURL(urlRaw: string) {\r\n  // @link https://www.rfc-editor.org/rfc/rfc3986\r\n  let url: URL\r\n  try {\r\n    url = new URL(urlRaw)\r\n  } catch (_) {\r\n    return false\r\n  }\r\n  return url.protocol === 'http:' || url.protocol === 'https:'\r\n}\r\n\r\n/** 获取基于 conf.server 的 URL */\r\nexport function getURLBasedOnApi(opts: { base: string; path: string }) {\r\n  return getURLBasedOn(opts.base, opts.path)\r\n}\r\n\r\n/** 获取基于某个 baseURL 的 URL */\r\nexport function getURLBasedOn(baseURL: string, path: string) {\r\n  return `${baseURL.replace(/\\/$/, '')}/${path.replace(/^\\//, '')}`\r\n}\r\n","import en, { I18n, I18nKeys } from './en'\r\nimport zhCN from './zh-CN'\r\nimport { GLOBAL_LOCALES_KEY } from './external'\r\nimport * as Utils from '../lib/utils'\r\n\r\nexport type * from './en'\r\n\r\n// @note the key of language is followed by `ISO 639`\r\n// https://en.wikipedia.org/wiki/ISO_639\r\n// https://datatracker.ietf.org/doc/html/rfc5646#section-2.1\r\nexport const internal = {\r\n  en,\r\n  'en-US': en,\r\n  'zh-CN': zhCN,\r\n}\r\n\r\n/**\r\n * find a locale object by language name\r\n */\r\nexport function findLocaleSet(lang: string): I18n {\r\n  // normalize a key of language to `ISO 639`\r\n  lang = lang.replace(\r\n    /^([a-zA-Z]+)(-[a-zA-Z]+)?$/,\r\n    (_, p1: string, p2: string) => p1.toLowerCase() + (p2 || '').toUpperCase(),\r\n  )\r\n\r\n  // internal finding\r\n  if (internal[lang]) {\r\n    return internal[lang]\r\n  }\r\n\r\n  // external finding\r\n  if (window[GLOBAL_LOCALES_KEY] && window[GLOBAL_LOCALES_KEY][lang]) {\r\n    return window[GLOBAL_LOCALES_KEY][lang]\r\n  }\r\n\r\n  // case when not found:\r\n  // use `en` by default\r\n  return internal.en\r\n}\r\n\r\n/**\r\n * System locale setting\r\n */\r\nlet LocaleConf: I18n | string = 'en'\r\nlet LocaleDict: I18n = findLocaleSet(LocaleConf) // en by default\r\n\r\n/**\r\n * Set system locale\r\n */\r\nexport function setLocale(locale: I18n | string) {\r\n  if (locale === LocaleConf) return\r\n  LocaleConf = locale\r\n  LocaleDict = typeof locale === 'string' ? findLocaleSet(locale) : locale\r\n}\r\n\r\n/**\r\n * Get an i18n message by key\r\n */\r\nexport function t(key: I18nKeys, args: { [key: string]: string } = {}) {\r\n  let str = LocaleDict?.[key] || key\r\n  str = str.replace(/\\{\\s*(\\w+?)\\s*\\}/g, (_, token) => args[token] || '')\r\n\r\n  return Utils.htmlEncode(str)\r\n}\r\n\r\nexport default t\r\n","import type { I18n } from '.'\r\n\r\nconst zhCN: I18n = {\r\n  /* Editor */\r\n  placeholder: '键入内容...',\r\n  noComment: '「此时无声胜有声」',\r\n  send: '发送评论',\r\n  save: '保存评论',\r\n  nick: '昵称',\r\n  email: '邮箱',\r\n  link: '网址',\r\n  emoticon: '<svg viewBox=\"0 0 1024 1024\" width=\"24\" height=\"24\"><path d=\"M563.2 463.3 677 540c1.7 1.2 3.7 1.8 5.8 1.8.7 0 1.4-.1 2-.2 2.7-.5 5.1-2.1 6.6-4.4l25.3-37.8c1.5-2.3 2.1-5.1 1.6-7.8s-2.1-5.1-4.4-6.6l-73.6-49.1 73.6-49.1c2.3-1.5 3.9-3.9 4.4-6.6.5-2.7 0-5.5-1.6-7.8l-25.3-37.8a10.1 10.1 0 0 0-6.6-4.4c-.7-.1-1.3-.2-2-.2-2.1 0-4.1.6-5.8 1.8l-113.8 76.6c-9.2 6.2-14.7 16.4-14.7 27.5.1 11 5.5 21.3 14.7 27.4zM387 348.8h-45.5c-5.7 0-10.4 4.7-10.4 10.4v153.3c0 5.7 4.7 10.4 10.4 10.4H387c5.7 0 10.4-4.7 10.4-10.4V359.2c0-5.7-4.7-10.4-10.4-10.4zm333.8 241.3-41-20a10.3 10.3 0 0 0-8.1-.5c-2.6.9-4.8 2.9-5.9 5.4-30.1 64.9-93.1 109.1-164.4 115.2-5.7.5-9.9 5.5-9.5 11.2l3.9 45.5c.5 5.3 5 9.5 10.3 9.5h.9c94.8-8 178.5-66.5 218.6-152.7 2.4-5 .3-11.2-4.8-13.6zm186-186.1c-11.9-42-30.5-81.4-55.2-117.1-24.1-34.9-53.5-65.6-87.5-91.2-33.9-25.6-71.5-45.5-111.6-59.2-41.2-14-84.1-21.1-127.8-21.1h-1.2c-75.4 0-148.8 21.4-212.5 61.7-63.7 40.3-114.3 97.6-146.5 165.8-32.2 68.1-44.3 143.6-35.1 218.4 9.3 74.8 39.4 145 87.3 203.3.1.2.3.3.4.5l36.2 38.4c1.1 1.2 2.5 2.1 3.9 2.6 73.3 66.7 168.2 103.5 267.5 103.5 73.3 0 145.2-20.3 207.7-58.7 37.3-22.9 70.3-51.5 98.1-85 27.1-32.7 48.7-69.5 64.2-109.1 15.5-39.7 24.4-81.3 26.6-123.8 2.4-43.6-2.5-87-14.5-129zm-60.5 181.1c-8.3 37-22.8 72-43 104-19.7 31.1-44.3 58.6-73.1 81.7-28.8 23.1-61 41-95.7 53.4-35.6 12.7-72.9 19.1-110.9 19.1-82.6 0-161.7-30.6-222.8-86.2l-34.1-35.8c-23.9-29.3-42.4-62.2-55.1-97.7-12.4-34.7-18.8-71-19.2-107.9-.4-36.9 5.4-73.3 17.1-108.2 12-35.8 30-69.2 53.4-99.1 31.7-40.4 71.1-72 117.2-94.1 44.5-21.3 94-32.6 143.4-32.6 49.3 0 97 10.8 141.8 32 34.3 16.3 65.3 38.1 92 64.8 26.1 26 47.5 56 63.6 89.2 16.2 33.2 26.6 68.5 31 105.1 4.6 37.5 2.7 75.3-5.6 112.3z\" fill=\"currentColor\"></path></svg>',\r\n  preview: '<svg viewBox=\"0 0 1024 1024\" width=\"24\" height=\"24\"><path d=\"M710.816 654.301c70.323-96.639 61.084-230.578-23.705-314.843-46.098-46.098-107.183-71.109-172.28-71.109-65.008 0-126.092 25.444-172.28 71.109-45.227 46.098-70.756 107.183-70.756 172.106 0 64.923 25.444 126.007 71.194 172.106 46.099 46.098 107.184 71.109 172.28 71.109 51.414 0 100.648-16.212 142.824-47.404l126.53 126.006c7.058 7.06 16.297 10.979 26.406 10.979 10.105 0 19.343-3.919 26.402-10.979 14.467-14.467 14.467-38.172 0-52.723L710.816 654.301zm-315.107-23.265c-65.88-65.88-65.88-172.54 0-238.42 32.069-32.07 74.245-49.149 119.471-49.149 45.227 0 87.407 17.603 119.472 49.149 65.88 65.879 65.88 172.539 0 238.42-63.612 63.178-175.242 63.178-238.943 0zm0 0\" fill=\"currentColor\"></path><path d=\"M703.319 121.603H321.03c-109.8 0-199.469 89.146-199.469 199.38v382.034c0 109.796 89.236 199.38 199.469 199.38h207.397c20.653 0 37.384-16.645 37.384-37.299 0-20.649-16.731-37.296-37.384-37.296H321.03c-68.582 0-124.352-55.77-124.352-124.267V321.421c0-68.496 55.77-124.267 124.352-124.267h382.289c68.582 0 124.352 55.771 124.352 124.267V524.72c0 20.654 16.736 37.299 37.385 37.299 20.654 0 37.384-16.645 37.384-37.299V320.549c-.085-109.8-89.321-198.946-199.121-198.946zm0 0\" fill=\"currentColor\"></path></svg>',\r\n  image: '<svg viewBox=\"0 0 1024 1024\" width=\"24\" height=\"24\"><path d=\"M784 112H240c-88 0-160 72-160 160v480c0 88 72 160 160 160h544c88 0 160-72 160-160V272c0-88-72-160-160-160zm96 640c0 52.8-43.2 96-96 96H240c-52.8 0-96-43.2-96-96V272c0-52.8 43.2-96 96-96h544c52.8 0 96 43.2 96 96v480z\" fill=\"currentColor\"></path><path d=\"M352 480c52.8 0 96-43.2 96-96s-43.2-96-96-96-96 43.2-96 96 43.2 96 96 96zm0-128c17.6 0 32 14.4 32 32s-14.4 32-32 32-32-14.4-32-32 14.4-32 32-32zm462.4 379.2-3.2-3.2-177.6-177.6c-25.6-25.6-65.6-25.6-91.2 0l-80 80-36.8-36.8c-25.6-25.6-65.6-25.6-91.2 0L200 728c-4.8 6.4-8 14.4-8 24 0 17.6 14.4 32 32 32 9.6 0 16-3.2 22.4-9.6L380.8 640l134.4 134.4c6.4 6.4 14.4 9.6 24 9.6 17.6 0 32-14.4 32-32 0-9.6-4.8-17.6-9.6-24l-52.8-52.8 80-80L769.6 776c6.4 4.8 12.8 8 20.8 8 17.6 0 32-14.4 32-32 0-8-3.2-16-8-20.8z\" fill=\"currentColor\"></path></svg>',\r\n  refresh: '<svg viewBox=\"0 0 1024 1024\" width=\"24\" height=\"24\"><path d=\"M512.34133333 931.38488889c-49.94844445 0-98.87288889-8.64711111-145.29422222-25.82755556-44.94222222-16.61155555-86.35733333-40.61866667-123.22133333-71.45244444-74.29688889-61.89511111-125.15555555-148.02488889-143.24622223-242.34666667l71.45244445-13.76711111c31.28888889 162.58844445 174.42133333 280.576 340.30933333 280.576 70.08711111 0 137.55733333-20.82133333 195.12888889-60.07466666 56.32-38.45688889 99.66933333-91.93244445 125.49688889-154.73777778l67.35644444 27.648c-31.28888889 76.00355555-83.74044445 140.74311111-151.77955555 187.16444444-69.85955555 47.67288889-151.43822222 72.81777778-236.20266667 72.81777778zM846.848 421.43288889C827.392 349.29777778 783.92888889 284.33066667 724.65066667 238.13688889c-61.21244445-47.55911111-134.59911111-72.704-212.30933334-72.704-69.97333333 0-137.44355555 20.70755555-194.90133333 59.96088889-56.32 38.57066667-99.78311111 91.93244445-125.61066667 154.624l-67.35644444-27.76177778c31.28888889-75.88977778 83.74044445-140.40177778 151.77955556-186.82311111 69.74577778-47.55911111 151.32444445-72.704 235.9751111-72.704 47.33155555 0 93.86666667 7.85066667 138.12622223 23.32444444 42.89422222 14.90488889 82.83022222 36.75022222 118.784 64.62577778 35.61244445 27.648 66.33244445 60.64355555 91.47733333 98.07644444 25.48622222 38.00177778 44.48711111 79.64444445 56.32 123.67644445l-70.08711111 19.00088889z\" fill=\"currentColor\"></path><path d=\"M30.26488889 669.35466667l93.52533333-162.58844445 162.58844445 93.52533333M997.71733333 345.20177778l-83.28533333 168.16355555-168.16355555-83.17155555\" fill=\"currentColor\"></path></svg>',\r\n  uploadImage: '上传图片',\r\n  uploadFail: '上传失败',\r\n  commentFail: '评论失败',\r\n  restoredMsg: '内容已自动恢复',\r\n  onlyAdminCanReply: '仅管理员可评论',\r\n  uploadLoginMsg: '填入你的名字邮箱才能上传哦',\r\n\r\n  /* List */\r\n  counter: '{count} 条评论',\r\n  sortLatest: '最新',\r\n  sortOldest: '最早',\r\n  sortBest: '最热',\r\n  sortAuthor: '作者',\r\n  openComment: '打开评论',\r\n  closeComment: '关闭评论',\r\n  listLoadFailMsg: '无法获取评论列表数据',\r\n  listRetry: '点击重新获取',\r\n  loadMore: '加载更多',\r\n\r\n  /* Comment */\r\n  admin: '管理员',\r\n  reply: '回复',\r\n  voteUp: '赞同',\r\n  voteDown: '反对',\r\n  voteFail: '投票失败',\r\n  readMore: '阅读更多',\r\n  actionConfirm: '确认操作',\r\n  collapse: '折叠',\r\n  collapsed: '已折叠',\r\n  collapsedMsg: '该评论已被系统或管理员折叠',\r\n  expand: '展开',\r\n  approved: '已审',\r\n  pending: '待审',\r\n  pendingMsg: '审核中，仅本人可见。',\r\n  edit: '编辑',\r\n  editCancel: '取消编辑',\r\n  delete: '删除',\r\n  deleteConfirm: '确认删除',\r\n  pin: '置顶',\r\n  unpin: '取消置顶',\r\n\r\n  /* Time */\r\n  seconds: '秒前',\r\n  minutes: '分钟前',\r\n  hours: '小时前',\r\n  days: '天前',\r\n  now: '刚刚',\r\n\r\n  /* Checker */\r\n  adminCheck: '键入密码来验证管理员身份：',\r\n  captchaCheck: '键入验证码继续：',\r\n  confirm: '确认',\r\n  cancel: '取消',\r\n\r\n  /* Sidebar */\r\n  msgCenter: '通知中心',\r\n  ctrlCenter: '控制中心',\r\n  emailVerified: '邮箱已验证',\r\n\r\n  /* General */\r\n  frontend: '前端',\r\n  backend: '后端',\r\n  loading: '加载中',\r\n  loadFail: '加载失败',\r\n  editing: '修改中',\r\n  editFail: '修改失败',\r\n  deleting: '删除中',\r\n  deleteFail: '删除失败',\r\n  reqGot: '请求响应',\r\n  reqAborted: '请求超时或意外终止',\r\n  updateMsg: '请更新 Artalk {name} 以获得更好的体验！',\r\n  currentVersion: '当前版本',\r\n  ignore: '忽略',\r\n  open: '打开',\r\n  openName: '打开{name}',\r\n}\r\n\r\nexport default zhCN\r\n","export type EventHandler<T> = (payload: T) => void\r\nexport interface Event<PayloadMap, K extends keyof PayloadMap = keyof PayloadMap>\r\n  extends EventOptions {\r\n  name: K\r\n  handler: EventHandler<PayloadMap[K]>\r\n}\r\nexport interface EventOptions {\r\n  once?: boolean\r\n}\r\n\r\nexport interface EventManagerFuncs<PayloadMap> {\r\n  on<K extends keyof PayloadMap>(\r\n    name: K,\r\n    handler: EventHandler<PayloadMap[K]>,\r\n    opts?: EventOptions,\r\n  ): void\r\n  off<K extends keyof PayloadMap>(name: K, handler: EventHandler<PayloadMap[K]>): void\r\n  trigger<K extends keyof PayloadMap>(name: K, payload?: PayloadMap[K]): void\r\n}\r\n\r\nexport default class EventManager<PayloadMap> implements EventManagerFuncs<PayloadMap> {\r\n  private events: Event<PayloadMap>[] = []\r\n\r\n  /**\r\n   * Add an event listener for a specific event name\r\n   */\r\n  public on<K extends keyof PayloadMap>(\r\n    name: K,\r\n    handler: EventHandler<PayloadMap[K]>,\r\n    opts: EventOptions = {},\r\n  ) {\r\n    this.events.push({\r\n      name,\r\n      handler: handler as EventHandler<PayloadMap[keyof PayloadMap]>,\r\n      ...opts,\r\n    })\r\n  }\r\n\r\n  /**\r\n   * Remove an event listener for a specific event name and handler\r\n   */\r\n  public off<K extends keyof PayloadMap>(name: K, handler: EventHandler<PayloadMap[K]>) {\r\n    if (!handler) return // not allow remove all events with same name\r\n    this.events = this.events.filter((evt) => !(evt.name === name && evt.handler === handler))\r\n  }\r\n\r\n  /**\r\n   * Trigger an event with an optional payload\r\n   */\r\n  public trigger<K extends keyof PayloadMap>(name: K, payload?: PayloadMap[K]) {\r\n    this.events\r\n      .slice(0) // make a copy, in case listeners are removed while iterating\r\n      .filter((evt) => evt.name === name && typeof evt.handler === 'function')\r\n      .forEach((evt) => {\r\n        if (evt.once) this.off(name, evt.handler)\r\n        evt.handler(payload!)\r\n      })\r\n  }\r\n}\r\n","import type { ArtalkConfig } from '@/types'\r\n\r\nconst defaults: ArtalkConfig = {\r\n  el: '',\r\n  pageKey: '',\r\n  pageTitle: '',\r\n  server: '',\r\n  site: '',\r\n\r\n  placeholder: '',\r\n  noComment: '',\r\n  sendBtn: '',\r\n  darkMode: false,\r\n  editorTravel: true,\r\n\r\n  flatMode: 'auto',\r\n  nestMax: 2,\r\n  nestSort: 'DATE_ASC',\r\n\r\n  emoticons: 'https://cdn.jsdelivr.net/gh/ArtalkJS/Emoticons/grps/default.json',\r\n\r\n  vote: true,\r\n  voteDown: false,\r\n  uaBadge: true,\r\n  listSort: true,\r\n  preview: true,\r\n  countEl: '#ArtalkCount',\r\n  pvEl: '#ArtalkPV',\r\n\r\n  gravatar: {\r\n    mirror: 'https://weavatar.com/avatar/',\r\n    params: 'd=mp&s=240',\r\n  },\r\n\r\n  pagination: {\r\n    pageSize: 20,\r\n    readMore: true,\r\n    autoLoad: true,\r\n  },\r\n\r\n  heightLimit: {\r\n    content: 300,\r\n    children: 400,\r\n    scrollable: false,\r\n  },\r\n\r\n  imgUpload: true,\r\n  reqTimeout: 15000,\r\n  versionCheck: true,\r\n  useBackendConf: true,\r\n\r\n  locale: 'en',\r\n}\r\n\r\nif (ARTALK_LITE) {\r\n  defaults.vote = false\r\n  defaults.uaBadge = false\r\n  defaults.emoticons = false\r\n  defaults.preview = false\r\n}\r\n\r\nexport default defaults\r\n","import type { ArtalkConfig, ContextApi } from '@/types'\r\nimport type { ApiOptions } from './api/options'\r\nimport { mergeDeep } from './lib/merge-deep'\r\nimport { createApiHandlers } from './api'\r\nimport Defaults from './defaults'\r\n\r\n/**\r\n * Handle the custom config which is provided by the user\r\n *\r\n * @param customConf - The custom config object which is provided by the user\r\n * @param full - If `full` is `true`, the return value will be the complete config for Artalk instance creation\r\n * @returns The config for Artalk instance creation\r\n */\r\nexport function handelCustomConf(customConf: Partial<ArtalkConfig>, full: true): ArtalkConfig\r\nexport function handelCustomConf(\r\n  customConf: Partial<ArtalkConfig>,\r\n  full?: false,\r\n): Partial<ArtalkConfig>\r\nexport function handelCustomConf(customConf: Partial<ArtalkConfig>, full = false) {\r\n  // 合并默认配置\r\n  const conf: Partial<ArtalkConfig> = full ? mergeDeep(Defaults, customConf) : customConf\r\n\r\n  // 绑定元素\r\n  if (conf.el && typeof conf.el === 'string') {\r\n    try {\r\n      const findEl = document.querySelector<HTMLElement>(conf.el)\r\n      if (!findEl) throw Error(`Target element \"${conf.el}\" was not found.`)\r\n      conf.el = findEl\r\n    } catch (e) {\r\n      console.error(e)\r\n      throw new Error('Please check your Artalk `el` config.')\r\n    }\r\n  }\r\n\r\n  // 默认 pageKey\r\n  if (conf.pageKey === '') conf.pageKey = `${window.location.pathname}` // @link http://bl.ocks.org/abernier/3070589\r\n\r\n  // 默认 pageTitle\r\n  if (conf.pageTitle === '') conf.pageTitle = `${document.title}`\r\n\r\n  // 服务器配置\r\n  if (conf.server) conf.server = conf.server.replace(/\\/$/, '').replace(/\\/api\\/?$/, '')\r\n\r\n  // 自适应语言\r\n  if (conf.locale === 'auto') conf.locale = navigator.language\r\n\r\n  // 自动判断启用平铺模式\r\n  if (conf.flatMode === 'auto') conf.flatMode = window.matchMedia('(max-width: 768px)').matches\r\n\r\n  // flatMode\r\n  if (typeof conf.nestMax === 'number' && Number(conf.nestMax) <= 1) conf.flatMode = true\r\n\r\n  return conf\r\n}\r\n\r\n/**\r\n * Handle the config which is provided by the server\r\n *\r\n * @param conf - The Server response config for control the frontend of Artalk remotely\r\n * @returns The config for Artalk instance creation\r\n */\r\nexport function handleConfFormServer(conf: Partial<ArtalkConfig>) {\r\n  const DisabledKeys: (keyof ArtalkConfig)[] = [\r\n    'el',\r\n    'pageKey',\r\n    'pageTitle',\r\n    'server',\r\n    'site',\r\n    'darkMode',\r\n  ]\r\n  Object.keys(conf).forEach((k) => {\r\n    if (DisabledKeys.includes(k as any)) delete conf[k]\r\n  })\r\n\r\n  // Patch: `emoticons` config string to json\r\n  if (conf.emoticons && typeof conf.emoticons === 'string') {\r\n    conf.emoticons = conf.emoticons.trim()\r\n    if (conf.emoticons.startsWith('[') || conf.emoticons.startsWith('{')) {\r\n      conf.emoticons = JSON.parse(conf.emoticons) // parse json\r\n    } else if (conf.emoticons === 'false') {\r\n      conf.emoticons = false\r\n    }\r\n  }\r\n\r\n  return conf\r\n}\r\n\r\n/**\r\n * Convert Artalk Config to ApiOptions for Api client\r\n *\r\n * @param conf - Artalk config\r\n * @param ctx - If `ctx` not provided, `checkAdmin` and `checkCaptcha` will be disabled\r\n * @returns ApiOptions for Api client instance creation\r\n */\r\nexport function convertApiOptions(conf: Partial<ArtalkConfig>, ctx?: ContextApi): ApiOptions {\r\n  return {\r\n    baseURL: `${conf.server}/api/v2`,\r\n    siteName: conf.site || '',\r\n    pageKey: conf.pageKey || '',\r\n    pageTitle: conf.pageTitle || '',\r\n    timeout: conf.reqTimeout,\r\n    getApiToken: () => ctx?.get('user').getData().token,\r\n    userInfo: ctx?.get('user').checkHasBasicUserInfo()\r\n      ? {\r\n          name: ctx?.get('user').getData().nick,\r\n          email: ctx?.get('user').getData().email,\r\n        }\r\n      : undefined,\r\n    handlers: ctx?.getApiHandlers(),\r\n  }\r\n}\r\n\r\nexport function createNewApiHandlers(ctx: ContextApi) {\r\n  const h = createApiHandlers()\r\n  h.add('need_captcha', (res) => ctx.checkCaptcha(res))\r\n  h.add('need_login', () => ctx.checkAdmin({}))\r\n\r\n  return h\r\n}\r\n","import type { ArtalkConfig, ContextApi } from '@/types'\r\n\r\nexport function watchConf<T extends (keyof ArtalkConfig)[]>(\r\n  ctx: ContextApi,\r\n  keys: T,\r\n  effect: (conf: Pick<ArtalkConfig, T[number]>) => void,\r\n): void {\r\n  const deepEqual = (a: any, b: any) => JSON.stringify(a) === JSON.stringify(b)\r\n  const val = () => {\r\n    const conf = ctx.getConf()\r\n    const res: any = {}\r\n    keys.forEach((key) => {\r\n      res[key] = conf[key]\r\n    })\r\n    return res\r\n  }\r\n  let lastVal: any = null\r\n  const handler = () => {\r\n    const newVal = val()\r\n    const isDiff = lastVal == null || !deepEqual(lastVal, newVal)\r\n    // only trigger when specific keys changed\r\n    if (isDiff) {\r\n      lastVal = newVal\r\n      effect(newVal)\r\n    }\r\n  }\r\n  ctx.on('mounted', handler)\r\n  ctx.on('updated', handler)\r\n}\r\n","import type {\r\n  ArtalkConfig,\r\n  CommentData,\r\n  ListFetchParams,\r\n  ContextApi,\r\n  EventPayloadMap,\r\n  SidebarShowPayload,\r\n} from '@/types'\r\nimport type { TInjectedServices } from './service'\r\nimport { Api, ApiHandlers } from './api'\r\n\r\nimport * as marked from './lib/marked'\r\nimport { mergeDeep } from './lib/merge-deep'\r\nimport { CheckerCaptchaPayload, CheckerPayload } from './components/checker'\r\n\r\nimport { DataManager } from './data'\r\nimport * as I18n from './i18n'\r\n\r\nimport EventManager from './lib/event-manager'\r\nimport { convertApiOptions, createNewApiHandlers, handelCustomConf } from './config'\r\nimport { watchConf } from './lib/watch-conf'\r\n\r\n// Auto dependency injection\r\ninterface Context extends TInjectedServices {}\r\n\r\n/**\r\n * Artalk Context\r\n */\r\nclass Context implements ContextApi {\r\n  /* 运行参数 */\r\n  conf: ArtalkConfig\r\n  data: DataManager\r\n  $root: HTMLElement\r\n\r\n  /* Event Manager */\r\n  private events = new EventManager<EventPayloadMap>()\r\n  private mounted = false\r\n\r\n  constructor(conf: ArtalkConfig) {\r\n    this.conf = conf\r\n\r\n    this.$root = conf.el as HTMLElement\r\n    this.$root.classList.add('artalk')\r\n    this.$root.innerHTML = ''\r\n\r\n    this.data = new DataManager(this.events)\r\n\r\n    this.on('mounted', () => {\r\n      this.mounted = true\r\n    })\r\n  }\r\n\r\n  inject(depName: string, obj: any) {\r\n    this[depName] = obj\r\n  }\r\n\r\n  get(depName: string) {\r\n    return this[depName]\r\n  }\r\n\r\n  getApi() {\r\n    return new Api(convertApiOptions(this.conf, this))\r\n  }\r\n\r\n  private apiHandlers = <ApiHandlers | null>null\r\n  getApiHandlers() {\r\n    if (!this.apiHandlers) this.apiHandlers = createNewApiHandlers(this)\r\n    return this.apiHandlers\r\n  }\r\n\r\n  getData() {\r\n    return this.data\r\n  }\r\n\r\n  replyComment(commentData: CommentData, $comment: HTMLElement): void {\r\n    this.editor.setReply(commentData, $comment)\r\n  }\r\n\r\n  editComment(commentData: CommentData, $comment: HTMLElement): void {\r\n    this.editor.setEditComment(commentData, $comment)\r\n  }\r\n\r\n  fetch(params: Partial<ListFetchParams>): void {\r\n    this.data.fetchComments(params)\r\n  }\r\n\r\n  reload(): void {\r\n    this.data.fetchComments({ offset: 0 })\r\n  }\r\n\r\n  /* List */\r\n  listGotoFirst(): void {\r\n    this.events.trigger('list-goto-first')\r\n  }\r\n\r\n  getCommentNodes() {\r\n    return this.list.getCommentNodes()\r\n  }\r\n\r\n  getComments() {\r\n    return this.data.getComments()\r\n  }\r\n\r\n  getCommentList = this.getCommentNodes\r\n  getCommentDataList = this.getComments\r\n\r\n  /* Editor */\r\n  editorShowLoading(): void {\r\n    this.editor.showLoading()\r\n  }\r\n\r\n  editorHideLoading(): void {\r\n    this.editor.hideLoading()\r\n  }\r\n\r\n  editorShowNotify(msg, type): void {\r\n    this.editor.showNotify(msg, type)\r\n  }\r\n\r\n  editorResetState(): void {\r\n    this.editor.resetState()\r\n  }\r\n\r\n  /* Sidebar */\r\n  showSidebar(payload?: SidebarShowPayload): void {\r\n    this.sidebarLayer.show(payload)\r\n  }\r\n\r\n  hideSidebar(): void {\r\n    this.sidebarLayer.hide()\r\n  }\r\n\r\n  /* Checker */\r\n  checkAdmin(payload: CheckerPayload): Promise<void> {\r\n    return this.checkerLauncher.checkAdmin(payload)\r\n  }\r\n\r\n  checkCaptcha(payload: CheckerCaptchaPayload): Promise<void> {\r\n    return this.checkerLauncher.checkCaptcha(payload)\r\n  }\r\n\r\n  /* Events */\r\n  on(name: any, handler: any) {\r\n    this.events.on(name, handler)\r\n  }\r\n\r\n  off(name: any, handler: any) {\r\n    this.events.off(name, handler)\r\n  }\r\n\r\n  trigger(name: any, payload?: any) {\r\n    this.events.trigger(name, payload)\r\n  }\r\n\r\n  /* i18n */\r\n  $t(key: I18n.I18nKeys, args: { [key: string]: string } = {}): string {\r\n    return I18n.t(key, args)\r\n  }\r\n\r\n  setDarkMode(darkMode: boolean | 'auto'): void {\r\n    this.updateConf({ darkMode })\r\n\r\n    const owoShow = document.querySelector('#owo-big')\r\n    if (this.conf.darkMode) owoShow?.classList.add('atk-dark-mode')\r\n    else owoShow?.classList.remove('atk-dark-mode')\r\n  }\r\n\r\n  updateConf(nConf: Partial<ArtalkConfig>): void {\r\n    this.conf = mergeDeep(this.conf, handelCustomConf(nConf, false))\r\n    this.mounted && this.events.trigger('updated', this.conf)\r\n  }\r\n\r\n  getConf(): ArtalkConfig {\r\n    return this.conf\r\n  }\r\n\r\n  getEl(): HTMLElement {\r\n    return this.$root\r\n  }\r\n\r\n  getMarked() {\r\n    return marked.getInstance()\r\n  }\r\n\r\n  watchConf<T extends (keyof ArtalkConfig)[]>(\r\n    keys: T,\r\n    effect: (conf: Pick<ArtalkConfig, T[number]>) => void,\r\n  ): void {\r\n    watchConf(this, keys, effect)\r\n  }\r\n\r\n  /** 表情包放大 */\r\n  showOwoBig(target: Node) {\r\n    const ratio = 2;\r\n    const maxLength = 200;\r\n    const body = document.querySelector('body') || document.createElement('body');\r\n    let div = document.querySelector('#owo-big') as HTMLElement;\r\n\r\n    if (!div) {\r\n      div = document.createElement('div');\r\n      div.id = 'owo-big';\r\n      body.appendChild(div);\r\n    }\r\n\r\n    const observer = new MutationObserver(mutations => {\r\n      mutations.forEach(mutation => {\r\n        mutation.addedNodes.forEach(node => {\r\n          const element = node as HTMLElement;\r\n\r\n          if (shouldEnlarge(element)) {\r\n            setupHoverEffects(element);\r\n          }\r\n        });\r\n      });\r\n    });\r\n\r\n    observer.observe(target, { subtree: true, childList: true });\r\n\r\n    function shouldEnlarge(element: HTMLElement): boolean {\r\n      return element.classList?.contains('atk-grp')\r\n        || element.classList?.contains('atk-comment-wrap')\r\n        || !!element.attributes?.['atk-emoticon']\r\n        || !!element.querySelector?.('img[atk-emoticon]');\r\n    }\r\n\r\n    function setupHoverEffects(element: HTMLElement) {\r\n      let flag = true;\r\n      let owoTime: number;\r\n\r\n      element.addEventListener('mouseover', (e: MouseEvent) => {\r\n        const imgElement = e.target as HTMLImageElement;\r\n        \r\n        if (flag && imgElement.tagName === 'IMG' && imgElement.attributes['atk-emoticon']) {\r\n          flag = false;\r\n          owoTime = window.setTimeout(() => {\r\n            const alt = imgElement.getAttribute(\"notitle\") === \"true\" ? '' : imgElement.alt || '';\r\n            const { clientHeight, clientWidth, naturalHeight, naturalWidth } = imgElement;\r\n            \r\n            if (clientHeight <= maxLength && clientWidth <= maxLength) {\r\n              const { tempWidth, tempHeight } = calculateSize(clientHeight, clientWidth, naturalHeight, naturalWidth);\r\n              const { top, left } = calculatePosition(e, tempWidth, clientWidth, body);\r\n\r\n              let adjustedTempHeight = tempHeight;\r\n              if (alt !== '') adjustedTempHeight += 10;\r\n\r\n              div.style.cssText = `display:block;height:${adjustedTempHeight + 34}px;width:${tempWidth + 34}px;left:${left}px;top:${top}px;`;\r\n              div.innerHTML = `<img src=\"${imgElement.src}\" onerror=\"this.classList.add('error')\"><p>${alt}</p>`;\r\n            }\r\n          }, 300);\r\n        }\r\n      });\r\n\r\n      element.addEventListener('mouseout', () => {\r\n        flag = true;\r\n        div.style.display = 'none';\r\n        clearTimeout(owoTime);\r\n      });\r\n    }\r\n\r\n    function calculateSize(clientHeight: number, clientWidth: number, naturalHeight: number, naturalWidth: number): { tempWidth: number, tempHeight: number } {\r\n      const zoomHeight = clientHeight * ratio;\r\n      const zoomWidth = clientWidth * ratio;\r\n\r\n      const height = Math.min(naturalHeight, zoomHeight, maxLength, clientHeight);\r\n      const width = Math.min(naturalWidth, zoomWidth, maxLength, clientWidth);\r\n      const aspectRatio = width / height;\r\n\r\n      const tempWidth = aspectRatio >= 1 ? Math.min(width, maxLength) : Math.min((width * maxLength) / height, width);\r\n      const tempHeight = aspectRatio < 1 ? Math.min(height, maxLength) : Math.min((height * maxLength) / width, height);\r\n\r\n      return { tempWidth, tempHeight };\r\n    }\r\n\r\n    function calculatePosition(e: MouseEvent, tempWidth: number, clientWidth: number, bodyElement: HTMLElement): { top: number, left: number } {\r\n      const top = e.clientY - e.offsetY;\r\n      let left = e.clientX - e.offsetX - (tempWidth - clientWidth) / 2;\r\n\r\n      left = Math.max(10, Math.min(left, bodyElement.clientWidth - tempWidth - 10));\r\n\r\n      return { top, left };\r\n    }\r\n  }\r\n\r\n  handleImageLoadFailure(target: Node) {\r\n    target.addEventListener('error', e => {\r\n      const elem = e.target as any;\r\n      if (elem?.tagName.toLowerCase() === 'img') {\r\n        elem.classList.add('error');\r\n        if(elem?.alt === '' && elem.getAttribute('atk-emoticon') !== null) {\r\n          elem.alt = '表情加载失败'\r\n        }\r\n        const parent = elem.parentElement;\r\n        if (parent && parent.classList.contains('loading-spinner-wrapper')) {\r\n          parent.replaceWith(elem);\r\n        }\r\n      }\r\n    }, true)\r\n  }\r\n\r\n  lazyLoadImages(target: Node) {\r\n    const loadImg = (img: Element) => {\r\n      const dataSrc = img.getAttribute('data-src');\r\n      if (dataSrc) {\r\n        img.setAttribute('src', dataSrc);\r\n        (img as HTMLElement).onload = () => {\r\n          // eslint-disable-next-line no-debugger\r\n          // debugger;\r\n          // 移除加载动画\r\n          const parent = img.parentElement;\r\n          if (parent && parent.classList.contains('loading-spinner-wrapper')) {\r\n            parent.replaceWith(img);\r\n          }\r\n        };\r\n      }\r\n    };\r\n\r\n    const wrapImgWithSpinner = (img: Element) => {\r\n      const wrapper = document.createElement('div');\r\n      wrapper.className = 'loading-spinner-wrapper';\r\n      wrapper.innerHTML = '<div class=\"loading-spinner\"></div>';\r\n      img.parentNode?.insertBefore(wrapper, img);\r\n      wrapper.appendChild(img);\r\n    };\r\n\r\n    const lazyLoadHandler = () => {\r\n      if (target instanceof HTMLElement) {\r\n        const imgs = target.querySelectorAll('img.lazy-load');\r\n        imgs.forEach(img => {\r\n          if (!img.parentElement?.classList.contains('loading-spinner-wrapper')) {\r\n            wrapImgWithSpinner(img);\r\n          }\r\n          const rect = img.getBoundingClientRect();\r\n          if (rect.top <= window.innerHeight && rect.bottom >= 0 && !(img as HTMLImageElement).src) {\r\n            loadImg(img);\r\n          }\r\n        });\r\n      }\r\n    };\r\n\r\n    if ('IntersectionObserver' in window) {\r\n      const ioObserver = new IntersectionObserver((entries, observer) => {\r\n        entries.forEach(entry => {\r\n          if (entry.isIntersecting) {\r\n            const img = entry.target as HTMLImageElement;\r\n            loadImg(img);\r\n            observer.unobserve(img);\r\n          }\r\n        });\r\n      });\r\n\r\n      if (target instanceof HTMLElement) {\r\n        const initialImgs = target.querySelectorAll('img');\r\n        initialImgs.forEach(img => {\r\n          if (!img.hasAttribute('loading')) {\r\n            img.setAttribute('loading', 'lazy');\r\n          }\r\n          if (!img.parentElement?.classList.contains('loading-spinner-wrapper')) {\r\n            wrapImgWithSpinner(img);\r\n          }\r\n          ioObserver.observe(img);\r\n        });\r\n      }\r\n\r\n      const mutationObserver = new MutationObserver(mutations => {\r\n        mutations.forEach(mutation => {\r\n          mutation.addedNodes.forEach(node => {\r\n            if (node instanceof HTMLElement) {\r\n              const imgs = node.querySelectorAll('img');\r\n              imgs.forEach(img => {\r\n                if (!img.hasAttribute('loading')) {\r\n                  img.setAttribute('loading', 'lazy');\r\n                }\r\n                if (!img.parentElement?.classList.contains('loading-spinner-wrapper')) {\r\n                  wrapImgWithSpinner(img);\r\n                }\r\n                ioObserver.observe(img);\r\n              });\r\n            }\r\n          });\r\n        });\r\n      });\r\n\r\n      mutationObserver.observe(target, { childList: true, subtree: true });\r\n    } else {\r\n      lazyLoadHandler();\r\n\r\n      const mutationObserver = new MutationObserver(mutations => {\r\n        mutations.forEach(mutation => {\r\n          mutation.addedNodes.forEach(node => {\r\n            if (node instanceof HTMLElement) {\r\n              const imgs = node.querySelectorAll('img');\r\n              imgs.forEach(img => {\r\n                if (!img.parentElement?.classList.contains('loading-spinner-wrapper')) {\r\n                  wrapImgWithSpinner(img);\r\n                }\r\n                loadImg(img);\r\n              });\r\n            }\r\n          });\r\n        });\r\n      });\r\n\r\n      mutationObserver.observe(target, { childList: true, subtree: true });\r\n\r\n      // Listen for scroll and resize events to load images\r\n      (window as Window).addEventListener('scroll', lazyLoadHandler);\r\n      (window as Window).addEventListener('resize', lazyLoadHandler);\r\n    }\r\n  }\r\n  \r\n}\r\n\r\nexport default Context\r\n","export interface ApiHandlerPayload {\r\n  need_captcha: { img_data?: string; iframe?: string }\r\n  need_login: {}\r\n  need_auth_login: {}\r\n}\r\n\r\ntype PayloadKey = keyof ApiHandlerPayload\r\n\r\nexport interface ApiHandler<T extends PayloadKey = PayloadKey> {\r\n  action: T\r\n  handler: (data: ApiHandlerPayload[T]) => Promise<void>\r\n}\r\n\r\nexport interface ApiHandlers {\r\n  add: <T extends PayloadKey>(\r\n    action: T,\r\n    handler: (data: ApiHandlerPayload[T]) => Promise<void>,\r\n  ) => void\r\n  get: () => ApiHandler[]\r\n}\r\n\r\nexport function createApiHandlers(): ApiHandlers {\r\n  const handlers: ApiHandler[] = []\r\n  return {\r\n    add: (action, handler) => {\r\n      handlers.push({ action, handler })\r\n    },\r\n    get: () => handlers,\r\n  }\r\n}\r\n","import $t from '@/i18n'\r\nimport * as Utils from '../lib/utils'\r\n\r\ntype BtnClickHandler = (btnEl: HTMLElement, dialog: Dialog) => boolean | void\r\n\r\n/**\r\n * 对话框\r\n */\r\nexport default class Dialog {\r\n  public $el: HTMLElement\r\n  public $content: HTMLElement\r\n  public $actions: HTMLElement\r\n\r\n  constructor(contentEl: HTMLElement) {\r\n    this.$el = Utils.createElement(\r\n      `<div class=\"atk-layer-dialog-wrap\">\r\n        <div class=\"atk-layer-dialog\">\r\n          <div class=\"atk-layer-dialog-content\"></div>\r\n          <div class=\"atk-layer-dialog-actions\"></div>\r\n        </div>\r\n      </div>`,\r\n    )\r\n\r\n    // 按钮\r\n    this.$actions = this.$el.querySelector<HTMLElement>('.atk-layer-dialog-actions')!\r\n\r\n    // 内容\r\n    this.$content = this.$el.querySelector('.atk-layer-dialog-content')!\r\n    this.$content.appendChild(contentEl)\r\n  }\r\n\r\n  /** 按钮 · 确定 */\r\n  public setYes(handler: BtnClickHandler) {\r\n    const btn = Utils.createElement<HTMLButtonElement>(\r\n      `<button data-action=\"confirm\">${$t('confirm')}</button>`,\r\n    )\r\n    btn.onclick = this.onBtnClick(handler)\r\n    this.$actions.appendChild(btn)\r\n\r\n    return this\r\n  }\r\n\r\n  /** 按钮 · 取消 */\r\n  public setNo(handler: BtnClickHandler) {\r\n    const btn = Utils.createElement<HTMLButtonElement>(\r\n      `<button data-action=\"cancel\">${$t('cancel')}</button>`,\r\n    )\r\n    btn.onclick = this.onBtnClick(handler)\r\n    this.$actions.appendChild(btn)\r\n\r\n    return this\r\n  }\r\n\r\n  private onBtnClick(handler: BtnClickHandler) {\r\n    return (evt: Event) => {\r\n      const re = handler(evt.currentTarget as HTMLElement, this)\r\n      if (re === undefined || re === true) {\r\n        this.$el.remove()\r\n      }\r\n    }\r\n  }\r\n}\r\n","import type { NotifyLevel } from '@/types'\r\nimport * as Utils from './utils'\r\n\r\n/** 显示加载 */\r\nexport function showLoading(parentElem: HTMLElement, conf?: { transparentBg?: boolean }) {\r\n  // Use :scope https://developer.mozilla.org/en-US/docs/Web/CSS/:scope\r\n  let $loading = parentElem.querySelector<HTMLElement>(':scope > .atk-loading')\r\n  if (!$loading) {\r\n    $loading = Utils.createElement(\r\n      `<div class=\"atk-loading\" style=\"display: none;\">\r\n      <div class=\"atk-loading-spinner\">\r\n        <svg viewBox=\"25 25 50 50\"><circle cx=\"50\" cy=\"50\" r=\"20\" fill=\"none\" stroke-width=\"2\" stroke-miterlimit=\"10\"></circle></svg>\r\n      </div>\r\n    </div>`,\r\n    )\r\n    if (conf?.transparentBg) $loading.style.background = 'transparent'\r\n    parentElem.appendChild($loading)\r\n  }\r\n  $loading.style.display = ''\r\n\r\n  // spinner 延迟显示，若加载等待时间太短，没必要显示（闪一下即可）\r\n  const $spinner = $loading.querySelector<HTMLElement>('.atk-loading-spinner')\r\n  if ($spinner) {\r\n    $spinner.style.display = 'none'\r\n    window.setTimeout(() => {\r\n      if ($spinner.isConnected) $spinner.style.display = ''\r\n    }, 500)\r\n  }\r\n}\r\n\r\n/** 隐藏加载 */\r\nexport function hideLoading(parentElem: HTMLElement) {\r\n  const $loading = parentElem.querySelector<HTMLElement>(':scope > .atk-loading')\r\n  if ($loading) $loading.style.display = 'none'\r\n}\r\n\r\n/** 元素加载动画 */\r\nexport function setLoading(val: boolean, parentElem: HTMLElement) {\r\n  if (val) showLoading(parentElem)\r\n  else hideLoading(parentElem)\r\n}\r\n\r\n/** 元素是否用户可见 */\r\nexport function isVisible(el: HTMLElement, viewport: HTMLElement = document.documentElement) {\r\n  const viewportHeight = viewport.clientHeight\r\n\r\n  const docViewTop = viewport.scrollTop\r\n  const docViewBottom = docViewTop + viewportHeight\r\n\r\n  const rect = el.getBoundingClientRect()\r\n  const elemTop = rect.top + docViewTop\r\n  const elemBottom = elemTop + rect.height\r\n\r\n  return elemBottom <= docViewBottom //&& (elemTop >= docViewTop) 注释因为假如 el 比 viewport 还高就会失效\r\n}\r\n\r\n/** 滚动到元素中心 */\r\nexport function scrollIntoView(\r\n  elem: HTMLElement,\r\n  enableAnim: boolean = true,\r\n  relativeTo?: HTMLElement,\r\n) {\r\n  let top: number\r\n\r\n  if (relativeTo) {\r\n    const containerRect = relativeTo.getBoundingClientRect()\r\n    const elementRect = elem.getBoundingClientRect()\r\n    top =\r\n      elementRect.top -\r\n      containerRect.top +\r\n      relativeTo.scrollTop -\r\n      relativeTo.clientHeight / 2 +\r\n      elem.clientHeight / 2\r\n  } else {\r\n    const rect = elem.getBoundingClientRect()\r\n    const elemTop = rect.top + window.scrollY\r\n    top = elemTop - (window.innerHeight / 2 - rect.height / 2)\r\n  }\r\n\r\n  const scrollOptions: ScrollToOptions = {\r\n    top,\r\n    left: 0,\r\n    // behavior: enableAnim ? 'smooth' : 'instant',\r\n    behavior: 'instant',\r\n  }\r\n\r\n  if (relativeTo) relativeTo.scroll(scrollOptions)\r\n  else window.scroll(scrollOptions)\r\n}\r\n\r\n/** 显示消息 */\r\nexport function showNotify(wrapElem: HTMLElement, msg: string, type: NotifyLevel) {\r\n  const colors = { s: '#57d59f', e: '#ff6f6c', w: '#ffc721', i: '#2ebcfc' }\r\n  const timeout = 3000 // 持续显示时间 ms\r\n\r\n  const notifyElem = Utils.createElement(\r\n    `<div class=\"atk-notify atk-fade-in\" style=\"background-color: ${colors[type]}\"><span class=\"atk-notify-content\"></span></div>`,\r\n  )\r\n  const notifyContentEl = notifyElem.querySelector<HTMLElement>('.atk-notify-content')!\r\n  notifyContentEl.innerHTML = Utils.htmlEncode(msg).replace('\\n', '<br/>')\r\n\r\n  wrapElem.appendChild(notifyElem)\r\n\r\n  const notifyRemove = () => {\r\n    notifyElem.classList.add('atk-fade-out')\r\n    setTimeout(() => {\r\n      notifyElem.remove()\r\n    }, 200)\r\n  }\r\n\r\n  let timeoutFn: number\r\n  if (timeout > 0) {\r\n    timeoutFn = window.setTimeout(() => {\r\n      notifyRemove()\r\n    }, timeout)\r\n  }\r\n\r\n  notifyElem.addEventListener('click', () => {\r\n    notifyRemove()\r\n    window.clearTimeout(timeoutFn)\r\n  })\r\n}\r\n\r\n/** fade 动画 */\r\nexport function playFadeAnim(elem: HTMLElement, after?: () => void, type: 'in' | 'out' = 'in') {\r\n  elem.classList.add(`atk-fade-${type}`)\r\n  // 动画结束清除 class\r\n  const onAnimEnded = () => {\r\n    elem.classList.remove(`atk-fade-${type}`)\r\n    elem.removeEventListener('animationend', onAnimEnded)\r\n    if (after) after()\r\n  }\r\n  elem.addEventListener('animationend', onAnimEnded)\r\n}\r\n\r\n/** 渐入动画 */\r\nexport function playFadeInAnim(elem: HTMLElement, after?: () => void) {\r\n  playFadeAnim(elem, after, 'in')\r\n}\r\n\r\n/** 渐出动画 */\r\nexport function playFadeOutAnim(elem: HTMLElement, after?: () => void) {\r\n  playFadeAnim(elem, after, 'out')\r\n}\r\n\r\n/** 设置全局错误 */\r\nexport function setError(\r\n  parentElem: HTMLElement,\r\n  html: string | HTMLElement | null,\r\n  title: string = '<span class=\"atk-error-title\">Artalk Error</span>',\r\n) {\r\n  let elem = parentElem.querySelector<HTMLElement>('.atk-error-layer')\r\n  if (html === null) {\r\n    if (elem !== null) elem.remove()\r\n    return\r\n  }\r\n  if (!elem) {\r\n    elem = Utils.createElement(\r\n      `<div class=\"atk-error-layer\">${title}<span class=\"atk-error-text\"></span></div>`,\r\n    )\r\n    parentElem.appendChild(elem)\r\n  }\r\n\r\n  const errorTextEl = elem.querySelector<HTMLElement>('.atk-error-text')!\r\n  errorTextEl.innerHTML = ''\r\n  if (html === null) return\r\n\r\n  if (html instanceof HTMLElement) {\r\n    errorTextEl.appendChild(html)\r\n  } else {\r\n    errorTextEl.innerText = html\r\n  }\r\n}\r\n\r\nexport function getScrollBarWidth() {\r\n  const inner = document.createElement('p')\r\n  inner.style.width = '100%'\r\n  inner.style.height = '200px'\r\n\r\n  const outer = document.createElement('div')\r\n  outer.style.position = 'absolute'\r\n  outer.style.top = '0px'\r\n  outer.style.left = '0px'\r\n  outer.style.visibility = 'hidden'\r\n  outer.style.width = '200px'\r\n  outer.style.height = '150px'\r\n  outer.style.overflow = 'hidden'\r\n  outer.appendChild(inner)\r\n\r\n  document.body.appendChild(outer)\r\n  const w1 = inner.offsetWidth\r\n  outer.style.overflow = 'scroll'\r\n  let w2 = inner.offsetWidth\r\n  if (w1 === w2) w2 = outer.clientWidth\r\n\r\n  document.body.removeChild(outer)\r\n\r\n  return w1 - w2\r\n}\r\n","import $t from '@/i18n'\r\nimport * as Utils from '@/lib/utils'\r\nimport * as Ui from '@/lib/ui'\r\nimport type { CheckerCtx } from '.'\r\n\r\n/** 图片验证码 */\r\nexport function imgBody(checker: CheckerCtx) {\r\n  // 图片验证方式\r\n  const elem = Utils.createElement(\r\n    `<span><img class=\"atk-captcha-img\" src=\"${checker.get('img_data') || ''}\">${$t('captchaCheck')}</span>`,\r\n  )\r\n\r\n  // 刷新验证码\r\n  elem.querySelector<HTMLElement>('.atk-captcha-img')!.onclick = () => {\r\n    const imgEl = elem.querySelector('.atk-captcha-img')\r\n    checker\r\n      .getApi()\r\n      .captcha.getCaptcha()\r\n      .then((res) => {\r\n        imgEl!.setAttribute('src', res.data.img_data)\r\n      })\r\n      .catch((err) => {\r\n        console.error('Failed to get captcha image ', err)\r\n      })\r\n  }\r\n  return elem\r\n}\r\n\r\n/** iframe 形式的通用验证服务 */\r\nexport function iframeBody(checker: CheckerCtx) {\r\n  const $iframeWrap = Utils.createElement(`<div class=\"atk-checker-iframe-wrap\"></div>`)\r\n  const $iframe = Utils.createElement<HTMLIFrameElement>(\r\n    `<iframe class=\"atk-fade-in\" referrerpolicy=\"strict-origin-when-cross-origin\"></iframe>`,\r\n  )\r\n  $iframe.style.display = 'none'\r\n  Ui.showLoading($iframeWrap, { transparentBg: true })\r\n  $iframe.src = checker.getOpts().getCaptchaIframeURL()\r\n  $iframe.onload = () => {\r\n    $iframe.style.display = ''\r\n    Ui.hideLoading($iframeWrap)\r\n  }\r\n  $iframeWrap.append($iframe)\r\n\r\n  const $closeBtn = Utils.createElement(\r\n    `<div class=\"atk-close-btn\"><i class=\"atk-icon atk-icon-close\"></i></div>`,\r\n  )\r\n  $iframeWrap.append($closeBtn)\r\n\r\n  checker.hideInteractInput()\r\n\r\n  // 轮询状态\r\n  let stop = false // 打断\r\n  const sleep = (ms: number) =>\r\n    new Promise((resolve) => {\r\n      window.setTimeout(() => {\r\n        resolve(null)\r\n      }, ms)\r\n    })\r\n  ;(async function queryStatus() {\r\n    await sleep(1000)\r\n    if (stop) return\r\n    let isPass = false\r\n    try {\r\n      const resp = await checker.getApi().captcha.getCaptchaStatus()\r\n      isPass = resp.data.is_pass\r\n    } catch {\r\n      isPass = false\r\n    }\r\n    if (isPass) {\r\n      checker.triggerSuccess()\r\n    } else {\r\n      queryStatus()\r\n    }\r\n  })()\r\n\r\n  $closeBtn.onclick = () => {\r\n    stop = true\r\n    checker.cancel()\r\n  }\r\n\r\n  return $iframeWrap\r\n}\r\n","import type { Checker } from '.'\r\nimport * as render from './captcha-renders'\r\n\r\nconst CaptchaChecker: Checker<{}> = {\r\n  request(checker, inputVal) {\r\n    return checker.getApi().captcha.verifyCaptcha({\r\n      value: inputVal,\r\n    })\r\n  },\r\n\r\n  body(checker) {\r\n    if (checker.get('iframe')) return render.iframeBody(checker)\r\n    return render.imgBody(checker)\r\n  },\r\n\r\n  onSuccess(checker, data, inputVal, formEl) {\r\n    checker.set('val', inputVal)\r\n  },\r\n\r\n  onError(checker, err, inputVal, formEl) {\r\n    formEl.querySelector<HTMLElement>('.atk-captcha-img')!.click() // 刷新验证码\r\n    formEl.querySelector<HTMLInputElement>('input[type=\"text\"]')!.value = '' // 清空输入框输入\r\n  },\r\n}\r\n\r\nexport default CaptchaChecker\r\n","import $t from '@/i18n'\r\nimport * as Utils from '@/lib/utils'\r\nimport type { Checker } from '.'\r\n\r\nconst AdminChecker: Checker<{ token: string }> = {\r\n  inputType: 'password',\r\n\r\n  async request(checker, inputVal) {\r\n    return (\r\n      await checker.getApi().user.login({\r\n        name: checker.getUser().getData().nick,\r\n        email: checker.getUser().getData().email,\r\n        password: inputVal,\r\n      })\r\n    ).data\r\n  },\r\n\r\n  body(checker) {\r\n    return Utils.createElement(`<span>${$t('adminCheck')}</span>`)\r\n  },\r\n\r\n  onSuccess(checker, res, inputVal, formEl) {\r\n    checker.getUser().update({\r\n      isAdmin: true,\r\n      token: res.token,\r\n    })\r\n    checker.getOpts().onReload()\r\n  },\r\n\r\n  onError(checker, err, inputVal, formEl) {},\r\n}\r\n\r\nexport default AdminChecker\r\n","import type { Api } from '@/api'\r\nimport Dialog from '@/components/dialog'\r\nimport $t from '@/i18n'\r\nimport type { ContextApi } from '@/types'\r\nimport type User from '@/lib/user'\r\nimport * as Utils from '@/lib/utils'\r\nimport CaptchaChecker from './captcha'\r\nimport AdminChecker from './admin'\r\n\r\nexport interface CheckerCaptchaPayload extends CheckerPayload {\r\n  img_data?: string\r\n  iframe?: string\r\n}\r\n\r\nexport interface CheckerPayload {\r\n  onSuccess?: () => void\r\n  onMount?: (dialogEl: HTMLElement) => void\r\n  onCancel?: () => void\r\n}\r\n\r\nexport interface CheckerLauncherOptions {\r\n  getCtx: () => ContextApi\r\n  getApi: () => Api\r\n  getCaptchaIframeURL: () => string\r\n  onReload: () => void\r\n}\r\n\r\nfunction wrapPromise<P extends CheckerPayload = CheckerPayload>(fn: (p: P) => void) {\r\n  return (payload: P) =>\r\n    new Promise<void>((resolve, reject) => {\r\n      const cancelFn = payload.onCancel\r\n      payload.onCancel = () => {\r\n        cancelFn && cancelFn()\r\n        reject(new Error('user canceled the checker'))\r\n      }\r\n      const successFn = payload.onSuccess\r\n      payload.onSuccess = () => {\r\n        successFn && successFn()\r\n        resolve()\r\n      }\r\n      fn(payload)\r\n    })\r\n}\r\n\r\n/**\r\n * Checker 发射台\r\n */\r\nexport default class CheckerLauncher {\r\n  constructor(private opts: CheckerLauncherOptions) {}\r\n\r\n  public checkCaptcha: (payload: CheckerCaptchaPayload) => Promise<void> = wrapPromise((p) => {\r\n    this.fire(CaptchaChecker, p, (ctx) => {\r\n      ctx.set('img_data', p.img_data)\r\n      ctx.set('iframe', p.iframe)\r\n    })\r\n  })\r\n\r\n  public checkAdmin: (payload: CheckerPayload) => Promise<void> = wrapPromise((p) => {\r\n    this.fire(AdminChecker, p)\r\n  })\r\n\r\n  public fire(checker: Checker, payload: CheckerPayload, postFire?: (c: CheckerCtx) => void) {\r\n    // 显示层\r\n    const layer = this.opts.getCtx().get('layerManager').create(`checker-${new Date().getTime()}`)\r\n    layer.show()\r\n\r\n    const close = () => {\r\n      layer.destroy()\r\n    }\r\n\r\n    // 构建 Checker 的上下文\r\n    const checkerStore: CheckerStore = {}\r\n    let hideInteractInput = false\r\n    const checkerCtx: CheckerCtx = {\r\n      set: (key, val) => {\r\n        checkerStore[key] = val\r\n      },\r\n      get: (key) => checkerStore[key],\r\n      getOpts: () => this.opts,\r\n      getUser: () => this.opts.getCtx().get('user'),\r\n      getApi: () => this.opts.getApi(),\r\n      hideInteractInput: () => {\r\n        hideInteractInput = true\r\n      },\r\n      triggerSuccess: () => {\r\n        close()\r\n        if (checker.onSuccess) checker.onSuccess(checkerCtx, '', '', formEl)\r\n        if (payload.onSuccess) payload.onSuccess()\r\n      },\r\n      cancel: () => {\r\n        close()\r\n        if (payload.onCancel) payload.onCancel()\r\n      },\r\n    }\r\n\r\n    if (postFire) postFire(checkerCtx)\r\n\r\n    // 创建表单\r\n    const formEl = Utils.createElement()\r\n    formEl.appendChild(checker.body(checkerCtx))\r\n\r\n    // 输入框\r\n    const $input = Utils.createElement<HTMLInputElement>(\r\n      `<input id=\"check\" type=\"${checker.inputType || 'text'}\" autocomplete=\"off\" required placeholder=\"\">`,\r\n    )\r\n    formEl.appendChild($input)\r\n    setTimeout(() => $input.focus(), 80) // 延迟 Focus\r\n\r\n    // 绑定键盘事件\r\n    $input.onkeyup = (evt) => {\r\n      if (evt.key === 'Enter' || evt.keyCode === 13) {\r\n        // 按下回车键\r\n        evt.preventDefault()\r\n        layer.getEl().querySelector<HTMLButtonElement>('button[data-action=\"confirm\"]')!.click()\r\n      }\r\n    }\r\n\r\n    let btnTextOrg: string | undefined\r\n    const dialog = new Dialog(formEl)\r\n\r\n    // 确认按钮\r\n    dialog.setYes((btnEl) => {\r\n      const inputVal = $input.value.trim()\r\n\r\n      // 按钮操作\r\n      if (!btnTextOrg) btnTextOrg = btnEl.innerText\r\n      const btnTextSet = (btnText: string) => {\r\n        btnEl.innerText = btnText\r\n        btnEl.classList.add('error')\r\n      }\r\n      const btnTextRestore = () => {\r\n        btnEl.innerText = btnTextOrg || ''\r\n        btnEl.classList.remove('error')\r\n      }\r\n\r\n      btnEl.innerText = `${$t('loading')}...`\r\n\r\n      // 发送请求\r\n      checker\r\n        .request(checkerCtx, inputVal)\r\n        .then((data) => {\r\n          // 请求成功\r\n          close()\r\n\r\n          if (checker.onSuccess) checker.onSuccess(checkerCtx, data, inputVal, formEl)\r\n          if (payload.onSuccess) payload.onSuccess()\r\n        })\r\n        .catch((err) => {\r\n          // 请求失败\r\n          btnTextSet(String(err.message || String(err)))\r\n\r\n          if (checker.onError) checker.onError(checkerCtx, err, inputVal, formEl)\r\n\r\n          // 错误显示 3s 后恢复按钮\r\n          const tf = setTimeout(() => btnTextRestore(), 3000)\r\n          $input.onfocus = () => {\r\n            btnTextRestore()\r\n            clearTimeout(tf)\r\n          }\r\n        })\r\n\r\n      return false\r\n    })\r\n\r\n    // 取消按钮\r\n    dialog.setNo(() => {\r\n      close()\r\n      if (payload.onCancel) payload.onCancel()\r\n      return false\r\n    })\r\n\r\n    if (hideInteractInput) {\r\n      $input.style.display = 'none'\r\n      dialog.$el.querySelector<HTMLElement>('.atk-layer-dialog-actions')!.style.display = 'none'\r\n    }\r\n\r\n    // 层装载 dialog 元素\r\n    layer.getEl().append(dialog.$el)\r\n\r\n    // onMount 回调\r\n    if (payload.onMount) payload.onMount(dialog.$el)\r\n  }\r\n}\r\n\r\nexport interface Checker<T = any> {\r\n  el?: HTMLElement\r\n  inputType?: 'password' | 'text'\r\n  body: (checker: CheckerCtx) => HTMLElement\r\n  request: (checker: CheckerCtx, inputVal: string) => Promise<T>\r\n  onSuccess?: (checker: CheckerCtx, respData: T, inputVal: string, formEl: HTMLElement) => void\r\n  onError?: (checker: CheckerCtx, errData: any, inputVal: string, formEl: HTMLElement) => void\r\n}\r\n\r\ninterface CheckerStore {\r\n  val?: string\r\n  img_data?: string\r\n  iframe?: string\r\n}\r\n\r\nexport interface CheckerCtx {\r\n  get<K extends keyof CheckerStore>(key: K): CheckerStore[K]\r\n  set<K extends keyof CheckerStore>(key: K, val: CheckerStore[K]): void\r\n  getOpts(): CheckerLauncherOptions\r\n  getApi(): Api\r\n  getUser(): User\r\n  hideInteractInput(): void\r\n  triggerSuccess(): void\r\n  cancel(): void\r\n}\r\n","import type { ContextApi } from '@/types'\r\n\r\nexport default abstract class Component {\r\n  public $el!: HTMLElement\r\n  public get conf() {\r\n    return this.ctx.conf\r\n  }\r\n\r\n  public constructor(public ctx: ContextApi) {}\r\n\r\n  getEl() {\r\n    return this.$el\r\n  }\r\n}\r\n","export default \"<div class=\\\"atk-main-editor\\\">\\r\\n  <div class=\\\"atk-header\\\">\\r\\n    <input name=\\\"nick\\\" class=\\\"atk-nick\\\" type=\\\"text\\\" required=\\\"required\\\" />\\r\\n    <input name=\\\"email\\\" class=\\\"atk-email\\\" type=\\\"email\\\" required=\\\"required\\\" autocomplete=\\\"off\\\" />\\r\\n    <input name=\\\"link\\\" class=\\\"atk-link\\\" type=\\\"url\\\" />\\r\\n  </div>\\r\\n  <div class=\\\"atk-textarea-wrap\\\">\\r\\n    <textarea class=\\\"atk-textarea\\\"></textarea>\\r\\n    <button type=\\\"button\\\" class=\\\"atk-send-btn\\\"></button>\\r\\n  </div>\\r\\n  <div class=\\\"atk-plug-panel-wrap\\\" style=\\\"display: none\\\"></div>\\r\\n  <div class=\\\"atk-bottom\\\">\\r\\n    <div class=\\\"atk-item atk-plug-btn-wrap\\\"></div>\\r\\n  </div>\\r\\n  <div class=\\\"atk-notify-wrap\\\"></div>\\r\\n</div>\\r\\n\"","import * as Utils from '../lib/utils'\r\nimport EditorHTML from './editor.html?raw'\r\n\r\nconst Sel = {\r\n  $header: '.atk-header',\r\n  $nick: '.atk-header [name=\"nick\"]',\r\n  $email: '.atk-header [name=\"email\"]',\r\n  $link: '.atk-header [name=\"link\"]',\r\n  $textareaWrap: '.atk-textarea-wrap',\r\n  $textarea: '.atk-textarea',\r\n  $bottom: '.atk-bottom',\r\n  $submitBtn: '.atk-send-btn',\r\n  $notifyWrap: '.atk-notify-wrap',\r\n  // $bottomLeft: '.atk-bottom-left',\r\n  // $stateWrap: '.atk-state-wrap',\r\n  $plugBtnWrap: '.atk-plug-btn-wrap',\r\n  $plugPanelWrap: '.atk-plug-panel-wrap',\r\n}\r\n\r\nexport interface EditorUI extends Record<keyof typeof Sel, HTMLElement> {\r\n  $el: HTMLElement\r\n  $nick: HTMLInputElement\r\n  $email: HTMLInputElement\r\n  $link: HTMLInputElement\r\n  $textarea: HTMLTextAreaElement\r\n  $submitBtn: HTMLButtonElement\r\n  $sendReply?: HTMLElement\r\n  // $sendReplyBtn?: HTMLElement\r\n  $editCancelBtn?: HTMLElement\r\n}\r\n\r\nexport function render() {\r\n  const $el = Utils.createElement(EditorHTML)\r\n  const ui = { $el }\r\n  Object.entries(Sel).forEach(([k, sel]) => {\r\n    ui[k] = $el.querySelector(sel)\r\n  })\r\n  return ui as EditorUI\r\n}\r\n","import type { CommentData, EditorState } from '@/types'\r\nimport * as Utils from '@/lib/utils'\r\nimport type PlugKit from './_kit'\r\n\r\n/**\r\n * Editor 插件\r\n */\r\ninterface EditorPlug {\r\n  $btn?: HTMLElement\r\n  $panel?: HTMLElement\r\n  contentTransformer?(rawContent: string): string\r\n  editorStateEffectWhen?: EditorState\r\n  editorStateEffect?(comment: CommentData): () => void\r\n}\r\n\r\nclass EditorPlug {\r\n  constructor(protected kit: PlugKit) {}\r\n\r\n  /** Use plug btn will add a btn on the bottom of editor */\r\n  useBtn(html: string = '<div></div>') {\r\n    const htmlDecoded = Utils.htmlDecode(html);\r\n    this.$btn = Utils.createElement(`<span class=\"atk-plug-btn\">${htmlDecoded}</span>`)\r\n    return this.$btn\r\n  }\r\n\r\n  /** Use plug panel will show the panel when btn is clicked */\r\n  usePanel(html: string = '<div></div>') {\r\n    this.$panel = Utils.createElement(html)\r\n    return this.$panel\r\n  }\r\n\r\n  /** Use the content transformer to handle the content of the last submit by the editor */\r\n  useContentTransformer(func: (raw: string) => string) {\r\n    this.contentTransformer = func\r\n  }\r\n\r\n  /** Listen the event of panel show */\r\n  usePanelShow(func: () => void) {\r\n    this.kit.useEvents().on('panel-show', (aPlug) => {\r\n      if (aPlug === this) func()\r\n    })\r\n  }\r\n\r\n  /** Listen the event of panel hide */\r\n  usePanelHide(func: () => void) {\r\n    this.kit.useEvents().on('panel-hide', (aPlug) => {\r\n      if (aPlug === this) func()\r\n    })\r\n  }\r\n\r\n  /** Use editor state modifier */\r\n  useEditorStateEffect(stateName: EditorState, effectFn: (comment: CommentData) => () => void) {\r\n    this.editorStateEffectWhen = stateName\r\n    this.editorStateEffect = effectFn\r\n  }\r\n}\r\n\r\nexport default EditorPlug\r\n","import * as Utils from '@/lib/utils'\r\nimport EditorPlug from './_plug'\r\n\r\nexport default class Mover extends EditorPlug {\r\n  private isMoved = false\r\n\r\n  move(afterEl: HTMLElement) {\r\n    if (this.isMoved) return\r\n    this.isMoved = true\r\n\r\n    const editorEl = this.kit.useUI().$el\r\n\r\n    editorEl.after(Utils.createElement('<div class=\"atk-editor-travel-placeholder\"></div>'))\r\n\r\n    const $travelPlace = Utils.createElement('<div></div>')\r\n    afterEl.after($travelPlace)\r\n    $travelPlace.replaceWith(editorEl)\r\n\r\n    editorEl.classList.add('atk-fade-in') // 添加渐入动画\r\n    editorEl.classList.add('editor-traveling')\r\n  }\r\n\r\n  back() {\r\n    if (!this.isMoved) return\r\n    this.isMoved = false\r\n    this.kit\r\n      .useGlobalCtx()\r\n      .$root.querySelector('.atk-editor-travel-placeholder')\r\n      ?.replaceWith(this.kit.useUI().$el)\r\n    this.kit.useUI().$el.classList.remove('editor-traveling')\r\n  }\r\n}\r\n","import type { EditorState, CommentData } from '@/types'\r\nimport * as Ui from '@/lib/ui'\r\nimport type Editor from './editor'\r\nimport Mover from '../plugins/editor/mover'\r\n\r\nexport default class EditorStateManager {\r\n  constructor(private editor: Editor) {}\r\n\r\n  private stateCurt: EditorState = 'normal'\r\n  private stateUnmountFn: (() => void) | null = null\r\n\r\n  /** Get current state */\r\n  get() {\r\n    return this.stateCurt\r\n  }\r\n\r\n  /**\r\n   * Switch editor state\r\n   *\r\n   * @param state The state to switch\r\n   * @param payload The cause of state switch\r\n   */\r\n  switch(state: EditorState, payload?: { $comment: HTMLElement; comment: CommentData }) {\r\n    // trigger unmount\r\n    if (this.stateUnmountFn) {\r\n      this.stateUnmountFn()\r\n      this.stateUnmountFn = null\r\n\r\n      // move editor back to the initial position\r\n      this.editor.getPlugs()?.get(Mover)?.back()\r\n    }\r\n\r\n    // invoke effect function and save unmount function\r\n    if (state !== 'normal' && payload) {\r\n      // move editor position\r\n      let moveAfterEl = payload.$comment\r\n      if (!this.editor.conf.flatMode)\r\n        moveAfterEl = moveAfterEl.querySelector<HTMLElement>('.atk-footer')!\r\n      this.editor.getPlugs()?.get(Mover)?.move(moveAfterEl)\r\n\r\n      const $relative =\r\n        this.editor.ctx.conf.scrollRelativeTo && this.editor.ctx.conf.scrollRelativeTo()\r\n      Ui.scrollIntoView(this.editor.getUI().$el, true, $relative)\r\n\r\n      const plugin = this.editor\r\n        .getPlugs()\r\n        ?.getPlugs()\r\n        .find((p) => p.editorStateEffectWhen === state)\r\n      if (plugin && plugin.editorStateEffect) {\r\n        this.stateUnmountFn = plugin.editorStateEffect(payload.comment)\r\n      }\r\n    }\r\n\r\n    // change current state\r\n    this.stateCurt = state\r\n  }\r\n}\r\n","import type { CommentData, ContextApi, EditorApi } from '@/types'\r\nimport Component from '../lib/component'\r\nimport * as Ui from '../lib/ui'\r\nimport marked from '../lib/marked'\r\nimport { render, EditorUI } from './ui'\r\nimport EditorStateManager from './state'\r\n\r\nclass Editor extends Component implements EditorApi {\r\n  private ui: EditorUI\r\n  private state: EditorStateManager\r\n\r\n  getUI() {\r\n    return this.ui\r\n  }\r\n  getPlugs() {\r\n    return this.ctx.get('editorPlugs')\r\n  }\r\n  getState() {\r\n    return this.state.get()\r\n  }\r\n\r\n  constructor(ctx: ContextApi) {\r\n    super(ctx)\r\n\r\n    // init editor ui\r\n    this.ui = render()\r\n    this.$el = this.ui.$el\r\n\r\n    // init state manager\r\n    this.state = new EditorStateManager(this)\r\n  }\r\n\r\n  getHeaderInputEls() {\r\n    return { nick: this.ui.$nick, email: this.ui.$email, link: this.ui.$link }\r\n  }\r\n\r\n  getContentFinal() {\r\n    let content = this.getContentRaw()\r\n\r\n    // plug hook: final content transformer\r\n    const plugs = this.getPlugs()\r\n    if (plugs) content = plugs.getTransformedContent(content)\r\n\r\n    return content\r\n  }\r\n\r\n  getContentRaw() {\r\n    return this.ui.$textarea.value || ''\r\n  }\r\n\r\n  getContentMarked() {\r\n    return marked(this.getContentFinal())\r\n  }\r\n\r\n  setContent(val: string) {\r\n    this.ui.$textarea.value = val\r\n\r\n    // plug hook: content updated\r\n    this.getPlugs()?.getEvents().trigger('content-updated', val)\r\n  }\r\n\r\n  insertContent(val: string) {\r\n    const owoBig = document.querySelector('#owo-big') as HTMLElement;\r\n    if(owoBig && owoBig.style) {\r\n      owoBig.style.display = 'none'\r\n    }\r\n    if ((document as any).selection) {\r\n      this.ui.$textarea.focus()\r\n      ;(document as any).selection.createRange().text = val\r\n      this.ui.$textarea.focus()\r\n    } else if (this.ui.$textarea.selectionStart || this.ui.$textarea.selectionStart === 0) {\r\n      const sStart = this.ui.$textarea.selectionStart\r\n      const sEnd = this.ui.$textarea.selectionEnd\r\n      const sT = this.ui.$textarea.scrollTop\r\n      this.setContent(\r\n        this.ui.$textarea.value.substring(0, sStart) +\r\n          val +\r\n          this.ui.$textarea.value.substring(sEnd, this.ui.$textarea.value.length),\r\n      )\r\n      this.ui.$textarea.focus()\r\n      this.ui.$textarea.selectionStart = sStart + val.length\r\n      this.ui.$textarea.selectionEnd = sStart + val.length\r\n      this.ui.$textarea.scrollTop = sT\r\n    } else {\r\n      this.ui.$textarea.focus()\r\n      this.ui.$textarea.value += val\r\n    }\r\n  }\r\n\r\n  focus() {\r\n    this.ui.$textarea.focus()\r\n  }\r\n\r\n  reset() {\r\n    this.setContent('')\r\n    this.resetState()\r\n  }\r\n\r\n  resetState() {\r\n    this.state.switch('normal')\r\n  }\r\n\r\n  setReply(comment: CommentData, $comment: HTMLElement) {\r\n    this.state.switch('reply', { comment, $comment })\r\n  }\r\n\r\n  setEditComment(comment: CommentData, $comment: HTMLElement) {\r\n    this.state.switch('edit', { comment, $comment })\r\n  }\r\n\r\n  showNotify(msg: string, type: any) {\r\n    Ui.showNotify(this.ui.$notifyWrap, msg, type)\r\n  }\r\n\r\n  showLoading() {\r\n    Ui.showLoading(this.ui.$el)\r\n  }\r\n\r\n  hideLoading() {\r\n    Ui.hideLoading(this.ui.$el)\r\n  }\r\n\r\n  submit() {\r\n    const next = () => this.ctx.trigger('editor-submit')\r\n    if (this.ctx.conf.beforeSubmit) {\r\n      this.ctx.conf.beforeSubmit(this, next)\r\n    } else {\r\n      next()\r\n    }\r\n  }\r\n}\r\n\r\nexport default Editor\r\n","import type { ContextApi, SidebarShowPayload } from '@/types'\r\nimport Component from '@/lib/component'\r\nimport * as Utils from '@/lib/utils'\r\nimport * as Ui from '@/lib/ui'\r\nimport SidebarHTML from './sidebar-layer.html?raw'\r\nimport type { Layer } from './layer'\r\n\r\nexport default class SidebarLayer extends Component {\r\n  public layer?: Layer\r\n  public $header: HTMLElement\r\n  public $closeBtn: HTMLElement\r\n  public $iframeWrap: HTMLElement\r\n  public $iframe?: HTMLIFrameElement\r\n\r\n  constructor(ctx: ContextApi) {\r\n    super(ctx)\r\n\r\n    this.$el = Utils.createElement(SidebarHTML)\r\n    this.$header = this.$el.querySelector('.atk-sidebar-header')!\r\n    this.$closeBtn = this.$header.querySelector('.atk-sidebar-close')!\r\n    this.$iframeWrap = this.$el.querySelector('.atk-sidebar-iframe-wrap')!\r\n\r\n    this.$closeBtn.onclick = () => {\r\n      this.hide()\r\n    }\r\n\r\n    // event\r\n    this.ctx.on('user-changed', () => {\r\n      this.refreshOnShow = true\r\n    })\r\n  }\r\n\r\n  /** Refresh iFrame on show */\r\n  private refreshOnShow = true\r\n\r\n  /** Animation timer */\r\n  private animTimer?: any = undefined\r\n\r\n  /** 显示 */\r\n  public async show(conf: SidebarShowPayload = {}) {\r\n    this.$el.style.transform = '' // 动画清除，防止二次打开失效\r\n\r\n    // init layer\r\n    this.initLayer()\r\n    this.layer!.show()\r\n\r\n    // init iframe\r\n    if (this.refreshOnShow) {\r\n      this.refreshOnShow = false\r\n      this.$iframeWrap.innerHTML = ''\r\n      this.$iframe = this.createIframe(conf.view)\r\n      this.$iframeWrap.append(this.$iframe)\r\n    } else {\r\n      // Sync Dark Mode (reload iframe if not match)\r\n      const $iframe = this.$iframe!\r\n      const iFrameSrc = $iframe.src\r\n      if (this.conf.darkMode !== iFrameSrc.includes('darkMode=1')) {\r\n        this.iframeLoad(\r\n          $iframe,\r\n          this.conf.darkMode\r\n            ? iFrameSrc.concat('&darkMode=1')\r\n            : iFrameSrc.replace('&darkMode=1', ''),\r\n        )\r\n      }\r\n    }\r\n\r\n    // 管理员身份验证 (若身份失效，弹出验证窗口)\r\n    this.authCheck({\r\n      onSuccess: () => this.show(conf), // retry show after auth check\r\n    })\r\n\r\n    // 执行滑动显示动画\r\n    this.animTimer = setTimeout(() => {\r\n      this.animTimer = undefined\r\n      this.$el.style.transform = 'translate(0, 0)'\r\n\r\n      setTimeout(() => {\r\n        this.ctx.getData().updateNotifies([])\r\n      }, 0)\r\n\r\n      this.ctx.trigger('sidebar-show')\r\n    }, 100)\r\n  }\r\n\r\n  /** 隐藏 */\r\n  public hide() {\r\n    this.layer?.hide()\r\n  }\r\n\r\n  // --------------------------------------------------\r\n\r\n  private async authCheck(opts: { onSuccess: () => void }) {\r\n    const data = (\r\n      await this.ctx.getApi().user.getUserStatus({\r\n        ...this.ctx.getApi().getUserFields(),\r\n      })\r\n    ).data\r\n    if (data.is_admin && !data.is_login) {\r\n      this.refreshOnShow = true\r\n\r\n      // show checker layer\r\n      this.ctx.checkAdmin({\r\n        onSuccess: () => {\r\n          setTimeout(() => {\r\n            opts.onSuccess()\r\n          }, 500)\r\n        },\r\n        onCancel: () => {\r\n          this.hide()\r\n        },\r\n      })\r\n\r\n      // hide sidebar layer\r\n      this.hide()\r\n    }\r\n  }\r\n\r\n  private initLayer() {\r\n    if (this.layer) return\r\n\r\n    this.layer = this.ctx.get('layerManager').create('sidebar', this.$el)\r\n    this.layer.setOnAfterHide(() => {\r\n      // 防止评论框被吞\r\n      this.ctx.editorResetState()\r\n\r\n      // interrupt animation\r\n      this.animTimer && clearTimeout(this.animTimer)\r\n\r\n      // perform transform\r\n      this.$el.style.transform = ''\r\n\r\n      // trigger event\r\n      this.ctx.trigger('sidebar-hide')\r\n    })\r\n  }\r\n\r\n  private createIframe(view?: string) {\r\n    const $iframe = Utils.createElement<HTMLIFrameElement>(\r\n      '<iframe referrerpolicy=\"strict-origin-when-cross-origin\"></iframe>',\r\n    )\r\n\r\n    // 准备 Iframe 参数\r\n    const baseURL = (import.meta.env.DEV)  ? 'http://10.0.10.2:23366/'\r\n      : Utils.getURLBasedOnApi({\r\n          base: this.ctx.conf.server,\r\n          path: '/sidebar/',\r\n        })\r\n\r\n    const query: any = {\r\n      pageKey: this.conf.pageKey,\r\n      site: this.conf.site || '',\r\n      user: JSON.stringify(this.ctx.get('user').getData()),\r\n      time: +new Date(),\r\n    }\r\n\r\n    if (view) query.view = view\r\n    if (this.conf.darkMode) query.darkMode = '1'\r\n\r\n    const urlParams = new URLSearchParams(query)\r\n    this.iframeLoad($iframe, `${baseURL}?${urlParams.toString()}`)\r\n\r\n    return $iframe\r\n  }\r\n\r\n  private iframeLoad($iframe: HTMLIFrameElement, src: string) {\r\n    $iframe.src = src\r\n\r\n    // 加载动画\r\n    Ui.showLoading(this.$iframeWrap)\r\n    $iframe.onload = () => {\r\n      Ui.hideLoading(this.$iframeWrap)\r\n    }\r\n  }\r\n}\r\n","export default \"<div class=\\\"atk-sidebar-layer\\\">\\r\\n  <div class=\\\"atk-sidebar-inner\\\">\\r\\n    <div class=\\\"atk-sidebar-header\\\">\\r\\n      <div class=\\\"atk-sidebar-close\\\">\\r\\n        <i class=\\\"atk-icon atk-icon-close-slim\\\"></i>\\r\\n      </div>\\r\\n    </div>\\r\\n    <div class=\\\"atk-sidebar-iframe-wrap\\\"></div>\\r\\n  </div>\\r\\n</div>\\r\\n\"","import type { CommentNode } from '@/comment'\r\nimport * as Ui from '@/lib/ui'\r\nimport * as ListNest from '@/list/nest'\r\nimport type { LayoutStrategyCreator } from '.'\r\n\r\nexport const createNestStrategy: LayoutStrategyCreator = (opts) => ({\r\n  import: (comments) => {\r\n    // 遍历 root 评论\r\n    const rootNodes = ListNest.makeNestCommentNodeList(comments, opts.nestSortBy, opts.nestMax)\r\n    rootNodes.forEach((rootNode: ListNest.CommentNode) => {\r\n      const rootC = opts.createCommentNode(rootNode.comment)\r\n\r\n      // 显示并播放渐入动画\r\n      opts.$commentsWrap?.appendChild(rootC.getEl())\r\n      rootC.getRender().playFadeAnim()\r\n\r\n      // 加载子评论\r\n      const loadChildren = (parentC: CommentNode, parentNode: ListNest.CommentNode) => {\r\n        parentNode.children.forEach((node: ListNest.CommentNode) => {\r\n          const replyD = comments.find((c) => c.id === node.comment.rid)\r\n          const childD = node.comment\r\n          const childC = opts.createCommentNode(childD, replyD)\r\n\r\n          // 插入到父评论中\r\n          parentC.putChild(childC)\r\n\r\n          // 递归加载子评论\r\n          loadChildren(childC, node)\r\n        })\r\n      }\r\n      loadChildren(rootC, rootNode)\r\n\r\n      // 限高检测\r\n      rootC.getRender().checkHeightLimit()\r\n    })\r\n  },\r\n  insert: (comment, replyComment) => {\r\n    // 嵌套模式\r\n    const node = opts.createCommentNode(comment, replyComment)\r\n\r\n    if (comment.rid === 0) {\r\n      // root评论 新增\r\n      opts.$commentsWrap?.prepend(node.getEl())\r\n    } else {\r\n      // 子评论 新增\r\n      const parent = opts.findCommentNode(comment.rid)\r\n      if (parent) {\r\n        parent.putChild(node, opts.nestSortBy === 'DATE_ASC' ? 'append' : 'prepend')\r\n\r\n        // 若父评论存在 “子评论部分” 限高，取消限高\r\n        node.getParents().forEach((p) => {\r\n          p.getRender().heightLimitRemoveForChildren()\r\n        })\r\n      }\r\n    }\r\n\r\n    node.getRender().checkHeightLimit()\r\n\r\n    node.scrollIntoView() // 滚动到可以见\r\n    node.getRender().playFadeAnim() // 播放评论渐出动画\r\n  },\r\n})\r\n","import type { CommentData } from '@/types'\r\n\r\nexport type CommentNode = {\r\n  id: number\r\n  comment: CommentData\r\n  children: CommentNode[]\r\n  parent?: CommentNode\r\n  level: number\r\n}\r\n\r\nexport type SortByType = 'DATE_DESC' | 'DATE_ASC' | 'SRC_INDEX' | 'VOTE_UP_DESC'\r\n\r\n// 构建树状结构列表\r\nexport function makeNestCommentNodeList(\r\n  srcData: CommentData[],\r\n  sortBy: SortByType = 'DATE_DESC',\r\n  nestMax = 2,\r\n) {\r\n  const nodeList: CommentNode[] = []\r\n\r\n  const roots = srcData.filter((o) => o.rid === 0)\r\n  roots.forEach((root: CommentData) => {\r\n    const rootNode: CommentNode = {\r\n      id: root.id,\r\n      comment: root,\r\n      children: [],\r\n      level: 1,\r\n    }\r\n\r\n    rootNode.parent = rootNode\r\n    nodeList.push(rootNode)\r\n    ;(function loadChildren(parentNode: CommentNode) {\r\n      const children = srcData.filter((o) => o.rid === parentNode.id)\r\n      if (children.length === 0) return\r\n      if (parentNode.level >= nestMax) parentNode = parentNode.parent!\r\n      children.forEach((child: CommentData) => {\r\n        const childNode: CommentNode = {\r\n          id: child.id,\r\n          comment: child,\r\n          children: [],\r\n          parent: parentNode,\r\n          level: parentNode.level + 1,\r\n        }\r\n\r\n        parentNode.children.push(childNode)\r\n        loadChildren(childNode)\r\n      })\r\n    })(rootNode)\r\n  })\r\n\r\n  // 排序\r\n  const sortFunc = (a: CommentNode, b: CommentNode): number => {\r\n    let v = a.id - b.id\r\n    if (sortBy === 'DATE_ASC') v = +new Date(a.comment.date) - +new Date(b.comment.date)\r\n    else if (sortBy === 'DATE_DESC') v = +new Date(b.comment.date) - +new Date(a.comment.date)\r\n    else if (sortBy === 'SRC_INDEX') v = srcData.indexOf(a.comment) - srcData.indexOf(b.comment)\r\n    else if (sortBy === 'VOTE_UP_DESC') v = b.comment.vote_up - a.comment.vote_up\r\n    return v\r\n  }\r\n\r\n  ;(function sortLevels(nodes: CommentNode[]) {\r\n    nodes.forEach((node) => {\r\n      node.children = node.children.sort(sortFunc)\r\n      sortLevels(node.children)\r\n    })\r\n  })(nodeList)\r\n\r\n  return nodeList\r\n}\r\n","import type { CommentData } from '@/types'\r\nimport * as Ui from '@/lib/ui'\r\nimport type { LayoutStrategyCreator, LayoutOptions } from '.'\r\n\r\nexport const createFlatStrategy: LayoutStrategyCreator = (opts) => ({\r\n  import: (comments) => {\r\n    comments.forEach((comment: CommentData) => {\r\n      const replyComment =\r\n        comment.rid === 0 ? undefined : comments.find((c) => c.id === comment.rid)\r\n      insertComment(opts, 'append', comment, replyComment)\r\n    })\r\n  },\r\n  insert: (comment, replyComment) => {\r\n    const node = insertComment(opts, 'prepend', comment, replyComment)\r\n    node.scrollIntoView()\r\n  },\r\n})\r\n\r\n/** 导入评论 · 平铺模式 */\r\nfunction insertComment(\r\n  opts: LayoutOptions,\r\n  insertMode: 'append' | 'prepend',\r\n  comment: CommentData,\r\n  replyComment?: CommentData | undefined,\r\n) {\r\n  if (comment.is_collapsed) comment.is_allow_reply = false\r\n  const node = opts.createCommentNode(comment, replyComment)\r\n\r\n  // 可见评论添加到界面\r\n  // 注：不可见评论用于显示 “引用内容”\r\n  if (comment.visible) {\r\n    const $comment = node.getEl()\r\n    const $listCommentsWrap = opts.$commentsWrap\r\n    if (insertMode === 'append') $listCommentsWrap?.append($comment)\r\n    if (insertMode === 'prepend') $listCommentsWrap?.prepend($comment)\r\n    node.getRender().playFadeAnim()\r\n  }\r\n\r\n  // 平铺评论插入后 · 内容限高检测\r\n  // 插入列表的评论 (visible=true) 和关联的评论 (visible=false) 都需要检测\r\n  node.getRender().checkHeightLimit()\r\n\r\n  return node\r\n}\r\n","import type { CommentData } from '@/types'\r\nimport type { CommentNode } from '@/comment'\r\nimport * as ListNest from '../nest'\r\nimport { createNestStrategy } from './nest'\r\nimport { createFlatStrategy } from './flat'\r\n\r\nexport interface LayoutOptions {\r\n  /** The comments wrap of list */\r\n  $commentsWrap: HTMLElement\r\n  nestSortBy: ListNest.SortByType\r\n  nestMax: number\r\n  flatMode: boolean\r\n\r\n  createCommentNode(comment: CommentData, replyComment?: CommentData): CommentNode\r\n  findCommentNode(id: number): CommentNode | undefined\r\n}\r\n\r\nexport interface LayoutStrategy {\r\n  import(comments: CommentData[]): void\r\n  insert(comment: CommentData, replyComment?: CommentData): void\r\n}\r\n\r\nexport type LayoutStrategyCreator = (opts: LayoutOptions) => LayoutStrategy\r\n\r\nexport class ListLayout {\r\n  constructor(private options: LayoutOptions) {}\r\n\r\n  private getStrategy() {\r\n    return this.options.flatMode\r\n      ? createFlatStrategy(this.options)\r\n      : createNestStrategy(this.options)\r\n  }\r\n\r\n  import(comments: CommentData[]) {\r\n    this.getStrategy().import(comments)\r\n  }\r\n\r\n  insert(comment: CommentData, replyComment?: CommentData) {\r\n    this.getStrategy().insert(comment, replyComment)\r\n  }\r\n}\r\n","import * as Utils from '../lib/utils'\r\nimport $t from '../i18n'\r\n\r\nexport interface IHeightLimitConf {\r\n  /** Post expand btn click */\r\n  postExpandBtnClick?: (e: MouseEvent) => void\r\n  /** Allow Scroll */\r\n  scrollable?: boolean\r\n}\r\n\r\nexport interface IHeightLimitRule {\r\n  /** Target element need to check */\r\n  el: HTMLElement | null | undefined\r\n\r\n  /** Max height (unit: px) */\r\n  max: number\r\n\r\n  /** Whether or not the element contains `<img />` */\r\n  imgContains?: boolean\r\n}\r\n\r\nexport type THeightLimitRuleSet = IHeightLimitRule[]\r\n\r\n/** Check all elements below the max height limit */\r\nexport function check(conf: IHeightLimitConf, rules: THeightLimitRuleSet) {\r\n  rules.forEach(({ el, max: maxHeight, imgContains }) => {\r\n    const _apply = () => {\r\n      if (!el) return\r\n      if (!conf.scrollable)\r\n        applyHeightLimit({\r\n          el,\r\n          maxHeight,\r\n          postBtnClick: conf.postExpandBtnClick,\r\n        })\r\n      else applyScrollableHeightLimit({ el, maxHeight })\r\n    }\r\n\r\n    // checking\r\n    const _check = () => {\r\n      if (el && Utils.getHeight(el) > maxHeight) _apply() // 是否超过高度\r\n    }\r\n    _check() // check now\r\n    if (imgContains && el)\r\n      // check again if img contains\r\n      Utils.onImagesLoaded(el, () => _check())\r\n  })\r\n}\r\n\r\n/** Height limit CSS class name */\r\nconst HEIGHT_LIMIT_CSS = 'atk-height-limit'\r\n\r\n/** Apply height limit on an element and add expand btn */\r\nexport function applyHeightLimit(obj: {\r\n  el: HTMLElement\r\n  maxHeight: number\r\n  postBtnClick?: (e: MouseEvent) => void\r\n}) {\r\n  if (!obj.el) return\r\n  if (!obj.maxHeight) return\r\n  if (obj.el.classList.contains(HEIGHT_LIMIT_CSS)) return\r\n\r\n  obj.el.classList.add(HEIGHT_LIMIT_CSS)\r\n  obj.el.style.height = `${obj.maxHeight}px`\r\n  obj.el.style.overflow = 'hidden'\r\n\r\n  /* Expand button */\r\n  const $expandBtn = Utils.createElement(\r\n    `<div class=\"atk-height-limit-btn\">${$t('readMore')}</span>`,\r\n  )\r\n  $expandBtn.onclick = (e) => {\r\n    e.stopPropagation()\r\n    disposeHeightLimit(obj.el)\r\n\r\n    if (obj.postBtnClick) obj.postBtnClick(e)\r\n  }\r\n  obj.el.append($expandBtn)\r\n}\r\n\r\n/** Dispose height limit on an element and remove expand btn */\r\nexport function disposeHeightLimit($el: HTMLElement) {\r\n  if (!$el) return\r\n  if (!$el.classList.contains(HEIGHT_LIMIT_CSS)) return\r\n\r\n  $el.classList.remove(HEIGHT_LIMIT_CSS)\r\n  Array.from($el.children).forEach((e) => {\r\n    if (e.classList.contains('atk-height-limit-btn')) e.remove()\r\n  })\r\n  $el.style.height = ''\r\n  $el.style.overflow = ''\r\n}\r\n\r\n/** Height limit scrollable CSS class name */\r\nconst HEIGHT_LIMIT_SCROLL_CSS = 'atk-height-limit-scroll'\r\n\r\n/** Apply scrollable height limit */\r\nexport function applyScrollableHeightLimit(obj: { el: HTMLElement; maxHeight: number }) {\r\n  if (!obj.el) return\r\n  if (obj.el.classList.contains(HEIGHT_LIMIT_SCROLL_CSS)) return\r\n  obj.el.classList.add(HEIGHT_LIMIT_SCROLL_CSS)\r\n  obj.el.style.height = `${obj.maxHeight}px`\r\n}\r\n","import $t from '@/i18n'\r\nimport * as Utils from '../../lib/utils'\r\nimport type Render from '../render'\r\n\r\n/**\r\n * 评论头部界面\r\n */\r\nexport default function renderHeader(r: Render) {\r\n  Object.entries({\r\n    renderNick,\r\n    renderVerifyBadge,\r\n    renderDate,\r\n    renderUABadge,\r\n  }).forEach(([name, render]) => {\r\n    render(r)\r\n  })\r\n}\r\n\r\nfunction renderNick(r: Render) {\r\n  r.$headerNick = r.$el.querySelector<HTMLElement>('.atk-nick')!\r\n\r\n  if (r.data.link) {\r\n    const $nickA = Utils.createElement<HTMLLinkElement>(\r\n      '<a target=\"_blank\" rel=\"noreferrer noopener nofollow\"></a>',\r\n    )\r\n    $nickA.innerText = r.data.nick\r\n    $nickA.href = Utils.isValidURL(r.data.link) ? r.data.link : `https://${r.data.link}`\r\n    r.$headerNick.append($nickA)\r\n  } else {\r\n    r.$headerNick.innerText = r.data.nick\r\n  }\r\n}\r\n\r\nfunction renderVerifyBadge(ctx: Render) {\r\n  ctx.$headerBadgeWrap = ctx.$el.querySelector<HTMLElement>('.atk-badge-wrap')!\r\n  ctx.$headerBadgeWrap.innerHTML = ''\r\n\r\n  const badgeText = ctx.data.badge_name\r\n  const badgeColor = ctx.data.badge_color\r\n  if (badgeText) {\r\n    const $badge = Utils.createElement(`<span class=\"atk-badge\"></span>`)\r\n    $badge.innerText = badgeText.replace('管理员', $t('admin')) // i18n patch\r\n    $badge.style.backgroundColor = badgeColor || ''\r\n    ctx.$headerBadgeWrap.append($badge)\r\n  } else if (ctx.data.is_verified) {\r\n    const $verifiedBadge = Utils.createElement(\r\n      `<span class=\"atk-verified-icon\" title=\"${$t('emailVerified')}\"></span>`,\r\n    ) // 邮箱验证徽章\r\n    ctx.$headerBadgeWrap.append($verifiedBadge)\r\n  }\r\n\r\n  if (ctx.data.is_pinned) {\r\n    const $pinnedBadge = Utils.createElement(`<span class=\"atk-pinned-badge\">${$t('pin')}</span>`) // 置顶徽章\r\n    ctx.$headerBadgeWrap.append($pinnedBadge)\r\n  }\r\n}\r\n\r\nfunction renderDate(ctx: Render) {\r\n  const $date = ctx.$el.querySelector<HTMLElement>('.atk-date')!\r\n  $date.innerText = ctx.comment.getDateFormatted()\r\n  $date.setAttribute('data-atk-comment-date', String(+new Date(ctx.data.date)))\r\n}\r\n\r\nfunction renderUABadge(ctx: Render) {\r\n  if (!ctx.opts.uaBadge && !ctx.data.ip_region) return\r\n\r\n  let $uaWrap = ctx.$header.querySelector('atk-ua-wrap')\r\n  if (!$uaWrap) {\r\n    $uaWrap = Utils.createElement(`<span class=\"atk-ua-wrap\"></span>`)\r\n    ctx.$header.append($uaWrap)\r\n  }\r\n\r\n  $uaWrap.innerHTML = ''\r\n\r\n  if (ctx.data.ip_region) {\r\n    const $regionBadge = Utils.createElement(`<span class=\"atk-region-badge\"></span>`)\r\n    $regionBadge.innerText = ctx.data.ip_region\r\n    $uaWrap.append($regionBadge)\r\n  }\r\n\r\n  if (ctx.opts.uaBadge) {\r\n    const { browser, os } = ctx.comment.getUserUA()\r\n    if (String(browser).trim()) {\r\n      const $uaBrowser = Utils.createElement(`<span class=\"atk-ua ua-browser\"></span>`)\r\n      $uaBrowser.innerText = browser\r\n      $uaWrap.append($uaBrowser)\r\n    }\r\n\r\n    if (String(os).trim()) {\r\n      const $usOS = Utils.createElement(`<span class=\"atk-ua ua-os\"></span>`)\r\n      $usOS.innerText = os\r\n      $uaWrap.append($usOS)\r\n    }\r\n  }\r\n}\r\n","import $t from '@/i18n'\r\nimport * as Utils from '../lib/utils'\r\n\r\ninterface ActionBtnOptions {\r\n  /** 按钮文字 (动态/静态) */\r\n  text: (() => string) | string\r\n\r\n  /** 仅管理员可用 */\r\n  adminOnly?: boolean\r\n\r\n  /** 确认操作 */\r\n  confirm?: boolean\r\n\r\n  /** 确认时提示文字 */\r\n  confirmText?: string\r\n}\r\n\r\n/**\r\n * 通用操作按钮\r\n */\r\nexport default class ActionBtn {\r\n  private opts: ActionBtnOptions\r\n  public $el: HTMLElement\r\n\r\n  public isLoading = false // 正在加载\r\n\r\n  public msgRecTimer?: number // 消息显示复原定时器\r\n  public msgRecTimerFunc?: Function // 消息显示复原操作\r\n  public get isMessaging() {\r\n    return !!this.msgRecTimer\r\n  } // 消息正在显示\r\n\r\n  public isConfirming = false // 正在确认\r\n  public confirmRecTimer?: number // 确认消息复原定时器\r\n\r\n  /** 构造函数 */\r\n  constructor(opts: ActionBtnOptions | string | (() => string)) {\r\n    this.$el = Utils.createElement(`<span class=\"atk-common-action-btn\"></span>`)\r\n\r\n    this.opts = typeof opts !== 'object' ? { text: opts } : opts\r\n    this.$el.innerText = this.getText()\r\n\r\n    // 仅管理员可操作\r\n    if (this.opts.adminOnly) this.$el.setAttribute('atk-only-admin-show', '')\r\n  }\r\n\r\n  /** 将按钮装载到指定元素 */\r\n  public appendTo(dom: HTMLElement) {\r\n    dom.append(this.$el)\r\n    return this\r\n  }\r\n\r\n  /** 获取按钮文字（动态/静态） */\r\n  private getText() {\r\n    return typeof this.opts.text === 'string' ? this.opts.text : this.opts.text()\r\n  }\r\n\r\n  /** 设置点击事件 */\r\n  public setClick(func: Function) {\r\n    this.$el.onclick = (e) => {\r\n      e.stopPropagation() // 防止穿透\r\n\r\n      // 按钮处于加载状态，禁止点击\r\n      if (this.isLoading) {\r\n        return\r\n      }\r\n\r\n      // 操作确认\r\n      if (this.opts.confirm && !this.isMessaging) {\r\n        const confirmRestore = () => {\r\n          this.isConfirming = false\r\n          this.$el.classList.remove('atk-btn-confirm')\r\n          this.$el.innerText = this.getText()\r\n        }\r\n\r\n        if (!this.isConfirming) {\r\n          this.isConfirming = true\r\n          this.$el.classList.add('atk-btn-confirm')\r\n          this.$el.innerText = this.opts.confirmText || $t('actionConfirm')\r\n          this.confirmRecTimer = window.setTimeout(() => confirmRestore(), 5000)\r\n          return\r\n        }\r\n\r\n        if (this.confirmRecTimer) window.clearTimeout(this.confirmRecTimer)\r\n        confirmRestore()\r\n      }\r\n\r\n      // 立刻释放掉原有的定时器（当显示消息后，用户立刻点击时）\r\n      if (this.msgRecTimer) {\r\n        this.fireMsgRecTimer()\r\n        this.clearMsgRecTimer()\r\n        return\r\n      }\r\n\r\n      // 触发设定的点击事件\r\n      func()\r\n    }\r\n  }\r\n\r\n  /** 文字刷新（动态/静态） */\r\n  public updateText(text?: (() => string) | string) {\r\n    if (text) this.opts.text = text\r\n    this.setLoading(false)\r\n    this.$el.innerText = this.getText()\r\n  }\r\n\r\n  /** 设置加载状态 */\r\n  public setLoading(value: boolean, loadingText?: string) {\r\n    if (this.isLoading === value) return\r\n    this.isLoading = value\r\n    if (value) {\r\n      this.$el.classList.add('atk-btn-loading')\r\n      this.$el.innerText = loadingText || `${$t('loading')}...`\r\n    } else {\r\n      this.$el.classList.remove('atk-btn-loading')\r\n      this.$el.innerText = this.getText()\r\n    }\r\n  }\r\n\r\n  /** 错误消息 */\r\n  public setError(text: string) {\r\n    this.setMsg(text, 'atk-btn-error')\r\n  }\r\n\r\n  /** 警告消息 */\r\n  public setWarn(text: string) {\r\n    this.setMsg(text, 'atk-btn-warn')\r\n  }\r\n\r\n  /** 成功消息 */\r\n  public setSuccess(text: string) {\r\n    this.setMsg(text, 'atk-btn-success')\r\n  }\r\n\r\n  /** 设置消息 */\r\n  public setMsg(text: string, className?: string, duringTime?: number, after?: Function) {\r\n    this.setLoading(false)\r\n    if (className) this.$el.classList.add(className)\r\n    this.$el.innerText = text\r\n\r\n    // 设定复原 timer\r\n    this.setMsgRecTimer(() => {\r\n      this.$el.innerText = this.getText()\r\n      if (className) this.$el.classList.remove(className)\r\n      if (after) after()\r\n    }, duringTime || 2500) // 消息默认显示持续 2500s\r\n  }\r\n\r\n  /** 设置消息复原操作定时器 */\r\n  private setMsgRecTimer(func: Function, duringTime: number) {\r\n    this.fireMsgRecTimer()\r\n    this.clearMsgRecTimer()\r\n\r\n    this.msgRecTimerFunc = func\r\n    this.msgRecTimer = window.setTimeout(() => {\r\n      func()\r\n      this.clearMsgRecTimer()\r\n    }, duringTime)\r\n  }\r\n\r\n  /** 立刻触发器复原定时器 */\r\n  private fireMsgRecTimer() {\r\n    if (this.msgRecTimerFunc) this.msgRecTimerFunc()\r\n  }\r\n\r\n  /** 仅清除 timer */\r\n  private clearMsgRecTimer() {\r\n    if (this.msgRecTimer) window.clearTimeout(this.msgRecTimer)\r\n    this.msgRecTimer = undefined\r\n    this.msgRecTimerFunc = undefined\r\n  }\r\n}\r\n","import $t from '@/i18n'\r\nimport * as Utils from '../../lib/utils'\r\nimport ActionBtn from '../../components/action-btn'\r\nimport type Render from '../render'\r\n\r\n/**\r\n * 评论操作按钮界面\r\n */\r\nexport default function renderActions(r: Render) {\r\n  Object.entries({\r\n    renderVote,\r\n    renderReply,\r\n    // 管理员操作\r\n    renderCollapse,\r\n    renderModerator,\r\n    renderPin,\r\n    renderEdit,\r\n    renderDel,\r\n  }).forEach(([name, render]) => {\r\n    render(r)\r\n  })\r\n}\r\n\r\n// 操作按钮 - 投票\r\nfunction renderVote(r: Render) {\r\n  if (!r.opts.vote) return // 关闭投票功能\r\n\r\n  // 赞同按钮\r\n  r.voteBtnUp = new ActionBtn(() => `${$t('voteUp')} (${r.data.vote_up || 0})`).appendTo(r.$actionNormal)\r\n  r.voteBtnUp.setClick(() => {\r\n    r.comment.getActions().vote('up')\r\n  })\r\n\r\n  // 反对按钮\r\n  if (r.opts.voteDown) {\r\n    r.voteBtnDown = new ActionBtn(() => `${$t('voteDown')} (${r.data.vote_down || 0})`).appendTo(\r\n      r.$actions,\r\n    )\r\n    r.voteBtnDown.setClick(() => {\r\n      r.comment.getActions().vote('down')\r\n    })\r\n  }\r\n}\r\n\r\n// 操作按钮 - 回复\r\nfunction renderReply(r: Render) {\r\n  if (!r.data.is_allow_reply) return // 不允许回复\r\n\r\n  const replyBtn = Utils.createElement(`<span>${$t('reply')}</span>`)\r\n  r.$actionNormal.append(replyBtn)\r\n  replyBtn.addEventListener('click', (e) => {\r\n    e.stopPropagation() // 防止穿透\r\n    r.opts.replyComment(r.data, r.$el)\r\n  })\r\n}\r\n\r\n// 操作按钮 - 折叠\r\nfunction renderCollapse(r: Render) {\r\n  const collapseBtn = new ActionBtn({\r\n    text: () => (r.data.is_collapsed ? $t('expand') : $t('collapse')),\r\n    adminOnly: true,\r\n  })\r\n  collapseBtn.appendTo(r.$actions)\r\n  collapseBtn.setClick(() => {\r\n    r.comment.getActions().adminEdit('collapsed', collapseBtn)\r\n  })\r\n}\r\n\r\n// 操作按钮 - 审核\r\nfunction renderModerator(r: Render) {\r\n  const pendingBtn = new ActionBtn({\r\n    text: () => (r.data.is_pending ? $t('pending') : $t('approved')),\r\n    adminOnly: true,\r\n  })\r\n  pendingBtn.appendTo(r.$actions)\r\n  pendingBtn.setClick(() => {\r\n    r.comment.getActions().adminEdit('pending', pendingBtn)\r\n  })\r\n}\r\n\r\n// 操作按钮 - 置顶\r\nfunction renderPin(r: Render) {\r\n  const pinnedBtn = new ActionBtn({\r\n    text: () => (r.data.is_pinned ? $t('unpin') : $t('pin')),\r\n    adminOnly: true,\r\n  })\r\n  pinnedBtn.appendTo(r.$actions)\r\n  pinnedBtn.setClick(() => {\r\n    r.comment.getActions().adminEdit('pinned', pinnedBtn)\r\n  })\r\n}\r\n\r\n// 操作按钮 - 编辑\r\nfunction renderEdit(r: Render) {\r\n  const editBtn = new ActionBtn({\r\n    text: $t('edit'),\r\n    adminOnly: true,\r\n  })\r\n  editBtn.appendTo(r.$actions)\r\n  editBtn.setClick(() => {\r\n    r.opts.editComment(r.data, r.$el)\r\n  })\r\n}\r\n\r\n// 操作按钮 - 删除\r\nfunction renderDel(r: Render) {\r\n  const delBtn = new ActionBtn({\r\n    text: $t('delete'),\r\n    confirm: true,\r\n    confirmText: $t('deleteConfirm'),\r\n    adminOnly: true,\r\n  })\r\n  delBtn.appendTo(r.$actions)\r\n  delBtn.setClick(() => {\r\n    r.comment.getActions().adminDelete(delBtn)\r\n  })\r\n}\r\n","import type Render from '../render'\r\nimport Avatar from './avatar'\r\nimport Header from './header'\r\nimport Content from './content'\r\nimport ReplyAt from './reply-at'\r\nimport ReplyTo from './reply-to'\r\nimport Pending from './pending'\r\nimport Actions from './actions'\r\n\r\nconst Renders = {\r\n  Avatar,\r\n  Header,\r\n  Content,\r\n  ReplyAt,\r\n  ReplyTo,\r\n  Pending,\r\n  Actions,\r\n}\r\n\r\nexport default function loadRenders(r: Render) {\r\n  Object.entries(Renders).forEach(([name, render]) => {\r\n    render(r)\r\n  })\r\n}\r\n","import * as Utils from '../../lib/utils'\r\nimport type Render from '../render'\r\n\r\n/**\r\n * 评论头像界面\r\n */\r\nexport default function renderAvatar(r: Render) {\r\n  const $avatar = r.$el.querySelector<HTMLElement>('.atk-avatar')!\r\n  const $avatarImg = Utils.createElement<HTMLImageElement>('<img />')\r\n\r\n  const avatarURLBuilder = r.opts.avatarURLBuilder\r\n  // $avatarImg.src = avatarURLBuilder ? avatarURLBuilder(r.data) : r.comment.getGravatarURL()\r\n  $avatarImg.setAttribute('data-src', avatarURLBuilder ? avatarURLBuilder(r.data) : r.comment.getGravatarURL());\r\n  if (!$avatarImg.hasAttribute('loading')) {\r\n    $avatarImg.setAttribute('loading', 'lazy');\r\n  }\r\n\r\n  if (r.data.link) {\r\n    const $avatarA = Utils.createElement<HTMLLinkElement>(\r\n      '<a target=\"_blank\" rel=\"noreferrer noopener nofollow\"></a>',\r\n    )\r\n    $avatarA.href = Utils.isValidURL(r.data.link) ? r.data.link : `https://${r.data.link}`\r\n    $avatarA.append($avatarImg)\r\n    $avatar.append($avatarA)\r\n  } else {\r\n    $avatar.append($avatarImg)\r\n  }\r\n}\r\n","import $t from '@/i18n'\r\nimport * as Utils from '../../lib/utils'\r\nimport * as Ui from '../../lib/ui'\r\nimport type Render from '../render'\r\n\r\n/**\r\n * 评论内容界面\r\n */\r\nexport default function renderContent(r: Render) {\r\n  if (!r.data.is_collapsed) {\r\n    r.$content.innerHTML = r.comment.getContentMarked()\r\n    r.$content.classList.remove('atk-hide', 'atk-collapsed')\r\n    return\r\n  }\r\n\r\n  // 内容 & 折叠\r\n  r.$content.classList.add('atk-hide', 'atk-type-collapsed')\r\n  const collapsedInfoEl = Utils.createElement(`\r\n    <div class=\"atk-collapsed\">\r\n      <span class=\"atk-text\">${$t('collapsedMsg')}</span>\r\n      <span class=\"atk-show-btn\">${$t('expand')}</span>\r\n    </div>`)\r\n  r.$body.insertAdjacentElement('beforeend', collapsedInfoEl)\r\n\r\n  const contentShowBtn = collapsedInfoEl.querySelector<HTMLElement>('.atk-show-btn')!\r\n  contentShowBtn.addEventListener('click', (e) => {\r\n    e.stopPropagation() // 防止穿透\r\n\r\n    if (r.$content.classList.contains('atk-hide')) {\r\n      r.$content.innerHTML = r.comment.getContentMarked()\r\n      r.$content.classList.remove('atk-hide')\r\n      Ui.playFadeInAnim(r.$content)\r\n      contentShowBtn.innerText = $t('collapse')\r\n    } else {\r\n      r.$content.innerHTML = ''\r\n      r.$content.classList.add('atk-hide')\r\n      contentShowBtn.innerText = $t('expand')\r\n    }\r\n  })\r\n}\r\n","import * as Utils from '../../lib/utils'\r\nimport type Render from '../render'\r\n\r\n/**\r\n * Reply user indicator (with arrow icon) in the comment meta header\r\n */\r\nexport default function renderReplyAt(r: Render) {\r\n  if (r.opts.flatMode || r.data.rid === 0) return // if not nested mode or root comment\r\n  if (!r.opts.replyTo) return // if no replyTo data\r\n\r\n  r.$replyAt = Utils.createElement(\r\n    `<span class=\"atk-item atk-reply-at\"><span class=\"atk-arrow\"></span><span class=\"atk-nick\"></span></span>`,\r\n  )\r\n  r.$replyAt.querySelector<HTMLElement>('.atk-nick')!.innerText = `${r.opts.replyTo.nick}`\r\n  r.$replyAt.onclick = () => {\r\n    r.comment.getActions().goToReplyComment()\r\n  }\r\n\r\n  r.$headerBadgeWrap.insertAdjacentElement('afterend', r.$replyAt)\r\n}\r\n","import * as Utils from '@/lib/utils'\r\nimport marked from '@/lib/marked'\r\nimport $t from '@/i18n'\r\nimport type Render from '../render'\r\n\r\n/**\r\n * 关联评论显示 (被回复的评论)\r\n */\r\nexport default function renderReplyTo(r: Render) {\r\n  if (!r.opts.flatMode) return // 仅平铺模式显示\r\n  if (!r.opts.replyTo) return\r\n\r\n  r.$replyTo = Utils.createElement(`\r\n    <div class=\"atk-reply-to\">\r\n      <div class=\"atk-meta\">${$t('reply')} <span class=\"atk-nick\"></span>:</div>\r\n      <div class=\"atk-content\"></div>\r\n    </div>`)\r\n\r\n  // Comment author name\r\n  const $nick = r.$replyTo.querySelector<HTMLElement>('.atk-nick')!\r\n  $nick.innerText = `@${r.opts.replyTo.nick}`\r\n  $nick.onclick = () => {\r\n    r.comment.getActions().goToReplyComment()\r\n  }\r\n\r\n  // Comment content\r\n  let replyContent = marked(r.opts.replyTo.content)\r\n  if (r.opts.replyTo.is_collapsed) replyContent = `[${$t('collapsed')}]`\r\n  r.$replyTo.querySelector<HTMLElement>('.atk-content')!.innerHTML = replyContent\r\n\r\n  // Mount the replyTo element\r\n  r.$body.prepend(r.$replyTo)\r\n}\r\n","import $t from '@/i18n'\r\nimport * as Utils from '../../lib/utils'\r\nimport type Render from '../render'\r\n\r\n/**\r\n * 待审核状态界面\r\n */\r\nexport default function renderPending(r: Render) {\r\n  if (!r.data.is_pending) return\r\n\r\n  const pendingEl = Utils.createElement(`<div class=\"atk-pending\">${$t('pendingMsg')}</div>`)\r\n  r.$body.prepend(pendingEl)\r\n}\r\n","import type { CommentNode } from '.'\r\nimport ActionBtn from '../components/action-btn'\r\nimport * as Utils from '../lib/utils'\r\nimport * as Ui from '../lib/ui'\r\n\r\nimport * as HeightLimit from './height-limit'\r\nimport CommentHTML from './comment.html?raw'\r\nimport loadRenders from './renders'\r\n\r\nexport default class Render {\r\n  public comment: CommentNode\r\n\r\n  public get data() {\r\n    return this.comment.getData()\r\n  }\r\n  public get opts() {\r\n    return this.comment.getOpts()\r\n  }\r\n\r\n  public $el!: HTMLElement\r\n  public $main!: HTMLElement\r\n  public $header!: HTMLElement\r\n  public $headerNick!: HTMLElement\r\n  public $headerBadgeWrap!: HTMLElement\r\n  public $body!: HTMLElement\r\n  public $content!: HTMLElement\r\n  public $childrenWrap!: HTMLElement | null\r\n  public $actions!: HTMLElement\r\n  public $actionNormal!: HTMLElement\r\n  public voteBtnUp?: ActionBtn\r\n  public voteBtnDown?: ActionBtn\r\n\r\n  public $replyTo?: HTMLElement // 回复评论内容 (平铺下显示)\r\n  public $replyAt?: HTMLElement // 回复 AT（层级嵌套下显示）\r\n\r\n  public constructor(comment: CommentNode) {\r\n    this.comment = comment\r\n  }\r\n\r\n  /**\r\n   * Render the comment ui\r\n   *\r\n   * If comment data is updated, call this method to re-render the comment ui.\r\n   * The method will be called multiple times, so it should be idempotent.\r\n   *\r\n   * Renders may add event listeners to the comment ui, so it should be called only once or override the original.\r\n   * Please be aware of the memory leak caused by the event listener.\r\n   */\r\n  public render() {\r\n    // init ui elements\r\n    this.$el = Utils.createElement(CommentHTML)\r\n\r\n    this.$main = this.$el.querySelector('.atk-main')!\r\n    this.$header = this.$el.querySelector('.atk-header')!\r\n    this.$body = this.$el.querySelector('.atk-body')!\r\n    this.$content = this.$body.querySelector('.atk-content')!\r\n    this.$actions = this.$el.querySelector('.atk-actions')!\r\n    this.$actionNormal = this.$el.querySelector('.atk-actions-normal')!\r\n\r\n    this.$el.setAttribute('id', `atk-comment-${this.data.id}`)\r\n\r\n    // call all renders\r\n    loadRenders(this)\r\n\r\n    // append children wrap if exists\r\n    if (this.$childrenWrap) {\r\n      this.$main.append(this.$childrenWrap)\r\n    }\r\n\r\n    return this.$el\r\n  }\r\n\r\n  /** 内容限高检测 */\r\n  public checkHeightLimit() {\r\n    const conf = this.opts.heightLimit\r\n    if (!conf || !conf.content || !conf.children) return // 关闭限高\r\n\r\n    const contentMaxH = conf.content\r\n    const childrenMaxH = conf.children\r\n\r\n    HeightLimit.check(\r\n      {\r\n        postExpandBtnClick: () => {\r\n          // 子评论数仅有 1，直接取消限高\r\n          const children = this.comment.getChildren()\r\n          if (children.length === 1)\r\n            HeightLimit.disposeHeightLimit(children[0].getRender().$content)\r\n        },\r\n        scrollable: conf.scrollable,\r\n      },\r\n      [\r\n        // 评论内容限高\r\n        { el: this.$content, max: contentMaxH, imgContains: true },\r\n        { el: this.$replyTo, max: contentMaxH, imgContains: true },\r\n        // 子评论区域限高（仅嵌套模式）\r\n        { el: this.$childrenWrap, max: childrenMaxH, imgContains: false },\r\n      ],\r\n    )\r\n  }\r\n\r\n  /** 子评论区域移除限高 */\r\n  public heightLimitRemoveForChildren() {\r\n    if (!this.$childrenWrap) return\r\n    HeightLimit.disposeHeightLimit(this.$childrenWrap)\r\n  }\r\n\r\n  /** 渐出动画 */\r\n  playFadeAnim() {\r\n    Ui.playFadeInAnim(this.comment.getRender().$el)\r\n  }\r\n\r\n  /** 渐出动画 · 评论内容区域 */\r\n  playFadeAnimForBody() {\r\n    Ui.playFadeInAnim(this.comment.getRender().$body)\r\n  }\r\n\r\n  /** Perform the flash animation */\r\n  playFlashAnim() {\r\n    // Make sure the class is removed\r\n    this.$el.classList.remove('atk-flash-once')\r\n    window.setTimeout(() => {\r\n      // Add the class to perform the animation\r\n      this.$el.classList.add('atk-flash-once')\r\n    }, 150)\r\n  }\r\n\r\n  /** 获取子评论 Wrap */\r\n  public getChildrenWrap() {\r\n    if (!this.$childrenWrap) {\r\n      // if not exists, create a new one\r\n      this.$childrenWrap = Utils.createElement('<div class=\"atk-comment-children\"></div>')\r\n      this.$main.append(this.$childrenWrap)\r\n    }\r\n    return this.$childrenWrap\r\n  }\r\n\r\n  /** 设置已读 */\r\n  public setUnread(val: boolean) {\r\n    if (val) this.$el.classList.add('atk-unread')\r\n    else this.$el.classList.remove('atk-unread')\r\n  }\r\n\r\n  /** 设置为可点击的评论 */\r\n  public setOpenable(val: boolean) {\r\n    if (val) this.$el.classList.add('atk-openable')\r\n    else this.$el.classList.remove('atk-openable')\r\n  }\r\n\r\n  /** 设置点击评论打开置顶 URL */\r\n  public setOpenURL(url: string) {\r\n    this.setOpenable(true)\r\n    this.$el.onclick = (evt) => {\r\n      evt.stopPropagation()\r\n      window.open(url)\r\n    }\r\n  }\r\n\r\n  /** 设置点击评论时的操作 */\r\n  public setOpenAction(action: () => void) {\r\n    this.setOpenable(true)\r\n    this.$el.onclick = (evt) => {\r\n      evt.stopPropagation()\r\n      action()\r\n    }\r\n  }\r\n}\r\n","export default \"<div class=\\\"atk-comment-wrap\\\">\\r\\n  <div class=\\\"atk-comment\\\">\\r\\n    <div class=\\\"atk-avatar\\\"></div>\\r\\n    <div class=\\\"atk-main\\\">\\r\\n      <div class=\\\"atk-header\\\">\\r\\n        <span class=\\\"atk-item atk-nick\\\"></span>\\r\\n        <span class=\\\"atk-badge-wrap\\\"></span>\\r\\n        <span class=\\\"atk-item atk-date\\\"></span>\\r\\n      </div>\\r\\n      <div class=\\\"atk-body\\\">\\r\\n        <div class=\\\"atk-content\\\"></div>\\r\\n      </div>\\r\\n      <div class=\\\"atk-footer\\\">\\r\\n        <div class=\\\"atk-actions\\\"></div>\\r\\n      </div>\\r\\n      <div class=\\\"atk-footer-normal\\\">\\r\\n        <div class=\\\"atk-actions-normal\\\"></div>\\r\\n      </div>\\r\\n    </div>\\r\\n  </div>\\r\\n</div>\\r\\n\"","import ActionBtn from '@/components/action-btn'\r\nimport $t from '@/i18n'\r\nimport type { CommentNode } from '.'\r\n\r\nexport default class CommentActions {\r\n  private comment: CommentNode\r\n\r\n  private get data() {\r\n    return this.comment.getData()\r\n  }\r\n  private get opts() {\r\n    return this.comment.getOpts()\r\n  }\r\n  private getApi() {\r\n    return this.comment.getOpts().getApi()\r\n  }\r\n\r\n  public constructor(comment: CommentNode) {\r\n    this.comment = comment\r\n  }\r\n\r\n  /** 投票操作 */\r\n  public vote(type: 'up' | 'down') {\r\n    const actionBtn =\r\n      type === 'up' ? this.comment.getRender().voteBtnUp : this.comment.getRender().voteBtnDown\r\n\r\n    this.getApi()\r\n      .votes.vote(`comment_${type}`, this.data.id, {\r\n        ...this.getApi().getUserFields(),\r\n      })\r\n      .then((res) => {\r\n        this.data.vote_up = res.data.up\r\n        this.data.vote_down = res.data.down\r\n        this.comment.getRender().voteBtnUp?.updateText()\r\n        this.comment.getRender().voteBtnDown?.updateText()\r\n      })\r\n      .catch((err) => {\r\n        actionBtn?.setError($t('voteFail'))\r\n        console.log(err)\r\n      })\r\n  }\r\n\r\n  /** 管理员 - 评论状态修改 */\r\n  public adminEdit(type: 'collapsed' | 'pending' | 'pinned', btnElem: ActionBtn) {\r\n    if (btnElem.isLoading) return // 若正在修改中\r\n\r\n    btnElem.setLoading(true, `${$t('editing')}...`)\r\n\r\n    // 克隆并修改当前数据\r\n    const modify = { ...this.data }\r\n    if (type === 'collapsed') {\r\n      modify.is_collapsed = !modify.is_collapsed\r\n    } else if (type === 'pending') {\r\n      modify.is_pending = !modify.is_pending\r\n    } else if (type === 'pinned') {\r\n      modify.is_pinned = !modify.is_pinned\r\n    }\r\n\r\n    this.getApi()\r\n      .comments.updateComment(this.data.id, {\r\n        ...modify,\r\n      })\r\n      .then((res) => {\r\n        btnElem.setLoading(false)\r\n\r\n        // 刷新当前 Comment UI\r\n        this.comment.setData(res.data)\r\n      })\r\n      .catch((err) => {\r\n        console.error(err)\r\n        btnElem.setError($t('editFail'))\r\n      })\r\n  }\r\n\r\n  /** 管理员 - 评论删除 */\r\n  public adminDelete(btnElem: ActionBtn) {\r\n    if (btnElem.isLoading) return // 若正在删除中\r\n\r\n    btnElem.setLoading(true, `${$t('deleting')}...`)\r\n    this.getApi()\r\n      .comments.deleteComment(this.data.id)\r\n      .then(() => {\r\n        btnElem.setLoading(false)\r\n        if (this.opts.onDelete) this.opts.onDelete(this.comment)\r\n      })\r\n      .catch((e) => {\r\n        console.error(e)\r\n        btnElem.setError($t('deleteFail'))\r\n      })\r\n  }\r\n\r\n  /** 快速跳转到该评论 */\r\n  public goToReplyComment() {\r\n    const origHash = window.location.hash\r\n    const modifyHash = `#atk-comment-${this.data.rid}`\r\n\r\n    window.location.hash = modifyHash\r\n    if (modifyHash === origHash) window.dispatchEvent(new Event('hashchange')) // 强制触发事件\r\n  }\r\n}\r\n","import type { CommentData, ArtalkConfig, ContextApi } from '@/types'\r\nimport $t from '@/i18n'\r\nimport type { Api } from '../api'\r\nimport * as Ui from '../lib/ui'\r\nimport * as Utils from '../lib/utils'\r\nimport marked from '../lib/marked'\r\nimport UADetect from '../lib/detect'\r\nimport CommentUI from './render'\r\nimport CommentActions from './actions'\r\n\r\nexport interface CommentOptions {\r\n  // Hooks\r\n  onAfterRender?: () => void\r\n  onDelete?: Function\r\n\r\n  /** The comment being replied to (linked comment) */\r\n  replyTo?: CommentData\r\n\r\n  // Referenced from ArtalkConfig\r\n  flatMode: boolean\r\n  vote: boolean\r\n  voteDown: boolean\r\n  uaBadge: boolean\r\n  nestMax: number\r\n  gravatar: ArtalkConfig['gravatar']\r\n  heightLimit: ArtalkConfig['heightLimit']\r\n  avatarURLBuilder: ArtalkConfig['avatarURLBuilder']\r\n  scrollRelativeTo: ArtalkConfig['scrollRelativeTo']\r\n\r\n  // TODO: Move to plugin folder and remove from core\r\n  getApi: () => Api\r\n  replyComment: ContextApi['replyComment']\r\n  editComment: ContextApi['editComment']\r\n}\r\n\r\nexport default class CommentNode {\r\n  $el?: HTMLElement\r\n\r\n  private renderInstance: CommentUI\r\n  private actionInstance: CommentActions\r\n\r\n  private data: CommentData\r\n  private opts: CommentOptions\r\n\r\n  private parent: CommentNode | null\r\n  private children: CommentNode[] = []\r\n\r\n  private nestCurt: number // 当前嵌套层数\r\n\r\n  constructor(data: CommentData, opts: CommentOptions) {\r\n    this.opts = opts\r\n    this.data = { ...data }\r\n    this.data.date = this.data.date.replace(/-/g, '/') // 解决 Safari 日期解析 NaN 问题\r\n\r\n    this.parent = null\r\n    this.nestCurt = 1 // 现在已嵌套 n 层\r\n\r\n    this.actionInstance = new CommentActions(this)\r\n    this.renderInstance = new CommentUI(this)\r\n  }\r\n\r\n  /** 渲染 UI */\r\n  public render() {\r\n    const newEl = this.renderInstance.render()\r\n\r\n    if (this.$el) this.$el.replaceWith(newEl)\r\n    this.$el = newEl\r\n    // Please be aware of the memory leak, the $el may be replaced multiple times.\r\n    // If somewhere else has a reference to the old $el, it will cause a memory leak.\r\n    // So it's limited to use the $el reference by `getEl()`.\r\n    // The `getEl()` will always return the latest $el.\r\n\r\n    if (this.opts.onAfterRender) this.opts.onAfterRender()\r\n  }\r\n\r\n  /** 获取评论操作实例对象 */\r\n  public getActions() {\r\n    return this.actionInstance\r\n  }\r\n\r\n  /** 获取评论渲染器实例对象 */\r\n  public getRender() {\r\n    return this.renderInstance\r\n  }\r\n\r\n  /** 获取评论数据 */\r\n  public getData() {\r\n    return this.data\r\n  }\r\n\r\n  /** 设置数据 */\r\n  public setData(data: CommentData) {\r\n    this.data = data\r\n\r\n    this.render()\r\n    this.getRender().playFadeAnimForBody()\r\n  }\r\n\r\n  /** 获取父评论 */\r\n  public getParent() {\r\n    return this.parent\r\n  }\r\n\r\n  /** 获取所有子评论 */\r\n  public getChildren() {\r\n    return this.children\r\n  }\r\n\r\n  /** 获取当前嵌套层数 */\r\n  public getNestCurt() {\r\n    return this.nestCurt\r\n  }\r\n\r\n  /** 判断是否为根评论 */\r\n  public getIsRoot() {\r\n    return this.data.rid === 0\r\n  }\r\n\r\n  /** 获取评论 ID */\r\n  public getID() {\r\n    return this.data.id\r\n  }\r\n\r\n  /** 置入子评论 */\r\n  public putChild(childNode: CommentNode, insertMode: 'append' | 'prepend' = 'append') {\r\n    childNode.parent = this\r\n    childNode.nestCurt = this.nestCurt + 1 // 嵌套层数 +1\r\n    this.children.push(childNode)\r\n\r\n    const $childrenWrap = this.getChildrenWrapEl()\r\n    const $childComment = childNode.getEl()\r\n    if (insertMode === 'append') $childrenWrap.append($childComment)\r\n    else if (insertMode === 'prepend') $childrenWrap.prepend($childComment)\r\n\r\n    childNode.getRender().playFadeAnim()\r\n    childNode.getRender().checkHeightLimit() // 内容限高\r\n  }\r\n\r\n  /** 获取存放子评论的元素对象 */\r\n  public getChildrenWrapEl(): HTMLElement {\r\n    // console.log(this.nestCurt)\r\n    if (this.nestCurt >= this.opts.nestMax) {\r\n      return this.parent!.getChildrenWrapEl()\r\n    }\r\n    return this.getRender().getChildrenWrap()\r\n  }\r\n\r\n  /** 获取所有父评论 */\r\n  public getParents() {\r\n    const flattenParents: CommentNode[] = []\r\n    let parent = this.parent\r\n    while (parent) {\r\n      flattenParents.push(parent)\r\n      parent = parent.getParent()\r\n    }\r\n    return flattenParents\r\n  }\r\n\r\n  /**\r\n   * Get the element of the comment\r\n   *\r\n   * The `getEl()` will always return the latest $el after calling `render()`.\r\n   * Please be aware of the memory leak if you use the $el reference directly.\r\n   */\r\n  public getEl() {\r\n    if (!this.$el) throw new Error('comment element not initialized before `getEl()`')\r\n    return this.$el\r\n  }\r\n\r\n  /**\r\n   * Focus on the comment\r\n   *\r\n   * Scroll to the comment and perform flash animation\r\n   */\r\n  focus() {\r\n    if (!this.$el) throw new Error('comment element not initialized before `focus()`')\r\n\r\n    // 若父评论存在 “子评论部分” 限高，取消限高\r\n    this.getParents().forEach((p) => {\r\n      p.getRender().heightLimitRemoveForChildren()\r\n    })\r\n\r\n    // Scroll to comment\r\n    this.scrollIntoView()\r\n\r\n    // Perform flash animation\r\n    this.getRender().playFlashAnim()\r\n  }\r\n\r\n  scrollIntoView() {\r\n    this.$el &&\r\n      Ui.scrollIntoView(this.$el, false, this.opts.scrollRelativeTo && this.opts.scrollRelativeTo())\r\n  }\r\n\r\n  /**\r\n   * Remove the comment node\r\n   */\r\n  remove() {\r\n    this.$el?.remove()\r\n  }\r\n\r\n  /** 获取 Gravatar 头像 URL */\r\n  public getGravatarURL() {\r\n    return Utils.getGravatarURL({\r\n      mirror: this.opts.gravatar.mirror,\r\n      params: this.opts.gravatar.params,\r\n      emailMD5: this.data.email_encrypted,\r\n    })\r\n  }\r\n\r\n  /** 获取评论 markdown 解析后的内容 */\r\n  public getContentMarked() {\r\n    return marked(this.data.content)\r\n  }\r\n\r\n  /** 获取格式化后的日期 */\r\n  public getDateFormatted() {\r\n    return Utils.timeAgo(new Date(this.data.date), $t)\r\n  }\r\n\r\n  /** 获取用户 UserAgent 信息 */\r\n  public getUserUA() {\r\n    const info = UADetect(this.data.ua)\r\n    return {\r\n      browser: `${info.browser} ${info.version}`,\r\n      os: `${info.os} ${info.osVersion}`,\r\n    }\r\n  }\r\n\r\n  /** 获取配置 */\r\n  public getOpts() {\r\n    return this.opts\r\n  }\r\n}\r\n","function Detect(userAgent?: string) {\r\n  const win = (window as any) || {}\r\n  const nav = navigator || {}\r\n\r\n  const u = String(userAgent || nav.userAgent)\r\n  const dest = {\r\n    os: '',\r\n    osVersion: '',\r\n    engine: '',\r\n    browser: '',\r\n    device: '',\r\n    language: '',\r\n    version: ''\r\n  }\r\n\r\n  // 内核\r\n  const engineMatch = {\r\n    Trident: u.includes('Trident') || u.includes('NET CLR'),\r\n    Presto: u.includes('Presto'),\r\n    WebKit: u.includes('AppleWebKit'),\r\n    Gecko: u.includes('Gecko/')\r\n  }\r\n\r\n  // 浏览器\r\n  const browserMatch = {\r\n    Safari: u.includes('Safari'),\r\n    Chrome: u.includes('Chrome') || u.includes('CriOS'),\r\n    IE: u.includes('MSIE') || u.includes('Trident'),\r\n    Edge: u.includes('Edge') || u.includes('Edg'),\r\n    Firefox: u.includes('Firefox') || u.includes('FxiOS'),\r\n    'Firefox Focus': u.includes('Focus'),\r\n    Chromium: u.includes('Chromium'),\r\n    Opera: u.includes('Opera') || u.includes('OPR'),\r\n    Vivaldi: u.includes('Vivaldi'),\r\n    Yandex: u.includes('YaBrowser'),\r\n    Kindle: u.includes('Kindle') || u.includes('Silk/'),\r\n    360: u.includes('360EE') || u.includes('360SE'),\r\n    UC: u.includes('UC') || u.includes(' UBrowser'),\r\n    QQBrowser: u.includes('QQBrowser'),\r\n    QQ: u.includes('QQ/'),\r\n    Baidu: u.includes('Baidu') || u.includes('BIDUBrowser'),\r\n    Maxthon: u.includes('Maxthon'),\r\n    Sogou: u.includes('MetaSr') || u.includes('Sogou'),\r\n    LBBROWSER: u.includes('LBBROWSER'),\r\n    '2345Explorer': u.includes('2345Explorer'),\r\n    TheWorld: u.includes('TheWorld'),\r\n    MIUI: u.includes('MiuiBrowser'),\r\n    Quark: u.includes('Quark'),\r\n    Qiyu: u.includes('Qiyu'),\r\n    Wechat: u.includes('MicroMessenger'),\r\n    Taobao: u.includes('AliApp(TB'),\r\n    Alipay: u.includes('AliApp(AP'),\r\n    Weibo: u.includes('Weibo'),\r\n    Douban: u.includes('com.douban.frodo'),\r\n    Suning: u.includes('SNEBUY-APP'),\r\n    iQiYi: u.includes('IqiyiApp'),\r\n  }\r\n\r\n  // 系统或平台\r\n  const osMatch = {\r\n    Windows: u.includes('Windows'),\r\n    Linux: u.includes('Linux') || u.includes('X11'),\r\n    'macOS': u.includes('Macintosh'),\r\n    Android: u.includes('Android') || u.includes('Adr'),\r\n    Ubuntu: u.includes('Ubuntu'),\r\n    FreeBSD: u.includes('FreeBSD'),\r\n    Debian: u.includes('Debian'),\r\n    'Windows Phone': u.includes('IEMobile') || u.includes('Windows Phone'),\r\n    BlackBerry: u.includes('BlackBerry') || u.includes('RIM'),\r\n    MeeGo: u.includes('MeeGo'),\r\n    Symbian: u.includes('Symbian'),\r\n    iOS: u.includes('like Mac OS X'),\r\n    'Chrome OS': u.includes('CrOS'),\r\n    WebOS: u.includes('hpwOS'),\r\n  }\r\n\r\n  // 设备\r\n  const deviceMatch = {\r\n    Mobile: u.includes('Mobi') || u.includes('iPh') || u.includes('480'),\r\n    Tablet: u.includes('Tablet') || u.includes('Pad') || u.includes('Nexus 7')\r\n  }\r\n\r\n  // 修正\r\n  if (deviceMatch.Mobile) {\r\n    deviceMatch.Mobile = !(u.includes('iPad'))\r\n  } else if (browserMatch.Chrome && u.includes('Edg')) {\r\n    // Chrome 内核的 Edge\r\n    browserMatch.Chrome = false\r\n    browserMatch.Edge = true\r\n  } else if (win.showModalDialog && win.chrome) {\r\n    browserMatch.Chrome = false\r\n    browserMatch['360'] = true\r\n  }\r\n\r\n  // 默认设备\r\n  dest.device = 'PC'\r\n\r\n  // 语言\r\n  dest.language = (() => {\r\n    const g = ((nav as any).browserLanguage || nav.language)\r\n    const arr = g.split('-')\r\n    if (arr[1]) arr[1] = arr[1].toUpperCase()\r\n    return arr.join('_')\r\n  })()\r\n\r\n  // 应用判断数据\r\n  const hash = {\r\n    engine: engineMatch,\r\n    browser: browserMatch,\r\n    os: osMatch,\r\n    device: deviceMatch,\r\n  }\r\n  Object.entries(hash).forEach(([type, match]) => {\r\n    Object.entries(match).forEach(([name, result]) => {\r\n      if (result === true) dest[type] = name\r\n    })\r\n  })\r\n\r\n  // 系统版本信息\r\n  const osVersion = {\r\n    Windows: () => {\r\n      const v = u.replace(/^.*Windows NT ([\\d.]+);.*$/, '$1')\r\n      const wvHash = {\r\n        '6.4': '10',\r\n        '6.3': '8.1',\r\n        '6.2': '8',\r\n        '6.1': '7',\r\n        '6.0': 'Vista',\r\n        '5.2': 'XP',\r\n        '5.1': 'XP',\r\n        '5.0': '2000',\r\n        '10.0': '10',\r\n        '11.0': '11' // 自定的，不是微软官方的判断方法\r\n      }\r\n      return wvHash[v] || v\r\n    },\r\n    Android: () => u.replace(/^.*Android ([\\d.]+);.*$/, '$1'),\r\n    iOS: () => u.replace(/^.*OS ([\\d_]+) like.*$/, '$1').replace(/_/g, '.'),\r\n    Debian: () => u.replace(/^.*Debian\\/([\\d.]+).*$/, '$1'),\r\n    'Windows Phone': () => u.replace(/^.*Windows Phone( OS)? ([\\d.]+);.*$/, '$2'),\r\n    'macOS': () => u.replace(/^.*Mac OS X ([\\d_]+).*$/, '$1').replace(/_/g, '.'),\r\n    WebOS: () => u.replace(/^.*hpwOS\\/([\\d.]+);.*$/, '$1')\r\n  }\r\n\r\n  dest.osVersion = ''\r\n  if (osVersion[dest.os]) {\r\n    dest.osVersion = osVersion[dest.os]()\r\n    if (dest.osVersion === u) {\r\n      dest.osVersion = ''\r\n    }\r\n  }\r\n\r\n  // 浏览器版本信息\r\n  const version = {\r\n    Safari: () => u.replace(/^.*Version\\/([\\d.]+).*$/, '$1'),\r\n    Chrome: () => u.replace(/^.*Chrome\\/([\\d.]+).*$/, '$1').replace(/^.*CriOS\\/([\\d.]+).*$/, '$1'),\r\n    IE: () => u.replace(/^.*MSIE ([\\d.]+).*$/, '$1').replace(/^.*rv:([\\d.]+).*$/, '$1'),\r\n    Edge: () => u.replace(/^.*(Edge|Edg|Edg[A-Z]{1})\\/([\\d.]+).*$/, '$2'),\r\n    Firefox: () => u.replace(/^.*Firefox\\/([\\d.]+).*$/, '$1').replace(/^.*FxiOS\\/([\\d.]+).*$/, '$1'),\r\n    'Firefox Focus': () => u.replace(/^.*Focus\\/([\\d.]+).*$/, '$1'),\r\n    Chromium: () => u.replace(/^.*Chromium\\/([\\d.]+).*$/, '$1'),\r\n    Opera: () => u.replace(/^.*Opera\\/([\\d.]+).*$/, '$1').replace(/^.*OPR\\/([\\d.]+).*$/, '$1'),\r\n    Vivaldi: () => u.replace(/^.*Vivaldi\\/([\\d.]+).*$/, '$1'),\r\n    Yandex: () => u.replace(/^.*YaBrowser\\/([\\d.]+).*$/, '$1'),\r\n    Kindle: () => u.replace(/^.*Version\\/([\\d.]+).*$/, '$1'),\r\n    Maxthon: () => u.replace(/^.*Maxthon\\/([\\d.]+).*$/, '$1'),\r\n    QQBrowser: () => u.replace(/^.*QQBrowser\\/([\\d.]+).*$/, '$1'),\r\n    QQ: () => u.replace(/^.*QQ\\/([\\d.]+).*$/, '$1'),\r\n    Baidu: () => u.replace(/^.*BIDUBrowser[\\s/]([\\d.]+).*$/, '$1'),\r\n    UC: () => u.replace(/^.*UC?Browser\\/([\\d.]+).*$/, '$1'),\r\n    Sogou: () => u.replace(/^.*SE ([\\d.X]+).*$/, '$1').replace(/^.*SogouMobileBrowser\\/([\\d.]+).*$/, '$1'),\r\n    '2345Explorer': () => u.replace(/^.*2345Explorer\\/([\\d.]+).*$/, '$1'),\r\n    TheWorld: () => u.replace(/^.*TheWorld ([\\d.]+).*$/, '$1'),\r\n    MIUI: () => u.replace(/^.*MiuiBrowser\\/([\\d.]+).*$/, '$1'),\r\n    Quark: () => u.replace(/^.*Quark\\/([\\d.]+).*$/, '$1'),\r\n    Qiyu: () => u.replace(/^.*Qiyu\\/([\\d.]+).*$/, '$1'),\r\n    Wechat: () => u.replace(/^.*MicroMessenger\\/([\\d.]+).*$/, '$1'),\r\n    Taobao: () => u.replace(/^.*AliApp\\(TB\\/([\\d.]+).*$/, '$1'),\r\n    Alipay: () => u.replace(/^.*AliApp\\(AP\\/([\\d.]+).*$/, '$1'),\r\n    Weibo: () => u.replace(/^.*weibo__([\\d.]+).*$/, '$1'),\r\n    Douban: () => u.replace(/^.*com.douban.frodo\\/([\\d.]+).*$/, '$1'),\r\n    Suning: () => u.replace(/^.*SNEBUY-APP([\\d.]+).*$/, '$1'),\r\n    iQiYi: () => u.replace(/^.*IqiyiVersion\\/([\\d.]+).*$/, '$1'),\r\n  }\r\n\r\n  dest.version = ''\r\n  if (version[dest.browser]) {\r\n    dest.version = version[dest.browser]()\r\n    if (dest.version === u) {\r\n      dest.version = ''\r\n    }\r\n  }\r\n\r\n  // 简化版本号\r\n  /* if (_this.osVersion.indexOf('.')) {\r\n    _this.osVersion = _this.osVersion.substring(0, _this.osVersion.indexOf('.'))\r\n  } */\r\n  if (dest.version.indexOf('.')) {\r\n    dest.version = dest.version.substring(0, dest.version.indexOf('.'))\r\n  }\r\n\r\n  // 修正\r\n  if (dest.os === 'iOS' && u.includes('iPad')) {\r\n    dest.os = 'iPadOS'\r\n  } else if (dest.browser === 'Edge' && !u.includes('Edg')) {\r\n    dest.engine = 'EdgeHTML'\r\n  } else if (dest.browser === 'MIUI') {\r\n    dest.os = 'Android'\r\n  } else if (dest.browser === 'Chrome' && Number(dest.version) > 27) {\r\n    dest.engine = 'Blink'\r\n  } else if (dest.browser === 'Opera' && Number(dest.version) > 12) {\r\n    dest.engine = 'Blink'\r\n  } else if (dest.browser === 'Yandex') {\r\n    dest.engine = 'Blink'\r\n  } else if (dest.browser === undefined) {\r\n    dest.browser = 'Unknow App'\r\n  }\r\n\r\n  return dest\r\n}\r\n\r\nexport default Detect\r\n","import * as Utils from '../lib/utils'\r\n\r\nexport interface ReadMoreBtnOptions {\r\n  /** 回调函数 */\r\n  onClick: (offset: number) => void\r\n\r\n  pageSize: number\r\n\r\n  text?: string\r\n}\r\n\r\n/**\r\n * 阅读更多按钮\r\n */\r\nexport default class ReadMoreBtn {\r\n  public opts: ReadMoreBtnOptions\r\n  public $el: HTMLElement\r\n  private $loading: HTMLElement\r\n  private $text: HTMLElement\r\n  private offset: number = 0\r\n  private total: number = 0\r\n  private origText: string = 'Load More'\r\n\r\n  /** 是否有更多内容 */\r\n  get hasMore() {\r\n    return this.total > this.offset + this.opts.pageSize\r\n  }\r\n\r\n  public constructor(opts: ReadMoreBtnOptions) {\r\n    this.opts = opts\r\n    this.origText = this.opts.text || this.origText\r\n\r\n    this.$el = Utils.createElement(\r\n      `<div class=\"atk-list-read-more\" style=\"display: none;\">\r\n      <div class=\"atk-list-read-more-inner\">\r\n        <div class=\"atk-loading-icon\" style=\"display: none;\"></div>\r\n        <span class=\"atk-text\">${this.origText}</span>\r\n      </div>\r\n    </div>`,\r\n    )\r\n\r\n    this.$loading = this.$el.querySelector<HTMLElement>('.atk-loading-icon')!\r\n    this.$text = this.$el.querySelector<HTMLElement>('.atk-text')!\r\n\r\n    this.$el.onclick = () => {\r\n      this.click()\r\n    }\r\n  }\r\n\r\n  click() {\r\n    if (this.hasMore) this.opts.onClick(this.offset + this.opts.pageSize)\r\n    this.checkDisabled()\r\n  }\r\n\r\n  /** 显示 */\r\n  show() {\r\n    this.$el.style.display = ''\r\n  }\r\n\r\n  /** 隐藏 */\r\n  hide() {\r\n    this.$el.style.display = 'none'\r\n  }\r\n\r\n  /** 加载 */\r\n  setLoading(isLoading: boolean) {\r\n    this.$loading.style.display = isLoading ? '' : 'none'\r\n    this.$text.style.display = isLoading ? 'none' : ''\r\n  }\r\n\r\n  /** 错误提示 */\r\n  showErr(errMsg: string) {\r\n    this.setLoading(false)\r\n\r\n    this.$text.innerText = errMsg\r\n    this.$el.classList.add('atk-err')\r\n    window.setTimeout(() => {\r\n      this.$text.innerText = this.origText\r\n      this.$el.classList.remove('atk-err')\r\n    }, 2000) // 2s后错误提示复原\r\n  }\r\n\r\n  /** 更新数据 */\r\n  public update(offset: number, total: number) {\r\n    this.offset = offset\r\n    this.total = total\r\n\r\n    this.checkDisabled()\r\n  }\r\n\r\n  public checkDisabled() {\r\n    if (this.hasMore) this.show()\r\n    else this.hide()\r\n  }\r\n}\r\n","import type { ListFetchParams } from '@/types'\r\nimport ReadMoreBtn from '@/components/read-more-btn'\r\nimport $t from '@/i18n'\r\nimport type { Paginator, IPgHolderOpt } from '.'\r\n\r\n/**\r\n * 阅读更多形式的分页\r\n */\r\nexport default class ReadMorePaginator implements Paginator {\r\n  private instance!: ReadMoreBtn\r\n  private onReachedBottom: (() => void) | null = null\r\n  private opt!: IPgHolderOpt\r\n\r\n  create(opt: IPgHolderOpt) {\r\n    this.opt = opt\r\n\r\n    this.instance = new ReadMoreBtn({\r\n      pageSize: opt.pageSize,\r\n      onClick: async (o) => {\r\n        opt.ctx.fetch({\r\n          offset: o,\r\n        })\r\n      },\r\n      text: $t('loadMore'),\r\n    })\r\n\r\n    // 滚动到底部自动加载\r\n    if (opt.readMoreAutoLoad) {\r\n      this.onReachedBottom = () => {\r\n        if (!this.instance.hasMore || this.opt.ctx.getData().getLoading()) return\r\n        this.instance.click()\r\n      }\r\n      this.opt.ctx.on('list-reach-bottom', this.onReachedBottom)\r\n    }\r\n\r\n    return this.instance.$el\r\n  }\r\n\r\n  setLoading(val: boolean) {\r\n    this.instance.setLoading(val)\r\n  }\r\n\r\n  update(offset: number, total: number) {\r\n    this.instance.update(offset, total)\r\n  }\r\n\r\n  showErr(msg: string) {\r\n    this.instance.showErr(msg)\r\n  }\r\n\r\n  next() {\r\n    this.instance.click()\r\n  }\r\n\r\n  getHasMore(): boolean {\r\n    return this.instance.hasMore\r\n  }\r\n\r\n  getIsClearComments(params: { offset?: number }): boolean {\r\n    return params.offset === 0\r\n  }\r\n\r\n  dispose(): void {\r\n    this.onReachedBottom && this.opt.ctx.off('list-reach-bottom', this.onReachedBottom)\r\n    this.instance.$el.remove()\r\n  }\r\n}\r\n","import * as Utils from '../lib/utils'\r\nimport * as Ui from '../lib/ui'\r\n\r\nexport interface PaginationOptions {\r\n  /** 每页条数 */\r\n  pageSize: number\r\n\r\n  /** 回调函数 */\r\n  onChange: (offset: number) => void\r\n}\r\n\r\nexport default class Pagination {\r\n  private opts: PaginationOptions\r\n  public total: number\r\n  public $el: HTMLElement\r\n  public $input: HTMLInputElement\r\n  public inputTimer?: number\r\n  public $prevBtn: HTMLElement\r\n  public $nextBtn: HTMLElement\r\n\r\n  public page: number = 1\r\n  get pageSize(): number {\r\n    return this.opts.pageSize\r\n  }\r\n  get offset(): number {\r\n    return this.pageSize * (this.page - 1)\r\n  }\r\n  get maxPage(): number {\r\n    return Math.ceil(this.total / this.pageSize)\r\n  }\r\n\r\n  public constructor(total: number, opts: PaginationOptions) {\r\n    this.total = total\r\n    this.opts = opts\r\n\r\n    this.$el = Utils.createElement(\r\n      `<div class=\"atk-pagination-wrap\">\r\n        <div class=\"atk-pagination\">\r\n          <div class=\"atk-btn atk-btn-prev\" aria-label=\"Previous page\">\r\n            <svg stroke=\"currentColor\" fill=\"currentColor\" stroke-width=\"0\" viewBox=\"0 0 512 512\" height=\"14px\" width=\"14px\" xmlns=\"http://www.w3.org/2000/svg\"><path d=\"M217.9 256L345 129c9.4-9.4 9.4-24.6 0-33.9-9.4-9.4-24.6-9.3-34 0L167 239c-9.1 9.1-9.3 23.7-.7 33.1L310.9 417c4.7 4.7 10.9 7 17 7s12.3-2.3 17-7c9.4-9.4 9.4-24.6 0-33.9L217.9 256z\"></path></svg>\r\n          </div>\r\n          <input type=\"text\" class=\"atk-input\" aria-label=\"Enter the number of page\" />\r\n          <div class=\"atk-btn atk-btn-next\" aria-label=\"Next page\">\r\n            <svg stroke=\"currentColor\" fill=\"currentColor\" stroke-width=\"0\" viewBox=\"0 0 512 512\" height=\"14px\" width=\"14px\" xmlns=\"http://www.w3.org/2000/svg\"><path d=\"M294.1 256L167 129c-9.4-9.4-9.4-24.6 0-33.9s24.6-9.3 34 0L345 239c9.1 9.1 9.3 23.7.7 33.1L201.1 417c-4.7 4.7-10.9 7-17 7s-12.3-2.3-17-7c-9.4-9.4-9.4-24.6 0-33.9l127-127.1z\"></path></svg>\r\n          </div>\r\n        </div>\r\n      </div>`,\r\n    )\r\n    this.$input = this.$el.querySelector('.atk-input')!\r\n    this.$input.value = `${this.page}`\r\n\r\n    this.$input.oninput = () => this.input()\r\n    this.$input.onkeydown = (e) => this.keydown(e)\r\n\r\n    this.$prevBtn = this.$el.querySelector('.atk-btn-prev')!\r\n    this.$nextBtn = this.$el.querySelector('.atk-btn-next')!\r\n\r\n    this.$prevBtn.onclick = () => this.prev()\r\n    this.$nextBtn.onclick = () => this.next()\r\n\r\n    this.checkDisabled()\r\n  }\r\n\r\n  public update(offset: number, total: number) {\r\n    this.page = Math.ceil(offset / this.pageSize) + 1\r\n    this.total = total\r\n\r\n    this.setInput(this.page)\r\n    this.checkDisabled()\r\n  }\r\n\r\n  public setInput(page: number) {\r\n    this.$input.value = `${page}`\r\n  }\r\n\r\n  public input(now: boolean = false) {\r\n    window.clearTimeout(this.inputTimer)\r\n\r\n    const value = this.$input.value.trim()\r\n\r\n    const modify = () => {\r\n      if (value === '') {\r\n        this.setInput(this.page)\r\n        return\r\n      }\r\n      let page = Number(value)\r\n      if (Number.isNaN(page)) {\r\n        this.setInput(this.page)\r\n        return\r\n      }\r\n      if (page < 1) {\r\n        this.setInput(this.page)\r\n        return\r\n      }\r\n      if (page > this.maxPage) {\r\n        this.setInput(this.maxPage)\r\n        page = this.maxPage\r\n      }\r\n      this.change(page)\r\n    }\r\n\r\n    // 延迟 800ms 执行\r\n    if (!now) this.inputTimer = window.setTimeout(() => modify(), 800)\r\n    else modify()\r\n  }\r\n\r\n  public prev() {\r\n    const page = this.page - 1\r\n    if (page < 1) {\r\n      return\r\n    }\r\n    this.change(page)\r\n  }\r\n\r\n  public next() {\r\n    const page = this.page + 1\r\n    if (page > this.maxPage) {\r\n      return\r\n    }\r\n    this.change(page)\r\n  }\r\n\r\n  public getHasMore() {\r\n    return this.page + 1 <= this.maxPage\r\n  }\r\n\r\n  public change(page: number) {\r\n    this.page = page\r\n    this.opts.onChange(this.offset)\r\n    this.setInput(page)\r\n    this.checkDisabled()\r\n  }\r\n\r\n  public checkDisabled() {\r\n    if (this.page + 1 > this.maxPage) {\r\n      this.$nextBtn.classList.add('atk-disabled')\r\n    } else {\r\n      this.$nextBtn.classList.remove('atk-disabled')\r\n    }\r\n\r\n    if (this.page - 1 < 1) {\r\n      this.$prevBtn.classList.add('atk-disabled')\r\n    } else {\r\n      this.$prevBtn.classList.remove('atk-disabled')\r\n    }\r\n  }\r\n\r\n  public keydown(e: KeyboardEvent) {\r\n    const keyCode = e.keyCode || e.which\r\n\r\n    if (keyCode === 38) {\r\n      // 上键\r\n      const page = Number(this.$input.value) + 1\r\n      if (page > this.maxPage) {\r\n        return\r\n      }\r\n      this.setInput(page)\r\n      this.input()\r\n    } else if (keyCode === 40) {\r\n      // 下键\r\n      const page = Number(this.$input.value) - 1\r\n      if (page < 1) {\r\n        return\r\n      }\r\n      this.setInput(page)\r\n      this.input()\r\n    } else if (keyCode === 13) {\r\n      // 回车\r\n      this.input(true)\r\n    }\r\n  }\r\n\r\n  /** 加载 */\r\n  setLoading(isLoading: boolean) {\r\n    if (isLoading) Ui.showLoading(this.$el)\r\n    else Ui.hideLoading(this.$el)\r\n  }\r\n}\r\n","import PaginationComponent from '@/components/pagination'\r\nimport type { Paginator, IPgHolderOpt } from '.'\r\n\r\n/**\r\n * 翻页形式的分页\r\n */\r\nexport default class UpDownPaginator implements Paginator {\r\n  private instance!: PaginationComponent\r\n\r\n  create(opt: IPgHolderOpt) {\r\n    this.instance = new PaginationComponent(opt.total, {\r\n      pageSize: opt.pageSize,\r\n      onChange: async (o) => {\r\n        opt.ctx.editorResetState() // 防止评论框被吞\r\n\r\n        opt.ctx.fetch({\r\n          offset: o,\r\n          onSuccess: () => {\r\n            opt.ctx.listGotoFirst()\r\n          },\r\n        })\r\n      },\r\n    })\r\n\r\n    return this.instance.$el\r\n  }\r\n\r\n  setLoading(val: boolean) {\r\n    this.instance.setLoading(val)\r\n  }\r\n\r\n  update(offset: number, total: number) {\r\n    this.instance.update(offset, total)\r\n  }\r\n\r\n  next() {\r\n    this.instance.next()\r\n  }\r\n\r\n  getHasMore(): boolean {\r\n    return this.instance.getHasMore()\r\n  }\r\n\r\n  getIsClearComments(): boolean {\r\n    return true\r\n  }\r\n\r\n  dispose(): void {\r\n    this.instance.$el.remove()\r\n  }\r\n}\r\n","import type { ArtalkConfig, ContextApi } from '@/types'\r\nimport $t from '@/i18n'\r\nimport { Paginator } from './paginator'\r\nimport ReadMorePaginator from './paginator/read-more'\r\nimport UpDownPaginator from './paginator/up-down'\r\n\r\nfunction createPaginatorByConf(conf: Pick<ArtalkConfig, 'pagination'>): Paginator {\r\n  if (conf.pagination.readMore) return new ReadMorePaginator()\r\n  return new UpDownPaginator()\r\n}\r\n\r\nfunction getPageDataByLastData(ctx: ContextApi): {\r\n  offset: number\r\n  total: number\r\n} {\r\n  const last = ctx.getData().getListLastFetch()\r\n  const r = { offset: 0, total: 0 }\r\n  if (!last) return r\r\n\r\n  r.offset = last.params.offset\r\n  if (last.data) r.total = last.params.flatMode ? last.data.count : last.data.roots_count\r\n\r\n  return r\r\n}\r\n\r\nexport const initListPaginatorFunc = (ctx: ContextApi) => {\r\n  let paginator: Paginator | null = null\r\n\r\n  // Init paginator when conf loaded\r\n  ctx.watchConf(['pagination', 'locale'], (conf) => {\r\n    const list = ctx.get('list')\r\n\r\n    if (paginator) paginator.dispose() // if had been init, dispose it\r\n\r\n    // create paginator instance\r\n    paginator = createPaginatorByConf(conf)\r\n\r\n    // create paginator dom\r\n    const { offset, total } = getPageDataByLastData(ctx)\r\n    const $paginator = paginator.create({\r\n      ctx,\r\n      pageSize: conf.pagination.pageSize,\r\n      total,\r\n\r\n      readMoreAutoLoad: conf.pagination.autoLoad,\r\n    })\r\n\r\n    // mount paginator dom\r\n    list.$commentsWrap.after($paginator)\r\n\r\n    // update paginator info\r\n    paginator?.update(offset, total)\r\n  })\r\n\r\n  // When list loaded\r\n  ctx.on('list-loaded', (comments) => {\r\n    // update paginator info\r\n    const { offset, total } = getPageDataByLastData(ctx)\r\n    paginator?.update(offset, total)\r\n  })\r\n\r\n  // When list fetch\r\n  ctx.on('list-fetch', (params) => {\r\n    // if clear comments when fetch new page data\r\n    if (ctx.getData().getComments().length > 0 && paginator?.getIsClearComments(params)) {\r\n      ctx.getData().clearComments()\r\n    }\r\n  })\r\n\r\n  // When list error\r\n  ctx.on('list-failed', () => {\r\n    paginator?.showErr?.($t('loadFail'))\r\n  })\r\n\r\n  // loading\r\n  ctx.on('list-fetch', (params) => {\r\n    paginator?.setLoading(true)\r\n  })\r\n  ctx.on('list-fetched', ({ params }) => {\r\n    paginator?.setLoading(false)\r\n  })\r\n}\r\n","import type { ContextApi } from '@/types'\r\nimport Component from '@/lib/component'\r\nimport * as Utils from '@/lib/utils'\r\nimport { CommentNode } from '@/comment'\r\nimport ListHTML from './list.html?raw'\r\nimport { ListLayout } from './layout'\r\nimport { createCommentNode } from './comment'\r\nimport { initListPaginatorFunc } from './page'\r\n\r\nexport default class List extends Component {\r\n  /** 列表评论集区域元素 */\r\n  $commentsWrap!: HTMLElement\r\n  public getCommentsWrapEl() {\r\n    return this.$commentsWrap\r\n  }\r\n\r\n  protected commentNodes: CommentNode[] = []\r\n  getCommentNodes() {\r\n    return this.commentNodes\r\n  }\r\n\r\n  constructor(ctx: ContextApi) {\r\n    super(ctx)\r\n\r\n    // Init base element\r\n    this.$el = Utils.createElement(ListHTML)\r\n    this.$commentsWrap = this.$el.querySelector('.atk-list-comments-wrap')!\r\n\r\n    // Init paginator\r\n    initListPaginatorFunc(ctx)\r\n\r\n    // Bind events\r\n    this.initCrudEvents()\r\n  }\r\n\r\n  getListLayout({ forceFlatMode }: { forceFlatMode?: boolean } = {}) {\r\n    return new ListLayout({\r\n      $commentsWrap: this.$commentsWrap,\r\n      nestSortBy: this.ctx.conf.nestSort,\r\n      nestMax: this.ctx.conf.nestMax,\r\n      flatMode:\r\n        typeof forceFlatMode === 'boolean' ? forceFlatMode : (this.ctx.conf.flatMode as boolean),\r\n      // flatMode must be boolean because it had been handled when Artalk.init\r\n      createCommentNode: (d, r) => {\r\n        const node = createCommentNode(this.ctx, d, r, { forceFlatMode })\r\n        this.commentNodes.push(node) // store node instance\r\n        return node\r\n      },\r\n      findCommentNode: (id) => this.commentNodes.find((c) => c.getID() === id),\r\n    })\r\n  }\r\n\r\n  private initCrudEvents() {\r\n    this.ctx.on('list-load', (comments) => {\r\n      // 导入数据\r\n      this.getListLayout().import(comments)\r\n    })\r\n\r\n    this.ctx.on('list-loaded', (comments) => {\r\n      if (comments.length === 0) {\r\n        this.commentNodes = []\r\n        this.$commentsWrap.innerHTML = ''\r\n      }\r\n    })\r\n\r\n    // When comment insert\r\n    this.ctx.on('comment-inserted', (comment) => {\r\n      const replyComment = comment.rid\r\n        ? this.commentNodes.find((c) => c.getID() === comment.rid)?.getData()\r\n        : undefined\r\n      this.getListLayout().insert(comment, replyComment)\r\n    })\r\n\r\n    // When comment delete\r\n    this.ctx.on('comment-deleted', (comment) => {\r\n      const node = this.commentNodes.find((c) => c.getID() === comment.id)\r\n      if (!node) {\r\n        console.error(`comment node id=${comment.id} not found`)\r\n        return\r\n      }\r\n      node.remove()\r\n      this.commentNodes = this.commentNodes.filter((c) => c.getID() !== comment.id)\r\n      // TODO: remove child nodes\r\n    })\r\n\r\n    // When comment update\r\n    this.ctx.on('comment-updated', (comment) => {\r\n      const node = this.commentNodes.find((c) => c.getID() === comment.id)\r\n      node && node.setData(comment)\r\n    })\r\n  }\r\n}\r\n","export default \"<div class=\\\"atk-list\\\">\\r\\n  <div class=\\\"atk-list-header\\\">\\r\\n    <div class=\\\"atk-comment-count\\\">\\r\\n      <div class=\\\"atk-text\\\"></div>\\r\\n    </div>\\r\\n    <div class=\\\"atk-right-action\\\">\\r\\n      <span data-action=\\\"admin-close-comment\\\" class=\\\"atk-hide\\\" atk-only-admin-show></span>\\r\\n      <span data-action=\\\"open-sidebar\\\" class=\\\"atk-hide atk-on\\\">\\r\\n        <span class=\\\"atk-unread-badge\\\" style=\\\"display: none\\\"></span>\\r\\n        <div class=\\\"atk-text\\\"></div>\\r\\n      </span>\\r\\n    </div>\\r\\n  </div>\\r\\n  <div class=\\\"atk-list-body\\\">\\r\\n    <div class=\\\"atk-list-comments-wrap\\\"></div>\\r\\n  </div>\\r\\n  <div class=\\\"atk-list-footer\\\">\\r\\n    <div class=\\\"atk-copyright\\\"></div>\\r\\n  </div>\\r\\n</div>\\r\\n\"","import type { ContextApi, CommentData } from '@/types'\r\nimport { CommentNode } from '@/comment'\r\n\r\ninterface CreateCommentNodeOptions {\r\n  forceFlatMode?: boolean\r\n}\r\n\r\nexport function createCommentNode(\r\n  ctx: ContextApi,\r\n  comment: CommentData,\r\n  replyComment?: CommentData,\r\n  opts?: CreateCommentNodeOptions,\r\n): CommentNode {\r\n  const instance = new CommentNode(comment, {\r\n    onAfterRender: () => {\r\n      ctx.trigger('comment-rendered', instance)\r\n    },\r\n    onDelete: (c: CommentNode) => {\r\n      ctx.getData().deleteComment(c.getID())\r\n    },\r\n\r\n    replyTo: replyComment,\r\n\r\n    // TODO simplify reference\r\n    flatMode:\r\n      typeof opts?.forceFlatMode === 'boolean'\r\n        ? opts?.forceFlatMode\r\n        : (ctx.conf.flatMode as boolean),\r\n    gravatar: ctx.conf.gravatar,\r\n    nestMax: ctx.conf.nestMax,\r\n    heightLimit: ctx.conf.heightLimit,\r\n    avatarURLBuilder: ctx.conf.avatarURLBuilder,\r\n    scrollRelativeTo: ctx.conf.scrollRelativeTo,\r\n    vote: ctx.conf.vote,\r\n    voteDown: ctx.conf.voteDown,\r\n    uaBadge: ctx.conf.uaBadge,\r\n\r\n    // TODO: move to plugin folder and remove from core\r\n    getApi: () => ctx.getApi(),\r\n    replyComment: (c, $el) => ctx.replyComment(c, $el),\r\n    editComment: (c, $el) => ctx.editComment(c, $el),\r\n  })\r\n\r\n  // 渲染元素\r\n  instance.render()\r\n\r\n  return instance\r\n}\r\n","import * as Ui from '@/lib/ui'\r\n\r\nlet bodyOrgOverflow: string\r\nlet bodyOrgPaddingRight: string\r\n\r\nexport function getScrollbarHelper() {\r\n  return {\r\n    init() {\r\n      bodyOrgOverflow = document.body.style.overflow\r\n      bodyOrgPaddingRight = document.body.style.paddingRight\r\n    },\r\n\r\n    unlock() {\r\n      document.body.style.overflow = bodyOrgOverflow\r\n      document.body.style.paddingRight = bodyOrgPaddingRight\r\n    },\r\n\r\n    lock() {\r\n      document.body.style.overflow = 'hidden'\r\n      const barPaddingRight = parseInt(\r\n        window.getComputedStyle(document.body, null).getPropertyValue('padding-right'),\r\n        10,\r\n      )\r\n      document.body.style.paddingRight = `${Ui.getScrollBarWidth() + barPaddingRight || 0}px`\r\n    },\r\n  }\r\n}\r\n","export interface LayerOptions {\r\n  onShow: () => void\r\n  onHide: () => void\r\n}\r\n\r\nexport class Layer {\r\n  private allowMaskClose = true\r\n  private onAfterHide?: () => void\r\n\r\n  constructor(\r\n    private $el: HTMLElement,\r\n    private opts: LayerOptions,\r\n  ) {}\r\n\r\n  setOnAfterHide(func: () => void) {\r\n    this.onAfterHide = func\r\n  }\r\n\r\n  setAllowMaskClose(allow: boolean) {\r\n    this.allowMaskClose = allow\r\n  }\r\n\r\n  getAllowMaskClose() {\r\n    return this.allowMaskClose\r\n  }\r\n\r\n  getEl() {\r\n    return this.$el\r\n  }\r\n\r\n  show() {\r\n    this.opts.onShow()\r\n    this.$el.style.display = ''\r\n  }\r\n\r\n  async hide() {\r\n    this.opts.onHide()\r\n    // this.$el.style.display = 'none'\r\n    this.onAfterHide && this.onAfterHide()\r\n  }\r\n\r\n  async destroy() {\r\n    this.opts.onHide()\r\n    this.$el.remove()\r\n    this.onAfterHide && this.onAfterHide()\r\n  }\r\n}\r\n","import * as Utils from '@/lib/utils'\r\nimport { getScrollbarHelper } from './scrollbar-helper'\r\nimport { Layer } from './layer'\r\n\r\nexport class LayerWrap {\r\n  private $wrap: HTMLElement\r\n  private $mask: HTMLElement\r\n  private items: Layer[] = []\r\n\r\n  constructor() {\r\n    this.$wrap = Utils.createElement(\r\n      `<div class=\"atk-layer-wrap\" style=\"display: none;\"><div class=\"atk-layer-mask\"></div></div>`,\r\n    )\r\n    this.$mask = this.$wrap.querySelector<HTMLElement>('.atk-layer-mask')!\r\n  }\r\n\r\n  createItem(name: string, el?: HTMLElement) {\r\n    // init element\r\n    el = el || this.createItemElement(name)\r\n    el.setAttribute('data-layer-name', name)\r\n    this.$wrap.appendChild(el)\r\n\r\n    // create layer instance\r\n    const layer = new Layer(el, {\r\n      onHide: () => this.hideWrap(el!),\r\n      onShow: () => this.showWrap(),\r\n    })\r\n\r\n    // register mask click event\r\n    this.getMask().addEventListener('click', () => {\r\n      layer.getAllowMaskClose() && layer.hide()\r\n    })\r\n\r\n    // add to items\r\n    this.items.push(layer)\r\n\r\n    return layer\r\n  }\r\n\r\n  private createItemElement(name: string) {\r\n    const el = document.createElement('div')\r\n    el.classList.add('atk-layer-item')\r\n    el.style.display = 'none'\r\n    this.$wrap.appendChild(el)\r\n    return el\r\n  }\r\n\r\n  getWrap() {\r\n    return this.$wrap\r\n  }\r\n\r\n  getMask() {\r\n    return this.$mask\r\n  }\r\n\r\n  showWrap() {\r\n    this.$wrap.style.display = 'block'\r\n    this.$mask.style.display = 'block'\r\n    this.$mask.style.backdropFilter = 'blur(10px)'\r\n    this.$mask.classList.add('atk-fade-in')\r\n    getScrollbarHelper().lock()\r\n  }\r\n\r\n  hideWrap($el: HTMLElement) {\r\n    // if wrap contains more than one item, do not hide entire wrap\r\n    if (\r\n      this.items\r\n        .map((l) => l.getEl())\r\n        .filter((e) => e !== $el && e.isConnected && e.style.display !== 'none').length > 0\r\n    ) {\r\n      return\r\n    }\r\n    this.$mask.style.backdropFilter = 'blur(0)'\r\n    setTimeout(() => {\r\n      this.$wrap.style.display = 'none'\r\n      getScrollbarHelper().unlock()\r\n    }, 350)\r\n  }\r\n}\r\n","import type { ContextApi } from '@/types'\r\nimport { getScrollbarHelper } from './scrollbar-helper'\r\nimport { LayerWrap } from './wrap'\r\n\r\nexport class LayerManager {\r\n  private wrap: LayerWrap\r\n\r\n  constructor(ctx: ContextApi) {\r\n    this.wrap = new LayerWrap()\r\n    document.body.appendChild(this.wrap.getWrap())\r\n\r\n    ctx.on('unmounted', () => {\r\n      this.wrap.getWrap().remove()\r\n    })\r\n\r\n    // 记录页面原始 CSS 属性\r\n    getScrollbarHelper().init()\r\n  }\r\n\r\n  getEl() {\r\n    return this.wrap.getWrap()\r\n  }\r\n\r\n  create(name: string, el?: HTMLElement) {\r\n    return this.wrap.createItem(name, el)\r\n  }\r\n}\r\n","import type { LocalUser } from '@/types'\r\n\r\nconst LOCAL_USER_KEY = 'ArtalkUser'\r\n\r\ninterface UserOpts {\r\n  onUserChanged?: (user: LocalUser) => void\r\n}\r\n\r\nclass User {\r\n  private data: LocalUser\r\n\r\n  constructor(private opts: UserOpts) {\r\n    // Import from localStorage\r\n    const localUser = JSON.parse(window.localStorage.getItem(LOCAL_USER_KEY) || '{}')\r\n\r\n    // Initialize\r\n    this.data = {\r\n      nick: localUser.nick || '',\r\n      email: localUser.email || '',\r\n      link: localUser.link || '',\r\n      token: localUser.token || '',\r\n      isAdmin: localUser.isAdmin || false,\r\n    }\r\n  }\r\n\r\n  getData() {\r\n    return this.data\r\n  }\r\n\r\n  /** Update user data and save to localStorage */\r\n  update(obj: Partial<LocalUser> = {}) {\r\n    Object.entries(obj).forEach(([key, value]) => {\r\n      this.data[key] = value\r\n    })\r\n\r\n    window.localStorage.setItem(LOCAL_USER_KEY, JSON.stringify(this.data))\r\n    this.opts.onUserChanged && this.opts.onUserChanged(this.data)\r\n  }\r\n\r\n  /**\r\n   * Logout\r\n   *\r\n   * @description Logout will clear login status, but not clear user data (nick, email, link)\r\n   */\r\n  logout() {\r\n    this.update({\r\n      token: '',\r\n      isAdmin: false,\r\n    })\r\n  }\r\n\r\n  /** Check if user has filled basic data */\r\n  checkHasBasicUserInfo() {\r\n    return !!this.data.nick && !!this.data.email\r\n  }\r\n}\r\n\r\nexport default User\r\n","import type { ContextApi } from '@/types'\r\nimport CheckerLauncher from './components/checker'\r\nimport Editor from './editor/editor'\r\nimport SidebarLayer from './layer/sidebar-layer'\r\n\r\nimport List from './list/list'\r\n\r\nimport * as I18n from './i18n'\r\nimport { PlugManager } from './plugins/editor-kit'\r\nimport { LayerManager } from './layer/layer-manager'\r\nimport User from './lib/user'\r\n\r\n/**\r\n * Services\r\n *\r\n * @description Call these services by `ctx.get('serviceName')` or `ctx.serviceName`\r\n */\r\nconst services = {\r\n  // I18n\r\n  i18n(ctx: ContextApi) {\r\n    I18n.setLocale(ctx.conf.locale)\r\n\r\n    ctx.watchConf(['locale'], (conf) => {\r\n      I18n.setLocale(conf.locale)\r\n    })\r\n  },\r\n\r\n  // User Store\r\n  user(ctx: ContextApi) {\r\n    const user = new User({\r\n      onUserChanged: (data) => {\r\n        ctx.trigger('user-changed', data)\r\n      },\r\n    })\r\n    return user\r\n  },\r\n\r\n  // 弹出层\r\n  layerManager(ctx: ContextApi) {\r\n    return new LayerManager(ctx)\r\n  },\r\n\r\n  // CheckerLauncher\r\n  checkerLauncher(ctx: ContextApi) {\r\n    const checkerLauncher = new CheckerLauncher({\r\n      getCtx: () => ctx,\r\n      getApi: () => ctx.getApi(),\r\n      onReload: () => ctx.reload(),\r\n\r\n      // make sure suffix with a slash, because it will be used as a base url when call `fetch`\r\n      getCaptchaIframeURL: () => `${ctx.conf.server}/api/v2/captcha/?t=${+new Date()}`,\r\n    })\r\n    return checkerLauncher\r\n  },\r\n\r\n  // 编辑器\r\n  editor(ctx: ContextApi) {\r\n    const editor = new Editor(ctx)\r\n    ctx.$root.appendChild(editor.$el)\r\n    return editor\r\n  },\r\n\r\n  // 评论列表\r\n  list(ctx: ContextApi): List {\r\n    const list = new List(ctx)\r\n    ctx.$root.appendChild(list.$el)\r\n    return list\r\n  },\r\n\r\n  // 侧边栏 Layer\r\n  sidebarLayer(ctx: ContextApi) {\r\n    const sidebarLayer = new SidebarLayer(ctx)\r\n    return sidebarLayer\r\n  },\r\n\r\n  // Extra Service\r\n  // -----------------------------------------\r\n  // Only for type check\r\n  // Not inject to ctx immediately,\r\n  // but can be injected by other occasions\r\n\r\n  editorPlugs(): PlugManager | undefined {\r\n    return undefined\r\n  },\r\n}\r\n\r\nexport default services\r\n\r\n// type tricks for dependency injection\r\ntype TServiceImps = typeof services\r\ntype TObjectWithFuncs = { [k: string]: (...args: any) => any }\r\ntype TKeysOnlyReturn<T extends TObjectWithFuncs, V> = {\r\n  [K in keyof T]: ReturnType<T[K]> extends V ? K : never\r\n}[keyof T]\r\ntype TOmitConditions = TKeysOnlyReturn<TServiceImps, void>\r\ntype TServiceInjectors = Omit<TServiceImps, TOmitConditions>\r\nexport type TInjectedServices = {\r\n  [K in keyof TServiceInjectors]: ReturnType<TServiceInjectors[K]>\r\n}\r\n","import type { ContextApi, ArtalkPlugin, ArtalkConfig } from '@/types'\r\nimport { Api } from '@/api'\r\n\r\nexport interface CountOptions {\r\n  getApi(): Api\r\n\r\n  siteName: string\r\n  pageKey?: string\r\n  pageTitle?: string\r\n  countEl: string\r\n  pvEl: string\r\n\r\n  /** 是否增加当前页面 PV 数 */\r\n  pvAdd?: boolean\r\n}\r\n\r\nexport const PvCountWidget: ArtalkPlugin = (ctx: ContextApi) => {\r\n  ctx.watchConf(['site', 'pageKey', 'pageTitle', 'countEl', 'pvEl'], (conf) => {\r\n    initCountWidget({\r\n      getApi: () => ctx.getApi(),\r\n      siteName: conf.site,\r\n      pageKey: conf.pageKey,\r\n      pageTitle: conf.pageTitle,\r\n      countEl: conf.countEl,\r\n      pvEl: conf.pvEl,\r\n      pvAdd: typeof ctx.conf.pvAdd === 'boolean' ? ctx.conf.pvAdd : true,\r\n    })\r\n  })\r\n}\r\n\r\n/** 初始化评论数和 PV 数量展示元素 */\r\nexport async function initCountWidget(opt: CountOptions) {\r\n  // 评论数\r\n  if (opt.countEl && document.querySelector(opt.countEl)) {\r\n    refreshStatCount(opt, { query: 'page_comment', numEl: opt.countEl })\r\n  }\r\n\r\n  // PV\r\n  const initialData =\r\n    opt.pvAdd && opt.pageKey\r\n      ? {\r\n          [opt.pageKey]: (\r\n            await opt.getApi().pages.logPv({\r\n              page_key: opt.pageKey,\r\n              page_title: opt.pageTitle,\r\n              site_name: opt.siteName,\r\n            })\r\n          ).data.pv, // pv+1 and get pv count\r\n        }\r\n      : undefined\r\n\r\n  if (opt.pvEl && document.querySelector(opt.pvEl)) {\r\n    refreshStatCount(opt, {\r\n      query: 'page_pv',\r\n      numEl: opt.pvEl,\r\n      data: initialData,\r\n    })\r\n  }\r\n}\r\n\r\ntype CountData = { [pageKey: string]: number }\r\n\r\nasync function refreshStatCount(\r\n  opt: CountOptions,\r\n  args: {\r\n    query: 'page_pv' | 'page_comment'\r\n    numEl: string\r\n    data?: CountData\r\n  },\r\n) {\r\n  let data: CountData = args.data || {}\r\n\r\n  // Get page keys which will be queried\r\n  let queryPageKeys = Array.from(document.querySelectorAll(args.numEl))\r\n    .map((e) => e.getAttribute('data-page-key') || opt.pageKey)\r\n    .filter((k) => k && typeof data[k] !== 'number') // filter out keys that already have data\r\n\r\n  queryPageKeys = [...new Set(queryPageKeys)] // deduplicate\r\n\r\n  // Fetch count data from server\r\n  if (queryPageKeys.length > 0) {\r\n    const res = (\r\n      await opt.getApi().stats.getStats(args.query, {\r\n        page_keys: queryPageKeys.join(','),\r\n        site_name: opt.siteName,\r\n      })\r\n    ).data.data as CountData\r\n    data = { ...data, ...res }\r\n  }\r\n\r\n  const defaultCount = opt.pageKey ? data[opt.pageKey] : 0\r\n  applyCountData(args.numEl, data, defaultCount)\r\n}\r\n\r\nfunction applyCountData(selector: string, data: CountData, defaultCount: number) {\r\n  document.querySelectorAll(selector).forEach((el) => {\r\n    const pageKey = el.getAttribute('data-page-key')\r\n    const count = Number(pageKey ? data[pageKey] : defaultCount)\r\n    el.innerHTML = `${count}`\r\n  })\r\n}\r\n","import * as Utils from '@/lib/utils'\r\nimport * as Ui from '@/lib/ui'\r\nimport $t from '@/i18n'\r\n\r\nexport interface ErrorDialogOptions {\r\n  $err: HTMLElement\r\n\r\n  errMsg: string\r\n  errData?: any\r\n  retryFn?: () => void\r\n\r\n  onOpenSidebar?: () => void\r\n}\r\n\r\nexport function showErrorDialog(opts: ErrorDialogOptions) {\r\n  const errEl = Utils.createElement(`<span><span class=\"error-message\"></span><br/><br/></span>`)\r\n  errEl.querySelector<HTMLElement>('.error-message')!.innerText =\r\n    `${$t('listLoadFailMsg')}\\n${opts.errMsg}`\r\n\r\n  if (opts.retryFn) {\r\n    const $retryBtn = Utils.createElement(`<span style=\"cursor:pointer;\">${$t('listRetry')}</span>`)\r\n    $retryBtn.onclick = () => opts.retryFn && opts.retryFn()\r\n    errEl.appendChild($retryBtn)\r\n  }\r\n\r\n  if (opts.onOpenSidebar) {\r\n    const $openSidebar = Utils.createElement(\r\n      `<span atk-only-admin-show> | <span style=\"cursor:pointer;\">${$t('openName', { name: $t('ctrlCenter') })}</span></span>`,\r\n    )\r\n    errEl.appendChild($openSidebar)\r\n    $openSidebar.onclick = () => opts.onOpenSidebar && opts.onOpenSidebar()\r\n  }\r\n\r\n  Ui.setError(opts.$err, errEl)\r\n}\r\n","import type { ArtalkPlugin } from '@/types'\r\nimport * as marked from '@/lib/marked'\r\n\r\nexport const Markdown: ArtalkPlugin = (ctx) => {\r\n  marked.initMarked()\r\n\r\n  ctx.on('updated', (conf) => {\r\n    if (conf.markedReplacers) marked.setReplacers(conf.markedReplacers)\r\n  })\r\n}\r\n","import $t from '@/i18n'\r\nimport type PlugKit from './_kit'\r\nimport EditorPlug from './_plug'\r\n\r\nconst LocalStorageKey = 'ArtalkContent'\r\n\r\nexport default class LocalStorage extends EditorPlug {\r\n  constructor(kit: PlugKit) {\r\n    super(kit)\r\n\r\n    const onContentUpdated = () => {\r\n      this.save()\r\n    }\r\n\r\n    this.kit.useMounted(() => {\r\n      // load editor content from localStorage when init\r\n      const localContent = window.localStorage.getItem(LocalStorageKey) || ''\r\n      if (localContent.trim() !== '') {\r\n        this.kit.useEditor().showNotify($t('restoredMsg'), 'i')\r\n        this.kit.useEditor().setContent(localContent)\r\n      }\r\n\r\n      // bind event\r\n      this.kit.useEvents().on('content-updated', onContentUpdated)\r\n    })\r\n\r\n    this.kit.useUnmounted(() => {\r\n      this.kit.useEvents().off('content-updated', onContentUpdated)\r\n    })\r\n  }\r\n\r\n  // Save editor content to localStorage\r\n  public save() {\r\n    window.localStorage.setItem(LocalStorageKey, this.kit.useEditor().getContentRaw().trim())\r\n  }\r\n}\r\n","import type { CommentData } from '@/types'\r\nimport * as Utils from '@/lib/utils'\r\nimport type PlugKit from './_kit'\r\n\r\nexport default class SubmitAddPreset {\r\n  constructor(private kit: PlugKit) {}\r\n\r\n  async reqAdd() {\r\n    const nComment = (\r\n      await this.kit.useApi().comments.createComment({\r\n        ...(await this.getSubmitAddParams()),\r\n      })\r\n    ).data\r\n    return nComment\r\n  }\r\n\r\n  async getSubmitAddParams() {\r\n    const { nick, email, link } = this.kit.useUser().getData()\r\n    const conf = this.kit.useConf()\r\n\r\n    return {\r\n      content: this.kit.useEditor().getContentFinal(),\r\n      name: nick,\r\n      email,\r\n      link,\r\n      rid: 0,\r\n      page_key: conf.pageKey,\r\n      page_title: conf.pageTitle,\r\n      site_name: conf.site,\r\n      ua: await Utils.getCorrectUserAgent(), // Get the corrected UA\r\n    }\r\n  }\r\n\r\n  postSubmitAdd(commentNew: CommentData) {\r\n    // insert the new comment to list\r\n    this.kit.useGlobalCtx().getData().insertComment(commentNew)\r\n  }\r\n}\r\n","import type { CommentData } from '@/types'\r\nimport $t from '@/i18n'\r\nimport EditorPlug from './_plug'\r\nimport type PlugKit from './_kit'\r\nimport SubmitAddPreset from './submit-add'\r\n\r\ninterface CustomSubmit {\r\n  activeCond: () => void\r\n  pre?: () => void\r\n  req?: () => Promise<CommentData>\r\n  /** The `post` method is called after the comment is successfully submitted */\r\n  post?: (nComment: CommentData) => void\r\n}\r\n\r\nexport default class Submit extends EditorPlug {\r\n  private customs: CustomSubmit[] = []\r\n  private defaultPreset: SubmitAddPreset\r\n\r\n  constructor(kit: PlugKit) {\r\n    super(kit)\r\n\r\n    this.defaultPreset = new SubmitAddPreset(this.kit)\r\n\r\n    const onEditorSubmit = () => this.do()\r\n\r\n    this.kit.useMounted(() => {\r\n      // invoke `do()` when event `editor-submit` is triggered\r\n      this.kit.useGlobalCtx().on('editor-submit', onEditorSubmit)\r\n    })\r\n    this.kit.useUnmounted(() => {\r\n      this.kit.useGlobalCtx().off('editor-submit', onEditorSubmit)\r\n    })\r\n  }\r\n\r\n  registerCustom(c: CustomSubmit) {\r\n    this.customs.push(c)\r\n  }\r\n\r\n  private async do() {\r\n    if (this.kit.useEditor().getContentFinal().trim() === '') {\r\n      this.kit.useEditor().focus()\r\n      return\r\n    }\r\n\r\n    const custom = this.customs.find((o) => o.activeCond())\r\n\r\n    this.kit.useEditor().showLoading()\r\n\r\n    try {\r\n      // pre submit\r\n      if (custom?.pre) custom.pre()\r\n\r\n      let nComment: CommentData\r\n\r\n      // submit request\r\n      if (custom?.req) nComment = await custom.req()\r\n      else nComment = await this.defaultPreset.reqAdd()\r\n\r\n      // post submit\r\n      if (custom?.post) custom.post(nComment)\r\n      else this.defaultPreset.postSubmitAdd(nComment)\r\n    } catch (err: any) {\r\n      // submit error\r\n      console.error(err)\r\n      this.kit.useEditor().showNotify(`${$t('commentFail')}: ${err.message || String(err)}`, 'e')\r\n      return\r\n    } finally {\r\n      this.kit.useEditor().hideLoading()\r\n    }\r\n\r\n    this.kit.useEditor().reset() // 复原编辑器\r\n    this.kit.useGlobalCtx().trigger('editor-submitted')\r\n  }\r\n}\r\n","import './emoticons.scss'\r\n\r\nimport type { EmoticonListData, EmoticonGrpData } from '@/types'\r\nimport * as Utils from '@/lib/utils'\r\nimport * as Ui from '@/lib/ui'\r\nimport $t from '@/i18n'\r\nimport EditorPlug from './_plug'\r\nimport type PlugKit from './_kit'\r\n\r\ntype OwOFormatType = {\r\n  [key: string] : {\r\n    type: 'emoticon'|'emoji'|'image',\r\n    container: {icon: string, text: string, notitle: string}[]\r\n  }\r\n}\r\n\r\nexport default class Emoticons extends EditorPlug {\r\n  private emoticons: EmoticonListData = []\r\n  private loadingTask: Promise<void> | null = null\r\n\r\n  private $grpWrap!: HTMLElement\r\n  private $grpSwitcher!: HTMLElement\r\n\r\n  constructor(kit: PlugKit) {\r\n    super(kit)\r\n\r\n    this.kit.useMounted(() => {\r\n      this.usePanel(`<div class=\"atk-editor-plug-emoticons\"></div>`)\r\n      //this.useBtn(`<i aria-label=\"${$t('emoticon')}\"><svg fill=\"currentColor\" aria-hidden=\"true\" height=\"14\" viewBox=\"0 0 14 14\" width=\"14\"><path d=\"m4.26829 5.29294c0-.94317.45893-1.7074 1.02439-1.7074.56547 0 1.02439.76423 1.02439 1.7074s-.45892 1.7074-1.02439 1.7074c-.56546 0-1.02439-.76423-1.02439-1.7074zm4.43903 1.7074c.56546 0 1.02439-.76423 1.02439-1.7074s-.45893-1.7074-1.02439-1.7074c-.56547 0-1.02439.76423-1.02439 1.7074s.45892 1.7074 1.02439 1.7074zm-1.70732 2.73184c-1.51883 0-2.06312-1.52095-2.08361-1.58173l-1.29551.43231c.03414.10244.868 2.51604 3.3798 2.51604 2.51181 0 3.34502-2.41291 3.37982-2.51604l-1.29484-.43573c-.02254.06488-.56683 1.58583-2.08498 1.58583zm7-2.73252c0 3.86004-3.1401 7.00034-7 7.00034s-7-3.1396-7-6.99966c0-3.86009 3.1401-7.00034 7-7.00034s7 3.14025 7 7.00034zm-1.3659 0c0-3.10679-2.5275-5.63442-5.6341-5.63442-3.10663 0-5.63415 2.52832-5.63415 5.6351 0 3.10676 2.52752 5.63446 5.63415 5.63446 3.1066 0 5.6341-2.5277 5.6341-5.63446z\" fill=\"#000\"/></svg></i>`)\r\n      this.useBtn($t('emoticon'))\r\n    })\r\n    this.kit.useUnmounted(() => {})\r\n\r\n    this.useContentTransformer((raw) => this.transEmoticonImageText(raw))\r\n    this.usePanelShow(() => {\r\n      ;(async () => {\r\n        await this.loadEmoticonsData()\r\n\r\n        // 初始化元素\r\n        if (!this.isImgLoaded) {\r\n          this.initEmoticonsList()\r\n          this.isImgLoaded = true\r\n        }\r\n\r\n        // 延迟执行，防止无法读取高度\r\n        setTimeout(() => {\r\n          this.changeListHeight()\r\n        }, 30)\r\n      })()\r\n    })\r\n    this.usePanelHide(() => {\r\n      this.$panel!.parentElement!.style.height = ''\r\n    })\r\n\r\n    // 表情包预加载\r\n    window.setTimeout(() => {\r\n      this.loadEmoticonsData()\r\n    }, 1000) // 延迟 1s 加载\r\n  }\r\n\r\n  private isListLoaded = false\r\n  private isImgLoaded = false\r\n\r\n  public async loadEmoticonsData() {\r\n    if (this.isListLoaded) return\r\n    if (this.loadingTask !== null) {\r\n      await this.loadingTask\r\n      return\r\n    }\r\n\r\n    // 数据处理\r\n    this.loadingTask = (async () => {\r\n      Ui.showLoading(this.$panel!)\r\n      this.emoticons = await this.handleData(this.kit.useConf().emoticons)\r\n      Ui.hideLoading(this.$panel!)\r\n      this.loadingTask = null\r\n      this.isListLoaded = true\r\n    })()\r\n    await this.loadingTask\r\n  }\r\n\r\n  private async handleData(data: any): Promise<any[]> {\r\n    if (!Array.isArray(data) && ['object', 'string'].includes(typeof data)) {\r\n      data = [data]\r\n    }\r\n\r\n    if (!Array.isArray(data)) {\r\n      Ui.setError(this.$panel!, `[${$t('emoticon')}] Data must be of Array/Object/String type`)\r\n      Ui.hideLoading(this.$panel!)\r\n      return []\r\n    }\r\n\r\n    const pushGrp = (grp: EmoticonGrpData) => {\r\n      if (typeof grp !== 'object') return\r\n      if (grp.name && data.find((o) => o.name === grp.name)) return\r\n      data.push(grp)\r\n    }\r\n\r\n    // 加载子内容\r\n    const remoteLoad = async (d: any[]) => {\r\n      await Promise.all(\r\n        d.map(async (grp, index) => {\r\n          if (typeof grp === 'object' && !Array.isArray(grp)) {\r\n            pushGrp(grp)\r\n          } else if (Array.isArray(grp)) {\r\n            await remoteLoad(grp)\r\n          } else if (typeof grp === 'string') {\r\n            const grpData = await this.remoteLoad(grp)\r\n\r\n            if (Array.isArray(grpData)) await remoteLoad(grpData)\r\n            else if (typeof grpData === 'object') pushGrp(grpData)\r\n          }\r\n        }),\r\n      )\r\n    }\r\n    await remoteLoad(data)\r\n\r\n    // 处理数组数据\r\n    data.forEach((item: any) => {\r\n      if (this.isOwOFormat(item)) {\r\n        const c = this.convertOwO(item)\r\n        c.forEach((grp) => {\r\n          pushGrp(grp)\r\n        })\r\n      } else if (Array.isArray(item)) {\r\n        item.forEach((grp) => {\r\n          pushGrp(grp)\r\n        })\r\n      }\r\n    })\r\n\r\n    // 剔除非法数据\r\n    data = data.filter(\r\n      (item: any) => typeof item === 'object' && !Array.isArray(item) && !!item && !!item.name,\r\n    )\r\n\r\n    // console.log(data)\r\n\r\n    this.solveNullKey(data)\r\n    this.solveSameKey(data)\r\n\r\n    return data\r\n  }\r\n\r\n  /** 远程加载 */\r\n  private async remoteLoad(url: string): Promise<any> {\r\n    if (!url) return []\r\n\r\n    try {\r\n      const resp = await fetch(url)\r\n      const json = await resp.json()\r\n      return json\r\n    } catch (err) {\r\n      Ui.hideLoading(this.$panel!)\r\n      console.error('[Emoticons] Load Failed:', err)\r\n      Ui.setError(this.$panel!, `[${$t('emoticon')}] ${$t('loadFail')}: ${String(err)}`)\r\n      return []\r\n    }\r\n  }\r\n\r\n  /** 避免表情 item.key 为 null 的情况 */\r\n  private solveNullKey(data: EmoticonGrpData[]) {\r\n    data.forEach((grp) => {\r\n      grp.items.forEach((item, index) => {\r\n        if (!item.key) item.key = `${grp.name} ${index + 1}`\r\n      })\r\n    })\r\n  }\r\n\r\n  /** 避免相同 item.key */\r\n  private solveSameKey(data: EmoticonGrpData[]) {\r\n    const tmp: { [key: string]: number } = {}\r\n    data.forEach((grp) => {\r\n      grp.items.forEach((item) => {\r\n        if (!item.key || String(item.key).trim() === '') return\r\n        if (!tmp[item.key]) tmp[item.key] = 1\r\n        else tmp[item.key]++\r\n\r\n        if (tmp[item.key] > 1) item.key = `${item.key} ${tmp[item.key]}`\r\n      })\r\n    })\r\n  }\r\n\r\n  /** 判断是否为 OwO 格式 */\r\n  private isOwOFormat(data: any) {\r\n    try {\r\n      return (\r\n        typeof data === 'object' &&\r\n        !!Object.values(data).length &&\r\n        Array.isArray(Object.keys(Object.values<any>(data)[0].container)) &&\r\n        Object.keys(Object.values<any>(data)[0].container[0]).includes('icon')\r\n      )\r\n    } catch {\r\n      return false\r\n    }\r\n  }\r\n\r\n  /** 转换 OwO 格式数据 */\r\n  private convertOwO(owoData: OwOFormatType): EmoticonListData {\r\n    const dest: EmoticonListData = []\r\n    Object.entries(owoData).forEach(([grpName, grp]) => {\r\n      const nGrp: EmoticonGrpData = { name: grpName, type: grp.type, items: [] }\r\n      grp.container.forEach((item, index) => {\r\n        // 图片标签提取 src 属性值\r\n        const iconStr = item.icon\r\n        if (/<(img|IMG)/.test(iconStr)) {\r\n          const find = /src=[\"'](.*?)[\"']/.exec(iconStr)\r\n          if (find && find.length > 1) item.icon = find[1]\r\n        }\r\n        nGrp.items.push({ key: item.text || `${grpName} ${index+1}`, val: item.icon, notitle: item.notitle })\r\n      })\r\n      dest.push(nGrp)\r\n    })\r\n    return dest\r\n  }\r\n\r\n  /** 初始化表情列表界面 */\r\n  private initEmoticonsList() {\r\n    // 表情列表\r\n    this.$grpWrap = Utils.createElement(`<div class=\"atk-grp-wrap\"></div>`)\r\n    this.$panel!.append(this.$grpWrap)\r\n\r\n    this.emoticons.forEach((grp, index) => {\r\n      const $grp = Utils.createElement(`<div class=\"atk-grp\" style=\"display: none;\"></div>`)\r\n      this.$grpWrap.append($grp)\r\n      $grp.setAttribute('data-index', String(index))\r\n      $grp.setAttribute('data-grp-name', grp.name)\r\n      $grp.setAttribute('data-type', grp.type)\r\n      grp.items.forEach((item) => {\r\n        const $item = Utils.createElement(`<span class=\"atk-item\"></span>`)\r\n        $grp.append($item)\r\n\r\n        // if (!!item.key && !(new RegExp(`^(${grp.name})?\\\\s?[0-9]+$`).test(item.key)))\r\n        //   $item.setAttribute('title', item.key)\r\n\r\n        if (grp.type === 'image') {\r\n          const imgEl = document.createElement('img')\r\n          const temp = item?.key.replace(/\\s[0-9]/i,'');\r\n          if (item.notitle) {\r\n            imgEl.setAttribute('notitle', item.notitle)\r\n          } else {\r\n            imgEl.alt = temp.slice(temp.indexOf('-') + 1)\r\n          }\r\n          imgEl.dataset.src = item.val\r\n          imgEl.setAttribute('atk-emoticon', item.key)\r\n          if (!imgEl.hasAttribute('loading')) {\r\n            imgEl.setAttribute('loading', 'lazy');\r\n          }\r\n          $item.append(imgEl)\r\n        } else {\r\n          $item.innerText = item.val\r\n        }\r\n\r\n        $item.onclick = e => {\r\n          e.stopPropagation();\r\n          if (grp.type === 'image') {\r\n            this.kit.useEditor().insertContent(`:[${item.key}]`)\r\n          } else {\r\n            this.kit.useEditor().insertContent(item.val || '')\r\n          }\r\n        }\r\n      })\r\n    })\r\n\r\n    // 表情分类切换 bar\r\n    if (this.emoticons.length > 1) {\r\n      this.$grpSwitcher = Utils.createElement(`<div class=\"atk-grp-switcher\"></div>`)\r\n      this.$panel!.append(this.$grpSwitcher)\r\n      this.emoticons.forEach((grp, index) => {\r\n        const $item = Utils.createElement('<span />')\r\n        $item.innerText = grp.name\r\n        $item.setAttribute('data-index', String(index))\r\n        $item.onclick = e => {\r\n          e.stopPropagation();\r\n          this.openGrp(index)\r\n        }\r\n        this.$grpSwitcher.append($item)\r\n      })\r\n    }\r\n\r\n    // 默认打开第一个分类\r\n    if (this.emoticons.length > 0) this.openGrp(0)\r\n  }\r\n\r\n  /** 打开一个表情组 */\r\n  public openGrp(index: number) {\r\n    Array.from(this.$grpWrap.children).forEach((item) => {\r\n      const el = item as HTMLElement\r\n      if (el.getAttribute('data-index') !== String(index)) {\r\n        el.style.display = 'none'\r\n      } else {\r\n        el.style.display = ''\r\n      }\r\n    })\r\n\r\n    this.$grpSwitcher\r\n      ?.querySelectorAll('span.active')\r\n      .forEach((item) => item.classList.remove('active'))\r\n    this.$grpSwitcher?.querySelector(`span[data-index=\"${index}\"]`)?.classList.add('active')\r\n\r\n    this.changeListHeight()\r\n  }\r\n\r\n  private changeListHeight() {\r\n    /* const listWrapHeight = Utils.getHeight(this.$grpWrapem)\r\n    this.editor.plugWrapEl.style.height = `${listWrapHeight > 150 ? listWrapHeight : 150}px` */\r\n  }\r\n\r\n  /** 处理评论 content 中的表情内容 */\r\n  public transEmoticonImageText(text: string) {\r\n    if (!this.emoticons || !Array.isArray(this.emoticons)) return text;\r\n\r\n    this.emoticons.forEach((grp) => {\r\n      if (grp.type !== 'image') return;\r\n      Object.entries(grp.items).forEach(([index, item]) => {\r\n        const temp = item?.key.replace(/\\s[0-9]/i,'');\r\n        const alt = item.notitle === 'true' ? undefined : temp.slice(temp.indexOf('-') + 1);\r\n        const eleAlt = alt === undefined ? '' : `alt=\"${alt}\"`;\r\n        const loadingAttr = `loading=\"lazy\"`;\r\n        const imgTag = `<img data-src=\"${item.val}\" ${eleAlt} ${loadingAttr} atk-emoticon=\"${item.key}\">`;\r\n        text = text.split(`:[${item.key}]`).join(imgTag);\r\n      });\r\n    });\r\n\r\n    return text;\r\n  }\r\n}\r\n","import * as Utils from '@/lib/utils'\r\nimport $t from '@/i18n'\r\nimport type PlugKit from './_kit'\r\nimport EditorPlug from './_plug'\r\n\r\n/** 允许的图片格式 */\r\nconst AllowImgExts = ['png', 'jpg', 'jpeg', 'gif', 'bmp', 'svg', 'webp']\r\n\r\nexport default class Upload extends EditorPlug {\r\n  private $imgUploadInput?: HTMLInputElement\r\n\r\n  constructor(kit: PlugKit) {\r\n    super(kit)\r\n\r\n    this.kit.useMounted(() => this.init())\r\n\r\n    this.initDragImg()\r\n  }\r\n\r\n  private init() {\r\n    this.$imgUploadInput = document.createElement('input')\r\n    this.$imgUploadInput.type = 'file'\r\n    this.$imgUploadInput.style.display = 'none'\r\n    this.$imgUploadInput.accept = AllowImgExts.map((o) => `.${o}`).join(',')\r\n\r\n    // TODO: Use btn cannot refresh when mounted event is triggered\r\n    //const $btn = this.useBtn(`<i aria-label=\"${$t('uploadImage')}\"><svg fill=\"currentColor\" aria-hidden=\"true\" height=\"14\" viewBox=\"0 0 14 14\" width=\"14\"><path d=\"m0 1.94444c0-1.074107.870333-1.94444 1.94444-1.94444h10.11116c1.0741 0 1.9444.870333 1.9444 1.94444v10.11116c0 1.0741-.8703 1.9444-1.9444 1.9444h-10.11116c-1.074107 0-1.94444-.8703-1.94444-1.9444zm1.94444-.38888c-.21466 0-.38888.17422-.38888.38888v7.06689l2.33333-2.33333 2.33333 2.33333 3.88888-3.88889 2.3333 2.33334v-5.51134c0-.21466-.1742-.38888-.3888-.38888zm10.49996 8.09977-2.3333-2.33333-3.88888 3.8889-2.33333-2.33334-2.33333 2.33334v.8447c0 .2146.17422.3888.38888.3888h10.11116c.2146 0 .3888-.1742.3888-.3888zm-7.1944-6.54422c-.75133 0-1.36111.60978-1.36111 1.36111 0 .75134.60978 1.36111 1.36111 1.36111s1.36111-.60977 1.36111-1.36111c0-.75133-.60978-1.36111-1.36111-1.36111z\" fill=\"#000\"/></svg></i>`)\r\n    const $btn = this.useBtn(`${$t('image')}`)\r\n    $btn.after(this.$imgUploadInput)\r\n    $btn.onclick = () => {\r\n      // 选择图片\r\n      const $input = this.$imgUploadInput!\r\n      $input.onchange = () => {\r\n        ;(async () => {\r\n          // 解决阻塞 UI 问题\r\n          if (!$input.files || $input.files.length === 0) return\r\n          const file = $input.files[0]\r\n          this.uploadImg(file)\r\n        })()\r\n      }\r\n      $input.click() // 显示选择图片对话框\r\n    }\r\n\r\n    if (!this.kit.useConf().imgUpload) {\r\n      this.$btn!.setAttribute('atk-only-admin-show', '')\r\n    }\r\n  }\r\n\r\n  private initDragImg() {\r\n    // 统一从 FileList 获取文件并上传图片方法\r\n    const uploadFromFileList = (files?: FileList) => {\r\n      if (!files) return\r\n\r\n      for (let i = 0; i < files.length; i++) {\r\n        const file = files[i]\r\n        this.uploadImg(file)\r\n      }\r\n    }\r\n\r\n    // 拖拽图片\r\n    // @link https://developer.mozilla.org/zh-CN/docs/Web/API/HTML_Drag_and_Drop_API/File_drag_and_drop\r\n    // 阻止浏览器的默认释放行为\r\n    const onDragover = (evt: Event) => {\r\n      evt.stopPropagation()\r\n      evt.preventDefault()\r\n    }\r\n\r\n    const onDrop = (evt: DragEvent) => {\r\n      const files = evt.dataTransfer?.files\r\n      if (files?.length) {\r\n        evt.preventDefault()\r\n        uploadFromFileList(files)\r\n      }\r\n    }\r\n\r\n    // 粘贴图片\r\n    const onPaste = (evt: ClipboardEvent) => {\r\n      const files = evt.clipboardData?.files\r\n      if (files?.length) {\r\n        evt.preventDefault()\r\n        uploadFromFileList(files)\r\n      }\r\n    }\r\n\r\n    this.kit.useMounted(() => {\r\n      this.kit.useUI().$textarea.addEventListener('dragover', onDragover)\r\n      this.kit.useUI().$textarea.addEventListener('drop', onDrop)\r\n      this.kit.useUI().$textarea.addEventListener('paste', onPaste)\r\n    })\r\n    this.kit.useUnmounted(() => {\r\n      this.kit.useUI().$textarea.removeEventListener('dragover', onDragover)\r\n      this.kit.useUI().$textarea.removeEventListener('drop', onDrop)\r\n      this.kit.useUI().$textarea.removeEventListener('paste', onPaste)\r\n    })\r\n  }\r\n\r\n  async uploadImg(file: File) {\r\n    const fileExt = /[^.]+$/.exec(file.name)\r\n    if (!fileExt || !AllowImgExts.includes(String(fileExt[0]).toLowerCase())) return\r\n\r\n    // 未登录提示\r\n    if (!this.kit.useUser().checkHasBasicUserInfo()) {\r\n      this.kit.useEditor().showNotify($t('uploadLoginMsg'), 'w')\r\n      return\r\n    }\r\n\r\n    // 插入图片前换一行\r\n    let insertPrefix = '\\n'\r\n    if (this.kit.useUI().$textarea.value.trim() === '') insertPrefix = ''\r\n\r\n    // 插入占位加载文字\r\n    const uploadPlaceholderTxt = `${insertPrefix}![](Uploading ${file.name}...)`\r\n    this.kit.useEditor().insertContent(uploadPlaceholderTxt)\r\n\r\n    // 上传图片\r\n    let resp: { public_url: string } | undefined\r\n    try {\r\n      const customUploaderFn = this.kit.useConf().imgUploader\r\n      if (!customUploaderFn) {\r\n        // 使用 Artalk 进行图片上传\r\n        resp = (await this.kit.useApi().upload.upload({ file })).data\r\n      } else {\r\n        // 使用自定义的图片上传器\r\n        resp = { public_url: await customUploaderFn(file) }\r\n      }\r\n    } catch (err: any) {\r\n      console.error(err)\r\n      this.kit.useEditor().showNotify(`${$t('uploadFail')}: ${err.message}`, 'e')\r\n    }\r\n    if (!!resp && resp.public_url) {\r\n      let imgURL = resp.public_url as string\r\n\r\n      // 若为相对路径，加上 artalk server\r\n      if (!Utils.isValidURL(imgURL))\r\n        imgURL = Utils.getURLBasedOnApi({\r\n          base: this.kit.useConf().server,\r\n          path: imgURL,\r\n        })\r\n\r\n      // 上传成功插入图片\r\n      this.kit\r\n        .useEditor()\r\n        .setContent(\r\n          this.kit\r\n            .useUI()\r\n            .$textarea.value.replace(uploadPlaceholderTxt, `${insertPrefix}![](${imgURL})`),\r\n        )\r\n    } else {\r\n      // 上传失败删除加载文字\r\n      this.kit\r\n        .useEditor()\r\n        .setContent(this.kit.useUI().$textarea.value.replace(uploadPlaceholderTxt, ''))\r\n    }\r\n  }\r\n}\r\n","import './preview.scss'\r\n\r\nimport * as marked from '@/lib/marked'\r\nimport $t from '@/i18n'\r\nimport EditorPlug from './_plug'\r\nimport type PlugKit from './_kit'\r\n\r\nexport default class Preview extends EditorPlug {\r\n  private isPlugPanelShow = false\r\n\r\n  constructor(kit: PlugKit) {\r\n    super(kit)\r\n\r\n    this.kit.useMounted(() => {\r\n      this.usePanel(`<div class=\"atk-editor-plug-preview\"></div>`)\r\n\r\n      // initialize plug button\r\n      //this.useBtn(`<i aria-label=\"${$t('preview')}\"><svg class=\"markdown\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M14.85 3H1.15C.52 3 0 3.52 0 4.15v7.69C0 12.48.52 13 1.15 13h13.69c.64 0 1.15-.52 1.15-1.15v-7.7C16 3.52 15.48 3 14.85 3zM9 11H7V8L5.5 9.92 4 8v3H2V5h2l1.5 2L7 5h2v6zm2.99.5L9.5 8H11V5h2v3h1.5l-2.51 3.5z\"></path></svg></i>`)\r\n      this.useBtn($t('preview'))\r\n    })\r\n    this.kit.useUnmounted(() => {})\r\n\r\n    // function to update content\r\n    this.kit.useEvents().on('content-updated', (content) => {\r\n      this.isPlugPanelShow && this.updateContent()\r\n    })\r\n\r\n    this.usePanelShow(() => {\r\n      this.isPlugPanelShow = true\r\n      this.updateContent()\r\n    })\r\n    this.usePanelHide(() => {\r\n      this.isPlugPanelShow = false\r\n    })\r\n  }\r\n\r\n  updateContent() {\r\n    this.$panel!.innerHTML = this.kit.useEditor().getContentMarked()\r\n  }\r\n}\r\n","import type { ArtalkConfig } from '@/types'\r\nimport type EditorPlug from './_plug'\r\nimport LocalStorage from './local-storage'\r\nimport Textarea from './textarea'\r\nimport SubmitBtn from './submit-btn'\r\nimport Submit from './submit'\r\nimport StateReply from './state-reply'\r\nimport StateEdit from './state-edit'\r\nimport Closable from './closable'\r\nimport HeaderEvent from './header-event'\r\nimport HeaderUser from './header-user'\r\nimport HeaderLink from './header-link'\r\nimport Mover from './mover'\r\nimport Emoticons from './emoticons'\r\nimport Upload from './upload'\r\nimport Preview from './preview'\r\nimport Refresh from './refresh'\r\n\r\n/** The default enabled plugs */\r\nconst EDITOR_PLUGS: (typeof EditorPlug)[] = [\r\n  // Core\r\n  LocalStorage,\r\n  HeaderEvent,\r\n  HeaderUser,\r\n  HeaderLink,\r\n  Textarea,\r\n  Submit,\r\n  SubmitBtn,\r\n  Mover,\r\n  StateReply,\r\n  StateEdit,\r\n  Closable,\r\n\r\n  // Extensions\r\n  Emoticons, Upload, Preview, Refresh\r\n]\r\n\r\n/**\r\n * Get the enabled plugs by config\r\n */\r\nexport function getEnabledPlugs(\r\n  conf: Pick<ArtalkConfig, 'imgUpload' | 'emoticons' | 'preview' | 'editorTravel'>,\r\n): (typeof EditorPlug)[] {\r\n  // The reference map of config and plugs\r\n  // (for check if the plug is enabled)\r\n  const confRefs = new Map<typeof EditorPlug, any>()\r\n  confRefs.set(Upload, conf.imgUpload)\r\n  confRefs.set(Emoticons, conf.emoticons)\r\n  confRefs.set(Preview, conf.preview)\r\n  confRefs.set(Mover, conf.editorTravel)\r\n\r\n  return EDITOR_PLUGS.filter((p) => !confRefs.has(p) || !!confRefs.get(p))\r\n}\r\n","import EditorPlug from './_plug'\r\nimport type PlugKit from './_kit'\r\n\r\nexport default class HeaderEvent extends EditorPlug {\r\n  private get $inputs() {\r\n    return this.kit.useEditor().getHeaderInputEls()\r\n  }\r\n\r\n  constructor(kit: PlugKit) {\r\n    super(kit)\r\n\r\n    const inputEventFns: { [name: string]: () => void } = {}\r\n    const changeEventFns: { [name: string]: () => void } = {}\r\n\r\n    const trigger =\r\n      (evt: 'header-input' | 'header-change', $input: HTMLInputElement, field: string) => () => {\r\n        this.kit.useEvents().trigger(evt, { field, $input })\r\n      }\r\n\r\n    this.kit.useMounted(() => {\r\n      // batch bind the events\r\n      Object.entries(this.$inputs).forEach(([key, $input]) => {\r\n        $input.addEventListener(\r\n          'input',\r\n          (inputEventFns[key] = trigger('header-input', $input, key)),\r\n        )\r\n        $input.addEventListener(\r\n          'change',\r\n          (changeEventFns[key] = trigger('header-change', $input, key)),\r\n        )\r\n      })\r\n    })\r\n\r\n    this.kit.useUnmounted(() => {\r\n      // unmount the event\r\n      Object.entries(this.$inputs).forEach(([key, $input]) => {\r\n        $input.removeEventListener('input', inputEventFns[key])\r\n        $input.removeEventListener('change', changeEventFns[key])\r\n      })\r\n    })\r\n  }\r\n}\r\n","import $t from '@/i18n'\r\nimport type { UserInfoApiResponseData } from '@/types'\r\nimport EditorPlug from './_plug'\r\nimport type PlugKit from './_kit'\r\n\r\nexport default class HeaderUser extends EditorPlug {\r\n  constructor(kit: PlugKit) {\r\n    super(kit)\r\n\r\n    const onInput = ({ $input, field }: { $input: HTMLInputElement; field: string }) => {\r\n      if (this.kit.useEditor().getState() === 'edit') return // TODO: prevent execute when editing, since update comment.user not support\r\n\r\n      // update user data\r\n      this.kit.useUser().update({ [field]: $input.value.trim() })\r\n\r\n      // remote fetch user info\r\n      if (field === 'nick' || field === 'email') this.fetchUserInfo() // must after update user data, since fetchUserInfo() will use User.data\r\n    }\r\n\r\n    this.kit.useMounted(() => {\r\n      Object.entries(this.kit.useEditor().getHeaderInputEls()).forEach(([key, $input]) => {\r\n        // set placeholder\r\n        $input.placeholder = `${$t(key as any)}`\r\n\r\n        // sync header values from User.data\r\n        $input.value = this.kit.useUser().getData()[key] || ''\r\n      })\r\n\r\n      // bind events\r\n      this.kit.useEvents().on('header-input', onInput)\r\n    })\r\n\r\n    this.kit.useUnmounted(() => {\r\n      this.kit.useEvents().off('header-input', onInput)\r\n    })\r\n  }\r\n\r\n  private query = {\r\n    timer: <number | null>null,\r\n    abortFn: <(() => void) | null>null,\r\n  }\r\n\r\n  /**\r\n   * Fetch user info from server\r\n   */\r\n  private fetchUserInfo() {\r\n    this.kit.useUser().logout() // clear login status\r\n\r\n    if (this.query.timer) window.clearTimeout(this.query.timer) // clear the not executed timeout task\r\n    if (this.query.abortFn) this.query.abortFn() // abort the last request (if request is pending not finished)\r\n\r\n    this.query.timer = window.setTimeout(() => {\r\n      this.query.timer = null // clear the timer (clarify the timer is executing)\r\n\r\n      const api = this.kit.useApi()\r\n      const CANCEL_TOKEN = 'getUserCancelToken'\r\n      this.query.abortFn = () => api.abortRequest(CANCEL_TOKEN)\r\n\r\n      api.user\r\n        .getUser(\r\n          { ...api.getUserFields() },\r\n          {\r\n            cancelToken: CANCEL_TOKEN,\r\n          },\r\n        )\r\n        .then((res) => this.onUserInfoFetched(res.data))\r\n        .catch((err) => {})\r\n        .finally(() => {\r\n          this.query.abortFn = null // clear the abort function (clarify the request is finished)\r\n        })\r\n    }, 400) // delay to reduce request\r\n  }\r\n\r\n  /**\r\n   * Function called when user info fetched\r\n   *\r\n   * @param data The response data from server\r\n   */\r\n  private onUserInfoFetched(data: UserInfoApiResponseData) {\r\n    // If api response is not login, logout\r\n    if (!data.is_login) this.kit.useUser().logout()\r\n\r\n    // Update unread notifies\r\n    this.kit.useGlobalCtx().getData().updateNotifies(data.notifies)\r\n\r\n    // If user is admin and not login,\r\n    if (this.kit.useUser().checkHasBasicUserInfo() && !data.is_login && data.user?.is_admin) {\r\n      // then show login window\r\n      this.kit.useGlobalCtx().checkAdmin({\r\n        onSuccess: () => {},\r\n      })\r\n    }\r\n\r\n    // Auto fill user link from server\r\n    if (data.user && data.user.link) {\r\n      this.kit.useUI().$link.value = data.user.link\r\n      this.kit.useUser().update({ link: data.user.link })\r\n    }\r\n  }\r\n}\r\n","import EditorPlug from './_plug'\r\nimport type PlugKit from './_kit'\r\n\r\nexport default class HeaderLink extends EditorPlug {\r\n  constructor(kit: PlugKit) {\r\n    super(kit)\r\n\r\n    const onLinkChange = ({ field }: { field: string }) => {\r\n      if (field === 'link') this.onLinkInputChange()\r\n    }\r\n\r\n    // bind events\r\n    this.kit.useMounted(() => {\r\n      this.kit.useEvents().on('header-change', onLinkChange)\r\n    })\r\n\r\n    this.kit.useUnmounted(() => {\r\n      this.kit.useEvents().off('header-change', onLinkChange)\r\n    })\r\n  }\r\n\r\n  private onLinkInputChange() {\r\n    // auto and force add protocol prefix for user input link\r\n    const link = this.kit.useUI().$link.value.trim()\r\n    if (!!link && !/^(http|https):\\/\\//.test(link)) {\r\n      this.kit.useUI().$link.value = `https://${link}`\r\n      this.kit.useUser().update({ link: this.kit.useUI().$link.value })\r\n    }\r\n  }\r\n}\r\n","import $t from '@/i18n'\r\nimport EditorPlug from './_plug'\r\nimport type PlugKit from './_kit'\r\n\r\nexport default class Textarea extends EditorPlug {\r\n  constructor(kit: PlugKit) {\r\n    super(kit)\r\n\r\n    const onKeydown = (e: KeyboardEvent) => this.onKeydown(e)\r\n    const onInput = () => this.onInput()\r\n\r\n    this.kit.useMounted(() => {\r\n      // 占位符\r\n      this.kit.useUI().$textarea.placeholder = this.kit.useConf().placeholder || $t('placeholder')\r\n\r\n      // bind the event\r\n      this.kit.useUI().$textarea.addEventListener('keydown', onKeydown)\r\n      this.kit.useUI().$textarea.addEventListener('input', onInput)\r\n    })\r\n\r\n    this.kit.useUnmounted(() => {\r\n      // unmount the event\r\n      this.kit.useUI().$textarea.removeEventListener('keydown', onKeydown)\r\n      this.kit.useUI().$textarea.removeEventListener('input', onInput)\r\n    })\r\n\r\n    this.kit.useEvents().on('content-updated', () => {\r\n      // delay 80ms to prevent invalid execution\r\n      window.setTimeout(() => {\r\n        this.adaptiveHeightByContent()\r\n      }, 80)\r\n    })\r\n  }\r\n\r\n  // 按下 Tab 输入内容，而不是失去焦距\r\n  private onKeydown(e: KeyboardEvent) {\r\n    const keyCode = e.code\r\n\r\n    if (keyCode === \"Tab\") {\r\n      e.preventDefault()\r\n      this.kit.useEditor().insertContent('\\t')\r\n    }\r\n  }\r\n\r\n  private onInput() {\r\n    this.kit.useEvents().trigger('content-updated', this.kit.useEditor().getContentRaw())\r\n  }\r\n\r\n  // Resize the textarea height by content\r\n  public adaptiveHeightByContent() {\r\n    const diff = this.kit.useUI().$textarea.offsetHeight - this.kit.useUI().$textarea.clientHeight\r\n    this.kit.useUI().$textarea.style.height = '0px' // it's a magic. 若不加此行，内容减少，高度回不去\r\n    this.kit.useUI().$textarea.style.height = `${this.kit.useUI().$textarea.scrollHeight + diff}px`\r\n  }\r\n}\r\n","import $t from '@/i18n'\r\nimport EditorPlug from './_plug'\r\nimport type PlugKit from './_kit'\r\n\r\nexport default class SubmitBtn extends EditorPlug {\r\n  constructor(kit: PlugKit) {\r\n    super(kit)\r\n\r\n    const onClick = () => {\r\n      this.kit.useEditor().submit()\r\n    }\r\n\r\n    this.kit.useMounted(() => {\r\n      // apply the submit button text from user custom config\r\n      this.kit.useUI().$submitBtn.innerText = this.kit.useConf().sendBtn || $t('send')\r\n\r\n      this.kit.useUI().$submitBtn.style.display = \"block\"\r\n\r\n      // bind the event when click the submit button\r\n      this.kit.useUI().$submitBtn.addEventListener('click', onClick)\r\n    })\r\n\r\n    this.kit.useUnmounted(() => {\r\n      this.kit.useUI().$submitBtn.removeEventListener('click', onClick)\r\n    })\r\n  }\r\n}\r\n","import type { CommentData } from '@/types'\r\nimport * as Utils from '@/lib/utils'\r\nimport * as Ui from '@/lib/ui'\r\nimport $t from '@/i18n'\r\nimport EditorPlug from './_plug'\r\nimport type PlugKit from './_kit'\r\nimport Submit from './submit'\r\nimport SubmitAddPreset from './submit-add'\r\n\r\nexport default class StateReply extends EditorPlug {\r\n  private comment?: CommentData\r\n\r\n  constructor(kit: PlugKit) {\r\n    super(kit)\r\n\r\n    // add effect when state switch to `reply`\r\n    this.useEditorStateEffect('reply', (commentData) => {\r\n      this.setReply(commentData)\r\n\r\n      return () => {\r\n        this.cancelReply()\r\n      }\r\n    })\r\n\r\n    // register submit preset\r\n    this.kit.useEvents().on('mounted', () => {\r\n      const submitPlug = this.kit.useDeps(Submit)\r\n      if (!submitPlug) throw Error('SubmitPlug not initialized')\r\n\r\n      const defaultPreset = new SubmitAddPreset(this.kit)\r\n\r\n      submitPlug.registerCustom({\r\n        activeCond: () => !!this.comment, // active this custom submit when reply mode\r\n        req: async () => {\r\n          if (!this.comment) throw new Error('reply comment cannot be empty')\r\n\r\n          const nComment = (\r\n            await this.kit.useApi().comments.createComment({\r\n              ...(await defaultPreset.getSubmitAddParams()),\r\n              rid: this.comment.id,\r\n              page_key: this.comment.page_key,\r\n              page_title: undefined,\r\n              site_name: this.comment.site_name,\r\n            })\r\n          ).data\r\n\r\n          return nComment\r\n        },\r\n        post: (nComment: CommentData) => {\r\n          // open another page when reply comment is not the same pageKey\r\n          const conf = this.kit.useConf()\r\n          if (nComment.page_key !== conf.pageKey) {\r\n            window.open(`${nComment.page_url}#atk-comment-${nComment.id}`)\r\n          }\r\n\r\n          defaultPreset.postSubmitAdd(nComment)\r\n        },\r\n      })\r\n    })\r\n  }\r\n\r\n  private setReply(commentData: CommentData) {\r\n    const ui = this.kit.useUI()\r\n    if (!ui.$sendReply) {\r\n      ui.$sendReply = Utils.createElement(\r\n        `<div class=\"atk-send-reply\">` +\r\n          `${$t('reply')} ` +\r\n          `<span class=\"atk-text\"></span><span class=\"atk-cancel\">×</span>` +\r\n        `</div>`\r\n      )\r\n      ui.$sendReply.querySelector<HTMLElement>('.atk-text')!.innerText = `@${commentData.nick}`\r\n      ui.$sendReply.addEventListener('click', () => {\r\n        this.kit.useEditor().resetState()\r\n      })\r\n      ui.$textareaWrap.append(ui.$sendReply)\r\n    }\r\n    this.comment = commentData\r\n\r\n    ui.$textarea.focus()\r\n  }\r\n\r\n  private cancelReply() {\r\n    if (!this.comment) return\r\n\r\n    const ui = this.kit.useUI()\r\n    if (ui.$sendReply) {\r\n      ui.$sendReply.remove()\r\n      ui.$sendReply = undefined\r\n    }\r\n    // if (ui.$sendReplyBtn) {\r\n    //   ui.$sendReplyBtn.remove()\r\n    //   ui.$sendReplyBtn = undefined\r\n    // }\r\n    this.comment = undefined\r\n  }\r\n}\r\n","import type { CommentData } from '@/types'\r\nimport $t from '@/i18n'\r\nimport * as Utils from '@/lib/utils'\r\nimport type PlugKit from './_kit'\r\nimport EditorPlug from './_plug'\r\nimport Submit from './submit'\r\n\r\nexport default class StateEdit extends EditorPlug {\r\n  private comment?: CommentData\r\n\r\n  constructor(kit: PlugKit) {\r\n    super(kit)\r\n\r\n    // add effect when state switch to `edit`\r\n    this.useEditorStateEffect('edit', (comment) => {\r\n      this.edit(comment)\r\n\r\n      return () => {\r\n        this.cancelEdit()\r\n      }\r\n    })\r\n\r\n    // register submit preset\r\n    this.kit.useMounted(() => {\r\n      const submitPlug = this.kit.useDeps(Submit)\r\n      if (!submitPlug) throw Error('SubmitPlug not initialized')\r\n\r\n      submitPlug.registerCustom({\r\n        activeCond: () => !!this.comment, // active this custom submit when edit mode\r\n        req: async () => {\r\n          const saveData = {\r\n            content: this.kit.useEditor().getContentFinal(),\r\n            nick: this.kit.useUI().$nick.value,\r\n            email: this.kit.useUI().$email.value,\r\n            link: this.kit.useUI().$link.value,\r\n          }\r\n          const comment = this.comment!\r\n          const nComment = await this.kit.useApi().comments.updateComment(comment.id, {\r\n            ...comment,\r\n            ...saveData,\r\n          })\r\n          return nComment.data\r\n        },\r\n        post: (nComment: CommentData) => {\r\n          this.kit.useGlobalCtx().getData().updateComment(nComment)\r\n        },\r\n      })\r\n    })\r\n  }\r\n\r\n  private edit(comment: CommentData) {\r\n    const ui = this.kit.useUI()\r\n    if (!ui.$editCancelBtn) {\r\n      const $btn = Utils.createElement(\r\n        `<div class=\"atk-send-reply\">` +\r\n          `${$t('editCancel')} ` +\r\n          `<span class=\"atk-cancel\">×</span>` +\r\n        `</div>`\r\n      )\r\n      $btn.onclick = () => {\r\n        this.kit.useEditor().resetState()\r\n      }\r\n      ui.$textareaWrap.append($btn) \r\n      ui.$editCancelBtn = $btn\r\n    }\r\n    this.comment = comment\r\n\r\n    ui.$header.style.display = 'none' // TODO: support modify header information\r\n\r\n    ui.$nick.value = comment.nick || ''\r\n    ui.$email.value = comment.email || ''\r\n    ui.$link.value = comment.link || ''\r\n\r\n    this.kit.useEditor().setContent(comment.content)\r\n    ui.$textarea.focus()\r\n\r\n    this.updateSubmitBtnText($t('save'))\r\n  }\r\n\r\n  private cancelEdit() {\r\n    if (!this.comment) return\r\n\r\n    const ui = this.kit.useUI()\r\n\r\n    if (ui.$editCancelBtn) {\r\n      ui.$editCancelBtn.remove()\r\n      ui.$editCancelBtn = undefined\r\n    }\r\n\r\n    this.comment = undefined\r\n\r\n    const { nick, email, link } = this.kit.useUser().getData()\r\n    ui.$nick.value = nick\r\n    ui.$email.value = email\r\n    ui.$link.value = link\r\n\r\n    this.kit.useEditor().setContent('')\r\n    this.restoreSubmitBtnText()\r\n\r\n    ui.$header.style.display = '' // TODO: support modify header information\r\n  }\r\n\r\n  // -------------------------------------------------------------------\r\n  //  Submit Btn Text Modifier\r\n  // -------------------------------------------------------------------\r\n\r\n  private originalSubmitBtnText = 'Send'\r\n\r\n  private updateSubmitBtnText(text: string) {\r\n    this.originalSubmitBtnText = this.kit.useUI().$submitBtn.innerText\r\n    this.kit.useUI().$submitBtn.innerText = text\r\n  }\r\n\r\n  private restoreSubmitBtnText() {\r\n    this.kit.useUI().$submitBtn.innerText = this.originalSubmitBtnText\r\n  }\r\n}\r\n","import * as Utils from '@/lib/utils'\r\nimport $t from '@/i18n'\r\nimport EditorPlug from './_plug'\r\nimport type PlugKit from './_kit'\r\n\r\nexport default class Closable extends EditorPlug {\r\n  constructor(kit: PlugKit) {\r\n    super(kit)\r\n\r\n    const onOpen = () => this.open()\r\n    const onClose = () => this.close()\r\n\r\n    this.kit.useMounted(() => {\r\n      this.kit.useEvents().on('editor-open', onOpen)\r\n      this.kit.useEvents().on('editor-close', onClose)\r\n    })\r\n    this.kit.useUnmounted(() => {\r\n      this.kit.useEvents().off('editor-open', onOpen)\r\n      this.kit.useEvents().off('editor-close', onClose)\r\n    })\r\n  }\r\n\r\n  private open() {\r\n    this.kit.useUI().$textareaWrap.querySelector('.atk-comment-closed')?.remove()\r\n    this.kit.useUI().$textarea.style.display = ''\r\n    this.kit.useUI().$bottom.style.display = ''\r\n  }\r\n\r\n  private close() {\r\n    const commentClosed = Utils.createElement(`<div class=\"atk-comment-closed\">${$t('onlyAdminCanReply')}</div>`)\r\n    if (!this.kit.useUI().$textareaWrap.querySelector('.atk-comment-closed'))\r\n      this.kit\r\n        .useUI()\r\n        .$textareaWrap.prepend(\r\n          Utils.createElement(`<div class=\"atk-comment-closed\">${$t('onlyAdminCanReply')}</div>`),\r\n        )\r\n\r\n    if (!this.kit.useUser().getData().isAdmin) {\r\n      this.kit.useUI().$textarea.style.display = 'none'\r\n      this.kit.useUI().$notifyWrap.style.display = 'none'\r\n      this.kit.useUI().$bottom.style.display = 'none'\r\n      this.kit.useUI().$textarea.value = ''\r\n      this.kit.useUI().$el.style.borderRadius = '10px';\r\n      this.kit.useEvents().trigger('panel-close')\r\n    } else {\r\n      // 管理员一直打开评论\r\n      this.kit.useUI().$textarea.style.display = ''\r\n      this.kit.useUI().$bottom.style.display = ''\r\n      commentClosed.remove()\r\n    }\r\n  }\r\n}\r\n","import $t from '@/i18n'\r\nimport PlugKit from './_kit';\r\nimport EditorPlug from './_plug'\r\n\r\nexport default class Refresh extends EditorPlug {\r\n\r\n  constructor(kit: PlugKit) {\r\n    super(kit);\r\n\r\n    const btnText = $t('refresh');\r\n    const $btn = this.useBtn(btnText);\r\n\r\n    $btn.onclick = () => {\r\n      kit.useEditor().ctx.reload()\r\n    }\r\n  }\r\n}","import type { PlugManager } from '../editor-kit'\r\nimport type EditorPlug from './_plug'\r\n\r\n/**\r\n * PlugKit provides a set of methods to help you develop editor plug\r\n */\r\nexport default class PlugKit {\r\n  constructor(private plugs: PlugManager) {}\r\n\r\n  /** Use the editor */\r\n  useEditor() {\r\n    return this.plugs.editor\r\n  }\r\n\r\n  /**\r\n   * Use the context of global\r\n   *\r\n   * @deprecated The calls to this function should be reduced as much as possible\r\n   */\r\n  useGlobalCtx() {\r\n    return this.plugs.editor.ctx\r\n  }\r\n\r\n  /** Use the config of Artalk */\r\n  useConf() {\r\n    return this.plugs.editor.ctx.conf\r\n  }\r\n\r\n  /** Use the http api client */\r\n  useApi() {\r\n    return this.plugs.editor.ctx.getApi()\r\n  }\r\n\r\n  /** Use the user manager */\r\n  useUser() {\r\n    return this.plugs.editor.ctx.get('user')\r\n  }\r\n\r\n  /** Use the ui of editor */\r\n  useUI() {\r\n    return this.plugs.editor.getUI()\r\n  }\r\n\r\n  /** Use the events in editor scope */\r\n  useEvents() {\r\n    return this.plugs.getEvents()\r\n  }\r\n\r\n  /** Listen the event when plug is mounted */\r\n  useMounted(func: () => void) {\r\n    this.useEvents().on('mounted', func)\r\n  }\r\n\r\n  /** Listen the event when plug is unmounted */\r\n  useUnmounted(func: () => void) {\r\n    this.useEvents().on('unmounted', func)\r\n  }\r\n\r\n  /** Use the deps of other plug */\r\n  useDeps<T extends typeof EditorPlug>(plug: T) {\r\n    return this.plugs.get(plug)\r\n  }\r\n}\r\n","import type { EditorApi, ArtalkPlugin } from '@/types'\r\nimport EventManager from '@/lib/event-manager'\r\nimport { getEnabledPlugs } from './editor'\r\nimport EditorPlug from './editor/_plug'\r\nimport PlugKit from './editor/_kit'\r\nimport Emoticons from './editor/emoticons'\r\n\r\nexport interface EditorEventPayloadMap {\r\n  mounted: undefined\r\n  unmounted: undefined\r\n  'header-input': { field: string; $input: HTMLInputElement }\r\n  'header-change': { field: string; $input: HTMLInputElement }\r\n  'content-updated': string\r\n  'panel-show': EditorPlug\r\n  'panel-hide': EditorPlug\r\n  'panel-close': undefined\r\n\r\n  'editor-close': undefined\r\n  'editor-open': undefined\r\n}\r\n\r\nexport const EditorKit: ArtalkPlugin = (ctx) => {\r\n  const editor = ctx.get('editor')\r\n\r\n  const editorPlugs = new PlugManager(editor)\r\n  ctx.inject('editorPlugs', editorPlugs)\r\n}\r\n\r\nexport class PlugManager {\r\n  private plugs: EditorPlug[] = []\r\n  private openedPlug: EditorPlug | null = null\r\n  private events = new EventManager<EditorEventPayloadMap>()\r\n\r\n  getPlugs() {\r\n    return this.plugs\r\n  }\r\n  getEvents() {\r\n    return this.events\r\n  }\r\n\r\n  private clear() {\r\n    this.plugs = []\r\n    this.events = new EventManager()\r\n    if (this.openedPlug) this.closePlugPanel()\r\n  }\r\n\r\n  constructor(public editor: EditorApi) {\r\n    let confLoaded = false // config not loaded at first time\r\n    this.editor.ctx.watchConf(\r\n      ['imgUpload', 'emoticons', 'preview', 'editorTravel', 'locale'],\r\n      (conf) => {\r\n        // trigger unmount event will call all plugs' unmount function\r\n        // (this will only be called while conf reloaded, not be called at first time)\r\n        confLoaded && this.getEvents().trigger('unmounted')\r\n\r\n        // reset the plugs\r\n        this.clear()\r\n\r\n        // init the all enabled plugs\r\n        getEnabledPlugs(conf).forEach((Plug) => {\r\n          // create the plug instance\r\n          const kit = new PlugKit(this)\r\n          this.plugs.push(new Plug(kit))\r\n        })\r\n\r\n        // trigger event for plug initialization\r\n        this.getEvents().trigger('mounted')\r\n        confLoaded = true\r\n\r\n        // refresh the plug UI\r\n        this.loadPluginUI()\r\n      },\r\n    )\r\n\r\n    this.events.on('panel-close', () => this.closePlugPanel())\r\n  }\r\n\r\n  private loadPluginUI() {\r\n    // handle ui, clear and reset the plug btns and plug panels\r\n    this.editor.getUI().$plugPanelWrap.innerHTML = ''\r\n    this.editor.getUI().$plugPanelWrap.style.display = 'none'\r\n    this.editor.getUI().$plugBtnWrap.innerHTML = ''\r\n\r\n    // load the plug UI\r\n    this.plugs.forEach((plug) => this.loadPluginItem(plug))\r\n  }\r\n\r\n  /** Load the plug btn and plug panel on editor ui */\r\n  private loadPluginItem(plug: EditorPlug) {\r\n    const $btn = plug.$btn\r\n    if (!$btn) return\r\n    this.editor.getUI().$plugBtnWrap.appendChild($btn)\r\n\r\n    // bind the event when click plug btn\r\n    !$btn.onclick &&\r\n      ($btn.onclick = () => {\r\n        // removing the active class from all the buttons\r\n        this.editor\r\n          .getUI()\r\n          .$plugBtnWrap.querySelectorAll('.active')\r\n          .forEach((item) => item.classList.remove('active'))\r\n\r\n        // if the plug is not the same as the openedPlug,\r\n        if (plug !== this.openedPlug) {\r\n          // then open the plug current clicked plug panel\r\n          this.openPlugPanel(plug)\r\n\r\n          // add active class for current plug panel\r\n          $btn.classList.add('active')\r\n        } else {\r\n          // then close the plug\r\n          this.closePlugPanel()\r\n        }\r\n      })\r\n\r\n    // initialization of plug panel\r\n    const $panel = plug.$panel\r\n    if ($panel) {\r\n      $panel.style.display = 'none'\r\n      this.editor.getUI().$plugPanelWrap.appendChild($panel)\r\n    }\r\n  }\r\n\r\n  get<T extends typeof EditorPlug>(plug: T) {\r\n    return this.plugs.find((p) => p instanceof plug) as InstanceType<T> | undefined\r\n  }\r\n\r\n  /** Open the editor plug panel */\r\n  openPlugPanel(plug: EditorPlug) {\r\n    this.plugs.forEach((aPlug) => {\r\n      const plugPanel = aPlug.$panel\r\n      if (!plugPanel) return\r\n\r\n      if (aPlug === plug) {\r\n        plugPanel.style.display = ''\r\n        this.events.trigger('panel-show', plug)\r\n      } else {\r\n        plugPanel.style.display = 'none'\r\n        this.events.trigger('panel-hide', plug)\r\n      }\r\n    })\r\n\r\n    this.editor.getUI().$plugPanelWrap.style.display = ''\r\n    this.openedPlug = plug\r\n\r\n    window.setTimeout(() => {\r\n      if(plug instanceof Emoticons) {\r\n        // 为表情弹窗添加关闭事件监听\r\n        document.addEventListener('click', () => {\r\n          this.closePlugPanel()\r\n          // 移除按钮激活\r\n          this.editor.getUI().$plugBtnWrap\r\n            .querySelectorAll('.active')\r\n            .forEach(item => item.classList.remove('active'))\r\n        }, { once: true })\r\n      }\r\n    }, 100)\r\n  }\r\n\r\n  /** Close the editor plug panel */\r\n  closePlugPanel() {\r\n    if (!this.openedPlug) return\r\n\r\n    this.editor.getUI().$plugPanelWrap.style.display = 'none'\r\n    this.events.trigger('panel-hide', this.openedPlug)\r\n    this.openedPlug = null\r\n  }\r\n\r\n  /** Get the content which is transformed by plugs */\r\n  getTransformedContent(rawContent: string) {\r\n    let result = rawContent\r\n    this.plugs.forEach((aPlug) => {\r\n      if (!aPlug.contentTransformer) return\r\n      result = aPlug.contentTransformer(result)\r\n    })\r\n    return result\r\n  }\r\n}\r\n","import type { ArtalkPlugin } from '@/types'\r\n\r\nexport const GotoFocus: ArtalkPlugin = (ctx) => {\r\n  ctx.on('list-goto', async (commentID) => {\r\n    // find the comment node\r\n    let comment = ctx.getCommentNodes().find((c) => c.getID() === commentID)\r\n    if (!comment) {\r\n      // fetch and insert the comment from the server\r\n      const data = (await ctx.getApi().comments.getComment(commentID)).data\r\n      ctx\r\n        .get('list')\r\n        .getListLayout({ forceFlatMode: true })\r\n        .insert(data.comment, data.reply_comment)\r\n      comment = ctx.getCommentNodes().find((c) => c.getID() === commentID)\r\n    }\r\n    if (!comment) return\r\n    comment.focus()\r\n  })\r\n}\r\n","import type { ArtalkPlugin } from '@/types'\r\nimport { version as ARTALK_VERSION } from '~/package.json'\r\nimport type List from '~/src/list/list'\r\nimport * as Ui from '@/lib/ui'\r\nimport * as Utils from '@/lib/utils'\r\nimport $t from '@/i18n'\r\n\r\nlet IgnoreVersionCheck = false\r\n\r\nexport const VersionCheck: ArtalkPlugin = (ctx) => {\r\n  ctx.watchConf(['apiVersion', 'versionCheck'], (conf) => {\r\n    const list = ctx.get('list')\r\n    if (conf.apiVersion && conf.versionCheck && !IgnoreVersionCheck)\r\n      versionCheck(list, ARTALK_VERSION, conf.apiVersion)\r\n  })\r\n}\r\n\r\nfunction versionCheck(list: List, feVer: string, beVer: string) {\r\n  const comp = Utils.versionCompare(feVer, beVer)\r\n  const sameVer = comp === 0\r\n  if (sameVer) return\r\n\r\n  const errEl = Utils.createElement(\r\n    `<div class=\"atk-version-check-notice\">${$t('updateMsg', {\r\n      name: comp < 0 ? $t('frontend') : $t('backend'),\r\n    })} <span class=\"atk-info\">` +\r\n      `${$t('currentVersion')}: ${$t('frontend')} ${feVer} / ${$t('backend')} ${beVer}` +\r\n      `</span></div>`,\r\n  )\r\n  const ignoreBtn = Utils.createElement(`<span class=\"atk-ignore-btn\">${$t('ignore')}</span>`)\r\n  ignoreBtn.onclick = () => {\r\n    errEl.remove()\r\n    IgnoreVersionCheck = true\r\n  }\r\n  errEl.append(ignoreBtn)\r\n  list.$el.parentElement!.prepend(errEl)\r\n}\r\n","import type { ArtalkPlugin } from '@/types'\r\n\r\n// Notice: Singleton pattern needs to be loaded as lazy as possible,\r\n//         because the SSG application does not have a `window` context.\r\nlet darkModeMedia: MediaQueryList | undefined\r\n\r\nfunction updateClassnames($els: HTMLElement[], darkMode: boolean) {\r\n  const DarkModeClassName = 'atk-dark-mode'\r\n\r\n  $els.forEach(($el) => {\r\n    if (darkMode) $el.classList.add(DarkModeClassName)\r\n    else $el.classList.remove(DarkModeClassName)\r\n  })\r\n}\r\n\r\nexport const DarkMode: ArtalkPlugin = (ctx) => {\r\n  // the handler bind to Artalk instance, don't forget to remove it when Artalk instance destroyed\r\n  let darkModeAutoHandler: ((evt: MediaQueryListEvent) => void) | undefined\r\n\r\n  const sync = (darkMode: boolean | 'auto') => {\r\n    // the elements that classnames need to be updated when darkMode changed\r\n    const $els = [ctx.$root, ctx.get('layerManager').getEl()]\r\n\r\n    // init darkModeMedia if not exists, and only create once\r\n    if (!darkModeMedia) {\r\n      darkModeMedia = window.matchMedia('(prefers-color-scheme: dark)')\r\n    }\r\n\r\n    if (darkMode === 'auto') {\r\n      // if darkMode is 'auto', add handler\r\n      if (!darkModeAutoHandler) {\r\n        // the handler that will be called when darkModeMedia changed\r\n        darkModeAutoHandler = (evt) => updateClassnames($els, evt.matches)\r\n        darkModeMedia.addEventListener('change', darkModeAutoHandler)\r\n      }\r\n\r\n      // update classnames immediately\r\n      updateClassnames($els, darkModeMedia.matches)\r\n    } else {\r\n      // if darkMode is boolean, remove handler\r\n      if (darkModeAutoHandler) {\r\n        darkModeMedia.removeEventListener('change', darkModeAutoHandler)\r\n        darkModeAutoHandler = undefined\r\n      }\r\n\r\n      // update classnames immediately\r\n      updateClassnames($els, darkMode)\r\n    }\r\n  }\r\n\r\n  ctx.watchConf(['darkMode'], (conf) => sync(conf.darkMode))\r\n  ctx.on('created', () => sync(ctx.conf.darkMode))\r\n  ctx.on('unmounted', () => {\r\n    // if handler exists, don't forget to remove it, or it will cause memory leak\r\n    darkModeAutoHandler && darkModeMedia?.removeEventListener('change', darkModeAutoHandler)\r\n    darkModeAutoHandler = undefined\r\n  })\r\n}\r\n","import type { ArtalkConfig, ArtalkPlugin, ContextApi } from '@/types'\r\nimport { handleConfFormServer } from '@/config'\r\nimport { showErrorDialog } from '@/components/error-dialog'\r\nimport { DefaultPlugins } from './plugins'\r\n\r\n/**\r\n * Global Plugins for all Artalk instances\r\n */\r\nexport const GlobalPlugins: ArtalkPlugin[] = [...DefaultPlugins]\r\n\r\nexport async function load(ctx: ContextApi) {\r\n  const loadedPlugins: ArtalkPlugin[] = []\r\n  const loadPlugins = (plugins: ArtalkPlugin[]) => {\r\n    plugins.forEach((plugin) => {\r\n      if (typeof plugin === 'function' && !loadedPlugins.includes(plugin)) {\r\n        plugin(ctx)\r\n        loadedPlugins.push(plugin)\r\n      }\r\n    })\r\n  }\r\n\r\n  // Load local plugins\r\n  loadPlugins(GlobalPlugins)\r\n\r\n  // Get conf from server\r\n  const { data } = await ctx\r\n    .getApi()\r\n    .conf.conf()\r\n    .catch((err) => {\r\n      onLoadErr(ctx, err)\r\n      throw err\r\n    })\r\n\r\n  // Initial config\r\n  let conf: Partial<ArtalkConfig> = {\r\n    apiVersion: data.version?.version, // version info\r\n  }\r\n\r\n  // Reference conf from backend\r\n  if (ctx.conf.useBackendConf) {\r\n    if (!data.frontend_conf)\r\n      throw new Error(\r\n        'The remote backend does not respond to the frontend conf, but `useBackendConf` conf is enabled',\r\n      )\r\n    conf = { ...conf, ...handleConfFormServer(data.frontend_conf) }\r\n  }\r\n\r\n  // Apply conf modifier\r\n  ctx.conf.remoteConfModifier && ctx.conf.remoteConfModifier(conf)\r\n\r\n  // Dynamically load network plugins\r\n  conf.pluginURLs &&\r\n    (await loadNetworkPlugins(conf.pluginURLs, ctx.conf.server)\r\n      .then((plugins) => {\r\n        loadPlugins(plugins)\r\n      })\r\n      .catch((err) => {\r\n        console.error('Failed to load plugin', err)\r\n      }))\r\n\r\n  // After all plugins are loaded\r\n  ctx.trigger('created')\r\n\r\n  // Apply conf updating\r\n  ctx.updateConf(conf)\r\n\r\n  // Trigger mounted event\r\n  ctx.trigger('mounted')\r\n\r\n  // Load comment list\r\n  if (!ctx.conf.remoteConfModifier) {\r\n    // only auto fetch when no remoteConfModifier\r\n    ctx.fetch({ offset: 0 })\r\n  }\r\n}\r\n\r\n/**\r\n * Dynamically load plugins from Network\r\n */\r\nasync function loadNetworkPlugins(scripts: string[], apiBase: string): Promise<ArtalkPlugin[]> {\r\n  if (!scripts || !Array.isArray(scripts)) return []\r\n\r\n  const tasks: Promise<void>[] = []\r\n\r\n  scripts.forEach((url) => {\r\n    // check url valid\r\n    if (!/^(http|https):\\/\\//.test(url))\r\n      url = `${apiBase.replace(/\\/$/, '')}/${url.replace(/^\\//, '')}`\r\n\r\n    tasks.push(\r\n      new Promise<void>((resolve, reject) => {\r\n        // check if loaded\r\n        if (document.querySelector(`script[src=\"${url}\"]`)) {\r\n          resolve()\r\n          return\r\n        }\r\n\r\n        // load script\r\n        const script = document.createElement('script')\r\n        script.src = url\r\n        document.head.appendChild(script)\r\n        script.onload = () => resolve()\r\n        script.onerror = (err) => reject(err)\r\n      }),\r\n    )\r\n  })\r\n\r\n  await Promise.all(tasks)\r\n\r\n  return Object.values(window.ArtalkPlugins || {})\r\n}\r\n\r\nexport function onLoadErr(ctx: ContextApi, err: any) {\r\n  let sidebarOpenView = ''\r\n\r\n  // if response err_no_site, modify the sidebar open view to create site\r\n  if (err.data?.err_no_site) {\r\n    const viewLoadParam = {\r\n      create_name: ctx.conf.site,\r\n      create_urls: `${window.location.protocol}//${window.location.host}`,\r\n    }\r\n    sidebarOpenView = `sites|${JSON.stringify(viewLoadParam)}`\r\n  }\r\n\r\n  showErrorDialog({\r\n    $err: ctx.get('list').$el,\r\n    errMsg: err.msg || String(err),\r\n    errData: err.data,\r\n    retryFn: () => load(ctx),\r\n    onOpenSidebar: ctx.get('user').getData().isAdmin\r\n      ? () =>\r\n          ctx.showSidebar({\r\n            view: sidebarOpenView as any,\r\n          })\r\n      : undefined, // only show open sidebar button when user is admin\r\n  })\r\n}\r\n","import type { ArtalkPlugin } from '@/types'\r\nimport { Markdown } from './markdown'\r\nimport { EditorKit } from './editor-kit'\r\nimport { ListPlugins } from './list'\r\nimport { Notifies } from './notifies'\r\nimport { PvCountWidget } from './stat'\r\nimport { VersionCheck } from './version-check'\r\nimport { AdminOnlyElem } from './admin-only-elem'\r\nimport { DarkMode } from './dark-mode'\r\n\r\nexport const DefaultPlugins: ArtalkPlugin[] = [\r\n  Markdown,\r\n  EditorKit,\r\n  AdminOnlyElem,\r\n  ...ListPlugins,\r\n  Notifies,\r\n  PvCountWidget,\r\n  VersionCheck,\r\n  DarkMode,\r\n]\r\n","import type { ArtalkPlugin } from '@/types'\r\n\r\nexport const AdminOnlyElem: ArtalkPlugin = (ctx) => {\r\n  const scanApply = () => {\r\n    applyAdminOnlyEls(\r\n      ctx.get('user').getData().isAdmin,\r\n      getAdminOnlyEls({\r\n        $root: ctx.$root,\r\n      }),\r\n    )\r\n  }\r\n\r\n  ctx.on('list-loaded', () => {\r\n    scanApply()\r\n  })\r\n\r\n  ctx.on('user-changed', (user) => {\r\n    scanApply()\r\n  })\r\n}\r\n\r\nfunction getAdminOnlyEls(opts: { $root: HTMLElement }): HTMLElement[] {\r\n  const els: HTMLElement[] = []\r\n\r\n  // elements in $root\r\n  opts.$root\r\n    .querySelectorAll<HTMLElement>(`[atk-only-admin-show]`)\r\n    .forEach((item) => els.push(item))\r\n\r\n  // TODO: provide a Artalk.conf hook to set whitelist of admin-only elements,\r\n  // and move following code to that hook (move into @artalk/artalk-sidebar)\r\n\r\n  // elements in sidebar\r\n  const $sidebarEl = document.querySelector<HTMLElement>('.atk-sidebar')\r\n  if ($sidebarEl)\r\n    $sidebarEl\r\n      .querySelectorAll<HTMLElement>(`[atk-only-admin-show]`)\r\n      .forEach((item) => els.push(item))\r\n\r\n  return els\r\n}\r\n\r\nfunction applyAdminOnlyEls(isAdmin: boolean, els: HTMLElement[]) {\r\n  els.forEach(($item: HTMLElement) => {\r\n    if (isAdmin) $item.classList.remove('atk-hide')\r\n    else $item.classList.add('atk-hide')\r\n  })\r\n}\r\n","import type { ArtalkPlugin } from '@/types'\r\nimport { WithEditor } from './with-editor'\r\nimport { Unread } from './unread'\r\nimport { Count } from './count'\r\nimport { SidebarBtn } from './sidebar-btn'\r\nimport { UnreadBadge } from './unread-badge'\r\nimport { GotoDispatcher } from './goto-dispatcher'\r\nimport { GotoFocus } from './goto-focus'\r\nimport { Copyright } from './copyright'\r\nimport { NoComment } from './no-comment'\r\nimport { Dropdown } from './dropdown'\r\nimport { TimeTicking } from './time-ticking'\r\nimport { ErrorDialog } from './error-dialog'\r\nimport { Loading } from './loading'\r\nimport { Fetch } from './fetch'\r\nimport { ReachBottom } from './reach-bottom'\r\nimport { GotoFirst } from './goto-first'\r\n\r\nconst ListPlugins: ArtalkPlugin[] = [\r\n  Fetch,\r\n  Loading,\r\n  Unread,\r\n  WithEditor,\r\n  Count,\r\n  SidebarBtn,\r\n  UnreadBadge,\r\n  Dropdown,\r\n  GotoDispatcher,\r\n  GotoFocus,\r\n  NoComment,\r\n  Copyright,\r\n  TimeTicking,\r\n  ErrorDialog,\r\n  ReachBottom,\r\n  GotoFirst,\r\n]\r\n\r\nexport { ListPlugins }\r\n","import type { ListFetchParams, ArtalkPlugin } from '@/types'\r\n\r\nexport const Fetch: ArtalkPlugin = (ctx) => {\r\n  ctx.on('list-fetch', (_params) => {\r\n    if (ctx.getData().getLoading()) return\r\n    ctx.getData().setLoading(true)\r\n\r\n    const params: ListFetchParams = {\r\n      // default params\r\n      offset: 0,\r\n      limit: ctx.conf.pagination.pageSize,\r\n      flatMode: ctx.conf.flatMode as boolean, // always be boolean because had been handled in Artalk.init\r\n      paramsModifier: ctx.conf.listFetchParamsModifier,\r\n      ..._params,\r\n    }\r\n\r\n    // must before other function call\r\n    ctx.getData().setListLastFetch({\r\n      params,\r\n    })\r\n\r\n    // prepare params for request\r\n    const reqParams = {\r\n      limit: params.limit,\r\n      offset: params.offset,\r\n      flat_mode: params.flatMode,\r\n      page_key: ctx.getConf().pageKey,\r\n      site_name: ctx.getConf().site,\r\n    }\r\n\r\n    // call the modifier function\r\n    if (params.paramsModifier) params.paramsModifier(reqParams)\r\n\r\n    // start request\r\n    ctx\r\n      .getApi()\r\n      .comments.getComments({\r\n        ...reqParams,\r\n        ...ctx.getApi().getUserFields(),\r\n      })\r\n      .then(({ data }) => {\r\n        // Must before all other function call and event trigger,\r\n        // because it will depend on the lastData\r\n        // TODO: this is global variable, easy to use, but not good, consider to refactor.\r\n        // refactor work is hard, because it is used in many places.\r\n        ctx.getData().setListLastFetch({ params, data })\r\n\r\n        // 装置评论\r\n        ctx.getData().loadComments(data.comments)\r\n\r\n        // 更新页面数据\r\n        ctx.getData().updatePage(data.page)\r\n\r\n        // trigger events when success\r\n        params.onSuccess && params.onSuccess(data)\r\n\r\n        ctx.trigger('list-fetched', { params, data })\r\n      })\r\n      .catch((e) => {\r\n        // 显示错误对话框\r\n        const error = {\r\n          msg: e.msg || String(e),\r\n          data: e.data,\r\n        }\r\n\r\n        params.onError && params.onError(error)\r\n\r\n        // trigger events when error\r\n        ctx.trigger('list-failed', error)\r\n        ctx.trigger('list-fetched', { params, error })\r\n\r\n        throw e\r\n      })\r\n      .finally(() => {\r\n        ctx.getData().setLoading(false)\r\n      })\r\n  })\r\n}\r\n","import type { ArtalkPlugin } from '@/types'\r\nimport * as Ui from '@/lib/ui'\r\n\r\nexport const Loading: ArtalkPlugin = (ctx) => {\r\n  ctx.on('list-fetch', (p) => {\r\n    const list = ctx.get('list')\r\n\r\n    if (p.offset === 0)\r\n      // only show loading when fetch first page\r\n      Ui.setLoading(true, list.$el)\r\n    // else if not first page, show loading in paginator (code not there)\r\n  })\r\n\r\n  ctx.on('list-fetched', () => {\r\n    const list = ctx.get('list')\r\n    Ui.setLoading(false, list.$el)\r\n  })\r\n}\r\n","import type { ArtalkPlugin } from '@/types'\r\nimport * as Utils from '@/lib/utils'\r\n\r\nexport const Unread: ArtalkPlugin = (ctx) => {\r\n  ctx.on('comment-rendered', (comment) => {\r\n    // comment unread highlight\r\n    if (ctx.conf.listUnreadHighlight === true) {\r\n      const notifies = ctx.getData().getNotifies()\r\n      const notify = notifies.find((o) => o.comment_id === comment.getID())\r\n\r\n      if (notify) {\r\n        // if comment contains in unread list\r\n        comment.getRender().setUnread(true)\r\n        comment.getRender().setOpenAction(() => {\r\n          window.open(notify.read_link)\r\n\r\n          // remove notify which has been read\r\n          ctx.getData().updateNotifies(notifies.filter((o) => o.comment_id !== comment.getID()))\r\n        })\r\n      } else {\r\n        // comment not in unread list\r\n        comment.getRender().setUnread(false)\r\n      }\r\n    }\r\n  })\r\n\r\n  ctx.on('list-goto', (commentID) => {\r\n    const notifyKey = Utils.getQueryParam('atk_notify_key')\r\n    if (notifyKey) {\r\n      // mark as read\r\n      ctx\r\n        .getApi()\r\n        .notifies.markNotifyRead(commentID, notifyKey)\r\n        .then(() => {\r\n          // remove from unread list\r\n          ctx.getData().updateNotifies(\r\n            ctx\r\n              .getData()\r\n              .getNotifies()\r\n              .filter((o) => o.comment_id !== commentID),\r\n          )\r\n        })\r\n    }\r\n  })\r\n}\r\n","import type { ContextApi, ArtalkPlugin, PageData } from '@/types'\r\nimport $t from '@/i18n'\r\n\r\nexport const WithEditor: ArtalkPlugin = (ctx) => {\r\n  let $closeCommentBtn: HTMLElement | undefined\r\n\r\n  // on Artalk mounted\r\n  // (after all components had mounted)\r\n  ctx.on('mounted', () => {\r\n    const list = ctx.get('list')\r\n\r\n    $closeCommentBtn = list.$el.querySelector<HTMLElement>('[data-action=\"admin-close-comment\"]')!\r\n\r\n    // bind editor close button click event\r\n    $closeCommentBtn.addEventListener('click', () => {\r\n      const page = ctx.getData().getPage()\r\n      if (!page) throw new Error('Page data not found')\r\n\r\n      page.admin_only = !page.admin_only\r\n      adminPageEditSave(ctx, page)\r\n    })\r\n  })\r\n\r\n  // on comment list loaded (it will include page data update)\r\n  ctx.on('page-loaded', (page) => {\r\n    const editor = ctx.get('editor')\r\n\r\n    // if page comment is closed\r\n    if (page?.admin_only === true) {\r\n      // then close editor\r\n      editor.getPlugs()?.getEvents().trigger('editor-close')\r\n      $closeCommentBtn && ($closeCommentBtn.innerText = $t('openComment'))\r\n    } else {\r\n      // the open editor\r\n      editor.getPlugs()?.getEvents().trigger('editor-open')\r\n      $closeCommentBtn && ($closeCommentBtn.innerText = $t('closeComment'))\r\n    }\r\n  })\r\n\r\n  ctx.on('list-loaded', (comments) => {\r\n    // 防止评论框被吞\r\n    ctx.editorResetState()\r\n  })\r\n}\r\n\r\n/** 管理员设置页面信息 */\r\nfunction adminPageEditSave(ctx: ContextApi, page: PageData) {\r\n  ctx.editorShowLoading()\r\n  ctx\r\n    .getApi()\r\n    .pages.updatePage(page.id, page)\r\n    .then(({ data }) => {\r\n      ctx.getData().updatePage(data)\r\n    })\r\n    .catch((err) => {\r\n      ctx.editorShowNotify(`${$t('editFail')}: ${err.message || String(err)}`, 'e')\r\n    })\r\n    .finally(() => {\r\n      ctx.editorHideLoading()\r\n    })\r\n}\r\n","import type { ArtalkPlugin } from '@/types'\r\nimport * as Utils from '@/lib/utils'\r\nimport $t from '@/i18n'\r\n\r\nexport const Count: ArtalkPlugin = (ctx) => {\r\n  const refreshCountNumEl = () => {\r\n    const list = ctx.get('list')\r\n\r\n    const $count = list.$el.querySelector('.atk-comment-count .atk-text')\r\n    if (!$count) return\r\n\r\n    const text = Utils.htmlEncode(\r\n      $t('counter', {\r\n        count: `${Number(ctx.getData().getListLastFetch()?.data?.count) || 0}`,\r\n      }),\r\n    )\r\n    $count.innerHTML = text.replace(/(\\d+)/, '<span class=\"atk-comment-count-num\">$1</span>')\r\n  }\r\n\r\n  ctx.on('list-loaded', () => {\r\n    refreshCountNumEl()\r\n  })\r\n\r\n  ctx.on('comment-inserted', () => {\r\n    // 评论数增加 1\r\n    const last = ctx.getData().getListLastFetch()\r\n    if (last?.data) last.data.count += 1\r\n  })\r\n\r\n  ctx.on('comment-deleted', () => {\r\n    // 评论数减 1\r\n    const last = ctx.getData().getListLastFetch()\r\n    if (last?.data) last.data.count -= 1\r\n  })\r\n}\r\n","import type { ArtalkPlugin } from '@/types'\r\nimport $t from '@/i18n'\r\n\r\nexport const SidebarBtn: ArtalkPlugin = (ctx) => {\r\n  let $openSidebarBtn: HTMLElement | null = null\r\n\r\n  const syncByUser = () => {\r\n    if (!$openSidebarBtn) return\r\n    const user = ctx.get('user').getData()\r\n\r\n    // 已输入个人信息\r\n    if (!!user.nick && !!user.email) {\r\n      $openSidebarBtn.classList.remove('atk-hide')\r\n\r\n      // update button text (normal user or admin)\r\n      const $btnText = $openSidebarBtn.querySelector<HTMLElement>('.atk-text')\r\n      if ($btnText) $btnText.innerText = !user.isAdmin ? $t('msgCenter') : $t('ctrlCenter')\r\n    } else {\r\n      $openSidebarBtn.classList.add('atk-hide')\r\n    }\r\n  }\r\n\r\n  ctx.watchConf(['locale'], (conf) => {\r\n    const list = ctx.get('list')\r\n\r\n    $openSidebarBtn = list.$el.querySelector<HTMLElement>('[data-action=\"open-sidebar\"]')\r\n    if (!$openSidebarBtn) return\r\n\r\n    $openSidebarBtn.onclick = () => {\r\n      // use onclick rather than addEventListener to prevent duplicate event\r\n      ctx.showSidebar()\r\n    }\r\n\r\n    syncByUser()\r\n  })\r\n\r\n  ctx.on('user-changed', (user) => {\r\n    syncByUser()\r\n  })\r\n}\r\n","import type { ArtalkPlugin } from '@/types'\r\n\r\nexport const UnreadBadge: ArtalkPlugin = (ctx) => {\r\n  let $unreadBadge: HTMLElement | null = null\r\n\r\n  const showUnreadBadge = (count: number) => {\r\n    if (!$unreadBadge) return\r\n\r\n    if (count > 0) {\r\n      $unreadBadge.innerText = `${Number(count || 0)}`\r\n      $unreadBadge.style.display = 'block'\r\n    } else {\r\n      $unreadBadge.style.display = 'none'\r\n    }\r\n  }\r\n\r\n  ctx.on('mounted', () => {\r\n    const list = ctx.get('list')\r\n\r\n    $unreadBadge = list.$el.querySelector<HTMLElement>('.atk-unread-badge')\r\n  })\r\n\r\n  ctx.on('notifies-updated', (notifies) => {\r\n    showUnreadBadge(notifies.length || 0)\r\n  })\r\n}\r\n","import type { ArtalkPlugin } from '@/types'\r\nimport * as Utils from '@/lib/utils'\r\nimport $t from '@/i18n'\r\n\r\nexport const Dropdown: ArtalkPlugin = (ctx) => {\r\n  const reloadUseParamsEditor = (func: (p: any) => void) => {\r\n    ctx.conf.listFetchParamsModifier = func\r\n    ctx.reload()\r\n  }\r\n\r\n  const initDropdown = ($dropdownOn: HTMLElement) => {\r\n    renderDropdown({\r\n      $dropdownWrap: $dropdownOn,\r\n      dropdownList: [\r\n        [\r\n          $t('sortLatest'),\r\n          () => {\r\n            reloadUseParamsEditor((p) => {\r\n              p.sort_by = 'date_desc'\r\n            })\r\n          },\r\n        ],\r\n        [\r\n          $t('sortBest'),\r\n          () => {\r\n            reloadUseParamsEditor((p) => {\r\n              p.sort_by = 'vote'\r\n            })\r\n          },\r\n        ],\r\n        [\r\n          $t('sortOldest'),\r\n          () => {\r\n            reloadUseParamsEditor((p) => {\r\n              p.sort_by = 'date_asc'\r\n            })\r\n          },\r\n        ],\r\n        [\r\n          $t('sortAuthor'),\r\n          () => {\r\n            reloadUseParamsEditor((p) => {\r\n              p.view_only_admin = true\r\n            })\r\n          },\r\n        ],\r\n      ],\r\n    })\r\n  }\r\n\r\n  ctx.watchConf(['listSort', 'locale'], (conf) => {\r\n    const list = ctx.get('list')\r\n\r\n    const $count = list.$el.querySelector<HTMLElement>('.atk-comment-count')\r\n    if (!$count) return\r\n\r\n    // 评论列表排序 Dropdown 下拉选择层\r\n    if (conf.listSort) {\r\n      initDropdown($count)\r\n    } else {\r\n      removeDropdown({\r\n        $dropdownWrap: $count,\r\n      })\r\n    }\r\n  })\r\n}\r\n\r\n/** 评论排序方式选择下拉菜单 */\r\nfunction renderDropdown(conf: {\r\n  $dropdownWrap: HTMLElement\r\n  dropdownList: [string, () => void][]\r\n}) {\r\n  const { $dropdownWrap, dropdownList } = conf\r\n  if ($dropdownWrap.querySelector('.atk-dropdown')) return\r\n\r\n  // 修改 class\r\n  $dropdownWrap.classList.add('atk-dropdown-wrap')\r\n\r\n  // 插入图标\r\n  $dropdownWrap.append(Utils.createElement(`<span class=\"atk-arrow-down-icon\"></span>`))\r\n\r\n  // 列表项点击事件\r\n  let curtActive = 0 // 当前选中\r\n  const onItemClick = (i: number, $item: HTMLElement, name: string, action: Function) => {\r\n    action()\r\n\r\n    // set active\r\n    curtActive = i\r\n    $dropdown.querySelectorAll('.active').forEach((e) => {\r\n      e.classList.remove('active')\r\n    })\r\n    $item.classList.add('active')\r\n\r\n    // 关闭层 (临时消失，取消 :hover)\r\n    $dropdown.style.display = 'none'\r\n    setTimeout(() => {\r\n      $dropdown.style.display = ''\r\n    }, 80)\r\n  }\r\n\r\n  // 生成列表元素\r\n  const $dropdown = Utils.createElement(`<ul class=\"atk-dropdown atk-fade-in\"></ul>`)\r\n  dropdownList.forEach((item, i) => {\r\n    const name = item[0] as string\r\n    const action = item[1] as Function\r\n\r\n    const $item = Utils.createElement(`<li class=\"atk-dropdown-item\"><span></span></li>`)\r\n    const $link = $item.querySelector<HTMLElement>('span')!\r\n    $link.innerText = name\r\n    $link.onclick = () => {\r\n      onItemClick(i, $item, name, action)\r\n    }\r\n    $dropdown.append($item)\r\n\r\n    if (i === curtActive) $item.classList.add('active') // 默认选中项\r\n  })\r\n\r\n  $dropdownWrap.append($dropdown)\r\n}\r\n\r\n/** 删除评论排序方式选择下拉菜单 */\r\nfunction removeDropdown(conf: { $dropdownWrap: HTMLElement }) {\r\n  const { $dropdownWrap } = conf\r\n  $dropdownWrap.classList.remove('atk-dropdown-wrap')\r\n  $dropdownWrap.querySelector('.atk-arrow-down-icon')?.remove()\r\n  $dropdownWrap.querySelector('.atk-dropdown')?.remove()\r\n}\r\n","import type { ArtalkPlugin } from '@/types'\r\nimport * as Utils from '@/lib/utils'\r\n\r\nexport const GotoDispatcher: ArtalkPlugin = (ctx) => {\r\n  let lastID = 0\r\n  const check = ({ locker }: { locker: boolean }) => {\r\n    const commentID = extractCommentID()\r\n    if (!commentID) return\r\n\r\n    if (locker && lastID === commentID) return // if the commentID is the same as the last one, do nothing\r\n    lastID = commentID // record the last commentID\r\n\r\n    ctx.trigger('list-goto', commentID) // trigger event\r\n  }\r\n\r\n  const hashChangeHandler = () => check({ locker: false })\r\n  const listLoadedHandler = () => check({ locker: true })\r\n  ctx.on('mounted', () => {\r\n    window.addEventListener('hashchange', hashChangeHandler)\r\n    ctx.on('list-loaded', listLoadedHandler)\r\n  })\r\n  ctx.on('unmounted', () => {\r\n    window.removeEventListener('hashchange', hashChangeHandler)\r\n    ctx.off('list-loaded', listLoadedHandler)\r\n  })\r\n}\r\n\r\nfunction extractCommentID(): number | null {\r\n  // Try get from hash\r\n  // Hash retrieval priority is higher than query,\r\n  // Because click goto will change hash.\r\n  const match = window.location.hash.match(/#atk-comment-([0-9]+)/)\r\n  let commentId =\r\n    match && match[1] && !Number.isNaN(parseFloat(match[1])) ? parseFloat(match[1]) : null\r\n\r\n  // Fail over to get from query\r\n  if (!commentId) {\r\n    commentId = Number(Utils.getQueryParam('atk_comment')) // same as backend GetReplyLink()\r\n  }\r\n\r\n  return commentId || null\r\n}\r\n","import type { ArtalkPlugin } from '@/types'\r\nimport * as Utils from '@/lib/utils'\r\nimport { sanitize } from '@/lib/sanitizer'\r\n\r\nexport const NoComment: ArtalkPlugin = (ctx) => {\r\n  ctx.on('list-loaded', (comments) => {\r\n    const list = ctx.get('list')!\r\n\r\n    // 无评论\r\n    const isNoComment = comments.length <= 0\r\n    let $noComment = list.getCommentsWrapEl().querySelector<HTMLElement>('.atk-list-no-comment')\r\n\r\n    if (isNoComment) {\r\n      if (!$noComment) {\r\n        $noComment = Utils.createElement('<div class=\"atk-list-no-comment\"></div>')\r\n\r\n        // sanitize before set innerHTML\r\n        $noComment.innerHTML = sanitize(list.ctx.conf.noComment || list.ctx.$t('noComment'))\r\n        list.getCommentsWrapEl().appendChild($noComment)\r\n      }\r\n    } else {\r\n      $noComment?.remove()\r\n    }\r\n  })\r\n}\r\n","import type { ArtalkPlugin } from '@/types'\r\nimport { version as ARTALK_VERSION } from '~/package.json'\r\n\r\nexport const Copyright: ArtalkPlugin = (ctx) => {\r\n  ctx.on('mounted', () => {\r\n    const list = ctx.get('list')\r\n\r\n    const $copyright = list.$el.querySelector<HTMLElement>('.atk-copyright')\r\n    if (!$copyright) return\r\n\r\n    $copyright.innerHTML =\r\n      `Powered By <a href=\"https://artalk.js.org\" ` +\r\n      `target=\"_blank\" title=\"Artalk v${ARTALK_VERSION}\">` +\r\n      `Artalk</a>`\r\n  })\r\n}\r\n","import type { ArtalkPlugin } from '@/types'\r\nimport * as Utils from '@/lib/utils'\r\n\r\n/** 评论时间自动更新 */\r\nexport const TimeTicking: ArtalkPlugin = (ctx) => {\r\n  let timer: number | null = null\r\n\r\n  ctx.on('mounted', () => {\r\n    timer = window.setInterval(() => {\r\n      const list = ctx.get('list')\r\n\r\n      list.$el.querySelectorAll<HTMLElement>('[data-atk-comment-date]').forEach((el) => {\r\n        const date = el.getAttribute('data-atk-comment-date')\r\n        el.innerText = Utils.timeAgo(new Date(Number(date)), ctx.$t)\r\n      })\r\n    }, 30 * 1000) // 30s 更新一次\r\n  })\r\n\r\n  ctx.on('unmounted', () => {\r\n    timer && window.clearInterval(timer)\r\n  })\r\n}\r\n","import type { ArtalkPlugin, ContextApi } from '@/types'\r\nimport { showErrorDialog } from '@/components/error-dialog'\r\nimport * as Ui from '../../lib/ui'\r\n\r\nexport const ErrorDialog: ArtalkPlugin = (ctx) => {\r\n  ctx.on('list-fetch', () => {\r\n    const list = ctx.get('list')\r\n\r\n    // clear the original error when a new fetch is triggered\r\n    Ui.setError(list.$el, null)\r\n  })\r\n\r\n  ctx.on('list-failed', (err) => {\r\n    showErrorDialog({\r\n      $err: ctx.get('list').$el,\r\n      errMsg: err.msg,\r\n      errData: err.data,\r\n      retryFn: () => ctx.fetch({ offset: 0 }),\r\n    })\r\n  })\r\n}\r\n","import type { ArtalkPlugin } from '@/types'\r\n\r\nexport const ReachBottom: ArtalkPlugin = (ctx) => {\r\n  let observer: IntersectionObserver | null = null\r\n\r\n  const setupObserver = ($target: HTMLElement) => {\r\n    const scrollEvtAt = (ctx.conf.scrollRelativeTo && ctx.conf.scrollRelativeTo()) || null\r\n\r\n    // eslint-disable-next-line compat/compat\r\n    observer = new IntersectionObserver(\r\n      ([entries]) => {\r\n        if (entries.isIntersecting) {\r\n          clearObserver() // clear before trigger event to avoid trigger twice `list-reach-bottom`\r\n\r\n          // note that this event will be triggered only once\r\n          // until the next list is loaded\r\n          ctx.trigger('list-reach-bottom')\r\n        }\r\n      },\r\n      {\r\n        threshold: 0.9, // when the target is 90% visible\r\n\r\n        // @see https://developer.mozilla.org/en-US/docs/Web/API/IntersectionObserver/root\r\n        // If the root is null, then the bounds of the actual document viewport are used.\r\n        root: scrollEvtAt,\r\n      },\r\n    )\r\n    observer.observe($target)\r\n  }\r\n\r\n  const clearObserver = () => {\r\n    observer?.disconnect()\r\n    observer = null\r\n  }\r\n\r\n  ctx.on('list-loaded', () => {\r\n    clearObserver()\r\n\r\n    const list = ctx.get('list')\r\n\r\n    // get the second last child\r\n    const children = list.getCommentsWrapEl().childNodes\r\n    const $target = children.length > 2 ? (children[children.length - 2] as HTMLElement) : null\r\n    if (!$target) return\r\n\r\n    // check IntersectionObserver support\r\n    if (!('IntersectionObserver' in window)) {\r\n      console.warn('IntersectionObserver api not supported')\r\n      return\r\n    }\r\n\r\n    // use IntersectionObserver to detect reach bottom\r\n    setupObserver($target)\r\n  })\r\n\r\n  ctx.on('unmounted', () => {\r\n    clearObserver()\r\n  })\r\n}\r\n","import type { ArtalkPlugin } from '@/types'\r\nimport * as Utils from '@/lib/utils'\r\n\r\n/** List scroll to the first comment */\r\nexport const GotoFirst: ArtalkPlugin = (ctx) => {\r\n  const handler = () => {\r\n    const list = ctx.get('list')\r\n\r\n    const $relative = ctx.conf.scrollRelativeTo && ctx.conf.scrollRelativeTo()\r\n    ;($relative || window).scroll({\r\n      top: Utils.getOffset(list.$el, $relative).top,\r\n      left: 0,\r\n    })\r\n  }\r\n\r\n  ctx.on('mounted', () => {\r\n    ctx.on('list-goto-first', handler)\r\n  })\r\n\r\n  ctx.on('unmounted', () => {\r\n    ctx.off('list-goto-first', handler)\r\n  })\r\n}\r\n","import type { ArtalkPlugin } from '@/types'\r\n\r\nexport const Notifies: ArtalkPlugin = (ctx) => {\r\n  ctx.on('list-fetch', (params) => {\r\n    if (params.offset !== 0) return\r\n\r\n    const user = ctx.getApi().getUserFields()\r\n    if (!user) return\r\n\r\n    // Fetch all unread notifies\r\n    ctx\r\n      .getApi()\r\n      .notifies.getNotifies(user)\r\n      .then((res) => {\r\n        ctx.getData().updateNotifies(res.data.notifies)\r\n      })\r\n  })\r\n}\r\n","import './style/main.scss'\r\n\r\nimport type { ArtalkConfig, EventPayloadMap, ArtalkPlugin, ContextApi } from '@/types'\r\nimport type { EventHandler } from './lib/event-manager'\r\nimport Context from './context'\r\nimport { handelCustomConf, convertApiOptions } from './config'\r\nimport Services from './service'\r\nimport * as Stat from './plugins/stat'\r\nimport { Api } from './api'\r\nimport type { TInjectedServices } from './service'\r\nimport { GlobalPlugins, load } from './load'\r\n\r\n/**\r\n * Artalk\r\n *\r\n * @see https://artalk.js.org\r\n */\r\nexport default class Artalk {\r\n  public ctx!: ContextApi\r\n\r\n  constructor(conf: Partial<ArtalkConfig>) {\r\n    // Init Config\r\n    const handledConf = handelCustomConf(conf, true)\r\n\r\n    // Init Context\r\n    this.ctx = new Context(handledConf)\r\n\r\n    // Init Services\r\n    Object.entries(Services).forEach(([name, initService]) => {\r\n      const obj = initService(this.ctx)\r\n      obj && this.ctx.inject(name as keyof TInjectedServices, obj) // auto inject deps to ctx\r\n    })\r\n\r\n    if (import.meta.env.DEV && import.meta.env.VITEST) {\r\n      global.devLoadArtalk = () => load(this.ctx)\r\n    } else {\r\n      load(this.ctx)\r\n    }\r\n\r\n    // 表情包放大\r\n    this.ctx.showOwoBig(handledConf.el as Node)\r\n\r\n    // 图片加载失败处理\r\n    this.ctx.handleImageLoadFailure(handledConf.el as Node)\r\n\r\n    // 图片懒加载\r\n    this.ctx.lazyLoadImages(handledConf.el as Node)\r\n  }\r\n\r\n  /** Get the config of Artalk */\r\n  public getConf() {\r\n    return this.ctx.getConf()\r\n  }\r\n\r\n  /** Get the root element of Artalk */\r\n  public getEl() {\r\n    return this.ctx.$root\r\n  }\r\n\r\n  /** Update config of Artalk */\r\n  public update(conf: Partial<ArtalkConfig>) {\r\n    this.ctx.updateConf(conf)\r\n    return this\r\n  }\r\n\r\n  /** Reload comment list of Artalk */\r\n  public reload() {\r\n    this.ctx.reload()\r\n  }\r\n\r\n  /** Destroy instance of Artalk */\r\n  public destroy() {\r\n    this.ctx.trigger('unmounted')\r\n    while (this.ctx.$root.firstChild) {\r\n      this.ctx.$root.removeChild(this.ctx.$root.firstChild)\r\n    }\r\n  }\r\n\r\n  /** Add an event listener */\r\n  public on<K extends keyof EventPayloadMap>(name: K, handler: EventHandler<EventPayloadMap[K]>) {\r\n    this.ctx.on(name, handler)\r\n  }\r\n\r\n  /** Remove an event listener */\r\n  public off<K extends keyof EventPayloadMap>(name: K, handler: EventHandler<EventPayloadMap[K]>) {\r\n    this.ctx.off(name, handler)\r\n  }\r\n\r\n  /** Trigger an event */\r\n  public trigger<K extends keyof EventPayloadMap>(name: K, payload?: EventPayloadMap[K]) {\r\n    this.ctx.trigger(name, payload)\r\n  }\r\n\r\n  /** Set dark mode */\r\n  public setDarkMode(darkMode: boolean) {\r\n    this.ctx.setDarkMode(darkMode)\r\n  }\r\n\r\n  // ===========================\r\n  //       Static Members\r\n  // ===========================\r\n\r\n  /** Init Artalk */\r\n  public static init(conf: Partial<ArtalkConfig>): Artalk {\r\n    return new Artalk(conf)\r\n  }\r\n\r\n  /** Use plugin, the plugin will be used when Artalk.init */\r\n  public static use(plugin: ArtalkPlugin) {\r\n    if (GlobalPlugins.includes(plugin)) return\r\n    GlobalPlugins.push(plugin)\r\n  }\r\n\r\n  /** Load count widget */\r\n  public static loadCountWidget(c: Partial<ArtalkConfig>) {\r\n    const conf = handelCustomConf(c, true)\r\n\r\n    Stat.initCountWidget({\r\n      getApi: () => new Api(convertApiOptions(conf)),\r\n      siteName: conf.site,\r\n      countEl: conf.countEl,\r\n      pvEl: conf.pvEl,\r\n      pvAdd: false,\r\n    })\r\n  }\r\n\r\n  // ===========================\r\n  //         Deprecated\r\n  // ===========================\r\n\r\n  /** @deprecated Please use `getEl()` instead */\r\n  public get $root() {\r\n    return this.ctx.$root\r\n  }\r\n\r\n  /** @description Please use `getConf()` instead */\r\n  public get conf() {\r\n    return this.ctx.getConf()\r\n  }\r\n}\r\n","import Artalk from './artalk'\r\nimport type * as ArtalkType from './types'\r\n\r\nexport type * from './types'\r\nexport { ArtalkType }\r\n\r\nexport default Artalk\r\n\r\n// Expose the static methods from the Artalk class\r\n// because direct export of static methods is not supported\r\n// for adapting to different environments like CommonJS and browser IIFE\r\n// for example, we can use `Artalk.init()` rather than `Artalk.default.init()`\r\n// therefore, we need to manually expose the static methods in the Artalk class.\r\nexport const init = Artalk.init\r\nexport const use = Artalk.use\r\nexport const loadCountWidget = Artalk.loadCountWidget\r\n"],"names":["HttpClient","constructor","apiConfig","__publicField","this","Map","fetchParams","fetch","credentials","headers","redirect","referrerPolicy","data","securityData","input","JSON","stringify","Object","keys","reduce","formData","key","property","append","Blob","FormData","toQueryString","cancelToken","abortControllers","has","abortController","get","signal","AbortController","set","abort","delete","_a","__async","_b","body","secure","path","type","query","format","baseUrl","params","__objRest","secureParams","baseApiParams","securityWorker","requestParams","mergeRequestParams","queryString","payloadFormatter","contentFormatters","responseFormat","customFetch","__spreadProps","__spreadValues","createAbortSignal","then","response","r","error","ok","catch","e","assign","encodeQueryParam","value","encodeURIComponent","addQueryParam","addArrayQueryParam","map","v","join","rawQuery","filter","Array","isArray","addQueryParams","params1","params2","super","arguments","flushCache","request","method","warmUpCache","getCaptcha","getCaptchaStatus","verifyCaptcha","getComments","createComment","comment","getComment","id","updateComment","deleteComment","conf","getDomain","getNotifies","markAllNotifyRead","options","markNotifyRead","commentId","notifyKey","getPages","fetchAllPages","getPageFetchStatus","logPv","page","updatePage","deletePage","fetchPage","sendEmail","email","getSettings","applySettings","settings","getSettingsTemplate","locale","getSites","createSite","site","updateSite","deleteSite","getStats","exportArtrans","importArtrans","uploadArtrans","upload","getUser","login","user","getUserStatus","createUser","updateUser","deleteUser","getUsers","getVersion","syncVotes","vote","targetId","_arrayLikeToArray","a","length","n","_assertThisInitialized","ReferenceError","_callSuper","t","o","_getPrototypeOf","_possibleConstructorReturn","_isNativeReflectConstruct","Reflect","construct","apply","_classCallCheck","TypeError","_defineProperties","enumerable","configurable","writable","defineProperty","_toPropertyKey","_createClass","prototype","_createForOfIteratorHelper","Symbol","iterator","_unsupportedIterableToArray","F","s","done","f","u","call","next","return","_get","bind","p","_superPropBase","getOwnPropertyDescriptor","setPrototypeOf","getPrototypeOf","__proto__","_inherits","create","_setPrototypeOf","Boolean","valueOf","hasOwnProperty","_superPropGet","_toPrimitive","toPrimitive","i","String","Number","toString","slice","name","from","test","createAbortEvent","reason","event","Event","document","createEvent","initEvent","createEventObject","bubbles","cancelable","normalizeAbortReason","Error","DOMException","err","self","global","AbortSignal","Emitter","callback","listeners","push","stack","l","splice","_this","stackToCall","_loop","listener","Promise","resolve","once","removeEventListener","defaultPrevented","_Emitter","_this2","aborted","onabort","_this$reason","time","controller","setTimeout","concat","iterable","clean","_step","_iterator","_step2","_iterator2","addEventListener","signalReason","dispatchEvent","polyfillNeeded","__FORCE_INSTALL_ABORTCONTROLLER_POLYFILL","console","log","Request","abortableFetchDecorator","patchTargets","_patchTargets","_patchTargets$Request","NativeRequest","NativeAbortController","_patchTargets$__FORCE","init","realFetch","isPrototypeOf","abortError","reject","cancellation","_","race","toStringTag","_abortableFetch","warn","Fetch","opts","apiToken","getApiToken","Headers","Authorization","resp","json","retry","handlers","promise","item","action","handler","code","FetchException","message","msg","createError","status","Api","ApiV2","baseURL","_opts","getUserFields","userInfo","_getDefaults","async","breaks","extensions","gfm","hooks","pedantic","renderer","silent","tokenizer","walkTokens","_defaults","changeDefaults","newDefaults","escapeTest","escapeReplace","RegExp","source","escapeTestNoEncode","escapeReplaceNoEncode","escapeReplacements","getEscapeReplacement","ch","escape$1","html","encode","replace","unescapeTest","caret","edit","regex","opt","obj","val","valSource","getRegex","cleanUrl","href","encodeURI","noopTest","exec","splitCells","tableRow","count","cells","match","offset","str","escaped","curr","split","trim","shift","pop","rtrim","c","invert","suffLen","currChar","charAt","outputLink","cap","link","raw","lexer","title","text","state","inLink","token","tokens","inlineTokens","_Tokenizer","space","src","rules","block","newline","codeBlockStyle","fences","matchIndentToCode","indentToCode","node","matchIndentInNode","indentInNode","indentCodeCompensation","lang","inline","anyPunctuation","heading","trimmed","depth","hr","blockquote","top","blockTokens","list","bull","isordered","ordered","start","loose","items","itemRegex","itemContents","endsWithBlankLine","endEarly","substring","line","repeat","nextLine","indent","trimStart","search","blankLine","nextBulletRegex","Math","min","hrRegex","fencesBeginRegex","headingBeginRegex","rawLine","ischecked","istask","task","checked","trimEnd","spacers","hasMultipleLineBreaks","some","pre","def","tag","toLowerCase","table","aligns","rows","header","align","row","cell","lheading","paragraph","escape","inRawBlock","trimmedUrl","rtrimSlash","lastParenIndex","b","indexOf","level","findClosingBracket","linkLen","reflink","links","nolink","emStrong","maskedSrc","prevChar","emStrongLDelim","punctuation","lLength","rDelim","rLength","delimTotal","midDelimTotal","endReg","emStrongRDelimAst","emStrongRDelimUnd","lastIndex","lastCharLength","index","codespan","hasNonSpaceChars","hasSpaceCharsOnBothEnds","br","del","autolink","url","prevCapZero","_backpedal","inlineText","bullet","_paragraph","_blockLabel","_tag","_comment","blockNormal","gfmTable","blockGfm","blockPedantic","_punctuation","_inlineComment","_inlineLabel","inlineNormal","blockSkip","reflinkSearch","inlinePedantic","inlineGfm","inlineBreaks","normal","_Lexer","inlineQueue","lex","lexInline","lastToken","cutSrc","lastParagraphClipped","leading","tabs","extTokenizer","startBlock","startIndex","Infinity","tempSrc","tempStart","forEach","getStartIndex","errMsg","charCodeAt","keepPrevChar","includes","lastIndexOf","startInline","_Renderer","infostring","quote","listitem","checkbox","tablerow","content","tablecell","flags","strong","em","cleanHref","out","image","_TextRenderer","_Parser","textRenderer","parse","parser","parseInline","renderers","genericToken","ret","headingToken","fromCharCode","parseInt","codeToken","tableToken","j","k","blockquoteToken","listToken","itemBody","unshift","htmlToken","paragraphToken","textToken","escapeToken","tagToken","linkToken","imageToken","strongToken","emToken","codespanToken","delToken","_Hooks","preprocess","markdown","postprocess","processAllTokens","Set","_parseMarkdown","WeakSet","parseMarkdown_fn","origOpt","defaults","throwError","__privateMethod","_onError","onError_fn","all","markedInstance","args","__privateAdd","setOptions","use","values","childTokens","flat","pack","ext","prevRenderer","extLevel","prop","rendererProp","rendererFunc","tokenizerProp","tokenizerFunc","prevTokenizer","hooksProp","hooksFunc","prevHook","passThroughHooks","arg","packWalktokens","marked","getDefaults","marked$1","Parser","Renderer","TextRenderer","Lexer","Tokenizer","Hooks","escapes","unescapes","rescaped","runescaped","escapeHtmlChar","unescapeHtmlChar","escapeHtml","unescapeHtml","she","decode","unescape","version","assignment_1","assignment","result","lowercase","string","asKey","accumulator","toMap_1","attributes","uris","require$$0","elements","voids","he","require$$1","require$$3","rstart","rend","rattrs","rtag","rtagend","require$$2","chars","lastItem","createStack","last","parsePart","substr","parseEdge","parseEndTag","parseStartTag","same","tagName","rest","unary","attrs","low","doubleQuotedValue","singleQuotedValue","unquotedValue","pos","end","sanitizer","buffer","context","ignoring","ignore","allowedTags","classesOk","allowedClasses","attrsOk","allowedAttributes","lkey","className","colon","questionmark","hash","allowedSchemes","matches","scheme","testUrl","unignore","transformText","reset","iframe","img","insane","strict","configuration","insaneOptions","span","reg","class","style","sanitize","exports","createCommonjsModule","fn","module","index$1","defaultColors","toComment","cm","ref","colors","cache","re","m","word","color","factory","renderCode","hanabi","getRenderer","libMarked","markedLinkRenderer","markedCodeRenderer","orgLinkRenderer","localLink","startsWith","window","location","protocol","hostname","realLang","colorized","hljs","getLanguage","highlight","instance","replacers","markedOptions","getInstance","markedContent","alt","imgSrc","simpleMarked","dest","tempDiv","createElement","innerHTML","querySelectorAll","hasAttribute","setAttribute","getAttribute","removeAttribute","replacer","mergeDeep","objects","isObject","prev","pVal","oVal","DataManager","events","getLoading","loading","setLoading","getListLastFetch","listLastFetch","setListLastFetch","comments","fetchComments","trigger","findComment","find","clearComments","loadComments","partialComments","insertComment","notifies","updateNotifies","getPage","pageData","en","placeholder","noComment","send","save","nick","emoticon","preview","refresh","uploadImage","uploadFail","commentFail","restoredMsg","onlyAdminCanReply","uploadLoginMsg","counter","sortLatest","sortOldest","sortBest","sortAuthor","openComment","closeComment","listLoadFailMsg","listRetry","loadMore","admin","reply","voteUp","voteDown","voteFail","readMore","actionConfirm","collapse","collapsed","collapsedMsg","expand","approved","pending","pendingMsg","editCancel","deleteConfirm","pin","unpin","seconds","minutes","hours","days","now","adminCheck","captchaCheck","confirm","cancel","msgCenter","ctrlCenter","emailVerified","frontend","backend","loadFail","editing","editFail","deleting","deleteFail","reqGot","reqAborted","updateMsg","currentVersion","open","openName","GLOBAL_LOCALES_KEY","htmlStr","div","firstElementChild","htmlEncode","temp","innerText","getQueryParam","decodeURIComponent","getOffset","el","relativeTo","getOffsetRecursive","element","rect","getBoundingClientRect","scrollLeft","pageXOffset","documentElement","scrollTop","pageYOffset","left","elOffset","relativeToOffset","padWithZeros","vNumber","width","numAsString","timeAgo","date","$t","oldTime","getTime","diffValue","Date","floor","leave1","leave2","leave3","round","vDay","getDate","vMonth","getMonth","getFullYear","dateFormat","getCorrectUserAgent","uaRaw","navigator","userAgent","userAgentData","getHighEntropyValues","uaData","uaGot","majorPlatformVersion","platformVersion","platform","isValidURL","urlRaw","URL","getURLBasedOnApi","base","internal","findLocaleSet","p1","p2","toUpperCase","LocaleConf","LocaleDict","setLocale","Utils.htmlEncode","EventManager","on","off","evt","payload","pageKey","pageTitle","server","sendBtn","darkMode","editorTravel","flatMode","nestMax","nestSort","emoticons","uaBadge","listSort","countEl","pvEl","gravatar","mirror","pagination","pageSize","autoLoad","heightLimit","children","scrollable","imgUpload","reqTimeout","versionCheck","useBackendConf","handelCustomConf","customConf","full","Defaults","findEl","querySelector","pathname","language","matchMedia","convertApiOptions","ctx","siteName","timeout","getData","checkHasBasicUserInfo","getApiHandlers","watchConf","effect","lastVal","newVal","getConf","res","Context","getCommentNodes","$root","classList","add","mounted","inject","depName","getApi","apiHandlers","h","createApiHandlers","checkCaptcha","checkAdmin","createNewApiHandlers","replyComment","commentData","$comment","editor","setReply","editComment","setEditComment","reload","listGotoFirst","editorShowLoading","showLoading","editorHideLoading","hideLoading","editorShowNotify","showNotify","editorResetState","resetState","showSidebar","sidebarLayer","show","hideSidebar","hide","checkerLauncher","I18n.t","setDarkMode","updateConf","owoShow","remove","nConf","getEl","getMarked","marked.getInstance","showOwoBig","target","maxLength","appendChild","MutationObserver","mutations","mutation","addedNodes","contains","_c","_d","shouldEnlarge","owoTime","flag","imgElement","clientHeight","clientWidth","naturalHeight","naturalWidth","tempWidth","tempHeight","zoomHeight","zoomWidth","height","aspectRatio","calculateSize","bodyElement","clientY","offsetY","clientX","offsetX","max","calculatePosition","adjustedTempHeight","cssText","display","clearTimeout","setupHoverEffects","observe","subtree","childList","handleImageLoadFailure","elem","parent","parentElement","replaceWith","lazyLoadImages","loadImg","dataSrc","onload","wrapImgWithSpinner","wrapper","parentNode","insertBefore","lazyLoadHandler","HTMLElement","innerHeight","bottom","ioObserver","IntersectionObserver","entries","observer","entry","isIntersecting","unobserve","Dialog","contentEl","$el","Utils.createElement","$actions","$content","setYes","btn","onclick","onBtnClick","setNo","currentTarget","parentElem","$loading","transparentBg","background","$spinner","isConnected","scrollIntoView","enableAnim","containerRect","scrollY","scrollOptions","behavior","scroll","playFadeInAnim","after","onAnimEnded","playFadeAnim","setError","errorTextEl","iframeBody","checker","$iframeWrap","$iframe","Ui.showLoading","getOpts","getCaptchaIframeURL","Ui.hideLoading","$closeBtn","hideInteractInput","stop","queryStatus","ms","isPass","captcha","is_pass","triggerSuccess","CaptchaChecker","inputVal","render.iframeBody","imgEl","img_data","render.imgBody","onSuccess","formEl","onError","click","AdminChecker","inputType","password","update","isAdmin","onReload","wrapPromise","cancelFn","onCancel","successFn","CheckerLauncher","fire","postFire","layer","getCtx","close","destroy","checkerStore","checkerCtx","$input","btnTextOrg","focus","onkeyup","keyCode","preventDefault","dialog","btnEl","btnTextRestore","btnText","tf","onfocus","onMount","Component","Sel","$header","$nick","$email","$link","$textareaWrap","$textarea","$bottom","$submitBtn","$notifyWrap","$plugBtnWrap","$plugPanelWrap","EditorPlug","kit","useBtn","htmlDecoded","Utils.htmlDecode","$btn","usePanel","$panel","useContentTransformer","func","contentTransformer","usePanelShow","useEvents","aPlug","usePanelHide","useEditorStateEffect","stateName","effectFn","editorStateEffectWhen","editorStateEffect","Mover","move","afterEl","isMoved","editorEl","useUI","$travelPlace","back","useGlobalCtx","EditorStateManager","stateCurt","stateUnmountFn","getPlugs","moveAfterEl","$relative","scrollRelativeTo","Ui.scrollIntoView","getUI","plugin","_e","Editor","ui","sel","render","getState","getHeaderInputEls","getContentFinal","getContentRaw","plugs","getTransformedContent","getContentMarked","setContent","getEvents","insertContent","owoBig","selection","createRange","selectionStart","sStart","sEnd","selectionEnd","sT","switch","wrapElem","notifyElem","w","notifyRemove","timeoutFn","Ui.showNotify","submit","beforeSubmit","SidebarLayer","refreshOnShow","transform","initLayer","createIframe","view","iFrameSrc","iframeLoad","authCheck","animTimer","is_admin","is_login","setOnAfterHide","Utils.getURLBasedOnApi","urlParams","URLSearchParams","createNestStrategy","import","srcData","sortBy","nodeList","rid","root","rootNode","loadChildren","child","childNode","sortFunc","vote_up","sortLevels","nodes","sort","ListNest.makeNestCommentNodeList","nestSortBy","rootC","createCommentNode","$commentsWrap","getRender","parentC","replyD","childD","childC","putChild","checkHeightLimit","insert","prepend","findCommentNode","getParents","heightLimitRemoveForChildren","insertMode","is_collapsed","is_allow_reply","visible","$listCommentsWrap","ListLayout","getStrategy","check","maxHeight","imgContains","_apply","HEIGHT_LIMIT_SCROLL_CSS","applyScrollableHeightLimit","HEIGHT_LIMIT_CSS","overflow","$expandBtn","stopPropagation","disposeHeightLimit","postBtnClick","applyHeightLimit","postExpandBtnClick","_check","parseFloat","getComputedStyle","Utils.getHeight","$container","images","getElementsByTagName","loaded","complete","onImagesLoaded","renderNick","$headerNick","$nickA","Utils.isValidURL","renderVerifyBadge","$headerBadgeWrap","badgeText","badge_name","badgeColor","badge_color","$badge","backgroundColor","is_verified","$verifiedBadge","is_pinned","$pinnedBadge","renderDate","$date","getDateFormatted","renderUABadge","ip_region","$uaWrap","$regionBadge","browser","os","getUserUA","$uaBrowser","$usOS","ActionBtn","getText","adminOnly","isMessaging","msgRecTimer","appendTo","dom","setClick","isLoading","confirmRestore","isConfirming","confirmText","confirmRecTimer","fireMsgRecTimer","clearMsgRecTimer","updateText","loadingText","setMsg","setWarn","setSuccess","duringTime","setMsgRecTimer","msgRecTimerFunc","renderVote","voteBtnUp","$actionNormal","getActions","voteBtnDown","vote_down","renderReply","replyBtn","renderCollapse","collapseBtn","adminEdit","renderModerator","pendingBtn","is_pending","renderPin","pinnedBtn","renderEdit","editBtn","renderDel","delBtn","adminDelete","Renders","Avatar","$avatar","$avatarImg","avatarURLBuilder","getGravatarURL","$avatarA","Header","Content","collapsedInfoEl","$body","insertAdjacentElement","contentShowBtn","Ui.playFadeInAnim","ReplyAt","replyTo","$replyAt","goToReplyComment","ReplyTo","$replyTo","replyContent","Pending","pendingEl","Actions","Render","$main","$childrenWrap","contentMaxH","childrenMaxH","HeightLimit.check","getChildren","HeightLimit.disposeHeightLimit","playFadeAnimForBody","playFlashAnim","getChildrenWrap","setUnread","setOpenable","setOpenURL","setOpenAction","CommentActions","actionBtn","votes","up","down","btnElem","modify","setData","onDelete","origHash","modifyHash","CommentNode","nestCurt","actionInstance","renderInstance","CommentUI","newEl","onAfterRender","getParent","getNestCurt","getIsRoot","getID","getChildrenWrapEl","$childComment","flattenParents","emailMD5","email_encrypted","Utils.timeAgo","info","win","nav","osVersion","engine","device","engineMatch","Trident","Presto","WebKit","Gecko","browserMatch","Safari","Chrome","IE","Edge","Firefox","Chromium","Opera","Vivaldi","Yandex","Kindle","UC","QQBrowser","QQ","Baidu","Maxthon","Sogou","LBBROWSER","TheWorld","MIUI","Quark","Qiyu","Wechat","Taobao","Alipay","Weibo","Douban","Suning","iQiYi","osMatch","Windows","Linux","macOS","Android","Ubuntu","FreeBSD","Debian","BlackBerry","MeeGo","Symbian","iOS","WebOS","deviceMatch","Mobile","Tablet","showModalDialog","chrome","arr","browserLanguage","UADetect","ua","ReadMoreBtn","origText","$text","hasMore","total","onClick","checkDisabled","showErr","ReadMorePaginator","readMoreAutoLoad","onReachedBottom","getHasMore","getIsClearComments","dispose","Pagination","oninput","onkeydown","keydown","$prevBtn","$nextBtn","maxPage","ceil","setInput","inputTimer","isNaN","change","onChange","which","UpDownPaginator","PaginationComponent","getPageDataByLastData","roots_count","initListPaginatorFunc","paginator","createPaginatorByConf","$paginator","List","initCrudEvents","getCommentsWrapEl","commentNodes","getListLayout","forceFlatMode","d","bodyOrgOverflow","bodyOrgPaddingRight","getScrollbarHelper","paddingRight","unlock","lock","barPaddingRight","getPropertyValue","inner","outer","position","visibility","w1","offsetWidth","w2","removeChild","Ui.getScrollBarWidth","Layer","onAfterHide","setAllowMaskClose","allow","allowMaskClose","getAllowMaskClose","onShow","onHide","LayerWrap","$wrap","$mask","createItem","createItemElement","hideWrap","showWrap","getMask","getWrap","backdropFilter","LayerManager","wrap","LOCAL_USER_KEY","User","localUser","localStorage","getItem","setItem","onUserChanged","logout","services","i18n","I18n.setLocale","layerManager","editorPlugs","initCountWidget","refreshStatCount","numEl","initialData","pvAdd","pages","page_key","page_title","site_name","pv","queryPageKeys","stats","page_keys","defaultCount","selector","applyCountData","showErrorDialog","errEl","retryFn","$retryBtn","onOpenSidebar","$openSidebar","$err","LocalStorageKey","SubmitAddPreset","reqAdd","useApi","getSubmitAddParams","useUser","useConf","useEditor","Utils.getCorrectUserAgent","postSubmitAdd","commentNew","Submit","defaultPreset","onEditorSubmit","do","useMounted","useUnmounted","registerCustom","customs","custom","activeCond","nComment","req","post","Emoticons","transEmoticonImageText","loadEmoticonsData","isImgLoaded","initEmoticonsList","changeListHeight","isListLoaded","loadingTask","handleData","Ui.setError","pushGrp","grp","remoteLoad","grpData","isOwOFormat","convertOwO","solveNullKey","solveSameKey","tmp","container","owoData","grpName","nGrp","iconStr","icon","notitle","$grpWrap","$grp","$item","dataset","$grpSwitcher","openGrp","eleAlt","imgTag","AllowImgExts","Upload","initDragImg","$imgUploadInput","accept","onchange","files","file","uploadImg","uploadFromFileList","onDragover","onDrop","dataTransfer","onPaste","clipboardData","fileExt","insertPrefix","uploadPlaceholderTxt","customUploaderFn","imgUploader","public_url","imgURL","Preview","isPlugPanelShow","updateContent","EDITOR_PLUGS","onContentUpdated","localContent","$inputs","inputEventFns","changeEventFns","field","timer","abortFn","onInput","fetchUserInfo","api","CANCEL_TOKEN","abortRequest","onUserInfoFetched","finally","onLinkChange","onLinkInputChange","onKeydown","adaptiveHeightByContent","diff","offsetHeight","scrollHeight","cancelReply","submitPlug","useDeps","page_url","$sendReply","cancelEdit","saveData","$editCancelBtn","updateSubmitBtnText","restoreSubmitBtnText","originalSubmitBtnText","onOpen","onClose","commentClosed","borderRadius","PlugKit","plug","PlugManager","confLoaded","clear","confRefs","getEnabledPlugs","Plug","loadPluginUI","closePlugPanel","openedPlug","loadPluginItem","openPlugPanel","plugPanel","rawContent","IgnoreVersionCheck","darkModeMedia","updateClassnames","$els","DarkModeClassName","GlobalPlugins","markedReplacers","scanApply","els","$sidebarEl","getAdminOnlyEls","_params","limit","paramsModifier","listFetchParamsModifier","reqParams","flat_mode","listUnreadHighlight","notify","comment_id","read_link","commentID","Utils.getQueryParam","$closeCommentBtn","admin_only","adminPageEditSave","$count","$openSidebarBtn","syncByUser","$btnText","$unreadBadge","reloadUseParamsEditor","initDropdown","$dropdownOn","$dropdownWrap","dropdownList","curtActive","onItemClick","$dropdown","renderDropdown","sort_by","view_only_admin","removeDropdown","lastID","locker","extractCommentID","hashChangeHandler","listLoadedHandler","reply_comment","isNoComment","$noComment","$copyright","ARTALK_VERSION","setInterval","clearInterval","errData","clearObserver","disconnect","childNodes","$target","scrollEvtAt","threshold","setupObserver","Utils.getOffset","apiVersion","feVer","beVer","comp","pa","pb","na","nb","Utils.versionCompare","ignoreBtn","darkModeAutoHandler","sync","load","loadedPlugins","loadPlugins","plugins","sidebarOpenView","err_no_site","viewLoadParam","create_name","create_urls","host","onLoadErr","frontend_conf","DisabledKeys","handleConfFormServer","remoteConfModifier","pluginURLs","scripts","apiBase","tasks","script","head","onerror","ArtalkPlugins","loadNetworkPlugins","Artalk","handledConf","Services","initService","firstChild","loadCountWidget"],"mappings":"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","x_google_ignoreList":[1,4,5,6,7,8,9,10,11,12,13,14,16]}